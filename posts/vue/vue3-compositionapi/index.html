<!doctype html><html lang=zh-cn dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Vue3 CompositionAPI | 隶笔难书</title>
<meta name=keywords content="Vue3"><meta name=description content="Options API的弊端


在Vue2中，我们编写组件的方式是Options API：

Options API的一大特点就是在对应的属性中编写对应的功能模块；
比如data定义数据、methods中定义方法、computed中定义计算属性、watch中监听属性改变，也包括生命 周期钩子；



但是这种代码有一个很大的弊端："><meta name=author content><link rel=canonical href=https://waite.wang/posts/vue/vue3-compositionapi/><link crossorigin=anonymous href=/assets/css/stylesheet.3d97af64455e262976bc8963ce1a2382d14e8c2788745b1deedf23a8e2ebd65c.css integrity="sha256-PZevZEVeJil2vIljzhojgtFOjCeIdFsd7t8jqOLr1lw=" rel="preload stylesheet" as=style><link rel=icon href=https://waite.wang/images/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://waite.wang/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://waite.wang/favicon-32x32.png><link rel=apple-touch-icon href=https://waite.wang/apple-touch-icon.png><link rel=mask-icon href=https://waite.wang/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh-cn href=https://waite.wang/posts/vue/vue3-compositionapi/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://waite.wang/posts/vue/vue3-compositionapi/"><meta property="og:site_name" content="隶笔难书"><meta property="og:title" content="Vue3 CompositionAPI"><meta property="og:description" content="Options API的弊端 在Vue2中，我们编写组件的方式是Options API：
Options API的一大特点就是在对应的属性中编写对应的功能模块； 比如data定义数据、methods中定义方法、computed中定义计算属性、watch中监听属性改变，也包括生命 周期钩子； 但是这种代码有一个很大的弊端："><meta property="og:locale" content="zh-cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-12-29T16:04:23+08:00"><meta property="article:modified_time" content="2023-12-29T16:04:23+08:00"><meta property="article:tag" content="Vue3"><meta name=twitter:card content="summary"><meta name=twitter:title content="Vue3 CompositionAPI"><meta name=twitter:description content="Options API的弊端


在Vue2中，我们编写组件的方式是Options API：

Options API的一大特点就是在对应的属性中编写对应的功能模块；
比如data定义数据、methods中定义方法、computed中定义计算属性、watch中监听属性改变，也包括生命 周期钩子；



但是这种代码有一个很大的弊端："><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://waite.wang/posts/"},{"@type":"ListItem","position":2,"name":"Vue3 CompositionAPI","item":"https://waite.wang/posts/vue/vue3-compositionapi/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Vue3 CompositionAPI","name":"Vue3 CompositionAPI","description":"Options API的弊端 在Vue2中，我们编写组件的方式是Options API：\nOptions API的一大特点就是在对应的属性中编写对应的功能模块； 比如data定义数据、methods中定义方法、computed中定义计算属性、watch中监听属性改变，也包括生命 周期钩子； 但是这种代码有一个很大的弊端：\n","keywords":["Vue3"],"articleBody":"Options API的弊端 在Vue2中，我们编写组件的方式是Options API：\nOptions API的一大特点就是在对应的属性中编写对应的功能模块； 比如data定义数据、methods中定义方法、computed中定义计算属性、watch中监听属性改变，也包括生命 周期钩子； 但是这种代码有一个很大的弊端：\n当我们实现某一个功能时，这个功能对应的代码逻辑会被拆分到各个属性中； 当我们组件变得更大、更复杂时，逻辑关注点的列表就会增长，那么同一个功能的逻辑就会被拆分的很分散； 尤其对于那些一开始没有编写这些组件的人来说，这个组件的代码是难以阅读和理解的（阅读组件的其他人）； 下面我们来看一个非常大的组件，其中的逻辑功能按照颜色进行了划分：\n这种碎片化的代码使用理解和维护这个复杂的组件变得异常困难，并且隐藏了潜在的逻辑问题； 并且当我们处理单个逻辑关注点时，需要不断的跳到相应的代码块中； 如果我们能将同一个逻辑关注 点相关的代码收集在一起会更 好。 这就是Composition API想 要做的事情，以及可以帮助我 们完成的事情。 也有人把Vue Composition API简称为VCA。 我们无需再为了一个逻辑关注点在不同的选项块间来回滚动切换。此外，我们现在可以很轻松地将这一组代码移动到一个外部文件中，不再需要为了抽象而重新组织代码，大大降低了重构成本，这在长期维护的大型项目中非常关键。 认识 组合式 API (Composition API) https://cn.vuejs.org/guide/extras/composition-api-faq.html#what-is-composition-api\n组合式 API (Composition API) 是一系列 API 的集合，使我们可以使用函数而不是声明选项的方式书写 Vue 组件。它是一个概括性的术语，涵盖了以下方面的 API：\n响应式 API：例如 ref() 和 reactive()，使我们可以直接创建响应式状态、计算属性和侦听器。 生命周期钩子：例如 onMounted() 和 onUnmounted()，使我们可以在组件各个生命周期阶段添加逻辑。 依赖注入：例如 provide() 和 inject()，使我们可以在使用响应式 API 时，利用 Vue 的依赖注入系统。 组合式 API 是 Vue 3 及 Vue 2.7 的内置功能。对于更老的 Vue 2 版本，可以使用官方维护的插件 @vue/composition-api。在 Vue 3 中，组合式 API 基本上都会配合 `` 语法在单文件组件中使用。下面是一个使用组合式 API 的组件示例：\n\u003cscript setup\u003e import { ref, onMounted } from 'vue' // 响应式状态 const count = ref(0) // 更改状态、触发更新的函数 function increment() { count.value++ } // 生命周期钩子 onMounted(() =\u003e { console.log(`计数器初始值为 ${count.value}。`) }) \u003c/script\u003e \u003ctemplate\u003e \u003cbutton @click=\"increment\"\u003e点击了：{{ count }} 次\u003c/button\u003e \u003c/template\u003e 虽然这套 API 的风格是基于函数的组合，但组合式 API 并不是函数式编程。组合式 API 是以 Vue 中数据可变的、细粒度的响应性系统为基础的，而函数式编程通常强调数据不可变。\nsetup() 以下的代码 均会采用选项式的写法, 组合式 Api 的写法可以参考官方文档, 但基本原理差不多, 而且 Vue3 选项式写法是基于组合式写法产生的!\nsetup() 钩子是在组件中使用组合式 API 的入口，通常只在以下情况下使用：\n需要在非单文件组件中使用组合式 API 时。 需要在基于选项式 API 的组件中集成基于组合式 API 的代码时。 setup函数的参数 主要有两个参数: 第一个参数：props 第二个参数：context setup 函数的第一个参数是组件的 props。和标准的组件一致，一个 setup 函数的 props 是响应式的，并且会在传入新的 props 时同步更新。： 对于定义props的类型，我们还是和之前的规则是一样的，在props选项中定义； 并且在template中依然是可以正常去使用props中的属性，比如message； 如果我们在setup函数中想要使用props，那么不可以通过 this 去获取 \u003cscript\u003e import { ref } from 'vue' export default { setup() { const count = ref(0) // 返回值会暴露给模板和其他的选项式 API 钩子 return { count } }, mounted() { console.log(this.count) // 0 } } \u003c/script\u003e \u003ctemplate\u003e \u003cbutton @click=\"count++\"\u003e{{ count }}\u003c/button\u003e \u003c/template\u003e \u003cscript\u003e export default { props: { message: { type: String, required: true } }, data() { return { counter: 100 } }, setup(props, ....){ ..... } ... } \u003c/script\u003e setup 函数的第一个参数是组件的 props。和标准的组件一致，一个 setup 函数的 props 是响应式的，并且会在传入新的 props 时同步更新。 export default { props: { title: String }, setup(props) { console.log(props.title) } } 请注意如果你解构了 props 对象，解构出的变量将会丢失响应性。因此我们推荐通过 props.xxx 的形式来使用其中的 props。\n如果你确实需要解构 props 对象，或者需要将某个 prop 传到一个外部函数中并保持响应性，那么你可以使用 toRefs() 和 toRef() 这两个工具函数：\nimport { toRefs, toRef } from 'vue' export default { setup(props) { // 将 `props` 转为一个其中全是 ref 的对象，然后解构 const { title } = toRefs(props) // `title` 是一个追踪着 `props.title` 的 ref console.log(title.value) // 或者，将 `props` 的单个属性转为一个 ref const title = toRef(props, 'title') } } 另外一个参数是context，我们也称之为是一个SetupContext，它里面包含三个属性： attrs：所有的非prop的attribute； slots：父组件传递过来的插槽（这个在以渲染函数返回时会有作用，后面会讲到）； emit：当我们组件内部需要发出事件时会用到emit（因为我们不能访问this，所以不可以通过 this.$emit发出事件）； export default { setup(props, context) { // 透传 Attributes（非响应式的对象，等价于 $attrs） console.log(context.attrs) // 插槽（非响应式的对象，等价于 $slots） console.log(context.slots) // 触发事件（函数，等价于 $emit） console.log(context.emit) // 暴露公共属性（函数） console.log(context.expose) } // 该上下文对象是非响应式的，可以安全地解构： setup(props, {attrs, slots, emit}) { console.log(props.message); console.log(attrs.id, attrs.class); console.log(slots); console.log(emit); } } attrs 和 slots 都是有状态的对象，它们总是会随着组件自身的更新而更新。这意味着你应当避免解构它们，并始终通过 attrs.x 或 slots.x 的形式使用其中的属性。此外还需注意，和 props 不同，attrs 和 slots 的属性都不是响应式的。如果你想要基于 attrs 或 slots 的改变来执行副作用，那么你应该在 onBeforeUpdate 生命周期钩子中编写相关逻辑。\n代码示例\n\u003ctemplate\u003e \u003cHelloWorld msg=\"Welcome to Your Vue.js App\" class=\"app-attr\" /\u003e \u003c/template\u003e \u003cscript\u003e import HelloWorld from './components/HelloWorld.vue'; export default { name: 'App', components: { HelloWorld } }; \u003c/script\u003e \u003cstyle\u003e\u003c/style\u003e \u003ctemplate\u003e \u003cdiv class=\"hello\"\u003e {{ msg }} \u003c/div\u003e \u003c/template\u003e \u003cscript\u003e export default { name: 'HelloWorld', // 组件接受的参数 props: { msg: String }, // 发射的事件这里可以标注一下 emits:['change'], setup(props, context) { // 这样可以拿到传递过来的msg的值 console.log(props.msg); // attrs console.log(context.attrs); // 发射事件 context.emit('change'); } }; \u003c/script\u003e \u003cstyle scoped\u003e\u003c/style\u003e setup函数的返回值 setup 也可以返回一个 渲染函数，此时在渲染函数中可以直接使用在同一作用域下声明的响应式状态：\nimport { h, ref } from 'vue' export default { setup() { const count = ref(0) return () =\u003e h('div', count.value) } } 返回一个渲染函数将会阻止我们返回其他东西。对于组件内部来说，这样没有问题，但如果我们想通过模板引用将这个组件的方法暴露给父组件，那就有问题了。\n我们可以通过调用 expose() 解决这个问题：\nimport { h, ref } from 'vue' export default { setup(props, { expose }) { const count = ref(0) const increment = () =\u003e ++count.value expose({ increment }) return () =\u003e h('div', count.value) } } 此时父组件可以通过模板引用来访问这个 increment 方法。\nexport default { props: { message: { type: String, required: true } }, setup() { let counter = 100; // 局部函数 const increment = () =\u003e { counter++; console.log(counter); } return { title: \"Hello Home\", counter, increment } } } setup的返回值可以在模板template中被使用 也就是说可以通过setup的返回值来替代data选项 最后导出的一定要是个对象\n\u003ctemplate\u003e \u003cdiv class=\"hello\"\u003e \u003ch1\u003e{{ count }}\u003c/h1\u003e \u003cbutton @click=\"increment\"\u003e+ 1\u003c/button\u003e \u003c/div\u003e \u003c/template\u003e \u003cscript\u003e export default { name: 'HelloWorld', setup() { // 定义普通的变量，可以被正常使用 // 缺点 : 数据不是响应式的 let count = 100; // 定义方法 const increment = () =\u003e { count++; console.log(count); }; // 导出 return { count, increment }; } }; \u003c/script\u003e \u003cstyle scoped\u003e\u003c/style\u003e 因为只是定义了个变量，然后导出了，并没有使它响应式\n补充: 为什么 setup 不能使用 this 在Vue 3中，setup 函数是用来替代以前的 data, computed, methods 等选项的。setup() 自身并不含对组件实例的访问权，即在 setup() 中访问 this 会是 undefined。你可以在选项式 API 中访问组合式 API 暴露的值，但反过来则不行。\n定义响应式数据的两种方式 Reactive API 如果想为在setup中定义的数据提供响应式的特性，那么可以使用reactive的函数\nps : 如果传入一个基本数据类型（String、Number、Boolean）会报一个警告\n应用场景 : reactive API对传入的类型是有限制的，它要求我们必须传入的是一个对象或者数组类型，最好相互有关联的数据时使用\n比如说想要上面的例子实现响应式, 我们可以做如下操作\n\u003ctemplate\u003e \u003cdiv class=\"hello\"\u003e \u003ch1\u003e{{ state.count }}\u003c/h1\u003e \u003cbutton @click=\"increment\"\u003e+ 1\u003c/button\u003e \u003c/div\u003e \u003c/template\u003e \u003cscript\u003e // 从vue中导入reactive import { reactive } from 'vue'; export default { name: 'HelloWorld', setup() { // 使用reactive，会返回一个响应式对象 const state = reactive({ // 在对象中编写自己所需要的属性 count: 100 }); const increment = () =\u003e { // 这样使用 state.count++; console.log(state.count); }; return { // 导出响应式state对象 state, increment }; } }; \u003c/script\u003e Reactive判断的API isProxy : 检查对象是否是由 reactive 或 readonly创建的 proxy isReactive : 检查对象是否是由 reactive创建的响应式代理，如果该代理是 readonly 建的，但包裹了由 reactive 创建的另一个代理，它也会返回 true isReadonly : 检查对象是否是由 readonly 创建的只读代理 toRaw : 返回 reactive 或 readonly 代理的原始对象（不建议保留对原始对象的持久引用。请谨慎使用） shallowReactive : 创建一个响应式代理，它跟踪其自身 property 的响应性，但不执行嵌套对象的深层响应式转换 (深层还是原生对象)，只响应第一层 shallowReadonly : 创建一个 proxy，使其自身的 property 为只读，但不执行嵌套对象的深度只读转换（深层还是可读、可写的）只检查第一层 import { reactive, readonly, isProxy, isReactive, isReadonly, toRaw, shallowReactive, shallowReadonly } from 'vue'; // 创建一个响应式对象 const original = { count: 0 }; const obj = reactive(original); // 检查对象是否是代理对象 console.log(isProxy(obj)); // true // 检查对象是否是由 reactive 创建的响应式代理 console.log(isReactive(obj)); // true // 检查对象是否是由 readonly 创建的只读代理 const ro = readonly(obj); console.log(isReadonly(ro)); // true // 返回 reactive 或 readonly 代理的原始对象 const rawObj = toRaw(obj); // 创建一个浅层响应式代理 const shallowObj = shallowReactive({ nested: { count: 0 } }); // 创建一个浅层只读代理 const shallowRo = shallowReadonly({ nested: { count: 0 } }); 以下是一些名词解释:\n代理对象：在Vue 3中，代理对象是由 reactive 或 readonly 创建的对象的代理，用于跟踪对象的属性的变化。 readonly：readonly 是一个函数，用于创建一个只读的代理对象，该代理对象只能读取属性值，不能修改属性值。 浅层响应式：浅层响应式是指只有对象的第一层属性会被设置为响应式，而嵌套对象的属性不会被设置为响应式。 浅层只读代理：浅层只读代理是指只有对象的第一层属性会被设置为只读，而嵌套对象的属性不会被设置为只读。 import { reactive, readonly, shallowReactive, shallowReadonly } from 'vue'; // 创建一个普通对象 const original = { count: 0, nested: { count: 1 } }; // 创建一个响应式代理对象 const reactiveObj = reactive(original); reactiveObj.count = 1; // 可以修改属性值 reactiveObj.nested.count = 2; // 嵌套对象的属性也会被设置为响应式 // 创建一个只读代理对象 const readonlyObj = readonly(original); // readonlyObj.count = 2; // 试图修改只读属性会报错 // readonlyObj.nested.count = 2; // 嵌套对象的属性也是只读的 // 创建一个浅层响应式代理对象 const shallowReactiveObj = shallowReactive(original); shallowReactiveObj.count = 2; // 可以修改属性值 shallowReactiveObj.nested.count = 2; // 嵌套对象的属性不会被设置为响应式 // 创建一个浅层只读代理对象 const shallowReadonlyObj = shallowReadonly(original); shallowReadonlyObj.count = 2; // 试图修改只读属性会报错 shallowReadonlyObj.nested.count = 2; // 嵌套对象的属性不会被设置为只读 Ref API Ref函数 : 定义简单类型的数据，也可以定义复杂类型的数据\n应用场景 : 定义一些简单的数据，或者从接口中获得的数据\nref 会返回一个可变的响应式对象，该对象作为一个 响应式的引用 维护着它内部的值，这就是ref名称的来源 它内部的值是在ref的 value 属性中被维护的 不管传入的是基本类型还是引用类型，都放在.value中 使用的时候是用 .value，但是有两个注意事项:\n在模板中引入ref的值时，Vue会自动帮助我们进行解包操作，所以并不需要在模板中通过 ref.value 的方式，直接使用即可 在 setup 函数内部，它依然是一个 ref引用， 所以对其进行操作时，依然需要使用 ref.value的方式 基本使用 \u003ctemplate\u003e \u003cdiv class=\"hello\"\u003e \u003ch1\u003e{{ count }}\u003c/h1\u003e \u003cbutton @click=\"increment\"\u003e+ 1\u003c/button\u003e \u003c/div\u003e \u003c/template\u003e \u003cscript\u003e // 从vue中导入ref import { ref } from 'vue'; export default { name: 'HelloWorld', setup() { // 使用Ref，会返回一个响应式对象 let count = ref(100); const increment = () =\u003e { // 这样使用,需要使用 .value count.value++; console.log(count.value); }; return { // 直接导出count即可 count, increment }; } }; \u003c/script\u003e Ref自动解包 模板中的解包是浅层的解包，如果我们的代码是下面的方式： 如果我们将ref放到一个reactive的属性当中，那么在模板中使用时，它会自动解包： const count = ref(1) const obj = reactive({ count }) // ref 会被解包 console.log(obj.count === count.value) // true // 会更新 `obj.count` count.value++ console.log(count.value) // 2 console.log(obj.count) // 2 // 也会更新 `count` ref obj.count++ console.log(obj.count) // 3 console.log(count.value) // 3 注意当访问到某个响应式数组或 Map 这样的原生集合类型中的 ref 元素时，不会执行 ref 的解包：\nconst books = reactive([ref('Vue 3 Guide')]) // 这里需要 .value console.log(books[0].value) const map = reactive(new Map([['count', ref(0)]])) // 这里需要 .value console.log(map.get('count').value) Ref判断的API isRef : 判断值是否是一个ref对象 unref : 如果我们想要获取一个ref引用中的value，那么也可以通过unref方法 如果参数是一个 ref，则返回内部值，否则返回参数本身 这是 val = isRef(val) ? val.value : val 的语法糖函数 shallowRef：shallowRef 是用来创建一个浅层的 ref 对象的函数。浅层的意思是只有对象的第一层属性会被设置为响应式，而嵌套对象的属性不会被设置为响应式。这意味着对嵌套对象属性的修改不会触发响应。 triggerRef：triggerRef 用于手动触发与 shallowRef 相关联的副作用。当 shallowRef 关联的数据发生变化时，相关的副作用将被触发执行。 import { ref, isRef, unref, shallowRef, triggerRef } from 'vue'; // 判断值是否是一个 ref 对象 const count = ref(0); console.log(isRef(count)); // true // 获取 ref 引用中的值 const value = unref(count); // 语法糖函数示例 const val = isRef(count) ? count.value : count; // 创建一个浅层的 ref 对象 const shallowCount = shallowRef({ value: 0 }); shallowCount.value = 1; // 可以直接修改 value 属性 // 手动触发与 shallowRef 相关联的副作用 triggerRef(shallowCount); 自定义Ref =\u003e customRef 创建一个自定义的ref，并对其依赖项跟踪和更新触发进行显示控制： 它需要一个工厂函数，该函数接受 track 和 trigger 函数作为参数； 并且应该返回一个带有 get 和 set 的对象； 这里我们使用一个的案例： 对双向绑定的属性进行debounce(节流)的操作 import { customRef } from 'vue'; // 自定义ref export default function(value, delay = 300) { let timer = null; return customRef((track, trigger) =\u003e { return { get() { track(); return value; }, set(newValue) { clearTimeout(timer); timer = setTimeout(() =\u003e { value = newValue; trigger(); }, delay); } } }) } \u003ctemplate\u003e \u003cdiv\u003e \u003cinput v-model=\"message\"/\u003e \u003ch2\u003e{{message}}\u003c/h2\u003e \u003c/div\u003e \u003c/template\u003e \u003cscript\u003e import debounceRef from './hook/useDebounceRef'; export default { setup() { const message = debounceRef(\"Hello World\"); return { message } } } \u003c/script\u003e readonly 概念 在我们传递给其他组件数据时，往往希望其他组件使用我们传递的内容，但是不允许它们修改时，就可以使用 readonly了；\n只读代理是深层的：对任何嵌套属性的访问都将是只读的。它的 ref 解包行为与 reactive() 相同，但解包得到的值是只读的。 要避免深层级的转换行为，请使用 shallowReadonly() 作替代。 在开发中常见的readonly方法会传入三个类型的参数： 类型一：普通对象 类型二：reactive返回的对象 类型三：ref的对象 在readonly的使用过程中，有如下规则 : readonly返回的对象都是不允许修改的 但是经过readonly处理的原来的对象是允许被修改的 比如 const info = readonly(obj)，info对象是不允许被修改的 当obj被修改时，readonly返回的info对象也会被修改 但是不能去修改readonly返回的对象info \u003ctemplate\u003e \u003cdiv class=\"hello\"\u003e \u003cbutton @click=\"btnClick\"\u003e按钮\u003c/button\u003e \u003c/div\u003e \u003c/template\u003e \u003cscript setup\u003e import { reactive, readonly, watchEffect } from 'vue' const original = reactive({ count: 0 }) const copy = readonly(original) const btnClick = () =\u003e { original.count++ } watchEffect(() =\u003e { // 用来做响应性追踪 console.log(copy.count) }) // 更改源属性会触发其依赖的侦听器 original.count++ // 更改该只读副本将会失败，并会得到一个警告 copy.count++ // warning! \u003c/script\u003e toRefs \u0026\u0026 toRef toRefs 如果使用ES6的解构语法，对reactive返回的对象进行解构获取值，那么之后无论是修改结构后的变量，还是修改reactive 返回的state对象，数据都不再是响应式的\n如何改成响应式呢，Vue提供了一个toRefs的函数 可以将reactive返回的对象中的属性都转成ref，这样解构出来的就是响应式的了 \u003ctemplate\u003e \u003cdiv class=\"hello\"\u003e \u003ch1\u003e{{ age }}\u003c/h1\u003e \u003cbutton @click=\"increment\"\u003e+age\u003c/button\u003e \u003c/div\u003e \u003c/template\u003e \u003cscript\u003e // 从vue中导入ref import { reactive, ref, readonly, toRefs } from 'vue'; export default { name: 'HelloWorld', setup() { const info = reactive({ name: 'star', age: 18 }); // 使用toRefs包裹需要结构的reactive对象，这样解构出来的值也是响应式的 let { name, age } = toRefs(info); const increment = () =\u003e { info.age++; // 👆这样都可以修改age，都是响应式的👇 // 相当于已经建立了链接，任何一个修改都会引起另外一个变化 age.value++; console.log(age, info.age); }; return { name, age, increment }; } }; \u003c/script\u003e \u003cstyle scoped\u003e\u003c/style\u003e toRef 如果只希望转换reactive对象中的其中某个属性为ref, 那么可以使用toRef的方法\nps : 这个效率会更高点, 这种做法相当于已经在state.name和ref.value之间建立了 链接，任何一个修改都会引起另外一个变化\nlet age = toRef(info, \"age\"); const changeAge = () =\u003e { age.value++; } computed 在前面的Options API中，我们是使用computed选项来完成的； 在Composition API中，我们可以在 setup 函数中使用 computed 方法来编写一个计算属性； 如何使用computed呢？ 方式一：接收一个getter函数，并为 getter 函数返回的值，返回一个不变的 ref 对象； 方式二：接收一个具有 get 和 set 的对象，返回一个可变的（可读写）ref 对象； 方式一 \u003ctemplate\u003e {{ fullName }} {{ scoreState }} \u003c/template\u003e \u003cscript\u003e import { computed, reactive, ref } from 'vue'; export default { name: 'App', setup() { const names = reactive({ firstName: 'coder', lastName: 'star' }); // 直接使用getter函数，正常来说都这么使用 const fullName = computed(() =\u003e names.firstName + names.lastName); const score = ref(88); const scoreState = computed(() =\u003e (score.value \u003e 90 ? '优秀' : '一般')); return { fullName, scoreState }; } }; \u003c/script\u003e 方式二 \u003ctemplate\u003e {{ fullName }} \u003cbutton @click=\"changeName\"\u003echange\u003c/button\u003e \u003c/template\u003e \u003cscript\u003e import { computed, reactive } from 'vue'; export default { name: 'App', setup() { const names = reactive({ firstName: '冲啊', lastName: '迪迦奥特曼' }); // 会返回一个ref对象 const fullName = computed({ set(newValue) { const tempNames = newValue.split(' '); names.firstName = tempNames[0]; names.lastName = tempNames[1]; }, get() { return names.firstName + names.lastName; } }); // 设置值 const changeName = () =\u003e { fullName.value = fullName.value === '冲啊迪迦奥特曼' ? '神秘的 宇宙人' : '冲啊 迪迦奥特曼'; }; return { fullName, changeName }; } }; \u003c/script\u003e 生命周期钩子 https://cn.vuejs.org/api/composition-api-lifecycle.html\nsetup中可以直接使用导入的onX函数注册生命周期，并且同一个生命周期可以使用多次\n所有罗列在本页的 API 都应该在组件的 setup() 阶段被同步调用。相关细节请看 指南 - 生命周期钩子。\n可以使用直接导入的 onX 函数注册生命周期钩子； beforeCreate和create在setup中没有相对应的onX的函数 如果想要在beforeCreate和create中进行操作 可以把代码直接写入到setup中 setup的执行时序比beforeCreate和create还要早 import { onBeforeMount, onMounted, onBeforeUpdate, onUpdated, onBeforeUnmount, onUnmounted } from 'vue'; // 注册生命周期钩子 export default { setup() { onBeforeMount(() =\u003e { console.log('Before Mount'); // 组件挂载前 }); onMounted(() =\u003e { console.log('Mounted'); // 组件挂载后 }); onBeforeUpdate(() =\u003e { console.log('Before Update'); // 组件更新前 }); onUpdated(() =\u003e { console.log('Updated'); // 组件更新后 }); onBeforeUnmount(() =\u003e { console.log('Before Unmount'); // 组件卸载前 }); onUnmounted(() =\u003e { console.log('Unmounted'); // 组件卸载后 }); // 同一个生命周期可以使用多次 onMounted(() =\u003e { console.log('Another Mounted'); // 另一个组件挂载后 }); return {}; } }; setup中使用ref获取元素或组件 要定义一个ref对象，绑定到元素或者组件的ref属性上即可\n只有在挂载完成后才能拿到值, 所以需要在生命周期中调用拿值\n获取元素 \u003ctemplate\u003e \u003ch2 ref=\"titleRef\"\u003e我是迪迦\u003c/h2\u003e \u003c/template\u003e \u003cscript\u003e import { onMounted, ref } from 'vue'; export default { name: 'App', setup() { // 2. 生成ref对象 const titleRef = ref(); // 4. 可以在生命周期中获取到值 onMounted(() =\u003e { console.log(titleRef.value); // 我是迪迦 }); return { // 3. 返回出去，会自动匹配到对应的ref的 titleRef }; } }; \u003c/script\u003e 获取组件 \u003ctemplate\u003e \u003cdiv\u003e我是子组件\u003c/div\u003e \u003c/template\u003e \u003cscript\u003e export default { name: 'home-layout', setup() { const showMessage = () =\u003e { console.log('home-layout function exection'); }; return { showMessage }; } }; \u003c/script\u003e \u003ctemplate\u003e \u003chome ref=\"homeCompRef\" /\u003e \u003c/template\u003e \u003cscript\u003e import { onMounted, ref } from 'vue'; import home from './home.vue'; export default { name: 'App', components: { home }, setup() { // 2. 生成ref对象 const homeCompRef = ref(); // 4. 可以在生命周期中获取到值 onMounted(() =\u003e { console.log(homeCompRef.value); // proxy对象 console.log(homeCompRef.value.$el); // 我是子组件 homeCompRef.value.showMessage(); // 调用子组件方法 }); return { // 3. 返回出去，会自动匹配到对应的ref的 homeCompRef }; } }; \u003c/script\u003e 侦听数据的变化 在前面的Options API中，我们可以通过watch选项来侦听data或者props的数据变化，当数据变化时执行某一些 操作。\n在Composition API中，我们可以使用watchEffect和watch来完成响应式数据的侦听；\nwatchEffect用于自动收集响应式数据的依赖； watch需要手动指定侦听的数据源； watchEffect 基本使用 自动收集响应式数据的依赖 watchEffect传入的函数会被立即执行一次，并且在执行的过程中会收集依赖 只有收集的依赖发生变化时，watchEffect传入的函数才会再次执行 \u003ctemplate\u003e \u003cdiv\u003e \u003ch1\u003e{{ name }} - {{ age }}\u003c/h1\u003e \u003cbutton @click=\"changeName\"\u003echangeName\u003c/button\u003e \u003cbutton @click=\"changeAge\"\u003echangeAge\u003c/button\u003e \u003c/div\u003e \u003c/template\u003e \u003cscript\u003e import { ref, watchEffect } from 'vue'; export default { setup() { let name = ref('star'); let age = ref(18); const changeName = () =\u003e (name.value === 'star' ? (name.value = 'xuanyu') : (name.value = 'star')); const changeAge = () =\u003e age.value++; watchEffect(() =\u003e { // 因为这里只使用了name，所以只会监听name，如果把age也写进来，那么两个都会监听 console.log('name:', name.value); }); return { name, age, changeName, changeAge }; } }; \u003c/script\u003e 停止监听 如果在发生某些情况下，我们希望停止侦听，这个时候我们可以获取watchEffect的返回值函数，调用该函数即可。 \u003ctemplate\u003e \u003cdiv\u003e \u003ch1\u003e{{ name }} - {{ age }}\u003c/h1\u003e \u003cbutton @click=\"changeName\"\u003echangeName\u003c/button\u003e \u003cbutton @click=\"changeAge\"\u003echangeAge\u003c/button\u003e \u003c/div\u003e \u003c/template\u003e \u003cscript\u003e import { ref, watchEffect } from 'vue'; export default { setup() { let name = ref('star'); let age = ref(18); const changeName = () =\u003e (name.value === 'star' ? (name.value = 'xuanyu') : (name.value = 'star')); // 获取返回值 const stopWatchEffect = watchEffect(() =\u003e { // 自动监听age console.log('age:', age.value); }); const changeAge = () =\u003e { age.value++; if (age.value \u003e 22) { // 停止监听 stopWatchEffect(); } }; return { name, age, changeName, changeAge }; } }; \u003c/script\u003e 清除副作用 什么是清除副作用呢？ 比如在开发中我们需要在侦听函数中执行网络请求，但是在网络请求还没有达到的时候，我们停止了侦听器， 或者侦听器侦听函数被再次执行了 那么上一次的网络请求应该被取消掉，这个时候我们就可以清除上一次的副作用； 在我们给watchEffect传入的函数被回调时，其实可以获取到一个参数：onInvalidate 当副作用即将重新执行 或者 侦听器被停止 时会执行该函数传入的回调函数； 我们可以在传入的回调函数中，执行一些清除工作； \u003ctemplate\u003e \u003cdiv\u003e \u003ch2\u003e{{ name }}-{{ age }}\u003c/h2\u003e \u003cbutton @click=\"changeName\"\u003e修改name\u003c/button\u003e \u003cbutton @click=\"changeAge\"\u003e修改age\u003c/button\u003e \u003c/div\u003e \u003c/template\u003e \u003cscript\u003e import { ref, watchEffect } from 'vue'; export default { setup() { // watchEffect: 自动收集响应式的依赖 const name = ref(\"why\"); const age = ref(18); const stop = watchEffect((onInvalidate) =\u003e { const timer = setTimeout(() =\u003e { console.log(\"网络请求成功~\"); }, 2000) // 根据name和age两个变量发送网络请求 onInvalidate(() =\u003e { // 在这个函数中清除额外的副作用 // request.cancel() clearTimeout(timer); console.log(\"onInvalidate\"); }) console.log(\"name:\", name.value, \"age:\", age.value); }); const changeName = () =\u003e name.value = name.value === \"why\" ? \"kobe\" : \"why\"; const changeAge = () =\u003e age.value++; return { name, age, changeName, changeAge } } } \u003c/script\u003e watchEffect的执行时机 默认情况下，组件的更新会在副作用函数执行之前： 如果我们希望在副作用函数中获取到元素，是否可行呢？ \u003ctemplate\u003e \u003cdiv\u003e \u003ch2 ref=\"title\"\u003e哈哈哈\u003c/h2\u003e \u003c/div\u003e \u003c/template\u003e \u003cscript\u003e import { ref, watchEffect } from 'vue'; export default { setup() { const title = ref(null); watchEffect(() =\u003e { console.log(title.value); }) return { title } } } \u003c/script\u003e 我们会发现打印结果打印了两次： 这是因为setup函数在执行时就会立即执行传入的副作用函数，这个时候DOM并没有挂载，所以打印为null； 而当DOM挂载时，会给title的ref对象赋值新的值，副作用函数会再次执行，打印出来对应的元素； 这个时候我们需要改变副作用函数的执行时机； 它的默认值是pre，它会在元素 挂载 或者 更新 之前执行； 所以我们会先打印出来一个空的，当依赖的title发生改变时，就会再次执行一次，打印出元素； 我们可以设置副作用函数的执行时机： pre : 默认值,它会在元素 挂载 或者 更新 之前执行 post : 元素 挂载 或者 更新 之后执行 sync : 强制同步一起执行，效率很低，不推荐 \u003cscript\u003e import { ref, watchEffect } from 'vue'; export default { setup() { const title = ref(null); watchEffect(() =\u003e { console.log(title.value); }, { flush: \"post\" }) return { title } } } \u003c/script\u003e Watch watch的API完全等同于组件watch选项的Property： watch需要侦听特定的数据源，并在回调函数中执行副作用； 默认情况下它是惰性的，只有当被侦听的源发 生变化时才会执行回调； 与watchEffect的比较，watch允许我们： 懒执行副作用（第一次不会直接执行）； 更具体的说明当哪些状态发生变化时，触发侦听器的执行； 访问侦听状态变化前后的值； 侦听单个数据源 watch侦听函数的数据源有两种类型：\n一个getter函数：但是该getter函数必须引用可响应式的对象（比如reactive或者ref）； 直接写入一个可响应式的对象，ref（如果是一个 reactive 的对象的侦听, 需要进行某些转换 ）； import { watch, reactive, ref, toRefs } from 'vue'; // 一个getter函数引用可响应式的对象 const state = reactive({ count: 0 }); watch( () =\u003e state.count, (newValue, oldValue) =\u003e { console.log(`Count changed from ${oldValue} to ${newValue}`); }); // 直接写入一个可响应式的对象 const count = ref(0); watch(count, (newValue, oldValue) =\u003e { console.log(`Count changed from ${oldValue} to ${newValue}`); }); // 直接写入一个可响应式的对象，需要进行某些转换 const reactiveState = reactive({ count: 0 }); const { count } = toRefs(reactiveState); watch(count, (newValue, oldValue) =\u003e { console.log(`Count changed from ${oldValue} to ${newValue}`); }); 注意: reactive 对象获取到的 newValue 以及 oldValue 本身都是 reactive 对象\nwatch( info, (newInfo, oldInfo) =\u003e { console.log(newInfo, oldInfo); } ) 如果希望两者都是一个普通对象, 可以使用以下写法(JavaScript中的展开运算符):\nwatch( () =\u003e ({ ...info }), (newInfo, oldInfo) =\u003e { console.log(newInfo, oldInfo); } ) 以下是完整代码:\n\u003ctemplate\u003e \u003cdiv\u003e \u003ch2 ref=\"title\"\u003e{{ info.name }}\u003c/h2\u003e \u003cbutton @click=\"changeData\"\u003e修改数据\u003c/button\u003e \u003c/div\u003e \u003c/template\u003e \u003cscript\u003e import { reactive, watch } from 'vue'; export default { setup() { const info = reactive({ name: \"why\", age: 18 }); watch( () =\u003e ({ ...info }), (newInfo, oldInfo) =\u003e { console.log(newInfo, oldInfo); } ) watch( info, (newInfo, oldInfo) =\u003e { console.log(newInfo, oldInfo); } ) const changeData = () =\u003e info.name = info.name === \"why\" ? \"kobe\" : \"why\"; return { changeData, info } } } \u003c/script\u003e 侦听多个数据源 当侦听多个来源时，回调函数接受两个数组，分别对应来源数组中的新值和旧值：\nwatch([fooRef, barRef], ([foo, bar], [prevFoo, prevBar]) =\u003e { /* ... */ }) \u003ctemplate\u003e \u003cdiv\u003e \u003ch2 ref=\"title\"\u003e{{ info.name }}\u003c/h2\u003e \u003cbutton @click=\"changeData\"\u003e修改数据\u003c/button\u003e \u003c/div\u003e \u003c/template\u003e \u003cscript\u003e import { ref, reactive, watch } from 'vue'; export default { setup() { const info = reactive({ name: \"why\", age: 18 }); const name = ref(\"why\"); watch([() =\u003e ({ ...info }), name], ([newInfo, newName], [oldInfo, oldName]) =\u003e { console.log(newInfo, newName, oldInfo, oldName); }) const changeData = () =\u003e { info.name = \"kobe\"; } return { changeData, info } } } \u003c/script\u003e watch的选项 deep : 是否深度监听 immediate ： 是否立即执行 watch 侦听 reactive时默认是深度侦听的, 但是在使用 {...info}展开运算符时, 是不会深度监听的, 所以我们要设置 deep: True\nimmediate: 第一次会执行\nwatch( () =\u003e { const obj = { ...info } obj.friend = { ...obj.friend } return obj }, (newValue, oldValue) =\u003e { console.log(newValue, oldValue) }, { // 如果有多层，需要加上deep deep: true, // 立即执行 immediate: true } ) 停止侦听 const stop = watch(source, callback) // 当已不再需要该侦听器时： stop() 副作用清理 watch(id, async (newId, oldId, onCleanup) =\u003e { const { response, cancel } = doAsyncWork(newId) // 当 `id` 变化时，`cancel` 将被调用， // 取消之前的未完成的请求 onCleanup(cancel) data.value = await response }) provide \u0026\u0026 inject provide 和 inject 通常成对一起使用，使一个祖先组件作为其后代组件的依赖注入方，无论这个组件的层级有多深都可以注入成功，只要他们处于同一条组件链上。\nprovide可以传入两个参数 :\nname：提供的属性名称 value：提供的属性值 inject可以传入两个参数 :\n对应provide传过来的name值 默认值 \u003ctemplate\u003e \u003ch1\u003eAPP count: {{ count }}\u003c/h1\u003e \u003cbutton @click=\"change\"\u003eAPP button\u003c/button\u003e \u003cdemo /\u003e \u003c/template\u003e \u003cscript\u003e import { ref, provide, readonly } from 'vue' import demo from './components/demo.vue' export default { name: 'App', components: { demo }, setup() { let count = ref(100) // 第一个参数key 第二个参数值，不让子组件随便修改，用readonly包裹一下 provide('count', readonly(count)) const change = () =\u003e count.value++ return { count, change } } } \u003c/script\u003e \u003ctemplate\u003e \u003ch2\u003edemo count:{{ count }}\u003c/h2\u003e \u003cbutton @click=\"change\"\u003edemo change\u003c/button\u003e \u003c/template\u003e \u003cscript\u003e import { ref, inject } from 'vue' export default { setup() { // 接收 第二个参数可以给一个默认值 let count = inject('count', '') // 因为设置了readOnly 所以更改不了 const change = () =\u003e count.value++ return { count, change } } } \u003c/script\u003e h函数 Vue在生成真实的DOM之前，会将节点转换成VNode，而VNode组合在一起形成一颗树结构，就是虚拟DOM ( VDOM ) 事实上，编写的 template 中的HTML 最终也是使用渲染函数生成对应的VNode 那么，如果想充分的利用JavaScript的编程能力，可以自己来编写 createVNode 函数，生成对应的VNode h() 函数是一个用于创建 vnode 的一个函数 其实更准备的命名是 createVNode() 函数，但是为了简便在Vue将之简化为 h() 函数 参数 // 完整参数签名 function h( type: string | Component, props?: object | null, children?: Children | Slot | Slots ): VNode // 省略 props function h(type: string | Component, children?: Children | Slot): VNode type Children = string | number | boolean | VNode | null | Children[] type Slot = () =\u003e Children type Slots = { [name: string]: Slot } 第一个参数既可以是一个字符串 (用于原生元素) 也可以是一个 Vue 组件定义。第二个参数是要传递的 prop，第三个参数是子节点。 当创建一个组件的 vnode 时，子节点必须以插槽函数进行传递。如果组件只有默认槽，可以使用单个插槽函数进行传递。否则，必须以插槽函数的对象形式来传递。 为了方便阅读，当子节点不是插槽对象时，可以省略 prop 参数。 基本使用 h函数可以在两个地方使用：\nrender函数选项中； setup函数选项中（setup本身需要是一个函数类型，函数再返回h函数创建的VNode）； 在render函数选项中 \u003cscript\u003e // 1. 引入h函数 import { h } from 'vue'; export default { data() { return { counter: 0 }; }, // 2. 定义render选项 render() { // 3. 返回自定义的h函数 return h('div', { class: 'app-view', name: 'abc' }, [ // 4. 定义h2 h('h2', { className: 'title' }, this.counter), // 5. 定义增加按钮 h( 'button', { className: 'add-btn', onClick: () =\u003e { this.counter++; } }, '加一' ), // 6. 定义减少按钮 h( 'button', { className: 'remove-btn', onClick: () =\u003e { this.counter--; } }, '减一' ) ]); } } \u003c/script\u003e 在setup函数选项中 \u003cscript\u003e import { h, ref } from 'vue'; export default { setup() { const counter = ref(0); const increment = () =\u003e { counter.value++; }; const decrement = () =\u003e { counter.value--; }; // 返回render函数 return () =\u003e h('div', { class: 'app-view', name: 'abc' }, [ h('h2', { className: 'title' }, counter.value), h( 'button', { onClick: increment }, '+1' ), h( 'button', { onClick: decrement }, '-1' ) ]); } }; \u003c/script\u003e 在setup语法糖中 \u003ctemplate\u003e \u003cstar-render /\u003e \u003c/template\u003e \u003cscript setup\u003e import { h, ref } from 'vue'; const counter = ref(0); const increment = () =\u003e { counter.value++; }; const decrement = () =\u003e { counter.value--; }; // 1. 拿到render函数 const starRender = () =\u003e h('div', { class: 'app-view', name: 'abc' }, [ h('h2', { className: 'title' }, counter.value), h( 'button', { onClick: increment }, '+1' ), h( 'button', { onClick: decrement }, '-1' ) ]); \u003c/script\u003e 其他写法 创建原生元素：\nimport { h } from 'vue' // 除了 type 外，其他参数都是可选的 h('div') h('div', { id: 'foo' }) // attribute 和 property 都可以用于 prop // Vue 会自动选择正确的方式来分配它 h('div', { class: 'bar', innerHTML: 'hello' }) // class 与 style 可以像在模板中一样 // 用数组或对象的形式书写 h('div', { class: [foo, { bar }], style: { color: 'red' } }) // 事件监听器应以 onXxx 的形式书写 h('div', { onClick: () =\u003e {} }) // children 可以是一个字符串 h('div', { id: 'foo' }, 'hello') // 没有 prop 时可以省略不写 h('div', 'hello') h('div', [h('span', 'hello')]) // children 数组可以同时包含 vnode 和字符串 h('div', ['hello', h('span', 'hello')]) 创建组件：\nimport Foo from './Foo.vue' // 传递 prop h(Foo, { // 等价于 some-prop=\"hello\" someProp: 'hello', // 等价于 @update=\"() =\u003e {}\" onUpdate: () =\u003e {} }) // 传递单个默认插槽 h(Foo, () =\u003e 'default slot') // 传递具名插槽 // 注意，需要使用 `null` 来避免 // 插槽对象被当作是 prop h(MyComponent, null, { default: () =\u003e 'default slot', foo: () =\u003e h('div', 'foo'), bar: () =\u003e [h('span', 'one'), h('span', 'two')] }) 函数组件和插槽的使用 \u003cscript\u003e import { h } from \"vue\"; export default { render() { return h(\"div\", null, [ h(\"h2\", null, \"Hello World\"), this.$slots.default ? this.$slots.default({name: \"coderwhy\"}): h(\"span\", null, \"我是HelloWorld的插槽默认值\") ]) } } \u003c/script\u003e \u003cstyle lang=\"scss\" scoped\u003e \u003c/style\u003e \u003ctemplate\u003e \u003cstarRender /\u003e \u003c/template\u003e \u003cscript setup\u003e import { h } from 'vue'; import HelloWorld from './HelloWorld.vue'; const starRender = () =\u003e h(\"div\", null, [ h(HelloWorld, null, { default: props =\u003e h(\"span\", null, `app传入到HelloWorld中的内容: ${props.name}`) }) ]) \u003c/script\u003e Jsx JSX 是 JavaScript 的一个类似 XML 的扩展，有了它，我们可以用以下的方式来书写代码：\nconst vnode = \u003cdiv\u003ehello\u003c/div\u003e 在 JSX 表达式中，使用大括号来嵌入动态值：\nconst vnode = \u003cdiv id={dynamicId}\u003ehello, {userName}\u003c/div\u003e 配置 vue-cli环境 npm install @vue/babel-plugin-jsx -D babel.config.js 中配置 vite环境 npm install @vitejs/plugin-vue-jsx -D vite.config.js 中配置 import { fileURLToPath, URL } from 'node:url'; import { defineConfig } from 'vite'; import vue from '@vitejs/plugin-vue'; import jsx from '@vitejs/plugin-vue-jsx'; export default defineConfig({ plugins: [vue(), jsx()], resolve: { alias: { '@': fileURLToPath(new URL('./src', import.meta.url)) } } }); 基本使用 在render函数中 \u003cscript lang=\"jsx\"\u003e import Home from './pages/home.vue'; export default { data() { return { counter: 0 }; }, render() { // 2. 返回jsx写法 return ( \u003cdiv class=\"app-view\"\u003e \u003ch2\u003e当前计数:{this.counter}\u003c/h2\u003e \u003cbutton onClick={this.increment}\u003e+1\u003c/button\u003e \u003cbutton onClick={this.decrement}\u003e-1\u003c/button\u003e \u003c/div\u003e ); }, methods: { increment() { this.counter++; }, decrement() { this.counter--; } } }; \u003c/script\u003e 在setup函数中 \u003cscript lang=\"jsx\"\u003e export default { data() { return { counter: 0 }; }, render() { // 2. 返回jsx写法 return ( \u003cdiv class=\"app-view\"\u003e \u003ch2\u003e当前计数:{this.counter}\u003c/h2\u003e \u003cbutton onClick={this.increment}\u003e+1\u003c/button\u003e \u003cbutton onClick={this.decrement}\u003e-1\u003c/button\u003e \u003c/div\u003e ); }, methods: { increment() { this.counter++; }, decrement() { this.counter--; } } }; \u003c/script\u003e 在setup语法糖中 \u003ctemplate\u003e \u003cstar-render /\u003e \u003c/template\u003e \u003cscript setup lang=\"jsx\"\u003e import { ref } from 'vue'; const counter = ref(0); const increment = () =\u003e counter.value++; const decrement = () =\u003e counter.value--; // 2. 拿到render函数 const starRender = () =\u003e ( \u003cdiv class=\"app-view\"\u003e \u003ch2\u003e当前计数:{counter.value}\u003c/h2\u003e \u003cbutton onClick={increment}\u003e+1\u003c/button\u003e \u003cbutton onClick={decrement}\u003e-1\u003c/button\u003e \u003c/div\u003e ); \u003c/script\u003e script setup语法糖 ","wordCount":"15734","inLanguage":"zh-cn","datePublished":"2023-12-29T16:04:23+08:00","dateModified":"2023-12-29T16:04:23+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://waite.wang/posts/vue/vue3-compositionapi/"},"publisher":{"@type":"Organization","name":"隶笔难书","logo":{"@type":"ImageObject","url":"https://waite.wang/images/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://waite.wang/ accesskey=h title="隶笔难书 (Alt + H)">隶笔难书</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://waite.wang/ title=首页><span>首页</span></a></li><li><a href=https://waite.wang/search title=搜索><span>搜索</span></a></li><li><a href=https://waite.wang/categories title=分类><span>分类</span></a></li><li><a href=https://waite.wang/tags title=标签><span>标签</span></a></li><li><a href=https://waite.wang/archives title=归档><span>归档</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Vue3 CompositionAPI</h1><div class=post-meta>Created: &nbsp;<span title='2023-12-29 16:04:23 +0800 +0800'>2023-12-29</span>&nbsp;·&nbsp;32 min&nbsp;·&nbsp;15734 words&nbsp;|&nbsp;<a href=https://github.com/Waite0603/HugoBlog/edit/main/content/posts/vue/vue3-compositionAPI.md rel="noopener noreferrer" target=_blank>在 GitHub 编辑</a></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#options-api%e7%9a%84%e5%bc%8a%e7%ab%af aria-label="Options API的弊端">Options API的弊端</a></li><li><a href=#%e8%ae%a4%e8%af%86-%e7%bb%84%e5%90%88%e5%bc%8f-api-composition-api aria-label="认识 组合式 API (Composition API)">认识 组合式 API (Composition API)</a></li><li><a href=#setup aria-label=setup()>setup()</a><ul><li><a href=#setup%e5%87%bd%e6%95%b0%e7%9a%84%e5%8f%82%e6%95%b0 aria-label=setup函数的参数>setup函数的参数</a></li><li><a href=#setup%e5%87%bd%e6%95%b0%e7%9a%84%e8%bf%94%e5%9b%9e%e5%80%bc aria-label=setup函数的返回值>setup函数的返回值</a></li><li><a href=#%e8%a1%a5%e5%85%85-%e4%b8%ba%e4%bb%80%e4%b9%88-setup-%e4%b8%8d%e8%83%bd%e4%bd%bf%e7%94%a8-this aria-label="补充: 为什么 setup 不能使用 this">补充: 为什么 setup 不能使用 this</a></li></ul></li><li><a href=#%e5%ae%9a%e4%b9%89%e5%93%8d%e5%ba%94%e5%bc%8f%e6%95%b0%e6%8d%ae%e7%9a%84%e4%b8%a4%e7%a7%8d%e6%96%b9%e5%bc%8f aria-label=定义响应式数据的两种方式>定义响应式数据的两种方式</a><ul><li><a href=#reactive-api aria-label="Reactive API">Reactive API</a><ul><li><a href=#reactive%e5%88%a4%e6%96%ad%e7%9a%84api aria-label=Reactive判断的API>Reactive判断的API</a></li></ul></li><li><a href=#ref-api aria-label="Ref API">Ref API</a><ul><li><a href=#%e5%9f%ba%e6%9c%ac%e4%bd%bf%e7%94%a8 aria-label=基本使用>基本使用</a></li><li><a href=#ref%e8%87%aa%e5%8a%a8%e8%a7%a3%e5%8c%85 aria-label=Ref自动解包>Ref自动解包</a></li><li><a href=#ref%e5%88%a4%e6%96%ad%e7%9a%84api aria-label=Ref判断的API>Ref判断的API</a></li><li><a href=#%e8%87%aa%e5%ae%9a%e4%b9%89ref--customref aria-label="自定义Ref => customRef">自定义Ref => <strong>customRef</strong></a></li></ul></li></ul></li><li><a href=#readonly aria-label=readonly>readonly</a><ul><li><a href=#%e6%a6%82%e5%bf%b5 aria-label=概念>概念</a></li></ul></li><li><a href=#torefs--toref aria-label="toRefs && toRef">toRefs && toRef</a><ul><li><a href=#torefs aria-label=toRefs><strong>toRefs</strong></a></li><li><a href=#toref aria-label=toRef><strong>toRef</strong></a></li></ul></li><li><a href=#computed aria-label=computed>computed</a><ul><li><a href=#%e6%96%b9%e5%bc%8f%e4%b8%80 aria-label=方式一>方式一</a></li><li><a href=#%e6%96%b9%e5%bc%8f%e4%ba%8c aria-label=方式二>方式二</a></li></ul></li><li><a href=#%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%e9%92%a9%e5%ad%90 aria-label=生命周期钩子>生命周期钩子</a></li><li><a href=#setup%e4%b8%ad%e4%bd%bf%e7%94%a8ref%e8%8e%b7%e5%8f%96%e5%85%83%e7%b4%a0%e6%88%96%e7%bb%84%e4%bb%b6 aria-label=setup中使用ref获取元素或组件>setup中使用ref获取元素或组件</a><ul><li><a href=#%e8%8e%b7%e5%8f%96%e5%85%83%e7%b4%a0 aria-label=获取元素>获取元素</a></li><li><a href=#%e8%8e%b7%e5%8f%96%e7%bb%84%e4%bb%b6 aria-label=获取组件>获取组件</a></li></ul></li><li><a href=#%e4%be%a6%e5%90%ac%e6%95%b0%e6%8d%ae%e7%9a%84%e5%8f%98%e5%8c%96 aria-label=侦听数据的变化>侦听数据的变化</a><ul><li><a href=#watcheffect aria-label=watchEffect>watchEffect</a><ul><li><a href=#%e5%9f%ba%e6%9c%ac%e4%bd%bf%e7%94%a8-1 aria-label=基本使用>基本使用</a></li><li><a href=#%e5%81%9c%e6%ad%a2%e7%9b%91%e5%90%ac aria-label=停止监听>停止监听</a></li><li><a href=#%e6%b8%85%e9%99%a4%e5%89%af%e4%bd%9c%e7%94%a8 aria-label=清除副作用>清除副作用</a></li><li><a href=#watcheffect%e7%9a%84%e6%89%a7%e8%a1%8c%e6%97%b6%e6%9c%ba aria-label=watchEffect的执行时机>watchEffect的执行时机</a></li></ul></li><li><a href=#watch aria-label=Watch>Watch</a><ul><li><a href=#%e4%be%a6%e5%90%ac%e5%8d%95%e4%b8%aa%e6%95%b0%e6%8d%ae%e6%ba%90 aria-label=侦听单个数据源>侦听单个数据源</a></li><li><a href=#%e4%be%a6%e5%90%ac%e5%a4%9a%e4%b8%aa%e6%95%b0%e6%8d%ae%e6%ba%90 aria-label=侦听多个数据源>侦听多个数据源</a></li><li><a href=#watch%e7%9a%84%e9%80%89%e9%a1%b9 aria-label=watch的选项>watch的选项</a></li><li><a href=#%e5%81%9c%e6%ad%a2%e4%be%a6%e5%90%ac aria-label=停止侦听>停止侦听</a></li><li><a href=#%e5%89%af%e4%bd%9c%e7%94%a8%e6%b8%85%e7%90%86 aria-label=副作用清理>副作用清理</a></li></ul></li></ul></li><li><a href=#provide--inject aria-label="provide && inject">provide && inject</a></li><li><a href=#h%e5%87%bd%e6%95%b0 aria-label=h函数>h函数</a><ul><li><a href=#%e5%8f%82%e6%95%b0 aria-label=参数>参数</a></li><li><a href=#%e5%9f%ba%e6%9c%ac%e4%bd%bf%e7%94%a8-2 aria-label=基本使用>基本使用</a><ul><li><a href=#%e5%9c%a8render%e5%87%bd%e6%95%b0%e9%80%89%e9%a1%b9%e4%b8%ad aria-label=在render函数选项中>在render函数选项中</a></li><li><a href=#%e5%9c%a8setup%e5%87%bd%e6%95%b0%e9%80%89%e9%a1%b9%e4%b8%ad aria-label=在setup函数选项中>在setup函数选项中</a></li><li><a href=#%e5%9c%a8setup%e8%af%ad%e6%b3%95%e7%b3%96%e4%b8%ad aria-label=在setup语法糖中>在setup语法糖中</a></li><li><a href=#%e5%85%b6%e4%bb%96%e5%86%99%e6%b3%95 aria-label=其他写法>其他写法</a></li></ul></li><li><a href=#%e5%87%bd%e6%95%b0%e7%bb%84%e4%bb%b6%e5%92%8c%e6%8f%92%e6%a7%bd%e7%9a%84%e4%bd%bf%e7%94%a8 aria-label=函数组件和插槽的使用>函数组件和插槽的使用</a></li></ul></li><li><a href=#jsx aria-label=Jsx>Jsx</a><ul><li><a href=#%e9%85%8d%e7%bd%ae aria-label=配置>配置</a><ul><li><a href=#vue-cli%e7%8e%af%e5%a2%83 aria-label=vue-cli环境>vue-cli环境</a></li><li><a href=#vite%e7%8e%af%e5%a2%83 aria-label=vite环境>vite环境</a></li></ul></li><li><a href=#%e5%9f%ba%e6%9c%ac%e4%bd%bf%e7%94%a8-3 aria-label=基本使用>基本使用</a><ul><li><a href=#%e5%9c%a8render%e5%87%bd%e6%95%b0%e4%b8%ad aria-label=在render函数中>在render函数中</a></li><li><a href=#%e5%9c%a8setup%e5%87%bd%e6%95%b0%e4%b8%ad aria-label=在setup函数中>在setup函数中</a></li><li><a href=#%e5%9c%a8setup%e8%af%ad%e6%b3%95%e7%b3%96%e4%b8%ad-1 aria-label=在setup语法糖中>在setup语法糖中</a></li></ul></li></ul></li><li><a href=#script-setup%e8%af%ad%e6%b3%95%e7%b3%96 aria-label="script setup语法糖">script setup语法糖</a><ul><li><a href=#%e9%a1%b6%e5%b1%82%e7%9a%84%e7%bb%91%e5%ae%9a%e4%bc%9a%e8%a2%ab%e6%9a%b4%e9%9c%b2%e7%bb%99%e6%a8%a1%e6%9d%bf aria-label=顶层的绑定会被暴露给模板>顶层的绑定会被暴露给模板</a></li><li><a href=#defineprops aria-label=defineProps()>defineProps()</a></li><li><a href=#defineemits aria-label=defineEmits()>defineEmits()</a></li><li><a href=#defineexpose aria-label=defineExpose()>defineExpose()</a></li></ul></li><li><a href=#%e8%87%aa%e5%ae%9a%e4%b9%89%e7%bb%84%e4%bb%b6 aria-label=自定义组件>自定义组件</a><ul><li><a href=#%e6%8c%87%e4%bb%a4%e7%9a%84%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f aria-label=指令的生命周期>指令的生命周期</a></li><li><a href=#%e6%8c%87%e4%bb%a4%e9%92%a9%e5%ad%90 aria-label=指令钩子>指令钩子</a></li><li><a href=#%e7%ae%80%e5%8d%95%e4%bd%bf%e7%94%a8 aria-label=简单使用>简单使用</a><ul><li><a href=#%e9%bb%98%e8%ae%a4%e5%ae%9e%e7%8e%b0%e6%96%b9%e5%bc%8f aria-label=默认实现方式>默认实现方式</a></li><li><a href=#%e4%bd%bf%e7%94%a8%e5%b1%80%e9%83%a8%e6%8c%87%e4%bb%a4 aria-label=使用局部指令>使用局部指令</a></li><li><a href=#%e8%87%aa%e5%ae%9a%e4%b9%89%e5%85%a8%e5%b1%80%e6%8c%87%e4%bb%a4 aria-label=自定义全局指令>自定义全局指令</a><ul><li><a href=#%e8%bf%9b%e8%a1%8c%e6%8a%bd%e5%8f%96 aria-label=进行抽取>进行抽取</a></li></ul></li><li><a href=#setup-1 aria-label=setup>setup</a><ul><li><a href=#%e5%87%bd%e6%95%b0 aria-label=函数>函数</a></li><li><a href=#%e8%af%ad%e6%b3%95%e7%b3%96 aria-label=语法糖>语法糖</a></li></ul></li></ul></li></ul></li><li><a href=#%e5%86%85%e7%bd%ae%e7%bb%84%e4%bb%b6 aria-label=内置组件>内置组件</a><ul><li><a href=#teleport aria-label=Teleport>Teleport</a><ul><li><a href=#%e5%9f%ba%e6%9c%ac%e4%bd%bf%e7%94%a8-4 aria-label=基本使用>基本使用</a></li><li><a href=#%e6%8c%82%e8%bd%bd%e5%88%b0app%e4%b9%8b%e5%a4%96%e7%9a%84%e6%8c%87%e5%ae%9a%e5%85%83%e7%b4%a0%e4%b8%8a aria-label=挂载到#app之外的指定元素上>挂载到#app之外的指定元素上</a></li><li><a href=#%e5%a4%9a%e4%b8%aateleport aria-label=多个Teleport>多个Teleport</a></li></ul></li><li><a href=#%e5%85%b6%e4%bb%96 aria-label=其他>其他</a></li></ul></li><li><a href=#vue%e6%8f%92%e4%bb%b6 aria-label=Vue插件>Vue插件</a><ul><li><a href=#%e5%af%b9%e8%b1%a1%e7%b1%bb%e5%9e%8b aria-label=对象类型>对象类型</a></li><li><a href=#%e5%87%bd%e6%95%b0%e7%b1%bb%e5%9e%8b aria-label=函数类型>函数类型</a></li><li><a href=#%e6%94%b9%e5%86%99%e8%87%aa%e5%ae%9a%e4%b9%89%e6%8c%87%e4%bb%a4 aria-label=改写自定义指令>改写自定义指令</a></li></ul></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h2 id=options-api的弊端>Options API的弊端<a hidden class=anchor aria-hidden=true href=#options-api的弊端>#</a></h2><ul><li><p>在Vue2中，我们编写组件的方式是Options API：</p><ul><li>Options API的一大特点就是在对应的属性中编写对应的功能模块；</li><li>比如data定义数据、methods中定义方法、computed中定义计算属性、watch中监听属性改变，也包括生命 周期钩子；</li></ul></li><li><p>但是这种代码有一个很大的弊端：</p><ul><li>当我们实现某一个功能时，这个功能对应的代码逻辑会被拆分到各个属性中；</li><li>当我们组件变得更大、更复杂时，逻辑关注点的列表就会增长，那么同一个功能的逻辑就会被拆分的很分散；</li><li>尤其对于那些一开始没有编写这些组件的人来说，这个组件的代码是难以阅读和理解的（阅读组件的其他人）；</li></ul></li><li><p>下面我们来看一个非常大的组件，其中的逻辑功能按照颜色进行了划分：</p><ul><li>这种碎片化的代码使用理解和维护这个复杂的组件变得异常困难，并且隐藏了潜在的逻辑问题；</li><li>并且当我们处理单个逻辑关注点时，需要不断的跳到相应的代码块中；</li></ul></li></ul><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202312160000793.png><img src=https://qiniu.waite.wang/202312160000793.png alt=image-20231216000029755></a></div></p><ul><li>如果我们能将同一个逻辑关注 点相关的代码收集在一起会更 好。</li><li>这就是Composition API想 要做的事情，以及可以帮助我 们完成的事情。</li><li>也有人把Vue Composition API简称为VCA。</li><li>我们无需再为了一个逻辑关注点在不同的选项块间来回滚动切换。此外，我们现在可以很轻松地将这一组代码移动到一个外部文件中，不再需要为了抽象而重新组织代码，大大降低了重构成本，这在长期维护的大型项目中非常关键。</li></ul><h2 id=认识-组合式-api-composition-api>认识 组合式 API (Composition API)<a hidden class=anchor aria-hidden=true href=#认识-组合式-api-composition-api>#</a></h2><blockquote><p><a href=https://cn.vuejs.org/guide/extras/composition-api-faq.html#what-is-composition-api target=_blank>https://cn.vuejs.org/guide/extras/composition-api-faq.html#what-is-composition-api</a></p></blockquote><p>组合式 API (Composition API) 是一系列 API 的集合，使我们可以使用函数而不是声明选项的方式书写 Vue 组件。它是一个概括性的术语，涵盖了以下方面的 API：</p><ul><li><a href=https://cn.vuejs.org/api/reactivity-core.html target=_blank>响应式 API</a>：例如 <code>ref()</code> 和 <code>reactive()</code>，使我们可以直接创建响应式状态、计算属性和侦听器。</li><li><a href=https://cn.vuejs.org/api/composition-api-lifecycle.html target=_blank>生命周期钩子</a>：例如 <code>onMounted()</code> 和 <code>onUnmounted()</code>，使我们可以在组件各个生命周期阶段添加逻辑。</li><li><a href=https://cn.vuejs.org/api/composition-api-dependency-injection.html target=_blank>依赖注入</a>：例如 <code>provide()</code> 和 <code>inject()</code>，使我们可以在使用响应式 API 时，利用 Vue 的依赖注入系统。</li></ul><p>组合式 API 是 Vue 3 及
<a href=https://blog.vuejs.org/posts/vue-2-7-naruto.html target=_blank>Vue 2.7</a> 的内置功能。对于更老的 Vue 2 版本，可以使用官方维护的插件
<a href=https://github.com/vuejs/composition-api target=_blank><code>@vue/composition-api</code></a>。在 Vue 3 中，组合式 API 基本上都会配合
<a href=https://cn.vuejs.org/api/sfc-script-setup.html target=_blank>``</a> 语法在单文件组件中使用。下面是一个使用组合式 API 的组件示例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>ref</span><span class=p>,</span> <span class=nx>onMounted</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 响应式状态
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>count</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 更改状态、触发更新的函数
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>function</span> <span class=nx>increment</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>count</span><span class=p>.</span><span class=nx>value</span><span class=o>++</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 生命周期钩子
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>onMounted</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`计数器初始值为 </span><span class=si>${</span><span class=nx>count</span><span class=p>.</span><span class=nx>value</span><span class=si>}</span><span class=sb>。`</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>button</span> <span class=nt>@click</span><span class=s>=&#34;increment&#34;</span><span class=p>&gt;</span><span class=na>点击了</span><span class=err>：</span><span class=p>{{</span> <span class=na>count</span> <span class=p>}}</span> <span class=na>次</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>虽然这套 API 的风格是基于函数的组合，但<strong>组合式 API 并不是函数式编程</strong>。组合式 API 是以 Vue 中数据可变的、细粒度的响应性系统为基础的，而函数式编程通常强调数据不可变。</p><h2 id=setup>setup()<a hidden class=anchor aria-hidden=true href=#setup>#</a></h2><blockquote><p>以下的代码 均会采用选项式的写法, 组合式 Api 的写法可以参考官方文档, 但基本原理差不多, 而且 Vue3 选项式写法是基于组合式写法产生的!</p></blockquote><p><code>setup()</code> 钩子是在组件中使用组合式 API 的入口，通常只在以下情况下使用：</p><ol><li>需要在非单文件组件中使用组合式 API 时。</li><li>需要在基于选项式 API 的组件中集成基于组合式 API 的代码时。</li></ol><h3 id=setup函数的参数>setup函数的参数<a hidden class=anchor aria-hidden=true href=#setup函数的参数>#</a></h3><ul><li>主要有两个参数:<ul><li>第一个参数：props</li><li>第二个参数：context</li></ul></li><li><code>setup</code> 函数的第一个参数是组件的 <code>props</code>。和标准的组件一致，一个 <code>setup</code> 函数的 <code>props</code> 是响应式的，并且会在传入新的 props 时同步更新。：<ul><li>对于定义props的类型，我们还是和之前的规则是一样的，在props选项中定义；</li><li>并且在template中依然是可以正常去使用props中的属性，比如message；</li><li>如果我们在setup函数中想要使用props，那么不可以通过 this 去获取</li></ul></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=c>&lt;!--</span> <span class=nx>推荐使用以下写法</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>ref</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>count</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 返回值会暴露给模板和其他的选项式 API 钩子
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>count</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>mounted</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>count</span><span class=p>)</span> <span class=c1>// 0
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>button</span> <span class=nt>@click</span><span class=s>=&#34;count++&#34;</span><span class=p>&gt;{{</span> <span class=na>count</span> <span class=p>}}&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=c>&lt;!--</span> <span class=nx>当然也可以使用以下写法</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>props</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>message</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>type</span><span class=o>:</span> <span class=nb>String</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>required</span><span class=o>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>data</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>counter</span><span class=o>:</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>setup</span><span class=p>(</span><span class=nx>props</span><span class=p>,</span> <span class=p>....){</span>
</span></span><span class=line><span class=cl>      <span class=p>.....</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><ul><li><code>setup</code> 函数的第一个参数是组件的 <code>props</code>。和标准的组件一致，一个 <code>setup</code> 函数的 <code>props</code> 是响应式的，并且会在传入新的 props 时同步更新。</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>props</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>title</span><span class=o>:</span> <span class=nb>String</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>(</span><span class=nx>props</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>props</span><span class=p>.</span><span class=nx>title</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>请注意如果你解构了 <code>props</code> 对象，解构出的变量将会丢失响应性。因此我们推荐通过 <code>props.xxx</code> 的形式来使用其中的 props。</p><p>如果你确实需要解构 <code>props</code> 对象，或者需要将某个 prop 传到一个外部函数中并保持响应性，那么你可以使用
<a href=https://cn.vuejs.org/api/reactivity-utilities.html#torefs target=_blank>toRefs()</a> 和
<a href=https://cn.vuejs.org/api/reactivity-utilities.html#toref target=_blank>toRef()</a> 这两个工具函数：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>toRefs</span><span class=p>,</span> <span class=nx>toRef</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>(</span><span class=nx>props</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 将 `props` 转为一个其中全是 ref 的对象，然后解构
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=p>{</span> <span class=nx>title</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>toRefs</span><span class=p>(</span><span class=nx>props</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1>// `title` 是一个追踪着 `props.title` 的 ref
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>title</span><span class=p>.</span><span class=nx>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 或者，将 `props` 的单个属性转为一个 ref
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>title</span> <span class=o>=</span> <span class=nx>toRef</span><span class=p>(</span><span class=nx>props</span><span class=p>,</span> <span class=s1>&#39;title&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><ul><li>另外一个参数是context，我们也称之为是一个SetupContext，它里面包含三个属性：<ul><li>attrs：所有的非prop的attribute；</li><li>slots：父组件传递过来的插槽（这个在以渲染函数返回时会有作用，后面会讲到）；</li><li>emit：当我们组件内部需要发出事件时会用到emit（因为我们不能访问this，所以不可以通过 this.$emit发出事件）；</li></ul></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>(</span><span class=nx>props</span><span class=p>,</span> <span class=nx>context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 透传 Attributes（非响应式的对象，等价于 $attrs）
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>attrs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 插槽（非响应式的对象，等价于 $slots）
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>slots</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 触发事件（函数，等价于 $emit）
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>emit</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 暴露公共属性（函数）
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>expose</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>   <span class=c1>// 该上下文对象是非响应式的，可以安全地解构：
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>setup</span><span class=p>(</span><span class=nx>props</span><span class=p>,</span> <span class=p>{</span><span class=nx>attrs</span><span class=p>,</span> <span class=nx>slots</span><span class=p>,</span> <span class=nx>emit</span><span class=p>})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>props</span><span class=p>.</span><span class=nx>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>attrs</span><span class=p>.</span><span class=nx>id</span><span class=p>,</span> <span class=nx>attrs</span><span class=p>.</span><span class=kr>class</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>slots</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>emit</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><code>attrs</code> 和 <code>slots</code> 都是有状态的对象，它们总是会随着组件自身的更新而更新。这意味着你应当避免解构它们，并始终通过 <code>attrs.x</code> 或 <code>slots.x</code> 的形式使用其中的属性。此外还需注意，和 <code>props</code> 不同，<code>attrs</code> 和 <code>slots</code> 的属性都<strong>不是</strong>响应式的。如果你想要基于 <code>attrs</code> 或 <code>slots</code> 的改变来执行副作用，那么你应该在 <code>onBeforeUpdate</code> 生命周期钩子中编写相关逻辑。</p><blockquote><p>代码示例</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>HelloWorld</span> <span class=na>msg</span><span class=o>=</span><span class=s>&#34;Welcome to Your Vue.js App&#34;</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;app-attr&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>HelloWorld</span> <span class=nx>from</span> <span class=s1>&#39;./components/HelloWorld.vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;App&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>components</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>HelloWorld</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>style</span><span class=p>&gt;&lt;/</span><span class=nt>style</span><span class=p>&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;hello&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!--</span> <span class=nx>使用接受过来的参数</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>{{</span> <span class=nx>msg</span> <span class=p>}}</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;HelloWorld&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 组件接受的参数
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>props</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>msg</span><span class=o>:</span> <span class=nb>String</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 发射的事件这里可以标注一下
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>emits</span><span class=o>:</span><span class=p>[</span><span class=s1>&#39;change&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>(</span><span class=nx>props</span><span class=p>,</span> <span class=nx>context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 这样可以拿到传递过来的msg的值
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>props</span><span class=p>.</span><span class=nx>msg</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// attrs
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>attrs</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 发射事件
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>context</span><span class=p>.</span><span class=nx>emit</span><span class=p>(</span><span class=s1>&#39;change&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>style</span> <span class=na>scoped</span><span class=p>&gt;&lt;/</span><span class=nt>style</span><span class=p>&gt;</span>
</span></span></code></pre></div><h3 id=setup函数的返回值>setup函数的返回值<a hidden class=anchor aria-hidden=true href=#setup函数的返回值>#</a></h3><p><code>setup</code> 也可以返回一个
<a href=https://cn.vuejs.org/guide/extras/render-function.html target=_blank>渲染函数</a>，此时在渲染函数中可以直接使用在同一作用域下声明的响应式状态：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>h</span><span class=p>,</span> <span class=nx>ref</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>count</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>h</span><span class=p>(</span><span class=s1>&#39;div&#39;</span><span class=p>,</span> <span class=nx>count</span><span class=p>.</span><span class=nx>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>返回一个渲染函数将会阻止我们返回其他东西。对于组件内部来说，这样没有问题，但如果我们想通过模板引用将这个组件的方法暴露给父组件，那就有问题了。</p><p>我们可以通过调用
<a href=https://cn.vuejs.org/api/composition-api-setup.html#exposing-public-properties target=_blank><code>expose()</code></a> 解决这个问题：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>h</span><span class=p>,</span> <span class=nx>ref</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>(</span><span class=nx>props</span><span class=p>,</span> <span class=p>{</span> <span class=nx>expose</span> <span class=p>})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>count</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>increment</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=o>++</span><span class=nx>count</span><span class=p>.</span><span class=nx>value</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>expose</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>increment</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>h</span><span class=p>(</span><span class=s1>&#39;div&#39;</span><span class=p>,</span> <span class=nx>count</span><span class=p>.</span><span class=nx>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>此时父组件可以通过模板引用来访问这个 <code>increment</code> 方法。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>props</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>message</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>type</span><span class=o>:</span> <span class=nb>String</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>required</span><span class=o>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>counter</span> <span class=o>=</span> <span class=mi>100</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 局部函数
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>increment</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>counter</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>counter</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>title</span><span class=o>:</span> <span class=s2>&#34;Hello Home&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>counter</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>increment</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><ul><li>setup的返回值可以在模板template中被使用</li><li>也就是说可以通过setup的返回值来替代data选项</li></ul><blockquote><p><strong>最后导出的一定要是个对象</strong></p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;hello&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!--</span> <span class=nx>使用导出的变量</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;{{</span> <span class=nx>count</span> <span class=p>}}&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!--</span> <span class=nx>使用导出的方法</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>button</span> <span class=nt>@click</span><span class=s>=&#34;increment&#34;</span><span class=p>&gt;</span><span class=err>+</span> <span class=na>1</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;HelloWorld&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 定义普通的变量，可以被正常使用
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// 缺点 : 数据不是响应式的
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>let</span> <span class=nx>count</span> <span class=o>=</span> <span class=mi>100</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 定义方法
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>increment</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>count</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>count</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 导出
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>count</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>increment</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>style</span> <span class=na>scoped</span><span class=p>&gt;&lt;/</span><span class=nt>style</span><span class=p>&gt;</span>
</span></span></code></pre></div><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202312162228196.gif><img src=https://qiniu.waite.wang/202312162228196.gif alt=img></a></div></p><blockquote><p><strong>因为只是定义了个变量，然后导出了，并没有使它响应式</strong></p></blockquote><h3 id=补充-为什么-setup-不能使用-this>补充: 为什么 setup 不能使用 this<a hidden class=anchor aria-hidden=true href=#补充-为什么-setup-不能使用-this>#</a></h3><p>在Vue 3中，<code>setup </code>函数是用来替代以前的 <code>data</code>, <code>computed</code>, <code>methods </code>等选项的。<code>setup()</code> 自身并不含对组件实例的访问权，即在 <code>setup()</code> 中访问 <code>this</code> 会是 <code>undefined</code>。你可以在选项式 API 中访问组合式 API 暴露的值，但反过来则不行。</p><h2 id=定义响应式数据的两种方式>定义响应式数据的两种方式<a hidden class=anchor aria-hidden=true href=#定义响应式数据的两种方式>#</a></h2><h3 id=reactive-api>Reactive API<a hidden class=anchor aria-hidden=true href=#reactive-api>#</a></h3><blockquote><p>如果想为在setup中定义的数据提供响应式的特性，那么可以使用reactive的函数</p><p>ps : 如果传入一个基本数据类型（String、Number、Boolean）会报一个警告</p><p>应用场景 : reactive API对传入的类型是有限制的，它要求我们必须传入的是一个对象或者数组类型，最好相互有关联的数据时使用</p></blockquote><p>比如说想要上面的例子实现响应式, 我们可以做如下操作</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;hello&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!--</span> <span class=nx>这样使用即可</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;{{</span> <span class=nx>state</span><span class=p>.</span><span class=nx>count</span> <span class=p>}}&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>button</span> <span class=nt>@click</span><span class=s>=&#34;increment&#34;</span><span class=p>&gt;</span><span class=err>+</span> <span class=na>1</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=c1>// 从vue中导入reactive
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=p>{</span> <span class=nx>reactive</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;HelloWorld&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 使用reactive，会返回一个响应式对象
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>state</span> <span class=o>=</span> <span class=nx>reactive</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 在对象中编写自己所需要的属性
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>count</span><span class=o>:</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>increment</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 这样使用
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>state</span><span class=p>.</span><span class=nx>count</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>state</span><span class=p>.</span><span class=nx>count</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 导出响应式state对象
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>state</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>increment</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><h4 id=reactive判断的api>Reactive判断的API<a hidden class=anchor aria-hidden=true href=#reactive判断的api>#</a></h4><ul><li>isProxy : 检查对象是否是由 reactive 或 readonly创建的 proxy</li><li>isReactive : 检查对象是否是由 reactive创建的响应式代理，如果该代理是 readonly 建的，但包裹了由 reactive 创建的另一个代理，它也会返回 true</li><li>isReadonly : 检查对象是否是由 readonly 创建的只读代理</li><li>toRaw : 返回 reactive 或 readonly 代理的原始对象（不建议保留对原始对象的持久引用。请谨慎使用）</li><li>shallowReactive : 创建一个响应式代理，它跟踪其自身 property 的响应性，但不执行嵌套对象的深层响应式转换 (深层还是原生对象)，只响应第一层</li><li>shallowReadonly : 创建一个 proxy，使其自身的 property 为只读，但不执行嵌套对象的深度只读转换（深层还是可读、可写的）只检查第一层</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>reactive</span><span class=p>,</span> <span class=nx>readonly</span><span class=p>,</span> <span class=nx>isProxy</span><span class=p>,</span> <span class=nx>isReactive</span><span class=p>,</span> <span class=nx>isReadonly</span><span class=p>,</span> <span class=nx>toRaw</span><span class=p>,</span> <span class=nx>shallowReactive</span><span class=p>,</span> <span class=nx>shallowReadonly</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 创建一个响应式对象
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>original</span> <span class=o>=</span> <span class=p>{</span> <span class=nx>count</span><span class=o>:</span> <span class=mi>0</span> <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>obj</span> <span class=o>=</span> <span class=nx>reactive</span><span class=p>(</span><span class=nx>original</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 检查对象是否是代理对象
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>isProxy</span><span class=p>(</span><span class=nx>obj</span><span class=p>));</span> <span class=c1>// true
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// 检查对象是否是由 reactive 创建的响应式代理
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>isReactive</span><span class=p>(</span><span class=nx>obj</span><span class=p>));</span> <span class=c1>// true
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// 检查对象是否是由 readonly 创建的只读代理
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>ro</span> <span class=o>=</span> <span class=nx>readonly</span><span class=p>(</span><span class=nx>obj</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>isReadonly</span><span class=p>(</span><span class=nx>ro</span><span class=p>));</span> <span class=c1>// true
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// 返回 reactive 或 readonly 代理的原始对象
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>rawObj</span> <span class=o>=</span> <span class=nx>toRaw</span><span class=p>(</span><span class=nx>obj</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 创建一个浅层响应式代理
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>shallowObj</span> <span class=o>=</span> <span class=nx>shallowReactive</span><span class=p>({</span> <span class=nx>nested</span><span class=o>:</span> <span class=p>{</span> <span class=nx>count</span><span class=o>:</span> <span class=mi>0</span> <span class=p>}</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 创建一个浅层只读代理
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>shallowRo</span> <span class=o>=</span> <span class=nx>shallowReadonly</span><span class=p>({</span> <span class=nx>nested</span><span class=o>:</span> <span class=p>{</span> <span class=nx>count</span><span class=o>:</span> <span class=mi>0</span> <span class=p>}</span> <span class=p>});</span>
</span></span></code></pre></div><blockquote><p>以下是一些名词解释:</p><ul><li>代理对象：在Vue 3中，代理对象是由 reactive 或 readonly 创建的对象的代理，用于跟踪对象的属性的变化。</li><li>readonly：readonly 是一个函数，用于创建一个只读的代理对象，该代理对象只能读取属性值，不能修改属性值。</li><li>浅层响应式：浅层响应式是指只有对象的第一层属性会被设置为响应式，而嵌套对象的属性不会被设置为响应式。</li><li>浅层只读代理：浅层只读代理是指只有对象的第一层属性会被设置为只读，而嵌套对象的属性不会被设置为只读。</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>reactive</span><span class=p>,</span> <span class=nx>readonly</span><span class=p>,</span> <span class=nx>shallowReactive</span><span class=p>,</span> <span class=nx>shallowReadonly</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 创建一个普通对象
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>original</span> <span class=o>=</span> <span class=p>{</span> <span class=nx>count</span><span class=o>:</span> <span class=mi>0</span><span class=p>,</span> <span class=nx>nested</span><span class=o>:</span> <span class=p>{</span> <span class=nx>count</span><span class=o>:</span> <span class=mi>1</span> <span class=p>}</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 创建一个响应式代理对象
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>reactiveObj</span> <span class=o>=</span> <span class=nx>reactive</span><span class=p>(</span><span class=nx>original</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>reactiveObj</span><span class=p>.</span><span class=nx>count</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span> <span class=c1>// 可以修改属性值
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>reactiveObj</span><span class=p>.</span><span class=nx>nested</span><span class=p>.</span><span class=nx>count</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span> <span class=c1>// 嵌套对象的属性也会被设置为响应式
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// 创建一个只读代理对象
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>readonlyObj</span> <span class=o>=</span> <span class=nx>readonly</span><span class=p>(</span><span class=nx>original</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// readonlyObj.count = 2; // 试图修改只读属性会报错
</span></span></span><span class=line><span class=cl><span class=c1>// readonlyObj.nested.count = 2; // 嵌套对象的属性也是只读的
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// 创建一个浅层响应式代理对象
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>shallowReactiveObj</span> <span class=o>=</span> <span class=nx>shallowReactive</span><span class=p>(</span><span class=nx>original</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>shallowReactiveObj</span><span class=p>.</span><span class=nx>count</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span> <span class=c1>// 可以修改属性值
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>shallowReactiveObj</span><span class=p>.</span><span class=nx>nested</span><span class=p>.</span><span class=nx>count</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span> <span class=c1>// 嵌套对象的属性不会被设置为响应式
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// 创建一个浅层只读代理对象
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>shallowReadonlyObj</span> <span class=o>=</span> <span class=nx>shallowReadonly</span><span class=p>(</span><span class=nx>original</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>shallowReadonlyObj</span><span class=p>.</span><span class=nx>count</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span> <span class=c1>// 试图修改只读属性会报错
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>shallowReadonlyObj</span><span class=p>.</span><span class=nx>nested</span><span class=p>.</span><span class=nx>count</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span> <span class=c1>// 嵌套对象的属性不会被设置为只读
</span></span></span></code></pre></div></blockquote><h3 id=ref-api>Ref API<a hidden class=anchor aria-hidden=true href=#ref-api>#</a></h3><blockquote><p><strong>Ref函数 : 定义简单类型的数据，也可以定义复杂类型的数据</strong></p><p><strong>应用场景 : 定义一些简单的数据，或者从接口中获得的数据</strong></p></blockquote><ul><li>ref 会返回一个可变的响应式对象，该对象作为一个 响应式的引用 维护着它内部的值，这就是ref名称的来源</li><li>它内部的值是在<code>ref</code>的 <code>value</code> 属性中被维护的</li><li>不管传入的是基本类型还是引用类型，都放在<code>.value</code>中</li></ul><blockquote><p>使用的时候是用 .value，但是有两个注意事项:</p><ul><li>在模板中引入ref的值时，Vue会自动帮助我们进行解包操作，所以并不需要在模板中通过 ref.value 的方式，直接使用即可</li><li>在 setup 函数内部，它依然是一个 ref引用， 所以对其进行操作时，依然需要使用 ref.value的方式</li></ul></blockquote><h4 id=基本使用>基本使用<a hidden class=anchor aria-hidden=true href=#基本使用>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;hello&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!--</span> <span class=nx>这样使用即可</span><span class=err>，</span><span class=nx>不需要使用count</span><span class=p>.</span><span class=nx>value</span><span class=err>，</span><span class=nx>会自动解包</span><span class=err>，</span><span class=nx>取出其中的value</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;{{</span> <span class=nx>count</span> <span class=p>}}&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>button</span> <span class=nt>@click</span><span class=s>=&#34;increment&#34;</span><span class=p>&gt;</span><span class=err>+</span> <span class=na>1</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=c1>// 从vue中导入ref
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=p>{</span> <span class=nx>ref</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;HelloWorld&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 使用Ref，会返回一个响应式对象
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>let</span> <span class=nx>count</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=mi>100</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>increment</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 这样使用,需要使用 .value
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>count</span><span class=p>.</span><span class=nx>value</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>count</span><span class=p>.</span><span class=nx>value</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 直接导出count即可
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>count</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>increment</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><h4 id=ref自动解包>Ref自动解包<a hidden class=anchor aria-hidden=true href=#ref自动解包>#</a></h4><ul><li>模板中的解包是浅层的解包，如果我们的代码是下面的方式：</li><li>如果我们将<code>ref</code>放到一个<code>reactive</code>的属性当中，那么在模板中使用时，它会自动解包：</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>count</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>obj</span> <span class=o>=</span> <span class=nx>reactive</span><span class=p>({</span> <span class=nx>count</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ref 会被解包
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>obj</span><span class=p>.</span><span class=nx>count</span> <span class=o>===</span> <span class=nx>count</span><span class=p>.</span><span class=nx>value</span><span class=p>)</span> <span class=c1>// true
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// 会更新 `obj.count`
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>count</span><span class=p>.</span><span class=nx>value</span><span class=o>++</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>count</span><span class=p>.</span><span class=nx>value</span><span class=p>)</span> <span class=c1>// 2
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>obj</span><span class=p>.</span><span class=nx>count</span><span class=p>)</span> <span class=c1>// 2
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// 也会更新 `count` ref
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>obj</span><span class=p>.</span><span class=nx>count</span><span class=o>++</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>obj</span><span class=p>.</span><span class=nx>count</span><span class=p>)</span> <span class=c1>// 3
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>count</span><span class=p>.</span><span class=nx>value</span><span class=p>)</span> <span class=c1>// 3
</span></span></span></code></pre></div><p>注意当访问到某个响应式数组或 <code>Map</code> 这样的原生集合类型中的 ref 元素时，<strong>不会</strong>执行 ref 的解包：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>books</span> <span class=o>=</span> <span class=nx>reactive</span><span class=p>([</span><span class=nx>ref</span><span class=p>(</span><span class=s1>&#39;Vue 3 Guide&#39;</span><span class=p>)])</span>
</span></span><span class=line><span class=cl><span class=c1>// 这里需要 .value
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>books</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=nx>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>map</span> <span class=o>=</span> <span class=nx>reactive</span><span class=p>(</span><span class=k>new</span> <span class=nx>Map</span><span class=p>([[</span><span class=s1>&#39;count&#39;</span><span class=p>,</span> <span class=nx>ref</span><span class=p>(</span><span class=mi>0</span><span class=p>)]]))</span>
</span></span><span class=line><span class=cl><span class=c1>// 这里需要 .value
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>map</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;count&#39;</span><span class=p>).</span><span class=nx>value</span><span class=p>)</span>
</span></span></code></pre></div><h4 id=ref判断的api>Ref判断的API<a hidden class=anchor aria-hidden=true href=#ref判断的api>#</a></h4><ul><li>isRef : 判断值是否是一个ref对象</li><li>unref : 如果我们想要获取一个ref引用中的value，那么也可以通过unref方法<ul><li>如果参数是一个 ref，则返回内部值，否则返回参数本身</li><li>这是 val = isRef(val) ? val.value : val 的语法糖函数</li></ul></li><li>shallowRef：shallowRef 是用来创建一个浅层的 ref 对象的函数。浅层的意思是只有对象的第一层属性会被设置为响应式，而嵌套对象的属性不会被设置为响应式。这意味着对嵌套对象属性的修改不会触发响应。</li><li>triggerRef：triggerRef 用于手动触发与 shallowRef 相关联的副作用。当 shallowRef 关联的数据发生变化时，相关的副作用将被触发执行。</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>ref</span><span class=p>,</span> <span class=nx>isRef</span><span class=p>,</span> <span class=nx>unref</span><span class=p>,</span> <span class=nx>shallowRef</span><span class=p>,</span> <span class=nx>triggerRef</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 判断值是否是一个 ref 对象
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>count</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>isRef</span><span class=p>(</span><span class=nx>count</span><span class=p>));</span> <span class=c1>// true
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// 获取 ref 引用中的值
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>value</span> <span class=o>=</span> <span class=nx>unref</span><span class=p>(</span><span class=nx>count</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 语法糖函数示例
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>val</span> <span class=o>=</span> <span class=nx>isRef</span><span class=p>(</span><span class=nx>count</span><span class=p>)</span> <span class=o>?</span> <span class=nx>count</span><span class=p>.</span><span class=nx>value</span> <span class=o>:</span> <span class=nx>count</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 创建一个浅层的 ref 对象
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>shallowCount</span> <span class=o>=</span> <span class=nx>shallowRef</span><span class=p>({</span> <span class=nx>value</span><span class=o>:</span> <span class=mi>0</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=nx>shallowCount</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span> <span class=c1>// 可以直接修改 value 属性
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// 手动触发与 shallowRef 相关联的副作用
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>triggerRef</span><span class=p>(</span><span class=nx>shallowCount</span><span class=p>);</span>
</span></span></code></pre></div><h4 id=自定义ref--customref>自定义Ref => <strong>customRef</strong><a hidden class=anchor aria-hidden=true href=#自定义ref--customref>#</a></h4><ul><li>创建一个自定义的ref，并对其依赖项跟踪和更新触发进行显示控制：<ul><li>它需要一个工厂函数，该函数接受 <code>track </code>和 <code>trigger </code>函数作为参数；</li><li>并且应该返回一个带有 <code>get </code>和 <code>set</code> 的对象；</li></ul></li><li>这里我们使用一个的案例：<ul><li>对双向绑定的属性进行debounce(节流)的操作</li></ul></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>customRef</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 自定义ref
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>export</span> <span class=k>default</span> <span class=kd>function</span><span class=p>(</span><span class=nx>value</span><span class=p>,</span> <span class=nx>delay</span> <span class=o>=</span> <span class=mi>300</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>timer</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span> 
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>customRef</span><span class=p>((</span><span class=nx>track</span><span class=p>,</span> <span class=nx>trigger</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>get</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>track</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nx>set</span><span class=p>(</span><span class=nx>newValue</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>clearTimeout</span><span class=p>(</span><span class=nx>timer</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>timer</span> <span class=o>=</span> <span class=nx>setTimeout</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>value</span> <span class=o>=</span> <span class=nx>newValue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          <span class=nx>trigger</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span> <span class=nx>delay</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>v</span><span class=nt>-model</span><span class=err>=&#34;</span><span class=na>message</span><span class=err>&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h2</span><span class=p>&gt;{{</span><span class=nx>message</span><span class=p>}}&lt;/</span><span class=nt>h2</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=kr>import</span> <span class=nx>debounceRef</span> <span class=nx>from</span> <span class=s1>&#39;./hook/useDebounceRef&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>message</span> <span class=o>=</span> <span class=nx>debounceRef</span><span class=p>(</span><span class=s2>&#34;Hello World&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>message</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><h2 id=readonly>readonly<a hidden class=anchor aria-hidden=true href=#readonly>#</a></h2><h3 id=概念>概念<a hidden class=anchor aria-hidden=true href=#概念>#</a></h3><blockquote><p>在我们传递给其他组件数据时，往往希望其他组件使用我们传递的内容，但是不允许它们修改时，就可以使用 <code>readonly</code>了；</p></blockquote><ul><li>只读代理是深层的：对任何嵌套属性的访问都将是只读的。它的 ref 解包行为与 <code>reactive()</code> 相同，但解包得到的值是只读的。</li><li>要避免深层级的转换行为，请使用
<a href=https://cn.vuejs.org/api/reactivity-advanced.html#shallowreadonly target=_blank>shallowReadonly()</a> 作替代。</li><li>在开发中常见的readonly方法会传入三个类型的参数：<ul><li>类型一：普通对象</li><li>类型二：reactive返回的对象</li><li>类型三：ref的对象</li></ul></li><li>在readonly的使用过程中，有如下规则 :<ul><li>readonly返回的对象都是不允许修改的</li><li>但是经过readonly处理的原来的对象是允许被修改的<ul><li>比如 const info = readonly(obj)，info对象是不允许被修改的</li><li>当obj被修改时，readonly返回的info对象也会被修改</li><li>但是不能去修改readonly返回的对象info</li></ul></li></ul></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;hello&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>button</span> <span class=nt>@click</span><span class=s>=&#34;btnClick&#34;</span><span class=p>&gt;</span><span class=na>按钮</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>reactive</span><span class=p>,</span> <span class=nx>readonly</span><span class=p>,</span> <span class=nx>watchEffect</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>original</span> <span class=o>=</span> <span class=nx>reactive</span><span class=p>({</span> <span class=nx>count</span><span class=o>:</span> <span class=mi>0</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>copy</span> <span class=o>=</span> <span class=nx>readonly</span><span class=p>(</span><span class=nx>original</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>btnClick</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>original</span><span class=p>.</span><span class=nx>count</span><span class=o>++</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>watchEffect</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 用来做响应性追踪
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>copy</span><span class=p>.</span><span class=nx>count</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 更改源属性会触发其依赖的侦听器
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>original</span><span class=p>.</span><span class=nx>count</span><span class=o>++</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 更改该只读副本将会失败，并会得到一个警告
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>copy</span><span class=p>.</span><span class=nx>count</span><span class=o>++</span> <span class=c1>// warning!
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><h2 id=torefs--toref>toRefs && toRef<a hidden class=anchor aria-hidden=true href=#torefs--toref>#</a></h2><h3 id=torefs><strong>toRefs</strong><a hidden class=anchor aria-hidden=true href=#torefs>#</a></h3><blockquote><p>如果使用ES6的解构语法，对reactive返回的对象进行解构获取值，那么之后无论是修改结构后的变量，还是修改reactive 返回的state对象，数据都不再是响应式的</p></blockquote><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202312171700262.png><img src=https://qiniu.waite.wang/202312171700262.png alt=image-20231217170024283></a></div></p><ul><li>如何改成响应式呢，Vue提供了一个toRefs的函数</li><li>可以将reactive返回的对象中的属性都转成ref，这样解构出来的就是响应式的了</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;hello&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;{{</span> <span class=nx>age</span> <span class=p>}}&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>button</span> <span class=nt>@click</span><span class=s>=&#34;increment&#34;</span><span class=p>&gt;</span><span class=err>+</span><span class=na>age</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=c1>// 从vue中导入ref
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=p>{</span> <span class=nx>reactive</span><span class=p>,</span> <span class=nx>ref</span><span class=p>,</span> <span class=nx>readonly</span><span class=p>,</span> <span class=nx>toRefs</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;HelloWorld&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>info</span> <span class=o>=</span> <span class=nx>reactive</span><span class=p>({</span> <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;star&#39;</span><span class=p>,</span> <span class=nx>age</span><span class=o>:</span> <span class=mi>18</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 使用toRefs包裹需要结构的reactive对象，这样解构出来的值也是响应式的
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>let</span> <span class=p>{</span> <span class=nx>name</span><span class=p>,</span> <span class=nx>age</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>toRefs</span><span class=p>(</span><span class=nx>info</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>increment</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>info</span><span class=p>.</span><span class=nx>age</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 👆这样都可以修改age，都是响应式的👇
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=c1>// 相当于已经建立了链接，任何一个修改都会引起另外一个变化
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>age</span><span class=p>.</span><span class=nx>value</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>age</span><span class=p>,</span> <span class=nx>info</span><span class=p>.</span><span class=nx>age</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>age</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>increment</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>style</span> <span class=na>scoped</span><span class=p>&gt;&lt;/</span><span class=nt>style</span><span class=p>&gt;</span>
</span></span></code></pre></div><h3 id=toref><strong>toRef</strong><a hidden class=anchor aria-hidden=true href=#toref>#</a></h3><blockquote><p>如果只希望转换reactive对象中的其中某个属性为ref, 那么可以使用toRef的方法</p><p><strong>ps : 这个效率会更高点, 这种做法相当于已经在state.name和ref.value之间建立了 链接，任何一个修改都会引起另外一个变化</strong></p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>let</span> <span class=nx>age</span> <span class=o>=</span> <span class=nx>toRef</span><span class=p>(</span><span class=nx>info</span><span class=p>,</span> <span class=s2>&#34;age&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>changeAge</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>age</span><span class=p>.</span><span class=nx>value</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=computed>computed<a hidden class=anchor aria-hidden=true href=#computed>#</a></h2><ul><li>在前面的Options API中，我们是使用computed选项来完成的；</li><li>在Composition API中，我们可以在 setup 函数中使用 computed 方法来编写一个计算属性；</li></ul><ul><li>如何使用computed呢？<ul><li>方式一：接收一个getter函数，并为 getter 函数返回的值，返回一个不变的 ref 对象；</li><li>方式二：接收一个具有 get 和 set 的对象，返回一个可变的（可读写）ref 对象；</li></ul></li></ul><h3 id=方式一>方式一<a hidden class=anchor aria-hidden=true href=#方式一>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!--</span> <span class=nx>coderstar</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>{{</span> <span class=nx>fullName</span> <span class=p>}}</span>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!--</span> <span class=nx>一般</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>{{</span> <span class=nx>scoreState</span> <span class=p>}}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>computed</span><span class=p>,</span> <span class=nx>reactive</span><span class=p>,</span> <span class=nx>ref</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;App&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>names</span> <span class=o>=</span> <span class=nx>reactive</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>firstName</span><span class=o>:</span> <span class=s1>&#39;coder&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>lastName</span><span class=o>:</span> <span class=s1>&#39;star&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 直接使用getter函数，正常来说都这么使用
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>fullName</span> <span class=o>=</span> <span class=nx>computed</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=nx>names</span><span class=p>.</span><span class=nx>firstName</span> <span class=o>+</span> <span class=nx>names</span><span class=p>.</span><span class=nx>lastName</span><span class=p>);</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>score</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=mi>88</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>scoreState</span> <span class=o>=</span> <span class=nx>computed</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>(</span><span class=nx>score</span><span class=p>.</span><span class=nx>value</span> <span class=o>&gt;</span> <span class=mi>90</span> <span class=o>?</span> <span class=s1>&#39;优秀&#39;</span> <span class=o>:</span> <span class=s1>&#39;一般&#39;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>fullName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>scoreState</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><h3 id=方式二>方式二<a hidden class=anchor aria-hidden=true href=#方式二>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>{{</span> <span class=nx>fullName</span> <span class=p>}}</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>button</span> <span class=nt>@click</span><span class=s>=&#34;changeName&#34;</span><span class=p>&gt;</span><span class=na>change</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>computed</span><span class=p>,</span> <span class=nx>reactive</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;App&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>names</span> <span class=o>=</span> <span class=nx>reactive</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>firstName</span><span class=o>:</span> <span class=s1>&#39;冲啊&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>lastName</span><span class=o>:</span> <span class=s1>&#39;迪迦奥特曼&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 会返回一个ref对象
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>fullName</span> <span class=o>=</span> <span class=nx>computed</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>set</span><span class=p>(</span><span class=nx>newValue</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>tempNames</span> <span class=o>=</span> <span class=nx>newValue</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=s1>&#39; &#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>names</span><span class=p>.</span><span class=nx>firstName</span> <span class=o>=</span> <span class=nx>tempNames</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=nx>names</span><span class=p>.</span><span class=nx>lastName</span> <span class=o>=</span> <span class=nx>tempNames</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nx>get</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>names</span><span class=p>.</span><span class=nx>firstName</span> <span class=o>+</span> <span class=nx>names</span><span class=p>.</span><span class=nx>lastName</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 设置值
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>changeName</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>fullName</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=nx>fullName</span><span class=p>.</span><span class=nx>value</span> <span class=o>===</span> <span class=s1>&#39;冲啊迪迦奥特曼&#39;</span> <span class=o>?</span> <span class=s1>&#39;神秘的 宇宙人&#39;</span> <span class=o>:</span> <span class=s1>&#39;冲啊 迪迦奥特曼&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>fullName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>changeName</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202312171732557.gif><img src=https://qiniu.waite.wang/202312171732557.gif alt=img></a></div></p><h2 id=生命周期钩子>生命周期钩子<a hidden class=anchor aria-hidden=true href=#生命周期钩子>#</a></h2><blockquote><p><a href=https://cn.vuejs.org/api/composition-api-lifecycle.html target=_blank>https://cn.vuejs.org/api/composition-api-lifecycle.html</a></p></blockquote><blockquote><p><strong>setup中可以直接使用导入的onX函数注册生命周期，并且同一个生命周期可以使用多次</strong></p><p><strong>所有罗列在本页的 API 都应该在组件的 <code>setup()</code> 阶段被同步调用。相关细节请看
<a href=https://cn.vuejs.org/guide/essentials/lifecycle.html target=_blank>指南 - 生命周期钩子</a>。</strong></p><ul><li>可以使用直接导入的 onX 函数注册生命周期钩子；</li><li>beforeCreate和create在setup中没有相对应的onX的函数<ul><li>如果想要在beforeCreate和create中进行操作</li><li>可以把代码直接写入到setup中</li><li>setup的执行时序比beforeCreate和create还要早</li></ul></li></ul></blockquote><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/image-20231218002757954.png><img src=https://qiniu.waite.wang/image-20231218002757954.png alt=image-20231218002757954></a></div></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>onBeforeMount</span><span class=p>,</span> <span class=nx>onMounted</span><span class=p>,</span> <span class=nx>onBeforeUpdate</span><span class=p>,</span> <span class=nx>onUpdated</span><span class=p>,</span> <span class=nx>onBeforeUnmount</span><span class=p>,</span> <span class=nx>onUnmounted</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 注册生命周期钩子
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>onBeforeMount</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Before Mount&#39;</span><span class=p>);</span> <span class=c1>// 组件挂载前
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>onMounted</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Mounted&#39;</span><span class=p>);</span> <span class=c1>// 组件挂载后
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>onBeforeUpdate</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Before Update&#39;</span><span class=p>);</span> <span class=c1>// 组件更新前
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>onUpdated</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Updated&#39;</span><span class=p>);</span> <span class=c1>// 组件更新后
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>onBeforeUnmount</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Before Unmount&#39;</span><span class=p>);</span> <span class=c1>// 组件卸载前
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>onUnmounted</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Unmounted&#39;</span><span class=p>);</span> <span class=c1>// 组件卸载后
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 同一个生命周期可以使用多次
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>onMounted</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Another Mounted&#39;</span><span class=p>);</span> <span class=c1>// 另一个组件挂载后
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><h2 id=setup中使用ref获取元素或组件>setup中使用ref获取元素或组件<a hidden class=anchor aria-hidden=true href=#setup中使用ref获取元素或组件>#</a></h2><blockquote><p><strong>要定义一个ref对象，绑定到元素或者组件的ref属性上即可</strong></p><p><strong>只有在挂载完成后才能拿到值, 所以需要在生命周期中调用拿值</strong></p></blockquote><h3 id=获取元素>获取元素<a hidden class=anchor aria-hidden=true href=#获取元素>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!--</span> <span class=mf>1.</span> <span class=nx>指定ref</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>h2</span> <span class=na>ref</span><span class=o>=</span><span class=s>&#34;titleRef&#34;</span><span class=p>&gt;</span><span class=nx>我是迪迦</span><span class=p>&lt;/</span><span class=nt>h2</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>onMounted</span><span class=p>,</span> <span class=nx>ref</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;App&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 2. 生成ref对象
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>titleRef</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>();</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=c1>// 4. 可以在生命周期中获取到值
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>onMounted</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>titleRef</span><span class=p>.</span><span class=nx>value</span><span class=p>);</span> <span class=c1>// &lt;h2&gt;我是迪迦&lt;/h2&gt;
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>});</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 3. 返回出去，会自动匹配到对应的ref的
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>titleRef</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><h3 id=获取组件>获取组件<a hidden class=anchor aria-hidden=true href=#获取组件>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span><span class=nx>我是子组件</span><span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;home-layout&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>showMessage</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;home-layout function exection&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span> <span class=nx>showMessage</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!--</span> <span class=mf>1.</span> <span class=nx>指定ref</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>home</span> <span class=na>ref</span><span class=o>=</span><span class=s>&#34;homeCompRef&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>onMounted</span><span class=p>,</span> <span class=nx>ref</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>home</span> <span class=nx>from</span> <span class=s1>&#39;./home.vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;App&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>components</span><span class=o>:</span> <span class=p>{</span> <span class=nx>home</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 2. 生成ref对象
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>homeCompRef</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>();</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=c1>// 4. 可以在生命周期中获取到值
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>onMounted</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>homeCompRef</span><span class=p>.</span><span class=nx>value</span><span class=p>);</span> <span class=c1>// proxy对象
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>homeCompRef</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>$el</span><span class=p>);</span> <span class=c1>// &lt;div&gt;我是子组件&lt;/div&gt;
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>homeCompRef</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>showMessage</span><span class=p>();</span> <span class=c1>// 调用子组件方法
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>});</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 3. 返回出去，会自动匹配到对应的ref的
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>homeCompRef</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202312172141785.png><img src=https://qiniu.waite.wang/202312172141785.png alt=image-20231217214139261></a></div></p><h2 id=侦听数据的变化>侦听数据的变化<a hidden class=anchor aria-hidden=true href=#侦听数据的变化>#</a></h2><ul><li><p>在前面的Options API中，我们可以通过watch选项来侦听data或者props的数据变化，当数据变化时执行某一些 操作。</p></li><li><p>在Composition API中，我们可以使用watchEffect和watch来完成响应式数据的侦听；</p><ul><li>watchEffect用于自动收集响应式数据的依赖；</li><li>watch需要手动指定侦听的数据源；</li></ul></li></ul><h3 id=watcheffect>watchEffect<a hidden class=anchor aria-hidden=true href=#watcheffect>#</a></h3><h4 id=基本使用-1>基本使用<a hidden class=anchor aria-hidden=true href=#基本使用-1>#</a></h4><ul><li>自动收集响应式数据的依赖</li><li>watchEffect传入的函数会被立即执行一次，并且在执行的过程中会收集依赖</li><li>只有收集的依赖发生变化时，watchEffect传入的函数才会再次执行</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;{{</span> <span class=nx>name</span> <span class=p>}}</span> <span class=o>-</span> <span class=p>{{</span> <span class=nx>age</span> <span class=p>}}&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>button</span> <span class=nt>@click</span><span class=s>=&#34;changeName&#34;</span><span class=p>&gt;</span><span class=na>changeName</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>button</span> <span class=nt>@click</span><span class=s>=&#34;changeAge&#34;</span><span class=p>&gt;</span><span class=na>changeAge</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>ref</span><span class=p>,</span> <span class=nx>watchEffect</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>name</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=s1>&#39;star&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>age</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=mi>18</span><span class=p>);</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>changeName</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>(</span><span class=nx>name</span><span class=p>.</span><span class=nx>value</span> <span class=o>===</span> <span class=s1>&#39;star&#39;</span> <span class=o>?</span> <span class=p>(</span><span class=nx>name</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=s1>&#39;xuanyu&#39;</span><span class=p>)</span> <span class=o>:</span> <span class=p>(</span><span class=nx>name</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=s1>&#39;star&#39;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>changeAge</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>age</span><span class=p>.</span><span class=nx>value</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=nx>watchEffect</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 因为这里只使用了name，所以只会监听name，如果把age也写进来，那么两个都会监听
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;name:&#39;</span><span class=p>,</span> <span class=nx>name</span><span class=p>.</span><span class=nx>value</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span> <span class=nx>name</span><span class=p>,</span> <span class=nx>age</span><span class=p>,</span> <span class=nx>changeName</span><span class=p>,</span> <span class=nx>changeAge</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202312171743816.gif><img src=https://qiniu.waite.wang/202312171743816.gif alt=img></a></div></p><h4 id=停止监听>停止监听<a hidden class=anchor aria-hidden=true href=#停止监听>#</a></h4><ul><li>如果在发生某些情况下，我们希望停止侦听，这个时候我们可以获取watchEffect的返回值函数，调用该函数即可。</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;{{</span> <span class=nx>name</span> <span class=p>}}</span> <span class=o>-</span> <span class=p>{{</span> <span class=nx>age</span> <span class=p>}}&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>button</span> <span class=nt>@click</span><span class=s>=&#34;changeName&#34;</span><span class=p>&gt;</span><span class=na>changeName</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>button</span> <span class=nt>@click</span><span class=s>=&#34;changeAge&#34;</span><span class=p>&gt;</span><span class=na>changeAge</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>ref</span><span class=p>,</span> <span class=nx>watchEffect</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>name</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=s1>&#39;star&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>age</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=mi>18</span><span class=p>);</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>changeName</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>(</span><span class=nx>name</span><span class=p>.</span><span class=nx>value</span> <span class=o>===</span> <span class=s1>&#39;star&#39;</span> <span class=o>?</span> <span class=p>(</span><span class=nx>name</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=s1>&#39;xuanyu&#39;</span><span class=p>)</span> <span class=o>:</span> <span class=p>(</span><span class=nx>name</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=s1>&#39;star&#39;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 获取返回值
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>stopWatchEffect</span> <span class=o>=</span> <span class=nx>watchEffect</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 自动监听age
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;age:&#39;</span><span class=p>,</span> <span class=nx>age</span><span class=p>.</span><span class=nx>value</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>changeAge</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>age</span><span class=p>.</span><span class=nx>value</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>age</span><span class=p>.</span><span class=nx>value</span> <span class=o>&gt;</span> <span class=mi>22</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 停止监听
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>stopWatchEffect</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span> <span class=nx>name</span><span class=p>,</span> <span class=nx>age</span><span class=p>,</span> <span class=nx>changeName</span><span class=p>,</span> <span class=nx>changeAge</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202312171747594.gif><img src=https://qiniu.waite.wang/202312171747594.gif alt=img></a></div></p><h4 id=清除副作用>清除副作用<a hidden class=anchor aria-hidden=true href=#清除副作用>#</a></h4><ul><li>什么是清除副作用呢？<ul><li>比如在开发中我们需要在侦听函数中执行网络请求，但是在网络请求还没有达到的时候，我们停止了侦听器， 或者侦听器侦听函数被再次执行了</li><li>那么上一次的网络请求应该被取消掉，这个时候我们就可以清除上一次的副作用；</li></ul></li><li>在我们给watchEffect传入的函数被回调时，其实可以获取到一个参数：onInvalidate<ul><li>当副作用即将重新执行 或者 侦听器被停止 时会执行该函数传入的回调函数；</li><li>我们可以在传入的回调函数中，执行一些清除工作；</li></ul></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h2</span><span class=p>&gt;{{</span> <span class=nx>name</span> <span class=p>}}</span><span class=o>-</span><span class=p>{{</span> <span class=nx>age</span> <span class=p>}}&lt;/</span><span class=nt>h2</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>button</span> <span class=nt>@click</span><span class=s>=&#34;changeName&#34;</span><span class=p>&gt;</span><span class=na>修改name</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>button</span> <span class=nt>@click</span><span class=s>=&#34;changeAge&#34;</span><span class=p>&gt;</span><span class=na>修改age</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>ref</span><span class=p>,</span> <span class=nx>watchEffect</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// watchEffect: 自动收集响应式的依赖
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>name</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=s2>&#34;why&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>age</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=mi>18</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>stop</span> <span class=o>=</span> <span class=nx>watchEffect</span><span class=p>((</span><span class=nx>onInvalidate</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>timer</span> <span class=o>=</span> <span class=nx>setTimeout</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;网络请求成功~&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span> <span class=mi>2000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=c1>// 根据name和age两个变量发送网络请求
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>onInvalidate</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 在这个函数中清除额外的副作用
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>// request.cancel()
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>clearTimeout</span><span class=p>(</span><span class=nx>timer</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;onInvalidate&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>})</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;name:&#34;</span><span class=p>,</span> <span class=nx>name</span><span class=p>.</span><span class=nx>value</span><span class=p>,</span> <span class=s2>&#34;age:&#34;</span><span class=p>,</span> <span class=nx>age</span><span class=p>.</span><span class=nx>value</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>changeName</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>name</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=nx>name</span><span class=p>.</span><span class=nx>value</span> <span class=o>===</span> <span class=s2>&#34;why&#34;</span> <span class=o>?</span> <span class=s2>&#34;kobe&#34;</span> <span class=o>:</span> <span class=s2>&#34;why&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>changeAge</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>age</span><span class=p>.</span><span class=nx>value</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>age</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>changeName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>changeAge</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span> 
</span></span></code></pre></div><h4 id=watcheffect的执行时机>watchEffect的执行时机<a hidden class=anchor aria-hidden=true href=#watcheffect的执行时机>#</a></h4><ul><li>默认情况下，组件的更新会在副作用函数执行之前：<ul><li>如果我们希望在副作用函数中获取到元素，是否可行呢？</li></ul></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h2</span> <span class=na>ref</span><span class=o>=</span><span class=s>&#34;title&#34;</span><span class=p>&gt;</span><span class=nx>哈哈哈</span><span class=p>&lt;/</span><span class=nt>h2</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=kr>import</span> <span class=p>{</span> <span class=nx>ref</span><span class=p>,</span> <span class=nx>watchEffect</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>title</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=nx>watchEffect</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>title</span><span class=p>.</span><span class=nx>value</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>})</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>title</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202312172147749.png><img src=https://qiniu.waite.wang/202312172147749.png alt=image-20231217214736939></a></div></p><ul><li>我们会发现打印结果打印了两次：<ul><li>这是因为setup函数在执行时就会立即执行传入的副作用函数，这个时候DOM并没有挂载，所以打印为null；</li><li>而当DOM挂载时，会给<code>title</code>的<code>ref</code>对象赋值新的值，副作用函数会再次执行，打印出来对应的元素；</li></ul></li><li>这个时候我们需要改变副作用函数的执行时机；<ul><li>它的默认值是pre，它会在元素 挂载 或者 更新 之前执行；</li><li>所以我们会先打印出来一个空的，当依赖的title发生改变时，就会再次执行一次，打印出元素；</li></ul></li><li>我们可以设置副作用函数的执行时机：<ul><li>pre : 默认值,它会在元素 挂载 或者 更新 之前执行</li><li>post : 元素 挂载 或者 更新 之后执行</li><li>sync : 强制同步一起执行，效率很低，不推荐</li></ul></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=kr>import</span> <span class=p>{</span> <span class=nx>ref</span><span class=p>,</span> <span class=nx>watchEffect</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>title</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=nx>watchEffect</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>title</span><span class=p>.</span><span class=nx>value</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>flush</span><span class=o>:</span> <span class=s2>&#34;post&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>title</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><h3 id=watch>Watch<a hidden class=anchor aria-hidden=true href=#watch>#</a></h3><ul><li>watch的API完全等同于组件watch选项的Property：<ul><li>watch需要侦听特定的数据源，并在回调函数中执行副作用；</li><li>默认情况下它是惰性的，只有当被侦听的源发 生变化时才会执行回调；</li></ul></li><li>与watchEffect的比较，watch允许我们：<ul><li>懒执行副作用（第一次不会直接执行）；</li><li>更具体的说明当哪些状态发生变化时，触发侦听器的执行；</li><li>访问侦听状态变化前后的值；</li></ul></li></ul><h4 id=侦听单个数据源>侦听单个数据源<a hidden class=anchor aria-hidden=true href=#侦听单个数据源>#</a></h4><p>watch侦听函数的数据源有两种类型：</p><ul><li>一个getter函数：但是该getter函数必须引用可响应式的对象（比如reactive或者ref）；</li><li>直接写入一个可响应式的对象，ref（如果是一个 reactive 的对象的侦听, 需要进行某些转换 ）；</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>watch</span><span class=p>,</span> <span class=nx>reactive</span><span class=p>,</span> <span class=nx>ref</span><span class=p>,</span> <span class=nx>toRefs</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 一个getter函数引用可响应式的对象
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>state</span> <span class=o>=</span> <span class=nx>reactive</span><span class=p>({</span> <span class=nx>count</span><span class=o>:</span> <span class=mi>0</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=nx>watch</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>state</span><span class=p>.</span><span class=nx>count</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nx>newValue</span><span class=p>,</span> <span class=nx>oldValue</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Count changed from </span><span class=si>${</span><span class=nx>oldValue</span><span class=si>}</span><span class=sb> to </span><span class=si>${</span><span class=nx>newValue</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 直接写入一个可响应式的对象
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>count</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>watch</span><span class=p>(</span><span class=nx>count</span><span class=p>,</span> <span class=p>(</span><span class=nx>newValue</span><span class=p>,</span> <span class=nx>oldValue</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Count changed from </span><span class=si>${</span><span class=nx>oldValue</span><span class=si>}</span><span class=sb> to </span><span class=si>${</span><span class=nx>newValue</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 直接写入一个可响应式的对象，需要进行某些转换
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>reactiveState</span> <span class=o>=</span> <span class=nx>reactive</span><span class=p>({</span> <span class=nx>count</span><span class=o>:</span> <span class=mi>0</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>count</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>toRefs</span><span class=p>(</span><span class=nx>reactiveState</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>watch</span><span class=p>(</span><span class=nx>count</span><span class=p>,</span> <span class=p>(</span><span class=nx>newValue</span><span class=p>,</span> <span class=nx>oldValue</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Count changed from </span><span class=si>${</span><span class=nx>oldValue</span><span class=si>}</span><span class=sb> to </span><span class=si>${</span><span class=nx>newValue</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><blockquote><p>注意: <code>reactive </code>对象获取到的 <code>newValue </code>以及 <code>oldValue </code>本身都是 <code>reactive</code> 对象</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>watch</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=nx>info</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nx>newInfo</span><span class=p>,</span> <span class=nx>oldInfo</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>newInfo</span><span class=p>,</span> <span class=nx>oldInfo</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></div><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202312172311755.png><img src=https://qiniu.waite.wang/202312172311755.png alt=image-20231217231108219></a></div></p><p>如果希望两者都是一个普通对象, 可以使用以下写法(JavaScript中的展开运算符):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>watch</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>({</span> <span class=p>...</span><span class=nx>info</span> <span class=p>}),</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nx>newInfo</span><span class=p>,</span> <span class=nx>oldInfo</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>newInfo</span><span class=p>,</span> <span class=nx>oldInfo</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></div><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202312172313342.png><img src=https://qiniu.waite.wang/202312172313342.png alt=image-20231217231330425></a></div></p><p>以下是完整代码:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h2</span> <span class=na>ref</span><span class=o>=</span><span class=s>&#34;title&#34;</span><span class=p>&gt;{{</span> <span class=nx>info</span><span class=p>.</span><span class=nx>name</span> <span class=p>}}&lt;/</span><span class=nt>h2</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>button</span> <span class=nt>@click</span><span class=s>=&#34;changeData&#34;</span><span class=p>&gt;</span><span class=na>修改数据</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>reactive</span><span class=p>,</span> <span class=nx>watch</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>info</span> <span class=o>=</span> <span class=nx>reactive</span><span class=p>({</span> <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;why&#34;</span><span class=p>,</span> <span class=nx>age</span><span class=o>:</span> <span class=mi>18</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>watch</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>({</span> <span class=p>...</span><span class=nx>info</span> <span class=p>}),</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=nx>newInfo</span><span class=p>,</span> <span class=nx>oldInfo</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>newInfo</span><span class=p>,</span> <span class=nx>oldInfo</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>watch</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=nx>info</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=nx>newInfo</span><span class=p>,</span> <span class=nx>oldInfo</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>newInfo</span><span class=p>,</span> <span class=nx>oldInfo</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>changeData</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>info</span><span class=p>.</span><span class=nx>name</span> <span class=o>=</span> <span class=nx>info</span><span class=p>.</span><span class=nx>name</span> <span class=o>===</span> <span class=s2>&#34;why&#34;</span> <span class=o>?</span> <span class=s2>&#34;kobe&#34;</span> <span class=o>:</span> <span class=s2>&#34;why&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>changeData</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>info</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div></blockquote><h4 id=侦听多个数据源>侦听多个数据源<a hidden class=anchor aria-hidden=true href=#侦听多个数据源>#</a></h4><p>当侦听多个来源时，回调函数接受两个数组，分别对应来源数组中的新值和旧值：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>watch</span><span class=p>([</span><span class=nx>fooRef</span><span class=p>,</span> <span class=nx>barRef</span><span class=p>],</span> <span class=p>([</span><span class=nx>foo</span><span class=p>,</span> <span class=nx>bar</span><span class=p>],</span> <span class=p>[</span><span class=nx>prevFoo</span><span class=p>,</span> <span class=nx>prevBar</span><span class=p>])</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=cm>/* ... */</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h2</span> <span class=na>ref</span><span class=o>=</span><span class=s>&#34;title&#34;</span><span class=p>&gt;{{</span> <span class=nx>info</span><span class=p>.</span><span class=nx>name</span> <span class=p>}}&lt;/</span><span class=nt>h2</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>button</span> <span class=nt>@click</span><span class=s>=&#34;changeData&#34;</span><span class=p>&gt;</span><span class=na>修改数据</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>ref</span><span class=p>,</span> <span class=nx>reactive</span><span class=p>,</span> <span class=nx>watch</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>info</span> <span class=o>=</span> <span class=nx>reactive</span><span class=p>({</span> <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;why&#34;</span><span class=p>,</span> <span class=nx>age</span><span class=o>:</span> <span class=mi>18</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>name</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=s2>&#34;why&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>watch</span><span class=p>([()</span> <span class=p>=&gt;</span> <span class=p>({</span> <span class=p>...</span><span class=nx>info</span> <span class=p>}),</span> <span class=nx>name</span><span class=p>],</span> <span class=p>([</span><span class=nx>newInfo</span><span class=p>,</span> <span class=nx>newName</span><span class=p>],</span> <span class=p>[</span><span class=nx>oldInfo</span><span class=p>,</span> <span class=nx>oldName</span><span class=p>])</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>newInfo</span><span class=p>,</span> <span class=nx>newName</span><span class=p>,</span> <span class=nx>oldInfo</span><span class=p>,</span> <span class=nx>oldName</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>changeData</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>info</span><span class=p>.</span><span class=nx>name</span> <span class=o>=</span> <span class=s2>&#34;kobe&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>changeData</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>info</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><h4 id=watch的选项>watch的选项<a hidden class=anchor aria-hidden=true href=#watch的选项>#</a></h4><ul><li><strong>deep : 是否深度监听</strong></li><li><strong>immediate ： 是否立即执行</strong></li></ul><blockquote><p><code>watch</code> 侦听 <code>reactive</code>时默认是深度侦听的, 但是在使用 <code>{...info}</code>展开运算符时, 是不会深度监听的, 所以我们要设置 <code>deep: True</code></p><p>immediate: 第一次会执行</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>watch</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>obj</span> <span class=o>=</span> <span class=p>{</span> <span class=p>...</span><span class=nx>info</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>obj</span><span class=p>.</span><span class=nx>friend</span> <span class=o>=</span> <span class=p>{</span> <span class=p>...</span><span class=nx>obj</span><span class=p>.</span><span class=nx>friend</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>obj</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nx>newValue</span><span class=p>,</span> <span class=nx>oldValue</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>newValue</span><span class=p>,</span> <span class=nx>oldValue</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 如果有多层，需要加上deep
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>deep</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 立即执行
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>immediate</span><span class=o>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></div><h4 id=停止侦听>停止侦听<a hidden class=anchor aria-hidden=true href=#停止侦听>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>stop</span> <span class=o>=</span> <span class=nx>watch</span><span class=p>(</span><span class=nx>source</span><span class=p>,</span> <span class=nx>callback</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 当已不再需要该侦听器时：
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>stop</span><span class=p>()</span>
</span></span></code></pre></div><h4 id=副作用清理>副作用清理<a hidden class=anchor aria-hidden=true href=#副作用清理>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>watch</span><span class=p>(</span><span class=nx>id</span><span class=p>,</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>newId</span><span class=p>,</span> <span class=nx>oldId</span><span class=p>,</span> <span class=nx>onCleanup</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>{</span> <span class=nx>response</span><span class=p>,</span> <span class=nx>cancel</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>doAsyncWork</span><span class=p>(</span><span class=nx>newId</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 当 `id` 变化时，`cancel` 将被调用，
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// 取消之前的未完成的请求
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>onCleanup</span><span class=p>(</span><span class=nx>cancel</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>data</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>response</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div><h2 id=provide--inject>provide && inject<a hidden class=anchor aria-hidden=true href=#provide--inject>#</a></h2><p><code>provide</code> 和
<a href=https://cn.vuejs.org/api/options-composition.html#inject target=_blank><code>inject</code></a> 通常成对一起使用，使一个祖先组件作为其后代组件的依赖注入方，无论这个组件的层级有多深都可以注入成功，只要他们处于同一条组件链上。</p><p><strong>provide可以传入两个参数 :</strong></p><ul><li><strong>name：提供的属性名称</strong></li><li><strong>value：提供的属性值</strong></li></ul><p><strong>inject可以传入两个参数 :</strong></p><ul><li><strong>对应provide传过来的name值</strong></li><li><strong>默认值</strong></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;</span><span class=nx>APP</span> <span class=nx>count</span><span class=o>:</span> <span class=p>{{</span> <span class=nx>count</span> <span class=p>}}&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>button</span> <span class=nt>@click</span><span class=s>=&#34;change&#34;</span><span class=p>&gt;</span><span class=na>APP</span> <span class=na>button</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>demo</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>ref</span><span class=p>,</span> <span class=nx>provide</span><span class=p>,</span> <span class=nx>readonly</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>demo</span> <span class=nx>from</span> <span class=s1>&#39;./components/demo.vue&#39;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;App&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>components</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>demo</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>count</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 第一个参数key  第二个参数值，不让子组件随便修改，用readonly包裹一下
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>provide</span><span class=p>(</span><span class=s1>&#39;count&#39;</span><span class=p>,</span> <span class=nx>readonly</span><span class=p>(</span><span class=nx>count</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>change</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>count</span><span class=p>.</span><span class=nx>value</span><span class=o>++</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>count</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>change</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>h2</span><span class=p>&gt;</span><span class=nx>demo</span> <span class=nx>count</span><span class=o>:</span><span class=p>{{</span> <span class=nx>count</span> <span class=p>}}&lt;/</span><span class=nt>h2</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>button</span> <span class=nt>@click</span><span class=s>=&#34;change&#34;</span><span class=p>&gt;</span><span class=na>demo</span> <span class=na>change</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>ref</span><span class=p>,</span> <span class=nx>inject</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 接收   第二个参数可以给一个默认值
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>let</span> <span class=nx>count</span> <span class=o>=</span> <span class=nx>inject</span><span class=p>(</span><span class=s1>&#39;count&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 因为设置了readOnly 所以更改不了
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>change</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>count</span><span class=p>.</span><span class=nx>value</span><span class=o>++</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>count</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>change</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202312180036440.gif><img src=https://qiniu.waite.wang/202312180036440.gif alt=img></a></div></p><h2 id=h函数>h函数<a hidden class=anchor aria-hidden=true href=#h函数>#</a></h2><ul><li>Vue在生成真实的DOM之前，会将节点转换成VNode，而VNode组合在一起形成一颗树结构，就是虚拟DOM ( VDOM )</li><li>事实上，编写的 template 中的HTML 最终也是使用渲染函数生成对应的VNode</li><li>那么，如果想充分的利用JavaScript的编程能力，可以自己来编写 createVNode 函数，生成对应的VNode</li><li><strong>h() 函数是一个用于创建 vnode 的一个函数</strong></li><li><strong>其实更准备的命名是 createVNode() 函数，但是为了简便在Vue将之简化为 h() 函数</strong></li></ul><h3 id=参数>参数<a hidden class=anchor aria-hidden=true href=#参数>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// 完整参数签名
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>function</span> <span class=nx>h</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=nx>type</span><span class=o>:</span> <span class=nx>string</span> <span class=o>|</span> <span class=nx>Component</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>props</span><span class=o>?:</span> <span class=nx>object</span> <span class=o>|</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>children</span><span class=o>?:</span> <span class=nx>Children</span> <span class=o>|</span> <span class=nx>Slot</span> <span class=o>|</span> <span class=nx>Slots</span>
</span></span><span class=line><span class=cl><span class=p>)</span><span class=o>:</span> <span class=nx>VNode</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 省略 props
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>function</span> <span class=nx>h</span><span class=p>(</span><span class=nx>type</span><span class=o>:</span> <span class=nx>string</span> <span class=o>|</span> <span class=nx>Component</span><span class=p>,</span> <span class=nx>children</span><span class=o>?:</span> <span class=nx>Children</span> <span class=o>|</span> <span class=nx>Slot</span><span class=p>)</span><span class=o>:</span> <span class=nx>VNode</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>type</span> <span class=nx>Children</span> <span class=o>=</span> <span class=nx>string</span> <span class=o>|</span> <span class=nx>number</span> <span class=o>|</span> <span class=kr>boolean</span> <span class=o>|</span> <span class=nx>VNode</span> <span class=o>|</span> <span class=kc>null</span> <span class=o>|</span> <span class=nx>Children</span><span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>type</span> <span class=nx>Slot</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>Children</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>type</span> <span class=nx>Slots</span> <span class=o>=</span> <span class=p>{</span> <span class=p>[</span><span class=nx>name</span><span class=o>:</span> <span class=nx>string</span><span class=p>]</span><span class=o>:</span> <span class=nx>Slot</span> <span class=p>}</span>
</span></span></code></pre></div><ul><li>第一个参数既可以是一个字符串 (用于原生元素) 也可以是一个 Vue 组件定义。第二个参数是要传递的 prop，第三个参数是子节点。</li><li>当创建一个组件的 vnode 时，子节点必须以插槽函数进行传递。如果组件只有默认槽，可以使用单个插槽函数进行传递。否则，必须以插槽函数的对象形式来传递。</li><li>为了方便阅读，当子节点不是插槽对象时，可以省略 prop 参数。</li></ul><h3 id=基本使用-2>基本使用<a hidden class=anchor aria-hidden=true href=#基本使用-2>#</a></h3><p>h函数可以在两个地方使用：</p><ul><li>render函数选项中；</li><li>setup函数选项中（setup本身需要是一个函数类型，函数再返回h函数创建的VNode）；</li></ul><h4 id=在render函数选项中>在render函数选项中<a hidden class=anchor aria-hidden=true href=#在render函数选项中>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=c1>// 1. 引入h函数
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=p>{</span> <span class=nx>h</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>data</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>counter</span><span class=o>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 2. 定义render选项
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>render</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 3. 返回自定义的h函数
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=nx>h</span><span class=p>(</span><span class=s1>&#39;div&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=kr>class</span><span class=o>:</span> <span class=s1>&#39;app-view&#39;</span><span class=p>,</span> <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;abc&#39;</span> <span class=p>},</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 4. 定义h2
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>h</span><span class=p>(</span><span class=s1>&#39;h2&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>className</span><span class=o>:</span> <span class=s1>&#39;title&#39;</span> <span class=p>},</span> <span class=k>this</span><span class=p>.</span><span class=nx>counter</span><span class=p>),</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 5. 定义增加按钮
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>h</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;button&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>className</span><span class=o>:</span> <span class=s1>&#39;add-btn&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>onClick</span><span class=o>:</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=p>.</span><span class=nx>counter</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;加一&#39;</span>
</span></span><span class=line><span class=cl>      <span class=p>),</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 6. 定义减少按钮
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>h</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;button&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>className</span><span class=o>:</span> <span class=s1>&#39;remove-btn&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>onClick</span><span class=o>:</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=p>.</span><span class=nx>counter</span><span class=o>--</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;减一&#39;</span>
</span></span><span class=line><span class=cl>      <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>]);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><h4 id=在setup函数选项中>在setup函数选项中<a hidden class=anchor aria-hidden=true href=#在setup函数选项中>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>h</span><span class=p>,</span> <span class=nx>ref</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>counter</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>increment</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>counter</span><span class=p>.</span><span class=nx>value</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>decrement</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>counter</span><span class=p>.</span><span class=nx>value</span><span class=o>--</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=c1>// 返回render函数
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=p>()</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nx>h</span><span class=p>(</span><span class=s1>&#39;div&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=kr>class</span><span class=o>:</span> <span class=s1>&#39;app-view&#39;</span><span class=p>,</span> <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;abc&#39;</span> <span class=p>},</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=nx>h</span><span class=p>(</span><span class=s1>&#39;h2&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>className</span><span class=o>:</span> <span class=s1>&#39;title&#39;</span> <span class=p>},</span> <span class=nx>counter</span><span class=p>.</span><span class=nx>value</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=nx>h</span><span class=p>(</span>
</span></span><span class=line><span class=cl>          <span class=s1>&#39;button&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>onClick</span><span class=o>:</span> <span class=nx>increment</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=s1>&#39;+1&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=nx>h</span><span class=p>(</span>
</span></span><span class=line><span class=cl>          <span class=s1>&#39;button&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>onClick</span><span class=o>:</span> <span class=nx>decrement</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=s1>&#39;-1&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>]);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><h4 id=在setup语法糖中>在setup语法糖中<a hidden class=anchor aria-hidden=true href=#在setup语法糖中>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!--</span> <span class=mf>2.</span> <span class=nx>使用一下</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>star-render</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>h</span><span class=p>,</span> <span class=nx>ref</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>counter</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>increment</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>counter</span><span class=p>.</span><span class=nx>value</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>decrement</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>counter</span><span class=p>.</span><span class=nx>value</span><span class=o>--</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=c1>// 1. 拿到render函数
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>starRender</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nx>h</span><span class=p>(</span><span class=s1>&#39;div&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=kr>class</span><span class=o>:</span> <span class=s1>&#39;app-view&#39;</span><span class=p>,</span> <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;abc&#39;</span> <span class=p>},</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=nx>h</span><span class=p>(</span><span class=s1>&#39;h2&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>className</span><span class=o>:</span> <span class=s1>&#39;title&#39;</span> <span class=p>},</span> <span class=nx>counter</span><span class=p>.</span><span class=nx>value</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=nx>h</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;button&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>onClick</span><span class=o>:</span> <span class=nx>increment</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;+1&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=nx>h</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;button&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>onClick</span><span class=o>:</span> <span class=nx>decrement</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;-1&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><h4 id=其他写法>其他写法<a hidden class=anchor aria-hidden=true href=#其他写法>#</a></h4><p>创建原生元素：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>h</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 除了 type 外，其他参数都是可选的
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>h</span><span class=p>(</span><span class=s1>&#39;div&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>h</span><span class=p>(</span><span class=s1>&#39;div&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>id</span><span class=o>:</span> <span class=s1>&#39;foo&#39;</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// attribute 和 property 都可以用于 prop
</span></span></span><span class=line><span class=cl><span class=c1>// Vue 会自动选择正确的方式来分配它
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>h</span><span class=p>(</span><span class=s1>&#39;div&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=kr>class</span><span class=o>:</span> <span class=s1>&#39;bar&#39;</span><span class=p>,</span> <span class=nx>innerHTML</span><span class=o>:</span> <span class=s1>&#39;hello&#39;</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// class 与 style 可以像在模板中一样
</span></span></span><span class=line><span class=cl><span class=c1>// 用数组或对象的形式书写
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>h</span><span class=p>(</span><span class=s1>&#39;div&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=kr>class</span><span class=o>:</span> <span class=p>[</span><span class=nx>foo</span><span class=p>,</span> <span class=p>{</span> <span class=nx>bar</span> <span class=p>}],</span> <span class=nx>style</span><span class=o>:</span> <span class=p>{</span> <span class=nx>color</span><span class=o>:</span> <span class=s1>&#39;red&#39;</span> <span class=p>}</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 事件监听器应以 onXxx 的形式书写
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>h</span><span class=p>(</span><span class=s1>&#39;div&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>onClick</span><span class=o>:</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{}</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// children 可以是一个字符串
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>h</span><span class=p>(</span><span class=s1>&#39;div&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>id</span><span class=o>:</span> <span class=s1>&#39;foo&#39;</span> <span class=p>},</span> <span class=s1>&#39;hello&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 没有 prop 时可以省略不写
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>h</span><span class=p>(</span><span class=s1>&#39;div&#39;</span><span class=p>,</span> <span class=s1>&#39;hello&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>h</span><span class=p>(</span><span class=s1>&#39;div&#39;</span><span class=p>,</span> <span class=p>[</span><span class=nx>h</span><span class=p>(</span><span class=s1>&#39;span&#39;</span><span class=p>,</span> <span class=s1>&#39;hello&#39;</span><span class=p>)])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// children 数组可以同时包含 vnode 和字符串
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>h</span><span class=p>(</span><span class=s1>&#39;div&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;hello&#39;</span><span class=p>,</span> <span class=nx>h</span><span class=p>(</span><span class=s1>&#39;span&#39;</span><span class=p>,</span> <span class=s1>&#39;hello&#39;</span><span class=p>)])</span>
</span></span></code></pre></div><p>创建组件：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=nx>Foo</span> <span class=nx>from</span> <span class=s1>&#39;./Foo.vue&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 传递 prop
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>h</span><span class=p>(</span><span class=nx>Foo</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 等价于 some-prop=&#34;hello&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>someProp</span><span class=o>:</span> <span class=s1>&#39;hello&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 等价于 @update=&#34;() =&gt; {}&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>onUpdate</span><span class=o>:</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 传递单个默认插槽
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>h</span><span class=p>(</span><span class=nx>Foo</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=s1>&#39;default slot&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 传递具名插槽
</span></span></span><span class=line><span class=cl><span class=c1>// 注意，需要使用 `null` 来避免
</span></span></span><span class=line><span class=cl><span class=c1>// 插槽对象被当作是 prop
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>h</span><span class=p>(</span><span class=nx>MyComponent</span><span class=p>,</span> <span class=kc>null</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>default</span><span class=o>:</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=s1>&#39;default slot&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>foo</span><span class=o>:</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>h</span><span class=p>(</span><span class=s1>&#39;div&#39;</span><span class=p>,</span> <span class=s1>&#39;foo&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>  <span class=nx>bar</span><span class=o>:</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>[</span><span class=nx>h</span><span class=p>(</span><span class=s1>&#39;span&#39;</span><span class=p>,</span> <span class=s1>&#39;one&#39;</span><span class=p>),</span> <span class=nx>h</span><span class=p>(</span><span class=s1>&#39;span&#39;</span><span class=p>,</span> <span class=s1>&#39;two&#39;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div><h3 id=函数组件和插槽的使用>函数组件和插槽的使用<a hidden class=anchor aria-hidden=true href=#函数组件和插槽的使用>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=kr>import</span> <span class=p>{</span> <span class=nx>h</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;vue&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>render</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>h</span><span class=p>(</span><span class=s2>&#34;div&#34;</span><span class=p>,</span> <span class=kc>null</span><span class=p>,</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=nx>h</span><span class=p>(</span><span class=s2>&#34;h2&#34;</span><span class=p>,</span> <span class=kc>null</span><span class=p>,</span> <span class=s2>&#34;Hello World&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>$slots</span><span class=p>.</span><span class=k>default</span> <span class=o>?</span> <span class=k>this</span><span class=p>.</span><span class=nx>$slots</span><span class=p>.</span><span class=k>default</span><span class=p>({</span><span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;coderwhy&#34;</span><span class=p>})</span><span class=o>:</span> <span class=nx>h</span><span class=p>(</span><span class=s2>&#34;span&#34;</span><span class=p>,</span> <span class=kc>null</span><span class=p>,</span> <span class=s2>&#34;我是HelloWorld的插槽默认值&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>style</span> <span class=na>lang</span><span class=o>=</span><span class=s>&#34;scss&#34;</span> <span class=na>scoped</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>style</span><span class=p>&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>starRender</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>h</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>HelloWorld</span> <span class=nx>from</span> <span class=s1>&#39;./HelloWorld.vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>starRender</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nx>h</span><span class=p>(</span><span class=s2>&#34;div&#34;</span><span class=p>,</span> <span class=kc>null</span><span class=p>,</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=nx>h</span><span class=p>(</span><span class=nx>HelloWorld</span><span class=p>,</span> <span class=kc>null</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>default</span><span class=o>:</span> <span class=nx>props</span> <span class=p>=&gt;</span> <span class=nx>h</span><span class=p>(</span><span class=s2>&#34;span&#34;</span><span class=p>,</span> <span class=kc>null</span><span class=p>,</span> <span class=sb>`app传入到HelloWorld中的内容: </span><span class=si>${</span><span class=nx>props</span><span class=p>.</span><span class=nx>name</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>])</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202312181955950.png><img src=https://qiniu.waite.wang/202312181955950.png alt=image-20231218195545969></a></div></p><h2 id=jsx>Jsx<a hidden class=anchor aria-hidden=true href=#jsx>#</a></h2><p><a href=https://facebook.github.io/jsx/ target=_blank>JSX</a> 是 JavaScript 的一个类似 XML 的扩展，有了它，我们可以用以下的方式来书写代码：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=kr>const</span> <span class=nx>vnode</span> <span class=o>=</span> <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span><span class=nx>hello</span><span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>在 JSX 表达式中，使用大括号来嵌入动态值：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=kr>const</span> <span class=nx>vnode</span> <span class=o>=</span> <span class=p>&lt;</span><span class=nt>div</span> <span class=na>id</span><span class=o>=</span><span class=p>{</span><span class=nx>dynamicId</span><span class=p>}&gt;</span><span class=nx>hello</span><span class=p>,</span> <span class=p>{</span><span class=nx>userName</span><span class=p>}&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span></code></pre></div><h3 id=配置>配置<a hidden class=anchor aria-hidden=true href=#配置>#</a></h3><h4 id=vue-cli环境>vue-cli环境<a hidden class=anchor aria-hidden=true href=#vue-cli环境>#</a></h4><ul><li><code>npm install @vue/babel-plugin-jsx -D</code></li><li><code>babel.config.js</code> 中配置</li></ul><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202312182036029.png><img src=https://qiniu.waite.wang/202312182036029.png alt=img></a></div></p><h4 id=vite环境>vite环境<a hidden class=anchor aria-hidden=true href=#vite环境>#</a></h4><ul><li><code>npm install @vitejs/plugin-vue-jsx -D</code></li><li><code>vite.config.js</code> 中配置</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>fileURLToPath</span><span class=p>,</span> <span class=nx>URL</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;node:url&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>defineConfig</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vite&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>vue</span> <span class=nx>from</span> <span class=s1>&#39;@vitejs/plugin-vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>jsx</span> <span class=nx>from</span> <span class=s1>&#39;@vitejs/plugin-vue-jsx&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineConfig</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>plugins</span><span class=o>:</span> <span class=p>[</span><span class=nx>vue</span><span class=p>(),</span> <span class=nx>jsx</span><span class=p>()],</span>
</span></span><span class=line><span class=cl>  <span class=nx>resolve</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>alias</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;@&#39;</span><span class=o>:</span> <span class=nx>fileURLToPath</span><span class=p>(</span><span class=k>new</span> <span class=nx>URL</span><span class=p>(</span><span class=s1>&#39;./src&#39;</span><span class=p>,</span> <span class=kr>import</span><span class=p>.</span><span class=nx>meta</span><span class=p>.</span><span class=nx>url</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><h3 id=基本使用-3>基本使用<a hidden class=anchor aria-hidden=true href=#基本使用-3>#</a></h3><h4 id=在render函数中>在render函数中<a hidden class=anchor aria-hidden=true href=#在render函数中>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=c>&lt;!--</span> <span class=mf>1.</span> <span class=nx>这里加上注明语言使用jsx</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>lang</span><span class=o>=</span><span class=s>&#34;jsx&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>Home</span> <span class=nx>from</span> <span class=s1>&#39;./pages/home.vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>data</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>counter</span><span class=o>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>render</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 2. 返回jsx写法
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;app-view&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>h2</span><span class=p>&gt;</span><span class=nx>当前计数</span><span class=o>:</span><span class=p>{</span><span class=k>this</span><span class=p>.</span><span class=nx>counter</span><span class=p>}&lt;/</span><span class=nt>h2</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>button</span> <span class=na>onClick</span><span class=o>=</span><span class=p>{</span><span class=k>this</span><span class=p>.</span><span class=nx>increment</span><span class=p>}&gt;</span><span class=o>+</span><span class=mi>1</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>button</span> <span class=na>onClick</span><span class=o>=</span><span class=p>{</span><span class=k>this</span><span class=p>.</span><span class=nx>decrement</span><span class=p>}&gt;</span><span class=o>-</span><span class=mi>1</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>methods</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>increment</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>counter</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>decrement</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>counter</span><span class=o>--</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><h4 id=在setup函数中>在setup函数中<a hidden class=anchor aria-hidden=true href=#在setup函数中>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=c>&lt;!--</span> <span class=mf>1.</span> <span class=nx>这里加上注明语言使用jsx</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>lang</span><span class=o>=</span><span class=s>&#34;jsx&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>data</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>counter</span><span class=o>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>render</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 2. 返回jsx写法
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;app-view&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>h2</span><span class=p>&gt;</span><span class=nx>当前计数</span><span class=o>:</span><span class=p>{</span><span class=k>this</span><span class=p>.</span><span class=nx>counter</span><span class=p>}&lt;/</span><span class=nt>h2</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>button</span> <span class=na>onClick</span><span class=o>=</span><span class=p>{</span><span class=k>this</span><span class=p>.</span><span class=nx>increment</span><span class=p>}&gt;</span><span class=o>+</span><span class=mi>1</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>button</span> <span class=na>onClick</span><span class=o>=</span><span class=p>{</span><span class=k>this</span><span class=p>.</span><span class=nx>decrement</span><span class=p>}&gt;</span><span class=o>-</span><span class=mi>1</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>methods</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>increment</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>counter</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>decrement</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>counter</span><span class=o>--</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><h4 id=在setup语法糖中-1>在setup语法糖中<a hidden class=anchor aria-hidden=true href=#在setup语法糖中-1>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!--</span> <span class=mf>3.</span> <span class=nx>使用</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>star-render</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=c>&lt;!--</span> <span class=mf>1.</span> <span class=nx>这里加上注明语言使用jsx</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span> <span class=na>lang</span><span class=o>=</span><span class=s>&#34;jsx&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>ref</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>counter</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span> 
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>increment</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>counter</span><span class=p>.</span><span class=nx>value</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>decrement</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>counter</span><span class=p>.</span><span class=nx>value</span><span class=o>--</span><span class=p>;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=c1>// 2. 拿到render函数
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>starRender</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;app-view&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h2</span><span class=p>&gt;</span><span class=nx>当前计数</span><span class=o>:</span><span class=p>{</span><span class=nx>counter</span><span class=p>.</span><span class=nx>value</span><span class=p>}&lt;/</span><span class=nt>h2</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>button</span> <span class=na>onClick</span><span class=o>=</span><span class=p>{</span><span class=nx>increment</span><span class=p>}&gt;</span><span class=o>+</span><span class=mi>1</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>button</span> <span class=na>onClick</span><span class=o>=</span><span class=p>{</span><span class=nx>decrement</span><span class=p>}&gt;</span><span class=o>-</span><span class=mi>1</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><h2 id=script-setup语法糖>script setup语法糖<a hidden class=anchor aria-hidden=true href=#script-setup语法糖>#</a></h2><blockquote><p><code>&lt;script setup></code>是在单文件组件 (SFC) 中使用组合式 API 的编译时语法糖，当同时使用 SFC 与组合式 API 时则推荐该语法</p></blockquote><ul><li><strong>更少的样板内容，更简洁的代码</strong></li><li><strong>能够使用纯 Typescript 声明 prop 和抛出事件</strong></li><li><strong>更好的运行时性能</strong></li><li><strong>更好的 IDE 类型推断性能</strong></li></ul><h3 id=顶层的绑定会被暴露给模板>顶层的绑定会被暴露给模板<a hidden class=anchor aria-hidden=true href=#顶层的绑定会被暴露给模板>#</a></h3><blockquote><p>当使用<code> &lt;script setup></code> 的时候，任何在<code>&lt;script setup></code> 声明的顶层的绑定 (包括变量，函数声明，以及 import 引入的内容) 能在模板中直接使用, 导入的组件也可以直接使用</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;{{</span> <span class=nx>mes</span> <span class=p>}}&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>button</span> <span class=nt>@click</span><span class=s>=&#34;addClick&#34;</span><span class=p>&gt;</span><span class=na>按钮</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=err>&lt;!--</span> <span class=na>1.</span> <span class=na>这里加上setup属性</span> <span class=err>--</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>ref</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=c1>// 定义数据后，template中可以直接使用，无需返回
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>mes</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// 定义的方法也是，直接可被使用
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>addClick</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;hahah&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!--</span> <span class=mf>2.</span> <span class=nx>直接使用</span><span class=err>，</span><span class=nx>不用通过compoents注册</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>my-home</span><span class=p>&gt;&lt;/</span><span class=nt>my-home</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=c1>// 1. 这是导入的组件
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>myHome</span> <span class=nx>from</span> <span class=s1>&#39;./myHome.vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><h3 id=defineprops>defineProps()<a hidden class=anchor aria-hidden=true href=#defineprops>#</a></h3><blockquote><p>defineProps => 用来接收从父组件传递过来的数据</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>my-home</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;hello&#34;</span> <span class=nt>:age</span><span class=o>=</span><span class=s>&#34;18&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>my-home</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>myHome</span> <span class=nx>from</span> <span class=s1>&#39;./myHome.vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;{{</span> <span class=nx>name</span> <span class=p>}}</span> <span class=o>-</span> <span class=p>{{</span> <span class=nx>age</span> <span class=p>}}&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=c1>// defineProps是内置组件，可以直接使用，不用导入
</span></span></span><span class=line><span class=cl><span class=c1>// 可以接收一下返回的props对象，也可以不用
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>props</span> <span class=o>=</span> <span class=nx>defineProps</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>type</span><span class=o>:</span> <span class=nb>String</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=k>default</span><span class=o>:</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>age</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>type</span><span class=o>:</span> <span class=nb>Number</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=k>default</span><span class=o>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>props</span><span class=p>);</span> <span class=c1>// Proxy {name: &#39;hello&#39;, age: 18}
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><h3 id=defineemits>defineEmits()<a hidden class=anchor aria-hidden=true href=#defineemits>#</a></h3><blockquote><p>defineProps => 用来发射事件给父组件</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>button</span> <span class=nt>@click</span><span class=s>=&#34;btnClick&#34;</span><span class=p>&gt;</span><span class=na>发送</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=c1>// 1. 注册一下发射的事件
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>emits</span> <span class=o>=</span> <span class=nx>defineEmits</span><span class=p>([</span><span class=s1>&#39;btnClick&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=c1>// 2. 监听按钮的点击
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>btnClick</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 3. 发射
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>emits</span><span class=p>(</span><span class=s1>&#39;btnClick&#39;</span><span class=p>,</span> <span class=s1>&#39;我发射了&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!--</span> <span class=mf>1.</span> <span class=nx>监听子组件发射来的事件</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>my-home</span> <span class=nt>@btnClick</span><span class=s>=&#34;handleClick&#34;</span><span class=p>&gt;</span><span class=err>&lt;/</span><span class=na>my</span><span class=nt>-home</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>myHome</span> <span class=nx>from</span> <span class=s1>&#39;./myHome.vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=c1>// 2. 获取子组件传递过来的值
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>handleClick</span> <span class=o>=</span> <span class=p>(</span><span class=nx>message</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>message</span><span class=p>);</span> <span class=c1>// 我发射了
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><h3 id=defineexpose>defineExpose()<a hidden class=anchor aria-hidden=true href=#defineexpose>#</a></h3><blockquote><p>defineExpose => 用来暴露数据</p><p>ps : 使用 <code>&lt;script setup> </code>的组件是默认关闭的</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>foo</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;foo&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=c1>// 暴露出去，才可以被访问到
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>defineExpose</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>foo</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!--</span> <span class=mf>1.</span> <span class=nx>定义ref</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>my-home</span> <span class=na>ref</span><span class=o>=</span><span class=s>&#34;myHomeRef&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>my-home</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>onMounted</span><span class=p>,</span> <span class=nx>ref</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>myHome</span> <span class=nx>from</span> <span class=s1>&#39;../../../Vue3/06_阶段六-Vue3全家桶实战/code/04_learn_composition/src/11_script_setup语法/myHome.vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>// 2. 定义名称一样
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>myHomeRef</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nx>onMounted</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 3. 在生命周期中访问
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>myHomeRef</span><span class=p>.</span><span class=nx>value</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><h2 id=自定义组件>自定义组件<a hidden class=anchor aria-hidden=true href=#自定义组件>#</a></h2><h3 id=指令的生命周期>指令的生命周期<a hidden class=anchor aria-hidden=true href=#指令的生命周期>#</a></h3><ul><li>一个指令定义的对象，Vue提供了如下的几个钩子函数：</li><li>created：在绑定元素的 attribute 或事件监听器被应用之前调用；</li><li>beforeMount：当指令第一次绑定到元素并且在挂载父组件之前调用；</li><li>mounted：在绑定元素的父组件被挂载后调用；</li><li>beforeUpdate：在更新包含组件的 VNode 之前调用；</li><li>updated：在包含组件的 VNode 及其子组件的 VNode 更新后调用；</li><li>beforeUnmount：在卸载绑定元素的父组件之前调用；</li><li>unmounted：当指令与元素解除绑定且父组件已卸载时，只调用一次；</li></ul><h3 id=指令钩子>指令钩子<a hidden class=anchor aria-hidden=true href=#指令钩子>#</a></h3><p>一个指令的定义对象可以提供几种钩子函数 (都是可选的)：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>myDirective</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 在绑定元素的 attribute 前
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// 或事件监听器应用前调用
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>created</span><span class=p>(</span><span class=nx>el</span><span class=p>,</span> <span class=nx>binding</span><span class=p>,</span> <span class=nx>vnode</span><span class=p>,</span> <span class=nx>prevVnode</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 下面会介绍各个参数的细节
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 在元素被插入到 DOM 前调用
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>beforeMount</span><span class=p>(</span><span class=nx>el</span><span class=p>,</span> <span class=nx>binding</span><span class=p>,</span> <span class=nx>vnode</span><span class=p>,</span> <span class=nx>prevVnode</span><span class=p>)</span> <span class=p>{},</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 在绑定元素的父组件
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// 及他自己的所有子节点都挂载完成后调用
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>mounted</span><span class=p>(</span><span class=nx>el</span><span class=p>,</span> <span class=nx>binding</span><span class=p>,</span> <span class=nx>vnode</span><span class=p>,</span> <span class=nx>prevVnode</span><span class=p>)</span> <span class=p>{},</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 绑定元素的父组件更新前调用
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>beforeUpdate</span><span class=p>(</span><span class=nx>el</span><span class=p>,</span> <span class=nx>binding</span><span class=p>,</span> <span class=nx>vnode</span><span class=p>,</span> <span class=nx>prevVnode</span><span class=p>)</span> <span class=p>{},</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 在绑定元素的父组件
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// 及他自己的所有子节点都更新后调用
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>updated</span><span class=p>(</span><span class=nx>el</span><span class=p>,</span> <span class=nx>binding</span><span class=p>,</span> <span class=nx>vnode</span><span class=p>,</span> <span class=nx>prevVnode</span><span class=p>)</span> <span class=p>{},</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 绑定元素的父组件卸载前调用
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>beforeUnmount</span><span class=p>(</span><span class=nx>el</span><span class=p>,</span> <span class=nx>binding</span><span class=p>,</span> <span class=nx>vnode</span><span class=p>,</span> <span class=nx>prevVnode</span><span class=p>)</span> <span class=p>{},</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 绑定元素的父组件卸载后调用
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>unmounted</span><span class=p>(</span><span class=nx>el</span><span class=p>,</span> <span class=nx>binding</span><span class=p>,</span> <span class=nx>vnode</span><span class=p>,</span> <span class=nx>prevVnode</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>指令的钩子会传递以下几种参数：</p><ul><li><code>el</code>：指令绑定到的元素。这可以用于直接操作 DOM。</li><li><code>binding</code>：一个对象，包含以下属性。<ul><li><code>value</code>：传递给指令的值。例如在 <code>v-my-directive="1 + 1"</code> 中，值是 <code>2</code>。</li><li><code>oldValue</code>：之前的值，仅在 <code>beforeUpdate</code> 和 <code>updated</code> 中可用。无论值是否更改，它都可用。</li><li><code>arg</code>：传递给指令的参数 (如果有的话)。例如在 <code>v-my-directive:foo</code> 中，参数是 <code>"foo"</code>。</li><li><code>modifiers</code>：一个包含修饰符的对象 (如果有的话)。例如在 <code>v-my-directive.foo.bar</code> 中，修饰符对象是 <code>{ foo: true, bar: true }</code>。</li><li><code>instance</code>：使用该指令的组件实例。</li><li><code>dir</code>：指令的定义对象。</li></ul></li><li><code>vnode</code>：代表绑定元素的底层 VNode。</li><li><code>prevNode</code>：代表之前的渲染中指令所绑定元素的 VNode。仅在 <code>beforeUpdate</code> 和 <code>updated</code> 钩子中可用。</li></ul><p>举例来说，像下面这样使用指令：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>div</span> <span class=na>v</span><span class=nt>-example:foo.bar</span><span class=o>=</span><span class=s>&#34;baz&#34;</span><span class=p>&gt;</span>
</span></span></code></pre></div><p><code>binding</code> 参数会是一个这样的对象：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>arg</span><span class=o>:</span> <span class=s1>&#39;foo&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>modifiers</span><span class=o>:</span> <span class=p>{</span> <span class=nx>bar</span><span class=o>:</span> <span class=kc>true</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>value</span><span class=o>:</span> <span class=cm>/* `baz` 的值 */</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>oldValue</span><span class=o>:</span> <span class=cm>/* 上一次更新时 `baz` 的值 */</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>和内置指令类似，自定义指令的参数也可以是动态的。举例来说：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>div</span> <span class=na>v</span><span class=nt>-example:[arg]</span><span class=o>=</span><span class=s>&#34;value&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>这里指令的参数会基于组件的 <code>arg</code> 数据属性响应式地更新。</p><blockquote><p>除了 <code>el</code> 外，其他参数都是只读的，不要更改它们。若你需要在不同的钩子间共享信息，推荐通过元素的
<a href=https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/dataset target=_blank>dataset</a> attribute 实现。</p></blockquote><h3 id=简单使用>简单使用<a hidden class=anchor aria-hidden=true href=#简单使用>#</a></h3><blockquote><p><strong>Vue中自带的指令例如v-show、v-for、v-model等等，除了使用这些指令之外，Vue 也允许我们来自定义自己的指令</strong></p><p><strong>ps : 一般需要对dom元素进行底层操作时使用</strong></p></blockquote><ul><li>自定义指令分为两种：<ul><li>自定义局部指令：组件中通过 directives 选项，只能在当前组件中使用；</li><li>自定义全局指令：app的 directive 方法，可以在任意组件中被使用；</li></ul></li></ul><h4 id=默认实现方式>默认实现方式<a hidden class=anchor aria-hidden=true href=#默认实现方式>#</a></h4><p>一个自定义指令由一个包含类似组件生命周期钩子的对象来定义。钩子函数会接收到指令所绑定元素作为其参数。下面是一个自定义指令的例子，当一个 input 元素被 Vue 插入到 DOM 中后，它会被自动聚焦：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=c1>// 在模板中启用 v-focus
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>vFocus</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>mounted</span><span class=o>:</span> <span class=p>(</span><span class=nx>el</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>el</span><span class=p>.</span><span class=nx>focus</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>input</span> <span class=na>v</span><span class=nt>-focus</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;app-view&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;text&#34;</span> <span class=na>ref</span><span class=o>=</span><span class=s>&#34;inputRef&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>onMounted</span><span class=p>,</span> <span class=nx>ref</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>inputRef</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=nx>onMounted</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>inputRef</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>focus</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><h4 id=使用局部指令>使用局部指令<a hidden class=anchor aria-hidden=true href=#使用局部指令>#</a></h4><p>在 <code>&lt;script setup></code> 中，任何以 <code>v</code> 开头的驼峰式命名的变量都可以被用作一个自定义指令。在上面的例子中，<code>vFocus</code> 即可以在模板中以 <code>v-focus</code> 的形式使用。</p><p>在没有使用 <code>&lt;script setup></code> 的情况下，自定义指令需要通过 <code>directives</code> 选项注册：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;text&#34;</span> <span class=nt>v-focus</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 局部指令
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>directives</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>focus</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>mounted</span><span class=p>(</span><span class=nx>el</span><span class=p>,</span> <span class=nx>bindings</span><span class=p>,</span> <span class=nx>vnode</span><span class=p>,</span> <span class=nx>preVnode</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;focus mounted&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=nx>el</span><span class=p>.</span><span class=nx>focus</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><h4 id=自定义全局指令>自定义全局指令<a hidden class=anchor aria-hidden=true href=#自定义全局指令>#</a></h4><ul><li><code>main.js</code>中注册</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>createApp</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>App</span> <span class=nx>from</span> <span class=s1>&#39;./App.vue&#39;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>app</span> <span class=o>=</span> <span class=nx>createApp</span><span class=p>(</span><span class=nx>App</span><span class=p>)</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=c1>// 指令名称
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>app</span><span class=p>.</span><span class=nx>directive</span><span class=p>(</span><span class=s1>&#39;focus&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 使用自定义指令的生命周期，挂载后访问
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>mounted</span><span class=p>(</span><span class=nx>el</span><span class=p>,</span> <span class=nx>bindings</span><span class=p>,</span> <span class=nx>vnode</span><span class=p>,</span> <span class=nx>preVnode</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>el</span><span class=o>?</span><span class=p>.</span><span class=nx>focus</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>mount</span><span class=p>(</span><span class=s1>&#39;#app&#39;</span><span class=p>)</span>
</span></span></code></pre></div><h5 id=进行抽取>进行抽取<a hidden class=anchor aria-hidden=true href=#进行抽取>#</a></h5><ul><li>注册directives文件夹</li><li>/directives/format-time.js</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=nx>dayjs</span> <span class=nx>from</span> <span class=s1>&#39;dayjs&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=kd>function</span><span class=p>(</span><span class=nx>app</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>app</span><span class=p>.</span><span class=nx>directive</span><span class=p>(</span><span class=s2>&#34;format-time&#34;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>created</span><span class=p>(</span><span class=nx>el</span><span class=p>,</span> <span class=nx>bindings</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>bindings</span><span class=p>.</span><span class=nx>formatString</span> <span class=o>=</span> <span class=s2>&#34;YYYY-MM-DD HH:mm:ss&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>bindings</span><span class=p>.</span><span class=nx>value</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>bindings</span><span class=p>.</span><span class=nx>formatString</span> <span class=o>=</span> <span class=nx>bindings</span><span class=p>.</span><span class=nx>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>mounted</span><span class=p>(</span><span class=nx>el</span><span class=p>,</span> <span class=nx>bindings</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>textContent</span> <span class=o>=</span> <span class=nx>el</span><span class=p>.</span><span class=nx>textContent</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=kd>let</span> <span class=nx>timestamp</span> <span class=o>=</span> <span class=nb>parseInt</span><span class=p>(</span><span class=nx>textContent</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>textContent</span><span class=p>.</span><span class=nx>length</span> <span class=o>===</span> <span class=mi>10</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>timestamp</span> <span class=o>=</span> <span class=nx>timestamp</span> <span class=o>*</span> <span class=mi>1000</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=nx>el</span><span class=p>.</span><span class=nx>textContent</span> <span class=o>=</span> <span class=nx>dayjs</span><span class=p>(</span><span class=nx>timestamp</span><span class=p>).</span><span class=nx>format</span><span class=p>(</span><span class=nx>bindings</span><span class=p>.</span><span class=nx>formatString</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>}</span> 
</span></span></code></pre></div><ul><li>/directives/index.js</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=nx>registerFormatTime</span> <span class=nx>from</span> <span class=s1>&#39;./format-time&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=kd>function</span> <span class=nx>registerDirectives</span><span class=p>(</span><span class=nx>app</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>registerFormatTime</span><span class=p>(</span><span class=nx>app</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><ul><li>mian.js</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=nx>registerDirectives</span> <span class=nx>from</span> <span class=s1>&#39;./directives&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>registerDirectives</span><span class=p>(</span><span class=nx>app</span><span class=p>);</span>
</span></span></code></pre></div><h4 id=setup-1>setup<a hidden class=anchor aria-hidden=true href=#setup-1>#</a></h4><h5 id=函数>函数<a hidden class=anchor aria-hidden=true href=#函数>#</a></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>h1</span> <span class=na>v</span><span class=nt>-fomat-time</span><span class=err>=&#34;</span><span class=na>timeFormatType</span><span class=err>&#34;</span><span class=p>&gt;{{</span> <span class=nx>timeStamp</span> <span class=p>}}&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>ref</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>dayJs</span> <span class=nx>from</span> <span class=s1>&#39;dayjs&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>directives</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;fomat-time&#39;</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>mounted</span><span class=p>(</span><span class=nx>el</span><span class=p>,</span> <span class=nx>bindings</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 默认显示时间类型
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kd>let</span> <span class=nx>formatType</span> <span class=o>=</span> <span class=nx>bindings</span><span class=p>.</span><span class=nx>value</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>formatType</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 转换成number类型
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kd>let</span> <span class=nx>time</span> <span class=o>=</span> <span class=nx>el</span><span class=p>.</span><span class=nx>textContent</span><span class=p>.</span><span class=nx>length</span> <span class=o>===</span> <span class=mi>10</span> <span class=o>?</span> <span class=nx>el</span><span class=p>.</span><span class=nx>textContent</span> <span class=o>*</span> <span class=mi>1000</span> <span class=o>:</span> <span class=nx>el</span><span class=p>.</span><span class=nx>textContent</span> <span class=o>*</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 格式化
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>el</span><span class=p>.</span><span class=nx>textContent</span> <span class=o>=</span> <span class=nx>dayJs</span><span class=p>(</span><span class=nx>time</span><span class=p>).</span><span class=nx>format</span><span class=p>(</span><span class=nx>formatType</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>setInterval</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=c1>// 定时器
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=nx>time</span> <span class=o>=</span> <span class=nx>dayJs</span><span class=p>(</span><span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>valueOf</span><span class=p>()).</span><span class=nx>format</span><span class=p>(</span><span class=nx>formatType</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=nx>el</span><span class=p>.</span><span class=nx>textContent</span> <span class=o>=</span> <span class=nx>time</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span> <span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 设置初始时间戳
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>timeStamp</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>valueOf</span><span class=p>())</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>timeFormatType</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=s1>&#39;YYYY-MM-DD HH:mm:ss&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>timeStamp</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>timeFormatType</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>style</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=nx>h1</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>display</span><span class=o>:</span> <span class=nx>inline</span><span class=o>-</span><span class=nx>block</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>color</span><span class=o>:</span> <span class=nx>transparent</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=o>-</span><span class=nx>webkit</span><span class=o>-</span><span class=nx>background</span><span class=o>-</span><span class=nx>clip</span><span class=o>:</span> <span class=nx>text</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>background</span><span class=o>-</span><span class=nx>image</span><span class=o>:</span> <span class=nx>linear</span><span class=o>-</span><span class=nx>gradient</span><span class=p>(</span><span class=nx>to</span> <span class=nx>right</span><span class=p>,</span> <span class=nx>red</span><span class=p>,</span> <span class=nx>blue</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>style</span><span class=p>&gt;</span>
</span></span></code></pre></div><h5 id=语法糖>语法糖<a hidden class=anchor aria-hidden=true href=#语法糖>#</a></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>h1</span> <span class=na>v</span><span class=nt>-fomat-time</span><span class=err>=&#34;</span><span class=na>timeFormatType</span><span class=err>&#34;</span><span class=p>&gt;{{</span> <span class=nx>timeStamp</span> <span class=p>}}&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>ref</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>dayJs</span> <span class=nx>from</span> <span class=s1>&#39;dayjs&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=c1>// 设置初始时间戳
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>timeStamp</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>valueOf</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=c1>// 设置初始时间格式
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>timeFormatType</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=s1>&#39;YYYY-MM-DD HH:mm:ss&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=c1>// 自定义时间格式化指令
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>vFomatTime</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>mounted</span><span class=p>(</span><span class=nx>el</span><span class=p>,</span> <span class=nx>bindings</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 获取定义的时间格式
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=p>{</span> <span class=nx>value</span><span class=o>:</span> <span class=nx>timeFormatType</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>bindings</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 转换成number类型
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>let</span> <span class=nx>time</span> <span class=o>=</span> <span class=nx>el</span><span class=p>.</span><span class=nx>textContent</span><span class=p>.</span><span class=nx>length</span> <span class=o>===</span> <span class=mi>10</span> <span class=o>?</span> <span class=nx>el</span><span class=p>.</span><span class=nx>textContent</span> <span class=o>*</span> <span class=mi>1000</span> <span class=o>:</span> <span class=nx>el</span><span class=p>.</span><span class=nx>textContent</span> <span class=o>*</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 使用dayJs，根据时间格式来格式化时间,并赋值给el
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>el</span><span class=p>.</span><span class=nx>textContent</span> <span class=o>=</span> <span class=nx>dayJs</span><span class=p>(</span><span class=nx>time</span><span class=p>).</span><span class=nx>format</span><span class=p>(</span><span class=nx>timeFormatType</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 定时器，每隔一秒，重新赋值给el
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>setInterval</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>time</span> <span class=o>=</span> <span class=nx>dayJs</span><span class=p>(</span><span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>valueOf</span><span class=p>()).</span><span class=nx>format</span><span class=p>(</span><span class=nx>timeFormatType</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nx>el</span><span class=p>.</span><span class=nx>textContent</span> <span class=o>=</span> <span class=nx>time</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span> <span class=mi>1000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>style</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=nx>h1</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>display</span><span class=o>:</span> <span class=nx>inline</span><span class=o>-</span><span class=nx>block</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>color</span><span class=o>:</span> <span class=nx>transparent</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=o>-</span><span class=nx>webkit</span><span class=o>-</span><span class=nx>background</span><span class=o>-</span><span class=nx>clip</span><span class=o>:</span> <span class=nx>text</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>background</span><span class=o>-</span><span class=nx>clip</span><span class=o>:</span> <span class=nx>text</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>background</span><span class=o>-</span><span class=nx>image</span><span class=o>:</span> <span class=nx>linear</span><span class=o>-</span><span class=nx>gradient</span><span class=p>(</span><span class=nx>to</span> <span class=nx>right</span><span class=p>,</span> <span class=nx>red</span><span class=p>,</span> <span class=nx>blue</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>style</span><span class=p>&gt;</span>
</span></span></code></pre></div><h2 id=内置组件>内置组件<a hidden class=anchor aria-hidden=true href=#内置组件>#</a></h2><h3 id=teleport>Teleport<a hidden class=anchor aria-hidden=true href=#teleport>#</a></h3><blockquote><p><code>&lt;Teleport></code> 是一个内置组件，它可以将一个组件内部的一部分模板“传送”到该组件的 DOM 结构外层的位置去。</p></blockquote><ul><li>在某些情况下，希望组件不是挂载在当前组件树上的，可能是移动到Vue app之外的其他位置<ul><li>比如移动到body元素上，或者我们有其他的div#app之外的元素上</li><li>可以通过teleport来完成</li></ul></li><li>teleport 翻译过来是心灵传输、远距离运输的意思，有两个属性<ul><li>to : 指定将其中的内容移动到的目标元素，可以使用选择器</li><li>disabled : 是否禁用 teleport 的功能</li></ul></li></ul><h4 id=基本使用-4>基本使用<a hidden class=anchor aria-hidden=true href=#基本使用-4>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;app-view&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!--</span> <span class=nx>把该组件挂载到body元素上</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>teleport</span> <span class=na>to</span><span class=o>=</span><span class=s>&#34;body&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;</span><span class=nx>Teleport</span><span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>teleport</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>style</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=nx>h1</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>display</span><span class=o>:</span> <span class=nx>inline</span><span class=o>-</span><span class=nx>block</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>color</span><span class=o>:</span> <span class=nx>transparent</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=o>-</span><span class=nx>webkit</span><span class=o>-</span><span class=nx>background</span><span class=o>-</span><span class=nx>clip</span><span class=o>:</span> <span class=nx>text</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>background</span><span class=o>-</span><span class=nx>clip</span><span class=o>:</span> <span class=nx>text</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>background</span><span class=o>-</span><span class=nx>image</span><span class=o>:</span> <span class=nx>linear</span><span class=o>-</span><span class=nx>gradient</span><span class=p>(</span><span class=nx>to</span> <span class=nx>right</span><span class=p>,</span> <span class=nx>red</span><span class=p>,</span> <span class=nx>green</span><span class=p>,</span> <span class=nx>pink</span><span class=p>,</span> <span class=nx>yellow</span><span class=p>,</span> <span class=nx>blue</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>style</span><span class=p>&gt;</span>
</span></span></code></pre></div><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202312190008149.png><img src=https://qiniu.waite.wang/202312190008149.png alt=image-20231219000840061></a></div></p><h4 id=挂载到app之外的指定元素上>挂载到#app之外的指定元素上<a hidden class=anchor aria-hidden=true href=#挂载到app之外的指定元素上>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;app&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;star&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;b&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;c&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!--</span> <span class=nx>把该组件挂载到</span><span class=err>#</span><span class=nx>star元素上</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>teleport</span> <span class=na>to</span><span class=o>=</span><span class=s>&#34;#star&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;</span><span class=nx>Teleport</span><span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>teleport</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!--</span> <span class=nx>把该组件挂载到</span><span class=p>.</span><span class=nx>b元素上</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>teleport</span> <span class=na>to</span><span class=o>=</span><span class=s>&#34;.b&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;</span><span class=nx>Teleport123</span><span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>teleport</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!--</span> <span class=nx>文档上说是挂载到</span><span class=err>#</span><span class=nx>app之外的元素</span><span class=err>，</span><span class=nx>可是我发现自己内部的也可以指定</span><span class=err>，</span><span class=nx>emmmm</span><span class=err>，</span><span class=nx>优先是从内部一层层往外找的</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!--</span> <span class=nx>把该组件挂载到</span><span class=p>.</span><span class=nx>c元素上</span><span class=p>...</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>teleport</span> <span class=na>to</span><span class=o>=</span><span class=s>&#34;.c&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;</span><span class=nx>Teleport123</span><span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>teleport</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>style</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=nx>h1</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>display</span><span class=o>:</span> <span class=nx>inline</span><span class=o>-</span><span class=nx>block</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>color</span><span class=o>:</span> <span class=nx>transparent</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=o>-</span><span class=nx>webkit</span><span class=o>-</span><span class=nx>background</span><span class=o>-</span><span class=nx>clip</span><span class=o>:</span> <span class=nx>text</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>background</span><span class=o>-</span><span class=nx>clip</span><span class=o>:</span> <span class=nx>text</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>background</span><span class=o>-</span><span class=nx>image</span><span class=o>:</span> <span class=nx>linear</span><span class=o>-</span><span class=nx>gradient</span><span class=p>(</span><span class=nx>to</span> <span class=nx>right</span><span class=p>,</span> <span class=nx>red</span><span class=p>,</span> <span class=nx>green</span><span class=p>,</span> <span class=nx>pink</span><span class=p>,</span> <span class=nx>yellow</span><span class=p>,</span> <span class=nx>blue</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>style</span><span class=p>&gt;</span>
</span></span></code></pre></div><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202312190013634.png><img src=https://qiniu.waite.wang/202312190013634.png alt=image-20231219001340177></a></div></p><h4 id=多个teleport>多个Teleport<a hidden class=anchor aria-hidden=true href=#多个teleport>#</a></h4><blockquote><p><strong>会合并，谁先谁在前面</strong></p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;star&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;app-view&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!--</span> <span class=nx>把该组件挂载到</span><span class=err>#</span><span class=nx>star元素上</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>teleport</span> <span class=na>to</span><span class=o>=</span><span class=s>&#34;#star&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;</span><span class=nx>Teleport</span><span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>teleport</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!--</span> <span class=nx>把该组件挂载到</span><span class=err>#</span><span class=nx>star元素上</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>teleport</span> <span class=na>to</span><span class=o>=</span><span class=s>&#34;#star&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;</span><span class=nx>Teleport123</span><span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>teleport</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>style</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=nx>h1</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>display</span><span class=o>:</span> <span class=nx>inline</span><span class=o>-</span><span class=nx>block</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>color</span><span class=o>:</span> <span class=nx>transparent</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=o>-</span><span class=nx>webkit</span><span class=o>-</span><span class=nx>background</span><span class=o>-</span><span class=nx>clip</span><span class=o>:</span> <span class=nx>text</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>background</span><span class=o>-</span><span class=nx>clip</span><span class=o>:</span> <span class=nx>text</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>background</span><span class=o>-</span><span class=nx>image</span><span class=o>:</span> <span class=nx>linear</span><span class=o>-</span><span class=nx>gradient</span><span class=p>(</span><span class=nx>to</span> <span class=nx>right</span><span class=p>,</span> <span class=nx>red</span><span class=p>,</span> <span class=nx>green</span><span class=p>,</span> <span class=nx>pink</span><span class=p>,</span> <span class=nx>yellow</span><span class=p>,</span> <span class=nx>blue</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>style</span><span class=p>&gt;</span>
</span></span></code></pre></div><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202312190016061.png><img src=https://qiniu.waite.wang/202312190016061.png alt=image-20231219001638121></a></div></p><h3 id=其他>其他<a hidden class=anchor aria-hidden=true href=#其他>#</a></h3><blockquote><p><a href=https://ladder.waite.wang/web/vue/learn/components/%E5%BC%82%E6%AD%A5%E7%BB%84%E4%BB%B6.html>异步组件 defineAsyncComponent/ Suspense : 实验特性</a></p><p><a href=https://ladder.waite.wang/web/vue/learn/components/%E5%8A%A8%E6%80%81%E7%BB%84%E4%BB%B6.html>动态组件 : component</a></p></blockquote><h2 id=vue插件>Vue插件<a hidden class=anchor aria-hidden=true href=#vue插件>#</a></h2><blockquote><p><a href=https://cn.vuejs.org/guide/reusability/plugins.html#plugins target=_blank>https://cn.vuejs.org/guide/reusability/plugins.html#plugins</a></p></blockquote><ul><li>通常我们向Vue全局添加一些功能时，会采用插件的模式，它有两种编写方式：<ul><li>对象类型：一个对象，但是必须包含一个 <code>install </code>的函数，该函数会在安装插件时执行；</li><li>函数类型：一个<code>function</code>，这个函数会在安装插件时自动执行；</li></ul></li><li>插件可以完成的功能没有限制，比如下面的几种都是可以的：<ul><li>添加全局方法或者<code>property</code>，通过把它们添加到 <code>config.globalProperties</code> 上实现；</li><li>添加全局资源：指令/过滤器/过渡等；</li><li>通过全局 <code>mixin </code>来添加一些组件选项；</li><li>一个库，提供自己的 API，同时提供上面提到的一个或多个功能；</li></ul></li></ul><h3 id=对象类型>对象类型<a hidden class=anchor aria-hidden=true href=#对象类型>#</a></h3><blockquote><p>对象类型：一个对象，但是必须包含一个 install 的函数，该函数会在安装插件时执行</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>install</span><span class=p>(</span><span class=nx>app</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;对象方式，插件被调用了&#39;</span><span class=p>,</span> <span class=nx>app</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><h3 id=函数类型>函数类型<a hidden class=anchor aria-hidden=true href=#函数类型>#</a></h3><blockquote><p>函数类型：一个function，这个函数会在安装插件时自动执行</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=kd>function</span><span class=p>(</span><span class=nx>app</span><span class=p>){</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;函数方式，插件被调用了&#39;</span><span class=p>,</span> <span class=nx>app</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div><h3 id=改写自定义指令>改写自定义指令<a hidden class=anchor aria-hidden=true href=#改写自定义指令>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>createApp</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>App</span> <span class=nx>from</span> <span class=s1>&#39;./App.vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>// 1. 导入指令方法
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>installDirectives</span> <span class=nx>from</span> <span class=s1>&#39;./directives&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=c1>// 2。 注册所有指令
</span></span></span><span class=line><span class=cl><span class=c1>// installDirectives(app);
</span></span></span><span class=line><span class=cl><span class=c1></span> 
</span></span><span class=line><span class=cl><span class=c1>// 这样使用use方法注册指令，因为传入的是一个函数，所以会自动执行
</span></span></span><span class=line><span class=cl><span class=c1>// 并且会把app实例传入，这样就可以在函数内部注册指令了
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>createApp</span><span class=p>(</span><span class=nx>App</span><span class=p>).</span><span class=nx>use</span><span class=p>(</span><span class=nx>installDirectives</span><span class=p>).</span><span class=nx>mount</span><span class=p>(</span><span class=s1>&#39;#app&#39;</span><span class=p>);</span>
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://waite.wang/tags/vue3/>Vue3</a></li></ul><nav class=paginav><a class=prev href=https://waite.wang/posts/vue/vue-project-construction-specification/><span class=title>« 上一页</span><br><span>vue 项目规范设置</span>
</a><a class=next href=https://waite.wang/posts/tools/qiniucloud-typora-picgo/><span class=title>下一页 »</span><br><span>七牛云 + Typora + PicGo</span></a></nav></footer><script src=https://utteranc.es/client.js repo=Waite0603/HugoBlog issue-term=pathname theme=github-light crossorigin=anonymous async></script></article></main><footer class=footer><span><a href=https://beian.miit.gov.cn/ target=_blank rel="noopener noreferrer">粤 ICP 备 2022028437 号</a></span><br><span>Copyright &copy; 2018 - 2025 By <a href=https://waite.wang/>Waite</a>, All Rights
Reserved.</span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script src=/js/jquery-3.5.1.min.js></script><link rel=stylesheet href=/css/jquery.fancybox.min.css><script src=/js/jquery.fancybox.min.js></script></body></html>