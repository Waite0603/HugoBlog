<!doctype html><html lang=zh-cn dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Vue PDF 预览与标注实现解析 | 隶笔难书</title><meta name=keywords content="Vue,Web"><meta name=description content="PDF 预览与标注实现解析
最近在做一个文件预览功能，需要在浏览器里展示 PDF 并支持位置标记和缩放。折腾了一段时间，把实现思路整理一下。
PDF 渲染
PDF 在浏览器里渲染，直接用 @tato30/vue-pdf 这个库。它基于 pdf.js，用起来还算顺手。"><meta name=author content><link rel=canonical href=https://waite.wang/posts/vue/pdf-preview-and-annotation/><link crossorigin=anonymous href=/assets/css/stylesheet.1f25c954b6964bfd120383618e0c76f5d98627118274109d51919206cab78c1e.css integrity="sha256-HyXJVLaWS/0SA4Nhjgx29dmGJxGCdBCdUZGSBsq3jB4=" rel="preload stylesheet" as=style><link rel=icon href=https://waite.wang/images/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://waite.wang/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://waite.wang/favicon-32x32.png><link rel=apple-touch-icon href=https://waite.wang/apple-touch-icon.png><link rel=mask-icon href=https://waite.wang/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh-cn href=https://waite.wang/posts/vue/pdf-preview-and-annotation/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://waite.wang/posts/vue/pdf-preview-and-annotation/"><meta property="og:site_name" content="隶笔难书"><meta property="og:title" content="Vue PDF 预览与标注实现解析"><meta property="og:description" content="PDF 预览与标注实现解析 最近在做一个文件预览功能，需要在浏览器里展示 PDF 并支持位置标记和缩放。折腾了一段时间，把实现思路整理一下。
PDF 渲染 PDF 在浏览器里渲染，直接用 @tato30/vue-pdf 这个库。它基于 pdf.js，用起来还算顺手。"><meta property="og:locale" content="zh-cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-11-11T12:04:23+08:00"><meta property="article:modified_time" content="2025-11-11T12:04:23+08:00"><meta property="article:tag" content="Vue"><meta property="article:tag" content="Web"><meta name=twitter:card content="summary"><meta name=twitter:title content="Vue PDF 预览与标注实现解析"><meta name=twitter:description content="PDF 预览与标注实现解析
最近在做一个文件预览功能，需要在浏览器里展示 PDF 并支持位置标记和缩放。折腾了一段时间，把实现思路整理一下。
PDF 渲染
PDF 在浏览器里渲染，直接用 @tato30/vue-pdf 这个库。它基于 pdf.js，用起来还算顺手。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://waite.wang/posts/"},{"@type":"ListItem","position":2,"name":"Vue PDF 预览与标注实现解析","item":"https://waite.wang/posts/vue/pdf-preview-and-annotation/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Vue PDF 预览与标注实现解析","name":"Vue PDF 预览与标注实现解析","description":"PDF 预览与标注实现解析 最近在做一个文件预览功能，需要在浏览器里展示 PDF 并支持位置标记和缩放。折腾了一段时间，把实现思路整理一下。\nPDF 渲染 PDF 在浏览器里渲染，直接用 @tato30/vue-pdf 这个库。它基于 pdf.js，用起来还算顺手。\n","keywords":["Vue","Web"],"articleBody":"PDF 预览与标注实现解析 最近在做一个文件预览功能，需要在浏览器里展示 PDF 并支持位置标记和缩放。折腾了一段时间，把实现思路整理一下。\nPDF 渲染 PDF 在浏览器里渲染，直接用 @tato30/vue-pdf 这个库。它基于 pdf.js，用起来还算顺手。\n状态定义 先定义几个核心状态：\nconst selectedFile = ref(null) // 当前选中的文件 const page = ref(1) // 当前页码 const isLoading = ref(false) // 加载状态 const zoomLevel = ref(1) // 缩放级别，默认 1 const minZoom = 0.5 // 最小缩放 const maxZoom = 3 // 最大缩放 const position = ref({ x: 0, y: 0 }) // 拖拽位置 const isDragging = ref(false) // 是否正在拖拽 const dragStart = ref({ x: 0, y: 0 }) // 拖拽起始位置 PDF URL 计算 PDF 的 URL 用 computed 动态计算，这样文件切换时会自动更新：\nconst currentPdfUrl = computed(() =\u003e { if (selectedFile.value?.path?.endsWith('.pdf')) { return getFileURL('pdf', selectedFile.value.id) } return '' }) const { pdf, pages } = usePDF(currentPdfUrl) const totalPages = computed(() =\u003e pages.value || 1) usePDF 是个 composable，接收 PDF 的 URL，返回 pdf 对象和总页数 pages。注意这里用 computed 包装 URL，这样当 selectedFile 变化时，PDF 会自动重新加载。\nPDF 监听 监听 PDF 加载完成，更新容器尺寸：\nwatch(pdf, (newPdf) =\u003e { if (newPdf) { isLoading.value = false nextTick(updateContainerSize) } }) nextTick 确保 DOM 更新后再计算尺寸，不然可能拿到旧值。\n模板渲染 在模板里用 VuePDF 组件渲染：\n\u003cVuePDF v-if=\"pdf\" :pdf=\"pdf\" :page=\"page\" :scale=\"zoomLevel\" /\u003e 传三个参数：pdf 对象、当前页码 page、缩放比例 zoomLevel。组件内部会渲染成 canvas，我们不用管底层细节。\n文件选择逻辑 选择文件时需要重置视图和页码，并加载标注数据：\nconst selectFile = (file) =\u003e { resetView() // 重置缩放和位置 page.value = 1 // 重置页码 isLoading.value = true selectedFile.value = file // 处理标注数据，确保页码是数字类型 if (file.risk_info?.page_info) { annotationInfo.value = file.risk_info.page_info.map((item) =\u003e ({ ...item, page: typeof item.page === 'string' ? parseInt(item.page) : item.page, })) } else { annotationInfo.value = [] } } 这里做了类型转换，因为后端可能返回字符串页码，统一转成数字方便后续比较。\n位置标记的实现 位置标记这块比较有意思。需求是在 PDF 上标出有问题的地方，比如某个区域格式不对、内容有误等等。\n数据结构 每个标记包含这些信息：\npage: 页码 location: 位置坐标，用 {x1, y1, x2, y2} 表示，都是 0-1 之间的相对坐标 status: 状态（error、warning、success） reason: 原因描述 坐标用相对值的好处是，不管 PDF 怎么缩放，标记都能准确对应到位置。\n叠加层实现 标记不是直接画在 PDF 上的，而是用一个绝对定位的 overlay 层叠在上面。这样不会影响 PDF 本身的渲染。\n\u003cdiv class=\"pdf-content\"\u003e \u003cVuePDF v-if=\"pdf\" :pdf=\"pdf\" :page=\"page\" :scale=\"zoomLevel\" /\u003e \u003cdiv class=\"annotations-overlay\"\u003e \u003cdiv v-for=\"annotation in currentPageAnnotations.filter((a) =\u003e a.location)\" :key=\"`${annotation.page}-${annotation.location.x}-${annotation.location.y}`\" class=\"annotation-marker\" :class=\"annotation.status || 'error'\" :style=\"getAnnotationStyle(annotation.location)\" /\u003e \u003c/div\u003e \u003c/div\u003e annotations-overlay 用绝对定位铺满整个 PDF 区域，pointer-events: none 让它不拦截鼠标事件。但标记本身设置 pointer-events: auto，这样鼠标悬停时能触发高亮。\n位置计算 getAnnotationStyle 函数把相对坐标转成 CSS 样式：\nconst getAnnotationStyle = (location) =\u003e { if (!location) return {} return { left: `${location.x1 * 100}%`, top: `${location.y1 * 100}%`, width: `${(location.x2 - location.x1) * 100}%`, height: `${(location.y2 - location.y1) * 100}%`, } } 比如 x1: 0.1, x2: 0.3 就表示从左边 10% 到 30% 的区域。这样无论 PDF 怎么缩放，标记都能跟着走。\n当前页过滤 只显示当前页的标记，用 computed 过滤：\nconst currentPageAnnotations = computed(() =\u003e { const currentPage = parseInt(page.value) return annotationInfo.value.filter((annotation) =\u003e { const annotationPage = typeof annotation.page === 'string' ? parseInt(annotation.page) : annotation.page return annotationPage === currentPage }) }) 这里做了类型兼容，因为后端可能返回字符串页码。\n标注列表联动 右侧有个标注列表，点击可以跳转到对应页面并高亮。\n状态管理 const currentAnnotationIndex = ref(-1) // 当前标注索引 const highlightedAnnotation = ref(null) // 高亮的标注 const totalAnnotations = computed(() =\u003e annotationInfo.value.length) // 是否可以切换标注 const canGoPrevAnnotation = computed(() =\u003e { return totalAnnotations.value \u003e 0 }) const canGoNextAnnotation = computed(() =\u003e { return totalAnnotations.value \u003e 0 }) 切换标注逻辑 切换到下一个标注：\nconst nextAnnotation = () =\u003e { if (canGoNextAnnotation.value) { // 循环切换：最后一个切到第一个 if (currentAnnotationIndex.value \u003e= totalAnnotations.value - 1) { currentAnnotationIndex.value = 0 } else { currentAnnotationIndex.value++ } const annotation = annotationInfo.value[currentAnnotationIndex.value] // 确保页码是数字类型 if (typeof annotation.page === 'string') { annotation.page = parseInt(annotation.page) } // 如果页码不同，切换页面 if (annotation.page !== page.value) { page.value = annotation.page } highlightAnnotation(annotation) } } 切换到上一个标注：\nconst prevAnnotation = () =\u003e { if (canGoPrevAnnotation.value) { // 如果是第一个标注，则切换到最后一个 if (currentAnnotationIndex.value \u003c= 0) { currentAnnotationIndex.value = totalAnnotations.value - 1 } else { currentAnnotationIndex.value-- } const annotation = annotationInfo.value[currentAnnotationIndex.value] if (typeof annotation.page === 'string') { annotation.page = parseInt(annotation.page) } if (annotation.page !== page.value) { page.value = annotation.page } highlightAnnotation(annotation) } } 高亮处理 const highlightAnnotation = (annotation) =\u003e { highlightedAnnotation.value = annotation } const clearHighlight = () =\u003e { highlightedAnnotation.value = null } 页面切换自动选择标注 监听页面变化，自动选择当前页面的第一个标注：\nwatch(page, (newPage) =\u003e { const pageAnnotations = annotationInfo.value.filter((a) =\u003e a.page === newPage) if (pageAnnotations.length \u003e 0) { const index = annotationInfo.value.indexOf(pageAnnotations[0]) if (index !== -1) { currentAnnotationIndex.value = index highlightAnnotation(pageAnnotations[0]) } } }) 切换标注时会自动跳转到对应页面，如果标注不在当前页的话。页面切换时也会自动选中该页的第一个标注。\n缩放与拖拽 缩放功能比较常规，但放大后需要支持拖拽移动，不然放大后看不到其他区域就很尴尬。\n缩放实现 缩放用 CSS transform: scale()，配合 transformOrigin: 'center center' 让缩放以中心点为基准：\n\u003cdiv class=\"pdf-content\" :style=\"{ transform: `scale(${zoomLevel}) translate(${position.x}px, ${position.y}px)`, transformOrigin: 'center center', cursor: isDragging ? 'grabbing' : zoomLevel \u003e 1 ? 'grab' : 'default', }\" \u003e zoomLevel 范围是 0.5 到 3，每次点击缩放按钮增减 0.1。缩放和位移都放在同一个 transform 里，这样性能更好。\n拖拽逻辑 只有放大（zoomLevel \u003e 1）时才允许拖拽，不然没必要。\n开始拖拽 const startDrag = (event) =\u003e { if (zoomLevel.value \u003c= 1) return // 只有放大时才能拖动 isDragging.value = true dragStart.value = { x: event.clientX - position.value.x, y: event.clientY - position.value.y, } } 这里有个细节：dragStart 存的是鼠标位置减去当前位移，这样拖拽时计算的是相对位移，而不是绝对位置。不然拖拽会\"跳\"一下。\n拖拽中 const onDrag = (event) =\u003e { if (!isDragging.value) return event.preventDefault() position.value = { x: event.clientX - dragStart.value.x, y: event.clientY - dragStart.value.y, } } preventDefault 防止拖拽时选中文本。\n停止拖拽 const stopDrag = () =\u003e { isDragging.value = false } 在 mouseup 和 mouseleave 事件中都调用，确保鼠标离开元素时也能结束拖拽。\n缩放控制 const zoomIn = () =\u003e { if (zoomLevel.value \u003c maxZoom) { zoomLevel.value = Math.min(maxZoom, zoomLevel.value + 0.1) } } const zoomOut = () =\u003e { if (zoomLevel.value \u003e minZoom) { zoomLevel.value = Math.max(minZoom, zoomLevel.value - 0.1) } } 每次增减 0.1，用 Math.min 和 Math.max 限制范围。\n重置视图 const resetView = () =\u003e { zoomLevel.value = 1 position.value = { x: 0, y: 0 } } // 切换页面时重置位置 watch(page, () =\u003e { position.value = { x: 0, y: 0 } }) 切换页面时也会自动重置位置，避免上一页的拖拽状态影响新页面。\n判断是否需要重置 const needsReset = computed(() =\u003e { return zoomLevel.value !== 1 || position.value.x !== 0 || position.value.y !== 0 }) 只有当缩放不是 1 或位置不是原点时，才显示重置按钮。\n一些细节 页码控制 上一页/下一页 const prevPage = () =\u003e { if (page.value \u003e 1) { page.value-- } } const nextPage = () =\u003e { if (page.value \u003c totalPages.value) { page.value++ } } 页码输入处理 const handlePageChange = (value) =\u003e { if (typeof value === 'string') { value = parseInt(value) } const newPage = parseInt(value) if (isNaN(newPage) || newPage \u003c 1) { page.value = 1 } else if (newPage \u003e totalPages.value) { page.value = totalPages.value } else { page.value = newPage } } 处理边界情况：非数字、小于 1、大于总页数。\n全屏模式 切换全屏 const toggleFullscreen = async () =\u003e { try { if (!document.fullscreenElement) { await contentRef.value.requestFullscreen() } else { await document.exitFullscreen() } } catch (err) { ElMessage.error('Fullscreen mode is not supported or disabled') } } 监听全屏状态 const handleFullscreenChange = () =\u003e { isFullscreen.value = !!document.fullscreenElement } // 在 onMounted 中监听 onMounted(() =\u003e { document.addEventListener('fullscreenchange', handleFullscreenChange) }) // 在 onUnmounted 中移除监听 onUnmounted(() =\u003e { document.removeEventListener('fullscreenchange', handleFullscreenChange) // 确保退出组件时退出全屏 if (document.fullscreenElement) { document.exitFullscreen() } }) 容器尺寸监听 const updateContainerSize = () =\u003e { if (pdfContainerRef.value) { const container = pdfContainerRef.value containerSize.value = { width: container.offsetWidth, height: container.offsetHeight, } } } // 监听窗口大小变化 onMounted(() =\u003e { window.addEventListener('resize', updateContainerSize) }) onUnmounted(() =\u003e { window.removeEventListener('resize', updateContainerSize) }) 性能优化 标记层用 pointer-events: none，只有标记本身响应鼠标事件 transform 用 CSS 实现，利用 GPU 加速 切换页面时重置位置，避免不必要的计算 用 computed 缓存计算结果，减少重复计算 总结 整体实现不算复杂，主要是几个点：\nPDF 渲染用现成的库，省事 标记用 overlay 层叠加，不污染 PDF 本身 坐标用相对值，适配各种缩放比例 缩放和拖拽配合，提升用户体验 实际用起来效果还行，标记位置准确，缩放拖拽也流畅。就是标记多的时候可能会有性能问题，不过目前还没遇到。\nCSS 样式详解 样式这块也挺重要，直接影响交互体验。下面详细说说关键样式的作用。\n整体布局 .content { display: grid; grid-template-columns: 300px 1fr; // 左侧文件列表 300px，右侧 PDF 区域自适应 margin-bottom: 8px; height: 100%; } 用 Grid 布局，左侧固定宽度，右侧自适应。\nPDF 容器样式 .content-body { flex: 1; overflow: hidden; // 隐藏溢出内容 display: flex; border-radius: 10px; border: 2px solid #bdbdbd; position: relative; margin: 10px; // 全屏模式 \u0026.fullscreen { position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 9999; // 确保在最上层 margin: 0; border-radius: 0; background-color: white; } } 全屏时用 position: fixed 铺满整个屏幕，z-index: 9999 确保在最上层。\nPDF 视图区域 .pdf-view-area { flex: 1; position: relative; border-right: 1px solid #dcdfe6; display: flex; justify-content: center; // 水平居中 align-items: center; // 垂直居中 overflow: hidden; // 隐藏溢出，配合拖拽使用 } overflow: hidden 很重要，这样放大后拖拽时，超出容器的部分会被隐藏。\nPDF 内容区域 .pdf-content { max-width: 100%; max-height: 100%; display: flex; justify-content: center; align-items: center; padding: 20px; position: relative; transition: transform 0.1s ease; // transform 动画，让缩放更平滑 user-select: none; // 防止拖动时选中文本 \u0026:active { cursor: grabbing; // 拖拽时显示抓取光标 } // PDF canvas 样式 :deep(canvas) { max-width: 100%; max-height: 100%; object-fit: contain; // 保持比例，完整显示 } } user-select: none 防止拖拽时选中文本，transition 让缩放动画更平滑。\n标注叠加层 .annotations-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; pointer-events: none; // 不拦截鼠标事件 .annotation-marker { position: absolute; border: 2px solid; border-radius: 4px; pointer-events: auto; // 标记本身可以响应鼠标事件 cursor: pointer; opacity: 0.6; // 默认半透明 transition: opacity 0.3s; // 透明度过渡 \u0026:hover { opacity: 1; // 悬停时完全不透明 } // 不同状态的样式 \u0026.error { border-color: #f56c6c; background-color: rgba(245, 108, 108, 0.3); } \u0026.warning { border-color: #e6a23c; background-color: rgba(230, 162, 60, 0.3); } \u0026.success { border-color: #67c23a; background-color: rgba(103, 194, 58, 0.3); } } } pointer-events: none 让 overlay 不拦截事件，但标记本身设置 pointer-events: auto，这样只有标记能响应鼠标。用 rgba 设置半透明背景，不会完全遮挡 PDF 内容。\n标注列表样式 .file-annotation { width: 300px; padding: 16px; background-color: #f5f7fa; display: flex; flex-direction: column; justify-content: space-between; .annotation-list { flex: 1; overflow-y: auto; // 列表可滚动 margin-bottom: 16px; .annotation-item { background-color: #fff; padding: 12px; border-radius: 4px; margin-bottom: 12px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05); display: flex; align-items: center; gap: 12px; cursor: pointer; transition: all 0.3s; // 所有属性过渡 \u0026:hover { transform: translateX(-4px); // 悬停时向左移动 box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); } \u0026.highlighted { background-color: #ecf5ff; border-left: 4px solid #409eff; // 左侧蓝色边框 } .annotation-status { width: 12px; height: 12px; border-radius: 50%; // 圆形状态点 \u0026.error { background-color: #f56c6c; } \u0026.warning { background-color: #e6a23c; } \u0026.success { background-color: #67c23a; } } } } } 标注项悬停时用 transform: translateX(-4px) 向左移动，配合阴影变化，有轻微的\"浮起\"效果。高亮时左侧加蓝色边框，视觉上更明显。\n控制栏样式 .pdf-controls { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); // 水平居中 background-color: rgba(255, 255, 255, 0.9); // 半透明白色背景 padding: 10px; border-radius: 8px; box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1); display: flex; align-items: center; gap: 20px; z-index: 100; // 确保在 PDF 上方 .controls-group { display: flex; align-items: center; gap: 10px; \u0026.zoom-controls { padding-left: 10px; border-left: 1px solid #dcdfe6; // 左侧分隔线 } .control-icon { font-size: 20px; padding: 8px; border-radius: 4px; cursor: pointer; transition: all 0.3s; color: #409eff; \u0026:hover { background-color: #ecf5ff; } \u0026.disabled { color: #c0c4cc; cursor: not-allowed; \u0026:hover { background-color: transparent; // 禁用时不响应悬停 } } } .zoom-level { min-width: 60px; text-align: center; font-size: 14px; color: #606266; } } } 控制栏用 position: absolute 固定在底部，transform: translateX(-50%) 实现水平居中。半透明背景不会完全遮挡 PDF，但又能看清控制按钮。\n页码输入框样式 .page-input-group { display: flex; align-items: center; margin: 0 10px; .el-input { width: 55px; margin-right: 5px; :deep(.el-input__inner) { padding: 0 8px; text-align: center; // 文字居中 } // 隐藏数字输入框的上下箭头 :deep(.el-input__inner::-webkit-outer-spin-button), :deep(.el-input__inner::-webkit-inner-spin-button) { -webkit-appearance: none; margin: 0; } :deep(.el-input__inner[type='number']) { -moz-appearance: textfield; // Firefox 隐藏箭头 } } } 隐藏数字输入框的上下箭头，让界面更简洁。用 :deep() 穿透 Element Plus 的样式作用域。\n文件列表样式 .files-section { padding: 10px; flex: 1; display: flex; flex-direction: column; \u0026.hidden-in-fullscreen { display: none; // 全屏时隐藏 } .file-list { flex: 1; overflow-y: auto; // 可滚动 border-radius: 10px; border: 2px solid #e7e7e7; .file-item { padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; transition: background-color 0.2s; border-bottom: 2px solid #e7e7e7; \u0026:hover { background: #f5f7fa; } \u0026.active { background: #0085fc; // 选中时蓝色背景 color: #fff; .file-icon { color: #fff; } } } } } 文件项选中时用蓝色背景，视觉上更明显。悬停时背景色变化，提供交互反馈。\n样式技巧总结 定位技巧：PDF 容器用 position: relative，标注 overlay 用 position: absolute 叠加 事件穿透：overlay 用 pointer-events: none，标记用 pointer-events: auto 居中技巧：用 transform: translateX(-50%) 实现绝对定位元素的水平居中 过渡动画：用 transition 让交互更平滑，特别是 transform 和 opacity 层级管理：用 z-index 控制元素层级，控制栏和全屏模式需要较高层级 响应式：用 max-width 和 max-height 配合 object-fit: contain 保持比例 一些其他的预览 PDF 方法 使用 @vue-office/pdf 库 微软官方的 Office Online 预览 （https://view.officeapps.live.com/op/view.aspx?src=https://501351981.github.io/vue-office/examples/dist/static/test-files/test.docx） 需要第三方域名支持 ","wordCount":"3982","inLanguage":"zh-cn","datePublished":"2025-11-11T12:04:23+08:00","dateModified":"2025-11-11T12:04:23+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://waite.wang/posts/vue/pdf-preview-and-annotation/"},"publisher":{"@type":"Organization","name":"隶笔难书","logo":{"@type":"ImageObject","url":"https://waite.wang/images/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://waite.wang/ accesskey=h title="隶笔难书 (Alt + H)">隶笔难书</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://waite.wang/ title=首页><span>首页</span></a></li><li><a href=https://waite.wang/search title=搜索><span>搜索</span></a></li><li><a href=https://waite.wang/categories title=分类><span>分类</span></a></li><li><a href=https://waite.wang/tags title=标签><span>标签</span></a></li><li><a href=https://waite.wang/archives title=归档><span>归档</span></a></li><li><a href=https://waite.wang/links title=友链><span>友链</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Vue PDF 预览与标注实现解析</h1><div class=post-meta><span title='2025-11-11 12:04:23 +0800 +0800'>2025-11-11</span>&nbsp;·&nbsp;8 min&nbsp;·&nbsp;3982 words&nbsp;|&nbsp;<a href=https://github.com/Waite0603/HugoBlog/edit/main/content/posts/vue/pdf-preview-and-annotation.md rel="noopener noreferrer" target=_blank>在 GitHub 编辑</a></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#pdf-%e9%a2%84%e8%a7%88%e4%b8%8e%e6%a0%87%e6%b3%a8%e5%ae%9e%e7%8e%b0%e8%a7%a3%e6%9e%90 aria-label="PDF 预览与标注实现解析">PDF 预览与标注实现解析</a><ul><li><a href=#pdf-%e6%b8%b2%e6%9f%93 aria-label="PDF 渲染">PDF 渲染</a><ul><li><a href=#%e7%8a%b6%e6%80%81%e5%ae%9a%e4%b9%89 aria-label=状态定义>状态定义</a></li><li><a href=#pdf-url-%e8%ae%a1%e7%ae%97 aria-label="PDF URL 计算">PDF URL 计算</a></li><li><a href=#pdf-%e7%9b%91%e5%90%ac aria-label="PDF 监听">PDF 监听</a></li><li><a href=#%e6%a8%a1%e6%9d%bf%e6%b8%b2%e6%9f%93 aria-label=模板渲染>模板渲染</a></li><li><a href=#%e6%96%87%e4%bb%b6%e9%80%89%e6%8b%a9%e9%80%bb%e8%be%91 aria-label=文件选择逻辑>文件选择逻辑</a></li></ul></li><li><a href=#%e4%bd%8d%e7%bd%ae%e6%a0%87%e8%ae%b0%e7%9a%84%e5%ae%9e%e7%8e%b0 aria-label=位置标记的实现>位置标记的实现</a><ul><li><a href=#%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84 aria-label=数据结构>数据结构</a></li><li><a href=#%e5%8f%a0%e5%8a%a0%e5%b1%82%e5%ae%9e%e7%8e%b0 aria-label=叠加层实现>叠加层实现</a></li><li><a href=#%e4%bd%8d%e7%bd%ae%e8%ae%a1%e7%ae%97 aria-label=位置计算>位置计算</a></li><li><a href=#%e5%bd%93%e5%89%8d%e9%a1%b5%e8%bf%87%e6%bb%a4 aria-label=当前页过滤>当前页过滤</a></li><li><a href=#%e6%a0%87%e6%b3%a8%e5%88%97%e8%a1%a8%e8%81%94%e5%8a%a8 aria-label=标注列表联动>标注列表联动</a><ul><li><a href=#%e7%8a%b6%e6%80%81%e7%ae%a1%e7%90%86 aria-label=状态管理>状态管理</a></li><li><a href=#%e5%88%87%e6%8d%a2%e6%a0%87%e6%b3%a8%e9%80%bb%e8%be%91 aria-label=切换标注逻辑>切换标注逻辑</a></li><li><a href=#%e9%ab%98%e4%ba%ae%e5%a4%84%e7%90%86 aria-label=高亮处理>高亮处理</a></li><li><a href=#%e9%a1%b5%e9%9d%a2%e5%88%87%e6%8d%a2%e8%87%aa%e5%8a%a8%e9%80%89%e6%8b%a9%e6%a0%87%e6%b3%a8 aria-label=页面切换自动选择标注>页面切换自动选择标注</a></li></ul></li></ul></li><li><a href=#%e7%bc%a9%e6%94%be%e4%b8%8e%e6%8b%96%e6%8b%bd aria-label=缩放与拖拽>缩放与拖拽</a><ul><li><a href=#%e7%bc%a9%e6%94%be%e5%ae%9e%e7%8e%b0 aria-label=缩放实现>缩放实现</a></li><li><a href=#%e6%8b%96%e6%8b%bd%e9%80%bb%e8%be%91 aria-label=拖拽逻辑>拖拽逻辑</a><ul><li><a href=#%e5%bc%80%e5%a7%8b%e6%8b%96%e6%8b%bd aria-label=开始拖拽>开始拖拽</a></li><li><a href=#%e6%8b%96%e6%8b%bd%e4%b8%ad aria-label=拖拽中>拖拽中</a></li><li><a href=#%e5%81%9c%e6%ad%a2%e6%8b%96%e6%8b%bd aria-label=停止拖拽>停止拖拽</a></li><li><a href=#%e7%bc%a9%e6%94%be%e6%8e%a7%e5%88%b6 aria-label=缩放控制>缩放控制</a></li><li><a href=#%e9%87%8d%e7%bd%ae%e8%a7%86%e5%9b%be aria-label=重置视图>重置视图</a></li><li><a href=#%e5%88%a4%e6%96%ad%e6%98%af%e5%90%a6%e9%9c%80%e8%a6%81%e9%87%8d%e7%bd%ae aria-label=判断是否需要重置>判断是否需要重置</a></li></ul></li></ul></li><li><a href=#%e4%b8%80%e4%ba%9b%e7%bb%86%e8%8a%82 aria-label=一些细节>一些细节</a><ul><li><a href=#%e9%a1%b5%e7%a0%81%e6%8e%a7%e5%88%b6 aria-label=页码控制>页码控制</a><ul><li><a href=#%e4%b8%8a%e4%b8%80%e9%a1%b5%e4%b8%8b%e4%b8%80%e9%a1%b5 aria-label=上一页/下一页>上一页/下一页</a></li><li><a href=#%e9%a1%b5%e7%a0%81%e8%be%93%e5%85%a5%e5%a4%84%e7%90%86 aria-label=页码输入处理>页码输入处理</a></li></ul></li><li><a href=#%e5%85%a8%e5%b1%8f%e6%a8%a1%e5%bc%8f aria-label=全屏模式>全屏模式</a><ul><li><a href=#%e5%88%87%e6%8d%a2%e5%85%a8%e5%b1%8f aria-label=切换全屏>切换全屏</a></li><li><a href=#%e7%9b%91%e5%90%ac%e5%85%a8%e5%b1%8f%e7%8a%b6%e6%80%81 aria-label=监听全屏状态>监听全屏状态</a></li></ul></li><li><a href=#%e5%ae%b9%e5%99%a8%e5%b0%ba%e5%af%b8%e7%9b%91%e5%90%ac aria-label=容器尺寸监听>容器尺寸监听</a></li><li><a href=#%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96 aria-label=性能优化>性能优化</a></li></ul></li><li><a href=#%e6%80%bb%e7%bb%93 aria-label=总结>总结</a></li><li><a href=#css-%e6%a0%b7%e5%bc%8f%e8%af%a6%e8%a7%a3 aria-label="CSS 样式详解">CSS 样式详解</a><ul><li><a href=#%e6%95%b4%e4%bd%93%e5%b8%83%e5%b1%80 aria-label=整体布局>整体布局</a></li><li><a href=#pdf-%e5%ae%b9%e5%99%a8%e6%a0%b7%e5%bc%8f aria-label="PDF 容器样式">PDF 容器样式</a></li><li><a href=#pdf-%e8%a7%86%e5%9b%be%e5%8c%ba%e5%9f%9f aria-label="PDF 视图区域">PDF 视图区域</a></li><li><a href=#pdf-%e5%86%85%e5%ae%b9%e5%8c%ba%e5%9f%9f aria-label="PDF 内容区域">PDF 内容区域</a></li><li><a href=#%e6%a0%87%e6%b3%a8%e5%8f%a0%e5%8a%a0%e5%b1%82 aria-label=标注叠加层>标注叠加层</a></li><li><a href=#%e6%a0%87%e6%b3%a8%e5%88%97%e8%a1%a8%e6%a0%b7%e5%bc%8f aria-label=标注列表样式>标注列表样式</a></li><li><a href=#%e6%8e%a7%e5%88%b6%e6%a0%8f%e6%a0%b7%e5%bc%8f aria-label=控制栏样式>控制栏样式</a></li><li><a href=#%e9%a1%b5%e7%a0%81%e8%be%93%e5%85%a5%e6%a1%86%e6%a0%b7%e5%bc%8f aria-label=页码输入框样式>页码输入框样式</a></li><li><a href=#%e6%96%87%e4%bb%b6%e5%88%97%e8%a1%a8%e6%a0%b7%e5%bc%8f aria-label=文件列表样式>文件列表样式</a></li><li><a href=#%e6%a0%b7%e5%bc%8f%e6%8a%80%e5%b7%a7%e6%80%bb%e7%bb%93 aria-label=样式技巧总结>样式技巧总结</a></li></ul></li><li><a href=#%e4%b8%80%e4%ba%9b%e5%85%b6%e4%bb%96%e7%9a%84%e9%a2%84%e8%a7%88-pdf-%e6%96%b9%e6%b3%95 aria-label="一些其他的预览 PDF 方法">一些其他的预览 PDF 方法</a></li></ul></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h1 id=pdf-预览与标注实现解析>PDF 预览与标注实现解析<a hidden class=anchor aria-hidden=true href=#pdf-预览与标注实现解析>#</a></h1><p>最近在做一个文件预览功能，需要在浏览器里展示 PDF 并支持位置标记和缩放。折腾了一段时间，把实现思路整理一下。</p><h2 id=pdf-渲染>PDF 渲染<a hidden class=anchor aria-hidden=true href=#pdf-渲染>#</a></h2><p>PDF 在浏览器里渲染，直接用 <code>@tato30/vue-pdf</code> 这个库。它基于 pdf.js，用起来还算顺手。</p><h3 id=状态定义>状态定义<a hidden class=anchor aria-hidden=true href=#状态定义>#</a></h3><p>先定义几个核心状态：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>selectedFile</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=kc>null</span><span class=p>)</span>        <span class=c1>// 当前选中的文件
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>page</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>                    <span class=c1>// 当前页码
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>isLoading</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=kc>false</span><span class=p>)</span>           <span class=c1>// 加载状态
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>zoomLevel</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>               <span class=c1>// 缩放级别，默认 1
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>minZoom</span> <span class=o>=</span> <span class=mf>0.5</span>                    <span class=c1>// 最小缩放
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>maxZoom</span> <span class=o>=</span> <span class=mi>3</span>                      <span class=c1>// 最大缩放
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>position</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>({</span> <span class=nx>x</span>: <span class=kt>0</span><span class=p>,</span> <span class=nx>y</span>: <span class=kt>0</span> <span class=p>})</span>   <span class=c1>// 拖拽位置
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>isDragging</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=kc>false</span><span class=p>)</span>          <span class=c1>// 是否正在拖拽
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>dragStart</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>({</span> <span class=nx>x</span>: <span class=kt>0</span><span class=p>,</span> <span class=nx>y</span>: <span class=kt>0</span> <span class=p>})</span>  <span class=c1>// 拖拽起始位置
</span></span></span></code></pre></div><h3 id=pdf-url-计算>PDF URL 计算<a hidden class=anchor aria-hidden=true href=#pdf-url-计算>#</a></h3><p>PDF 的 URL 用 computed 动态计算，这样文件切换时会自动更新：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>currentPdfUrl</span> <span class=o>=</span> <span class=nx>computed</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>selectedFile</span><span class=p>.</span><span class=nx>value</span><span class=o>?</span><span class=p>.</span><span class=nx>path</span><span class=o>?</span><span class=p>.</span><span class=nx>endsWith</span><span class=p>(</span><span class=s1>&#39;.pdf&#39;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>getFileURL</span><span class=p>(</span><span class=s1>&#39;pdf&#39;</span><span class=p>,</span> <span class=nx>selectedFile</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>pdf</span><span class=p>,</span> <span class=nx>pages</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>usePDF</span><span class=p>(</span><span class=nx>currentPdfUrl</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>totalPages</span> <span class=o>=</span> <span class=nx>computed</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=nx>pages</span><span class=p>.</span><span class=nx>value</span> <span class=o>||</span> <span class=mi>1</span><span class=p>)</span>
</span></span></code></pre></div><p><code>usePDF</code> 是个 composable，接收 PDF 的 URL，返回 <code>pdf</code> 对象和总页数 <code>pages</code>。注意这里用 computed 包装 URL，这样当 <code>selectedFile</code> 变化时，PDF 会自动重新加载。</p><h3 id=pdf-监听>PDF 监听<a hidden class=anchor aria-hidden=true href=#pdf-监听>#</a></h3><p>监听 PDF 加载完成，更新容器尺寸：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=nx>watch</span><span class=p>(</span><span class=nx>pdf</span><span class=p>,</span> <span class=p>(</span><span class=nx>newPdf</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>newPdf</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>isLoading</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>    <span class=nx>nextTick</span><span class=p>(</span><span class=nx>updateContainerSize</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div><p><code>nextTick</code> 确保 DOM 更新后再计算尺寸，不然可能拿到旧值。</p><h3 id=模板渲染>模板渲染<a hidden class=anchor aria-hidden=true href=#模板渲染>#</a></h3><p>在模板里用 <code>VuePDF</code> 组件渲染：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>VuePDF</span> <span class=nt>v-if</span><span class=o>=</span><span class=s>&#34;pdf&#34; :pdf=&#34;pdf&#34; :page=&#34;page&#34; :scale=&#34;zoomLevel&#34;</span><span class=p> /&gt;</span>
</span></span></code></pre></div><p>传三个参数：<code>pdf</code> 对象、当前页码 <code>page</code>、缩放比例 <code>zoomLevel</code>。组件内部会渲染成 canvas，我们不用管底层细节。</p><h3 id=文件选择逻辑>文件选择逻辑<a hidden class=anchor aria-hidden=true href=#文件选择逻辑>#</a></h3><p>选择文件时需要重置视图和页码，并加载标注数据：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>selectFile</span> <span class=o>=</span> <span class=p>(</span><span class=nx>file</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>resetView</span><span class=p>()</span>        <span class=c1>// 重置缩放和位置
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>page</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=mi>1</span>     <span class=c1>// 重置页码
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>isLoading</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>  <span class=nx>selectedFile</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=nx>file</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// 处理标注数据，确保页码是数字类型
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>if</span> <span class=p>(</span><span class=nx>file</span><span class=p>.</span><span class=nx>risk_info</span><span class=o>?</span><span class=p>.</span><span class=nx>page_info</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>annotationInfo</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=nx>file</span><span class=p>.</span><span class=nx>risk_info</span><span class=p>.</span><span class=nx>page_info</span><span class=p>.</span><span class=nx>map</span><span class=p>((</span><span class=nx>item</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=p>...</span><span class=nx>item</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>page</span>: <span class=kt>typeof</span> <span class=nx>item</span><span class=p>.</span><span class=nx>page</span> <span class=o>===</span> <span class=s1>&#39;string&#39;</span> <span class=o>?</span> <span class=nb>parseInt</span><span class=p>(</span><span class=nx>item</span><span class=p>.</span><span class=nx>page</span><span class=p>)</span> <span class=o>:</span> <span class=nx>item</span><span class=p>.</span><span class=nx>page</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}))</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>annotationInfo</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>这里做了类型转换，因为后端可能返回字符串页码，统一转成数字方便后续比较。</p><h2 id=位置标记的实现>位置标记的实现<a hidden class=anchor aria-hidden=true href=#位置标记的实现>#</a></h2><p>位置标记这块比较有意思。需求是在 PDF 上标出有问题的地方，比如某个区域格式不对、内容有误等等。</p><h3 id=数据结构>数据结构<a hidden class=anchor aria-hidden=true href=#数据结构>#</a></h3><p>每个标记包含这些信息：</p><ul><li><code>page</code>: 页码</li><li><code>location</code>: 位置坐标，用 <code>{x1, y1, x2, y2}</code> 表示，都是 0-1 之间的相对坐标</li><li><code>status</code>: 状态（error、warning、success）</li><li><code>reason</code>: 原因描述</li></ul><p>坐标用相对值的好处是，不管 PDF 怎么缩放，标记都能准确对应到位置。</p><h3 id=叠加层实现>叠加层实现<a hidden class=anchor aria-hidden=true href=#叠加层实现>#</a></h3><p>标记不是直接画在 PDF 上的，而是用一个绝对定位的 overlay 层叠在上面。这样不会影响 PDF 本身的渲染。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;pdf-content&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>VuePDF</span> <span class=nt>v-if</span><span class=o>=</span><span class=s>&#34;pdf&#34; :pdf=&#34;pdf&#34; :page=&#34;page&#34; :scale=&#34;zoomLevel&#34;</span><span class=p> /&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;annotations-overlay&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span>
</span></span><span class=line><span class=cl>      <span class=nt>v-for</span><span class=o>=</span><span class=s>&#34;annotation in currentPageAnnotations.filter((a) =&gt; a.location)&#34;</span><span class=p>
</span></span></span><span class=line><span class=cl><span class=p></span>      <span class=nt>:key</span><span class=o>=</span><span class=s>&#34;`${annotation.page}-${annotation.location.x}-${annotation.location.y}`&#34;</span>
</span></span><span class=line><span class=cl>      <span class=na>class</span><span class=o>=</span><span class=s>&#34;annotation-marker&#34;</span>
</span></span><span class=line><span class=cl>      <span class=o>:</span><span class=na>class</span><span class=o>=</span><span class=s>&#34;annotation.status || &#39;error&#39;&#34;</span>
</span></span><span class=line><span class=cl>      <span class=nt>:style</span><span class=o>=</span><span class=s>&#34;getAnnotationStyle(annotation.location)&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span></code></pre></div><p><code>annotations-overlay</code> 用绝对定位铺满整个 PDF 区域，<code>pointer-events: none</code> 让它不拦截鼠标事件。但标记本身设置 <code>pointer-events: auto</code>，这样鼠标悬停时能触发高亮。</p><h3 id=位置计算>位置计算<a hidden class=anchor aria-hidden=true href=#位置计算>#</a></h3><p><code>getAnnotationStyle</code> 函数把相对坐标转成 CSS 样式：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>getAnnotationStyle</span> <span class=o>=</span> <span class=p>(</span><span class=nx>location</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>location</span><span class=p>)</span> <span class=k>return</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>left</span><span class=o>:</span> <span class=sb>`</span><span class=si>${</span><span class=nx>location</span><span class=p>.</span><span class=nx>x1</span> <span class=o>*</span> <span class=mi>100</span><span class=si>}</span><span class=sb>%`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>top</span><span class=o>:</span> <span class=sb>`</span><span class=si>${</span><span class=nx>location</span><span class=p>.</span><span class=nx>y1</span> <span class=o>*</span> <span class=mi>100</span><span class=si>}</span><span class=sb>%`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>width</span><span class=o>:</span> <span class=sb>`</span><span class=si>${</span><span class=p>(</span><span class=nx>location</span><span class=p>.</span><span class=nx>x2</span> <span class=o>-</span> <span class=nx>location</span><span class=p>.</span><span class=nx>x1</span><span class=p>)</span> <span class=o>*</span> <span class=mi>100</span><span class=si>}</span><span class=sb>%`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>height</span><span class=o>:</span> <span class=sb>`</span><span class=si>${</span><span class=p>(</span><span class=nx>location</span><span class=p>.</span><span class=nx>y2</span> <span class=o>-</span> <span class=nx>location</span><span class=p>.</span><span class=nx>y1</span><span class=p>)</span> <span class=o>*</span> <span class=mi>100</span><span class=si>}</span><span class=sb>%`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>比如 <code>x1: 0.1, x2: 0.3</code> 就表示从左边 10% 到 30% 的区域。这样无论 PDF 怎么缩放，标记都能跟着走。</p><h3 id=当前页过滤>当前页过滤<a hidden class=anchor aria-hidden=true href=#当前页过滤>#</a></h3><p>只显示当前页的标记，用 computed 过滤：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>currentPageAnnotations</span> <span class=o>=</span> <span class=nx>computed</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>currentPage</span> <span class=o>=</span> <span class=nb>parseInt</span><span class=p>(</span><span class=nx>page</span><span class=p>.</span><span class=nx>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>annotationInfo</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>filter</span><span class=p>((</span><span class=nx>annotation</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>annotationPage</span> <span class=o>=</span> <span class=k>typeof</span> <span class=nx>annotation</span><span class=p>.</span><span class=nx>page</span> <span class=o>===</span> <span class=s1>&#39;string&#39;</span> 
</span></span><span class=line><span class=cl>      <span class=o>?</span> <span class=nb>parseInt</span><span class=p>(</span><span class=nx>annotation</span><span class=p>.</span><span class=nx>page</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>      <span class=o>:</span> <span class=nx>annotation</span><span class=p>.</span><span class=nx>page</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>annotationPage</span> <span class=o>===</span> <span class=nx>currentPage</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div><p>这里做了类型兼容，因为后端可能返回字符串页码。</p><h3 id=标注列表联动>标注列表联动<a hidden class=anchor aria-hidden=true href=#标注列表联动>#</a></h3><p>右侧有个标注列表，点击可以跳转到对应页面并高亮。</p><h4 id=状态管理>状态管理<a hidden class=anchor aria-hidden=true href=#状态管理>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>currentAnnotationIndex</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span>           <span class=c1>// 当前标注索引
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>highlightedAnnotation</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=kc>null</span><span class=p>)</span>          <span class=c1>// 高亮的标注
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>totalAnnotations</span> <span class=o>=</span> <span class=nx>computed</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=nx>annotationInfo</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>length</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 是否可以切换标注
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>canGoPrevAnnotation</span> <span class=o>=</span> <span class=nx>computed</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>totalAnnotations</span><span class=p>.</span><span class=nx>value</span> <span class=o>&gt;</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>canGoNextAnnotation</span> <span class=o>=</span> <span class=nx>computed</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>totalAnnotations</span><span class=p>.</span><span class=nx>value</span> <span class=o>&gt;</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div><h4 id=切换标注逻辑>切换标注逻辑<a hidden class=anchor aria-hidden=true href=#切换标注逻辑>#</a></h4><p>切换到下一个标注：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>nextAnnotation</span> <span class=o>=</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>canGoNextAnnotation</span><span class=p>.</span><span class=nx>value</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 循环切换：最后一个切到第一个
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=nx>currentAnnotationIndex</span><span class=p>.</span><span class=nx>value</span> <span class=o>&gt;=</span> <span class=nx>totalAnnotations</span><span class=p>.</span><span class=nx>value</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>currentAnnotationIndex</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>currentAnnotationIndex</span><span class=p>.</span><span class=nx>value</span><span class=o>++</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>annotation</span> <span class=o>=</span> <span class=nx>annotationInfo</span><span class=p>.</span><span class=nx>value</span><span class=p>[</span><span class=nx>currentAnnotationIndex</span><span class=p>.</span><span class=nx>value</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 确保页码是数字类型
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=k>typeof</span> <span class=nx>annotation</span><span class=p>.</span><span class=nx>page</span> <span class=o>===</span> <span class=s1>&#39;string&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>annotation</span><span class=p>.</span><span class=nx>page</span> <span class=o>=</span> <span class=nb>parseInt</span><span class=p>(</span><span class=nx>annotation</span><span class=p>.</span><span class=nx>page</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 如果页码不同，切换页面
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=nx>annotation</span><span class=p>.</span><span class=nx>page</span> <span class=o>!==</span> <span class=nx>page</span><span class=p>.</span><span class=nx>value</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>page</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=nx>annotation</span><span class=p>.</span><span class=nx>page</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>highlightAnnotation</span><span class=p>(</span><span class=nx>annotation</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>切换到上一个标注：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>prevAnnotation</span> <span class=o>=</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>canGoPrevAnnotation</span><span class=p>.</span><span class=nx>value</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 如果是第一个标注，则切换到最后一个
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=nx>currentAnnotationIndex</span><span class=p>.</span><span class=nx>value</span> <span class=o>&lt;=</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>currentAnnotationIndex</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=nx>totalAnnotations</span><span class=p>.</span><span class=nx>value</span> <span class=o>-</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>currentAnnotationIndex</span><span class=p>.</span><span class=nx>value</span><span class=o>--</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>annotation</span> <span class=o>=</span> <span class=nx>annotationInfo</span><span class=p>.</span><span class=nx>value</span><span class=p>[</span><span class=nx>currentAnnotationIndex</span><span class=p>.</span><span class=nx>value</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=k>typeof</span> <span class=nx>annotation</span><span class=p>.</span><span class=nx>page</span> <span class=o>===</span> <span class=s1>&#39;string&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>annotation</span><span class=p>.</span><span class=nx>page</span> <span class=o>=</span> <span class=nb>parseInt</span><span class=p>(</span><span class=nx>annotation</span><span class=p>.</span><span class=nx>page</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>annotation</span><span class=p>.</span><span class=nx>page</span> <span class=o>!==</span> <span class=nx>page</span><span class=p>.</span><span class=nx>value</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>page</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=nx>annotation</span><span class=p>.</span><span class=nx>page</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>highlightAnnotation</span><span class=p>(</span><span class=nx>annotation</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h4 id=高亮处理>高亮处理<a hidden class=anchor aria-hidden=true href=#高亮处理>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>highlightAnnotation</span> <span class=o>=</span> <span class=p>(</span><span class=nx>annotation</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>highlightedAnnotation</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=nx>annotation</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>clearHighlight</span> <span class=o>=</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>highlightedAnnotation</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=kc>null</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h4 id=页面切换自动选择标注>页面切换自动选择标注<a hidden class=anchor aria-hidden=true href=#页面切换自动选择标注>#</a></h4><p>监听页面变化，自动选择当前页面的第一个标注：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=nx>watch</span><span class=p>(</span><span class=nx>page</span><span class=p>,</span> <span class=p>(</span><span class=nx>newPage</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>pageAnnotations</span> <span class=o>=</span> <span class=nx>annotationInfo</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>filter</span><span class=p>((</span><span class=nx>a</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=nx>a</span><span class=p>.</span><span class=nx>page</span> <span class=o>===</span> <span class=nx>newPage</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>pageAnnotations</span><span class=p>.</span><span class=nx>length</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>index</span> <span class=o>=</span> <span class=nx>annotationInfo</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>indexOf</span><span class=p>(</span><span class=nx>pageAnnotations</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>index</span> <span class=o>!==</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>currentAnnotationIndex</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=nx>index</span>
</span></span><span class=line><span class=cl>      <span class=nx>highlightAnnotation</span><span class=p>(</span><span class=nx>pageAnnotations</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div><p>切换标注时会自动跳转到对应页面，如果标注不在当前页的话。页面切换时也会自动选中该页的第一个标注。</p><h2 id=缩放与拖拽>缩放与拖拽<a hidden class=anchor aria-hidden=true href=#缩放与拖拽>#</a></h2><p>缩放功能比较常规，但放大后需要支持拖拽移动，不然放大后看不到其他区域就很尴尬。</p><h3 id=缩放实现>缩放实现<a hidden class=anchor aria-hidden=true href=#缩放实现>#</a></h3><p>缩放用 CSS <code>transform: scale()</code>，配合 <code>transformOrigin: 'center center'</code> 让缩放以中心点为基准：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>div</span>
</span></span><span class=line><span class=cl>  <span class=na>class</span><span class=o>=</span><span class=s>&#34;pdf-content&#34;</span>
</span></span><span class=line><span class=cl>  <span class=o>:</span><span class=na>style</span><span class=o>=</span><span class=s>&#34;{
</span></span></span><span class=line><span class=cl><span class=s>    transform: `scale(${zoomLevel}) translate(${position.x}px, ${position.y}px)`,
</span></span></span><span class=line><span class=cl><span class=s>    transformOrigin: &#39;center center&#39;,
</span></span></span><span class=line><span class=cl><span class=s>    cursor: isDragging ? &#39;grabbing&#39; : zoomLevel &gt; 1 ? &#39;grab&#39; : &#39;default&#39;,
</span></span></span><span class=line><span class=cl><span class=s>  }&#34;</span>
</span></span><span class=line><span class=cl><span class=p>&gt;</span>
</span></span></code></pre></div><p><code>zoomLevel</code> 范围是 0.5 到 3，每次点击缩放按钮增减 0.1。缩放和位移都放在同一个 <code>transform</code> 里，这样性能更好。</p><h3 id=拖拽逻辑>拖拽逻辑<a hidden class=anchor aria-hidden=true href=#拖拽逻辑>#</a></h3><p>只有放大（<code>zoomLevel > 1</code>）时才允许拖拽，不然没必要。</p><h4 id=开始拖拽>开始拖拽<a hidden class=anchor aria-hidden=true href=#开始拖拽>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>startDrag</span> <span class=o>=</span> <span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>zoomLevel</span><span class=p>.</span><span class=nx>value</span> <span class=o>&lt;=</span> <span class=mi>1</span><span class=p>)</span> <span class=k>return</span> <span class=c1>// 只有放大时才能拖动
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>isDragging</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>  <span class=nx>dragStart</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>x</span>: <span class=kt>event.clientX</span> <span class=o>-</span> <span class=nx>position</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>x</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>y</span>: <span class=kt>event.clientY</span> <span class=o>-</span> <span class=nx>position</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>y</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>这里有个细节：<code>dragStart</code> 存的是鼠标位置减去当前位移，这样拖拽时计算的是相对位移，而不是绝对位置。不然拖拽会"跳"一下。</p><h4 id=拖拽中>拖拽中<a hidden class=anchor aria-hidden=true href=#拖拽中>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>onDrag</span> <span class=o>=</span> <span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>isDragging</span><span class=p>.</span><span class=nx>value</span><span class=p>)</span> <span class=k>return</span>
</span></span><span class=line><span class=cl>  <span class=nx>event</span><span class=p>.</span><span class=nx>preventDefault</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=nx>position</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>x</span>: <span class=kt>event.clientX</span> <span class=o>-</span> <span class=nx>dragStart</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>x</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>y</span>: <span class=kt>event.clientY</span> <span class=o>-</span> <span class=nx>dragStart</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>y</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><code>preventDefault</code> 防止拖拽时选中文本。</p><h4 id=停止拖拽>停止拖拽<a hidden class=anchor aria-hidden=true href=#停止拖拽>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>stopDrag</span> <span class=o>=</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>isDragging</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>在 <code>mouseup</code> 和 <code>mouseleave</code> 事件中都调用，确保鼠标离开元素时也能结束拖拽。</p><h4 id=缩放控制>缩放控制<a hidden class=anchor aria-hidden=true href=#缩放控制>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>zoomIn</span> <span class=o>=</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>zoomLevel</span><span class=p>.</span><span class=nx>value</span> <span class=o>&lt;</span> <span class=nx>maxZoom</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>zoomLevel</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>min</span><span class=p>(</span><span class=nx>maxZoom</span><span class=p>,</span> <span class=nx>zoomLevel</span><span class=p>.</span><span class=nx>value</span> <span class=o>+</span> <span class=mf>0.1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>zoomOut</span> <span class=o>=</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>zoomLevel</span><span class=p>.</span><span class=nx>value</span> <span class=o>&gt;</span> <span class=nx>minZoom</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>zoomLevel</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>max</span><span class=p>(</span><span class=nx>minZoom</span><span class=p>,</span> <span class=nx>zoomLevel</span><span class=p>.</span><span class=nx>value</span> <span class=o>-</span> <span class=mf>0.1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>每次增减 0.1，用 <code>Math.min</code> 和 <code>Math.max</code> 限制范围。</p><h4 id=重置视图>重置视图<a hidden class=anchor aria-hidden=true href=#重置视图>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>resetView</span> <span class=o>=</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>zoomLevel</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>  <span class=nx>position</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=p>{</span> <span class=nx>x</span>: <span class=kt>0</span><span class=p>,</span> <span class=nx>y</span>: <span class=kt>0</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 切换页面时重置位置
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>watch</span><span class=p>(</span><span class=nx>page</span><span class=p>,</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>position</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=p>{</span> <span class=nx>x</span>: <span class=kt>0</span><span class=p>,</span> <span class=nx>y</span>: <span class=kt>0</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div><p>切换页面时也会自动重置位置，避免上一页的拖拽状态影响新页面。</p><h4 id=判断是否需要重置>判断是否需要重置<a hidden class=anchor aria-hidden=true href=#判断是否需要重置>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>needsReset</span> <span class=o>=</span> <span class=nx>computed</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>zoomLevel</span><span class=p>.</span><span class=nx>value</span> <span class=o>!==</span> <span class=mi>1</span> <span class=o>||</span> <span class=nx>position</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>x</span> <span class=o>!==</span> <span class=mi>0</span> <span class=o>||</span> <span class=nx>position</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>y</span> <span class=o>!==</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div><p>只有当缩放不是 1 或位置不是原点时，才显示重置按钮。</p><h2 id=一些细节>一些细节<a hidden class=anchor aria-hidden=true href=#一些细节>#</a></h2><h3 id=页码控制>页码控制<a hidden class=anchor aria-hidden=true href=#页码控制>#</a></h3><h4 id=上一页下一页>上一页/下一页<a hidden class=anchor aria-hidden=true href=#上一页下一页>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>prevPage</span> <span class=o>=</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>page</span><span class=p>.</span><span class=nx>value</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>page</span><span class=p>.</span><span class=nx>value</span><span class=o>--</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>nextPage</span> <span class=o>=</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>page</span><span class=p>.</span><span class=nx>value</span> <span class=o>&lt;</span> <span class=nx>totalPages</span><span class=p>.</span><span class=nx>value</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>page</span><span class=p>.</span><span class=nx>value</span><span class=o>++</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h4 id=页码输入处理>页码输入处理<a hidden class=anchor aria-hidden=true href=#页码输入处理>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>handlePageChange</span> <span class=o>=</span> <span class=p>(</span><span class=nx>value</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=k>typeof</span> <span class=nx>value</span> <span class=o>===</span> <span class=s1>&#39;string&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>value</span> <span class=o>=</span> <span class=nb>parseInt</span><span class=p>(</span><span class=nx>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>newPage</span> <span class=o>=</span> <span class=nb>parseInt</span><span class=p>(</span><span class=nx>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nb>isNaN</span><span class=p>(</span><span class=nx>newPage</span><span class=p>)</span> <span class=o>||</span> <span class=nx>newPage</span> <span class=o>&lt;</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>page</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=nx>newPage</span> <span class=o>&gt;</span> <span class=nx>totalPages</span><span class=p>.</span><span class=nx>value</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>page</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=nx>totalPages</span><span class=p>.</span><span class=nx>value</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>page</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=nx>newPage</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>处理边界情况：非数字、小于 1、大于总页数。</p><h3 id=全屏模式>全屏模式<a hidden class=anchor aria-hidden=true href=#全屏模式>#</a></h3><h4 id=切换全屏>切换全屏<a hidden class=anchor aria-hidden=true href=#切换全屏>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>toggleFullscreen</span> <span class=o>=</span> <span class=kr>async</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nb>document</span><span class=p>.</span><span class=nx>fullscreenElement</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>await</span> <span class=nx>contentRef</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>requestFullscreen</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>await</span> <span class=nb>document</span><span class=p>.</span><span class=nx>exitFullscreen</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>ElMessage</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;Fullscreen mode is not supported or disabled&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h4 id=监听全屏状态>监听全屏状态<a hidden class=anchor aria-hidden=true href=#监听全屏状态>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>handleFullscreenChange</span> <span class=o>=</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>isFullscreen</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=o>!!</span><span class=nb>document</span><span class=p>.</span><span class=nx>fullscreenElement</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 在 onMounted 中监听
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>onMounted</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>document</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s1>&#39;fullscreenchange&#39;</span><span class=p>,</span> <span class=nx>handleFullscreenChange</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 在 onUnmounted 中移除监听
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>onUnmounted</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>document</span><span class=p>.</span><span class=nx>removeEventListener</span><span class=p>(</span><span class=s1>&#39;fullscreenchange&#39;</span><span class=p>,</span> <span class=nx>handleFullscreenChange</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 确保退出组件时退出全屏
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>if</span> <span class=p>(</span><span class=nb>document</span><span class=p>.</span><span class=nx>fullscreenElement</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>document</span><span class=p>.</span><span class=nx>exitFullscreen</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div><h3 id=容器尺寸监听>容器尺寸监听<a hidden class=anchor aria-hidden=true href=#容器尺寸监听>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>updateContainerSize</span> <span class=o>=</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>pdfContainerRef</span><span class=p>.</span><span class=nx>value</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>container</span> <span class=o>=</span> <span class=nx>pdfContainerRef</span><span class=p>.</span><span class=nx>value</span>
</span></span><span class=line><span class=cl>    <span class=nx>containerSize</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>width</span>: <span class=kt>container.offsetWidth</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>height</span>: <span class=kt>container.offsetHeight</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 监听窗口大小变化
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>onMounted</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>window</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s1>&#39;resize&#39;</span><span class=p>,</span> <span class=nx>updateContainerSize</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>onUnmounted</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>window</span><span class=p>.</span><span class=nx>removeEventListener</span><span class=p>(</span><span class=s1>&#39;resize&#39;</span><span class=p>,</span> <span class=nx>updateContainerSize</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div><h3 id=性能优化>性能优化<a hidden class=anchor aria-hidden=true href=#性能优化>#</a></h3><ul><li>标记层用 <code>pointer-events: none</code>，只有标记本身响应鼠标事件</li><li>transform 用 CSS 实现，利用 GPU 加速</li><li>切换页面时重置位置，避免不必要的计算</li><li>用 computed 缓存计算结果，减少重复计算</li></ul><h2 id=总结>总结<a hidden class=anchor aria-hidden=true href=#总结>#</a></h2><p>整体实现不算复杂，主要是几个点：</p><ol><li>PDF 渲染用现成的库，省事</li><li>标记用 overlay 层叠加，不污染 PDF 本身</li><li>坐标用相对值，适配各种缩放比例</li><li>缩放和拖拽配合，提升用户体验</li></ol><p>实际用起来效果还行，标记位置准确，缩放拖拽也流畅。就是标记多的时候可能会有性能问题，不过目前还没遇到。</p><h2 id=css-样式详解>CSS 样式详解<a hidden class=anchor aria-hidden=true href=#css-样式详解>#</a></h2><p>样式这块也挺重要，直接影响交互体验。下面详细说说关键样式的作用。</p><h3 id=整体布局>整体布局<a hidden class=anchor aria-hidden=true href=#整体布局>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-scss data-lang=scss><span class=line><span class=cl><span class=nc>.content</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=na>display</span><span class=o>:</span> <span class=ni>grid</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=na>grid-template-columns</span><span class=o>:</span> <span class=mi>300</span><span class=kt>px</span> <span class=mi>1</span><span class=kt>fr</span><span class=p>;</span>  <span class=c1>// 左侧文件列表 300px，右侧 PDF 区域自适应
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=na>margin-bottom</span><span class=o>:</span> <span class=mi>8</span><span class=kt>px</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=na>height</span><span class=o>:</span> <span class=mi>100</span><span class=kt>%</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>用 Grid 布局，左侧固定宽度，右侧自适应。</p><h3 id=pdf-容器样式>PDF 容器样式<a hidden class=anchor aria-hidden=true href=#pdf-容器样式>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-scss data-lang=scss><span class=line><span class=cl><span class=nc>.content-body</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=na>flex</span><span class=o>:</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=na>overflow</span><span class=o>:</span> <span class=ni>hidden</span><span class=p>;</span>              <span class=c1>// 隐藏溢出内容
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=na>display</span><span class=o>:</span> <span class=ni>flex</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=na>border-radius</span><span class=o>:</span> <span class=mi>10</span><span class=kt>px</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=na>border</span><span class=o>:</span> <span class=mi>2</span><span class=kt>px</span> <span class=ni>solid</span> <span class=mh>#bdbdbd</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=na>position</span><span class=o>:</span> <span class=ni>relative</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=na>margin</span><span class=o>:</span> <span class=mi>10</span><span class=kt>px</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 全屏模式
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>&amp;</span><span class=nc>.fullscreen</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=na>position</span><span class=o>:</span> <span class=ni>fixed</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=na>top</span><span class=o>:</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=na>left</span><span class=o>:</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=na>right</span><span class=o>:</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=na>bottom</span><span class=o>:</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=na>z-index</span><span class=o>:</span> <span class=mi>9999</span><span class=p>;</span>               <span class=c1>// 确保在最上层
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=na>margin</span><span class=o>:</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=na>border-radius</span><span class=o>:</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=na>background-color</span><span class=o>:</span> <span class=ni>white</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>全屏时用 <code>position: fixed</code> 铺满整个屏幕，<code>z-index: 9999</code> 确保在最上层。</p><h3 id=pdf-视图区域>PDF 视图区域<a hidden class=anchor aria-hidden=true href=#pdf-视图区域>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-scss data-lang=scss><span class=line><span class=cl><span class=nc>.pdf-view-area</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=na>flex</span><span class=o>:</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=na>position</span><span class=o>:</span> <span class=ni>relative</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=na>border-right</span><span class=o>:</span> <span class=mi>1</span><span class=kt>px</span> <span class=ni>solid</span> <span class=mh>#dcdfe6</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=na>display</span><span class=o>:</span> <span class=ni>flex</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=na>justify-content</span><span class=o>:</span> <span class=ni>center</span><span class=p>;</span>        <span class=c1>// 水平居中
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=na>align-items</span><span class=o>:</span> <span class=ni>center</span><span class=p>;</span>            <span class=c1>// 垂直居中
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=na>overflow</span><span class=o>:</span> <span class=ni>hidden</span><span class=p>;</span>               <span class=c1>// 隐藏溢出，配合拖拽使用
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><p><code>overflow: hidden</code> 很重要，这样放大后拖拽时，超出容器的部分会被隐藏。</p><h3 id=pdf-内容区域>PDF 内容区域<a hidden class=anchor aria-hidden=true href=#pdf-内容区域>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-scss data-lang=scss><span class=line><span class=cl><span class=nc>.pdf-content</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=na>max-width</span><span class=o>:</span> <span class=mi>100</span><span class=kt>%</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=na>max-height</span><span class=o>:</span> <span class=mi>100</span><span class=kt>%</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=na>display</span><span class=o>:</span> <span class=ni>flex</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=na>justify-content</span><span class=o>:</span> <span class=ni>center</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=na>align-items</span><span class=o>:</span> <span class=ni>center</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=na>padding</span><span class=o>:</span> <span class=mi>20</span><span class=kt>px</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=na>position</span><span class=o>:</span> <span class=ni>relative</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=na>transition</span><span class=o>:</span> <span class=ni>transform</span> <span class=mi>0</span><span class=mf>.1</span><span class=kt>s</span> <span class=ni>ease</span><span class=p>;</span>  <span class=c1>// transform 动画，让缩放更平滑
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=na>user-select</span><span class=o>:</span> <span class=ni>none</span><span class=p>;</span>                <span class=c1>// 防止拖动时选中文本
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=k>&amp;</span><span class=nd>:active</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=na>cursor</span><span class=o>:</span> <span class=ni>grabbing</span><span class=p>;</span>               <span class=c1>// 拖拽时显示抓取光标
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// PDF canvas 样式
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nd>:deep</span><span class=o>(</span><span class=nt>canvas</span><span class=o>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=na>max-width</span><span class=o>:</span> <span class=mi>100</span><span class=kt>%</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=na>max-height</span><span class=o>:</span> <span class=mi>100</span><span class=kt>%</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=na>object-fit</span><span class=o>:</span> <span class=ni>contain</span><span class=p>;</span>           <span class=c1>// 保持比例，完整显示
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><code>user-select: none</code> 防止拖拽时选中文本，<code>transition</code> 让缩放动画更平滑。</p><h3 id=标注叠加层>标注叠加层<a hidden class=anchor aria-hidden=true href=#标注叠加层>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-scss data-lang=scss><span class=line><span class=cl><span class=nc>.annotations-overlay</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=na>position</span><span class=o>:</span> <span class=ni>absolute</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=na>top</span><span class=o>:</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=na>left</span><span class=o>:</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=na>right</span><span class=o>:</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=na>bottom</span><span class=o>:</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=na>pointer-events</span><span class=o>:</span> <span class=ni>none</span><span class=p>;</span>            <span class=c1>// 不拦截鼠标事件
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=nc>.annotation-marker</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=na>position</span><span class=o>:</span> <span class=ni>absolute</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=na>border</span><span class=o>:</span> <span class=mi>2</span><span class=kt>px</span> <span class=ni>solid</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=na>border-radius</span><span class=o>:</span> <span class=mi>4</span><span class=kt>px</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=na>pointer-events</span><span class=o>:</span> <span class=ni>auto</span><span class=p>;</span>          <span class=c1>// 标记本身可以响应鼠标事件
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=na>cursor</span><span class=o>:</span> <span class=ni>pointer</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=na>opacity</span><span class=o>:</span> <span class=mi>0</span><span class=mf>.6</span><span class=p>;</span>                  <span class=c1>// 默认半透明
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=na>transition</span><span class=o>:</span> <span class=ni>opacity</span> <span class=mi>0</span><span class=mf>.3</span><span class=kt>s</span><span class=p>;</span>     <span class=c1>// 透明度过渡
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=k>&amp;</span><span class=nd>:hover</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=na>opacity</span><span class=o>:</span> <span class=mi>1</span><span class=p>;</span>                  <span class=c1>// 悬停时完全不透明
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 不同状态的样式
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>&amp;</span><span class=nc>.error</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=na>border-color</span><span class=o>:</span> <span class=mh>#f56c6c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=na>background-color</span><span class=o>:</span> <span class=nf>rgba</span><span class=p>(</span><span class=mi>245</span><span class=o>,</span> <span class=mi>108</span><span class=o>,</span> <span class=mi>108</span><span class=o>,</span> <span class=mi>0</span><span class=mf>.3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>&amp;</span><span class=nc>.warning</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=na>border-color</span><span class=o>:</span> <span class=mh>#e6a23c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=na>background-color</span><span class=o>:</span> <span class=nf>rgba</span><span class=p>(</span><span class=mi>230</span><span class=o>,</span> <span class=mi>162</span><span class=o>,</span> <span class=mi>60</span><span class=o>,</span> <span class=mi>0</span><span class=mf>.3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>&amp;</span><span class=nc>.success</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=na>border-color</span><span class=o>:</span> <span class=mh>#67c23a</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=na>background-color</span><span class=o>:</span> <span class=nf>rgba</span><span class=p>(</span><span class=mi>103</span><span class=o>,</span> <span class=mi>194</span><span class=o>,</span> <span class=mi>58</span><span class=o>,</span> <span class=mi>0</span><span class=mf>.3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><code>pointer-events: none</code> 让 overlay 不拦截事件，但标记本身设置 <code>pointer-events: auto</code>，这样只有标记能响应鼠标。用 <code>rgba</code> 设置半透明背景，不会完全遮挡 PDF 内容。</p><h3 id=标注列表样式>标注列表样式<a hidden class=anchor aria-hidden=true href=#标注列表样式>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-scss data-lang=scss><span class=line><span class=cl><span class=nc>.file-annotation</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=na>width</span><span class=o>:</span> <span class=mi>300</span><span class=kt>px</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=na>padding</span><span class=o>:</span> <span class=mi>16</span><span class=kt>px</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=na>background-color</span><span class=o>:</span> <span class=mh>#f5f7fa</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=na>display</span><span class=o>:</span> <span class=ni>flex</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=na>flex-direction</span><span class=o>:</span> <span class=ni>column</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=na>justify-content</span><span class=o>:</span> <span class=ni>space-between</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nc>.annotation-list</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=na>flex</span><span class=o>:</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=na>overflow-y</span><span class=o>:</span> <span class=ni>auto</span><span class=p>;</span>              <span class=c1>// 列表可滚动
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=na>margin-bottom</span><span class=o>:</span> <span class=mi>16</span><span class=kt>px</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nc>.annotation-item</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=na>background-color</span><span class=o>:</span> <span class=mh>#fff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=na>padding</span><span class=o>:</span> <span class=mi>12</span><span class=kt>px</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=na>border-radius</span><span class=o>:</span> <span class=mi>4</span><span class=kt>px</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=na>margin-bottom</span><span class=o>:</span> <span class=mi>12</span><span class=kt>px</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=na>box-shadow</span><span class=o>:</span> <span class=mi>0</span> <span class=mi>2</span><span class=kt>px</span> <span class=mi>4</span><span class=kt>px</span> <span class=nf>rgba</span><span class=p>(</span><span class=mi>0</span><span class=o>,</span> <span class=mi>0</span><span class=o>,</span> <span class=mi>0</span><span class=o>,</span> <span class=mi>0</span><span class=mf>.05</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=na>display</span><span class=o>:</span> <span class=ni>flex</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=na>align-items</span><span class=o>:</span> <span class=ni>center</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=na>gap</span><span class=o>:</span> <span class=mi>12</span><span class=kt>px</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=na>cursor</span><span class=o>:</span> <span class=ni>pointer</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=na>transition</span><span class=o>:</span> <span class=ni>all</span> <span class=mi>0</span><span class=mf>.3</span><span class=kt>s</span><span class=p>;</span>        <span class=c1>// 所有属性过渡
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>      <span class=k>&amp;</span><span class=nd>:hover</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=na>transform</span><span class=o>:</span> <span class=nf>translateX</span><span class=p>(</span><span class=o>-</span><span class=mi>4</span><span class=kt>px</span><span class=p>);</span>  <span class=c1>// 悬停时向左移动
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=na>box-shadow</span><span class=o>:</span> <span class=mi>0</span> <span class=mi>4</span><span class=kt>px</span> <span class=mi>8</span><span class=kt>px</span> <span class=nf>rgba</span><span class=p>(</span><span class=mi>0</span><span class=o>,</span> <span class=mi>0</span><span class=o>,</span> <span class=mi>0</span><span class=o>,</span> <span class=mi>0</span><span class=mf>.1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=k>&amp;</span><span class=nc>.highlighted</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=na>background-color</span><span class=o>:</span> <span class=mh>#ecf5ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=na>border-left</span><span class=o>:</span> <span class=mi>4</span><span class=kt>px</span> <span class=ni>solid</span> <span class=mh>#409eff</span><span class=p>;</span>  <span class=c1>// 左侧蓝色边框
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=nc>.annotation-status</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=na>width</span><span class=o>:</span> <span class=mi>12</span><span class=kt>px</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=na>height</span><span class=o>:</span> <span class=mi>12</span><span class=kt>px</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=na>border-radius</span><span class=o>:</span> <span class=mi>50</span><span class=kt>%</span><span class=p>;</span>         <span class=c1>// 圆形状态点
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=k>&amp;</span><span class=nc>.error</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=na>background-color</span><span class=o>:</span> <span class=mh>#f56c6c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>&amp;</span><span class=nc>.warning</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=na>background-color</span><span class=o>:</span> <span class=mh>#e6a23c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>&amp;</span><span class=nc>.success</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=na>background-color</span><span class=o>:</span> <span class=mh>#67c23a</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>标注项悬停时用 <code>transform: translateX(-4px)</code> 向左移动，配合阴影变化，有轻微的"浮起"效果。高亮时左侧加蓝色边框，视觉上更明显。</p><h3 id=控制栏样式>控制栏样式<a hidden class=anchor aria-hidden=true href=#控制栏样式>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-scss data-lang=scss><span class=line><span class=cl><span class=nc>.pdf-controls</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=na>position</span><span class=o>:</span> <span class=ni>absolute</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=na>bottom</span><span class=o>:</span> <span class=mi>20</span><span class=kt>px</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=na>left</span><span class=o>:</span> <span class=mi>50</span><span class=kt>%</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=na>transform</span><span class=o>:</span> <span class=nf>translateX</span><span class=p>(</span><span class=o>-</span><span class=mi>50</span><span class=kt>%</span><span class=p>);</span>    <span class=c1>// 水平居中
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=na>background-color</span><span class=o>:</span> <span class=nf>rgba</span><span class=p>(</span><span class=mi>255</span><span class=o>,</span> <span class=mi>255</span><span class=o>,</span> <span class=mi>255</span><span class=o>,</span> <span class=mi>0</span><span class=mf>.9</span><span class=p>);</span>  <span class=c1>// 半透明白色背景
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=na>padding</span><span class=o>:</span> <span class=mi>10</span><span class=kt>px</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=na>border-radius</span><span class=o>:</span> <span class=mi>8</span><span class=kt>px</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=na>box-shadow</span><span class=o>:</span> <span class=mi>0</span> <span class=mi>2</span><span class=kt>px</span> <span class=mi>12</span><span class=kt>px</span> <span class=mi>0</span> <span class=nf>rgba</span><span class=p>(</span><span class=mi>0</span><span class=o>,</span> <span class=mi>0</span><span class=o>,</span> <span class=mi>0</span><span class=o>,</span> <span class=mi>0</span><span class=mf>.1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=na>display</span><span class=o>:</span> <span class=ni>flex</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=na>align-items</span><span class=o>:</span> <span class=ni>center</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=na>gap</span><span class=o>:</span> <span class=mi>20</span><span class=kt>px</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=na>z-index</span><span class=o>:</span> <span class=mi>100</span><span class=p>;</span>                    <span class=c1>// 确保在 PDF 上方
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=nc>.controls-group</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=na>display</span><span class=o>:</span> <span class=ni>flex</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=na>align-items</span><span class=o>:</span> <span class=ni>center</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=na>gap</span><span class=o>:</span> <span class=mi>10</span><span class=kt>px</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>&amp;</span><span class=nc>.zoom-controls</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=na>padding-left</span><span class=o>:</span> <span class=mi>10</span><span class=kt>px</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=na>border-left</span><span class=o>:</span> <span class=mi>1</span><span class=kt>px</span> <span class=ni>solid</span> <span class=mh>#dcdfe6</span><span class=p>;</span>  <span class=c1>// 左侧分隔线
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nc>.control-icon</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=na>font-size</span><span class=o>:</span> <span class=mi>20</span><span class=kt>px</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=na>padding</span><span class=o>:</span> <span class=mi>8</span><span class=kt>px</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=na>border-radius</span><span class=o>:</span> <span class=mi>4</span><span class=kt>px</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=na>cursor</span><span class=o>:</span> <span class=ni>pointer</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=na>transition</span><span class=o>:</span> <span class=ni>all</span> <span class=mi>0</span><span class=mf>.3</span><span class=kt>s</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=na>color</span><span class=o>:</span> <span class=mh>#409eff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=k>&amp;</span><span class=nd>:hover</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=na>background-color</span><span class=o>:</span> <span class=mh>#ecf5ff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=k>&amp;</span><span class=nc>.disabled</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=na>color</span><span class=o>:</span> <span class=mh>#c0c4cc</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=na>cursor</span><span class=o>:</span> <span class=ni>not-allowed</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>&amp;</span><span class=nd>:hover</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=na>background-color</span><span class=o>:</span> <span class=ni>transparent</span><span class=p>;</span>  <span class=c1>// 禁用时不响应悬停
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nc>.zoom-level</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=na>min-width</span><span class=o>:</span> <span class=mi>60</span><span class=kt>px</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=na>text-align</span><span class=o>:</span> <span class=ni>center</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=na>font-size</span><span class=o>:</span> <span class=mi>14</span><span class=kt>px</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=na>color</span><span class=o>:</span> <span class=mh>#606266</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>控制栏用 <code>position: absolute</code> 固定在底部，<code>transform: translateX(-50%)</code> 实现水平居中。半透明背景不会完全遮挡 PDF，但又能看清控制按钮。</p><h3 id=页码输入框样式>页码输入框样式<a hidden class=anchor aria-hidden=true href=#页码输入框样式>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-scss data-lang=scss><span class=line><span class=cl><span class=nc>.page-input-group</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=na>display</span><span class=o>:</span> <span class=ni>flex</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=na>align-items</span><span class=o>:</span> <span class=ni>center</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=na>margin</span><span class=o>:</span> <span class=mi>0</span> <span class=mi>10</span><span class=kt>px</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nc>.el-input</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=na>width</span><span class=o>:</span> <span class=mi>55</span><span class=kt>px</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=na>margin-right</span><span class=o>:</span> <span class=mi>5</span><span class=kt>px</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>:deep</span><span class=o>(</span><span class=nc>.el-input__inner</span><span class=o>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=na>padding</span><span class=o>:</span> <span class=mi>0</span> <span class=mi>8</span><span class=kt>px</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=na>text-align</span><span class=o>:</span> <span class=ni>center</span><span class=p>;</span>          <span class=c1>// 文字居中
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 隐藏数字输入框的上下箭头
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nd>:deep</span><span class=o>(</span><span class=nc>.el-input__inner</span><span class=nd>::-webkit-outer-spin-button</span><span class=o>),</span>
</span></span><span class=line><span class=cl>    <span class=nd>:deep</span><span class=o>(</span><span class=nc>.el-input__inner</span><span class=nd>::-webkit-inner-spin-button</span><span class=o>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=na>-webkit-appearance</span><span class=o>:</span> <span class=ni>none</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=na>margin</span><span class=o>:</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>:deep</span><span class=o>(</span><span class=nc>.el-input__inner</span><span class=o>[</span><span class=nt>type</span><span class=o>=</span><span class=s1>&#39;number&#39;</span><span class=o>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=na>-moz-appearance</span><span class=o>:</span> <span class=ni>textfield</span><span class=p>;</span>  <span class=c1>// Firefox 隐藏箭头
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>隐藏数字输入框的上下箭头，让界面更简洁。用 <code>:deep()</code> 穿透 Element Plus 的样式作用域。</p><h3 id=文件列表样式>文件列表样式<a hidden class=anchor aria-hidden=true href=#文件列表样式>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-scss data-lang=scss><span class=line><span class=cl><span class=nc>.files-section</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=na>padding</span><span class=o>:</span> <span class=mi>10</span><span class=kt>px</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=na>flex</span><span class=o>:</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=na>display</span><span class=o>:</span> <span class=ni>flex</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=na>flex-direction</span><span class=o>:</span> <span class=ni>column</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>&amp;</span><span class=nc>.hidden-in-fullscreen</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=na>display</span><span class=o>:</span> <span class=ni>none</span><span class=p>;</span>                 <span class=c1>// 全屏时隐藏
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nc>.file-list</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=na>flex</span><span class=o>:</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=na>overflow-y</span><span class=o>:</span> <span class=ni>auto</span><span class=p>;</span>              <span class=c1>// 可滚动
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=na>border-radius</span><span class=o>:</span> <span class=mi>10</span><span class=kt>px</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=na>border</span><span class=o>:</span> <span class=mi>2</span><span class=kt>px</span> <span class=ni>solid</span> <span class=mh>#e7e7e7</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nc>.file-item</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=na>padding</span><span class=o>:</span> <span class=mi>12</span><span class=kt>px</span> <span class=mi>16</span><span class=kt>px</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=na>display</span><span class=o>:</span> <span class=ni>flex</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=na>justify-content</span><span class=o>:</span> <span class=ni>space-between</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=na>align-items</span><span class=o>:</span> <span class=ni>center</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=na>cursor</span><span class=o>:</span> <span class=ni>pointer</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=na>transition</span><span class=o>:</span> <span class=n>background-color</span> <span class=mi>0</span><span class=mf>.2</span><span class=kt>s</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=na>border-bottom</span><span class=o>:</span> <span class=mi>2</span><span class=kt>px</span> <span class=ni>solid</span> <span class=mh>#e7e7e7</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=k>&amp;</span><span class=nd>:hover</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=na>background</span><span class=o>:</span> <span class=mh>#f5f7fa</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=k>&amp;</span><span class=nc>.active</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=na>background</span><span class=o>:</span> <span class=mh>#0085fc</span><span class=p>;</span>      <span class=c1>// 选中时蓝色背景
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=na>color</span><span class=o>:</span> <span class=mh>#fff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nc>.file-icon</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=na>color</span><span class=o>:</span> <span class=mh>#fff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>文件项选中时用蓝色背景，视觉上更明显。悬停时背景色变化，提供交互反馈。</p><h3 id=样式技巧总结>样式技巧总结<a hidden class=anchor aria-hidden=true href=#样式技巧总结>#</a></h3><ol><li><strong>定位技巧</strong>：PDF 容器用 <code>position: relative</code>，标注 overlay 用 <code>position: absolute</code> 叠加</li><li><strong>事件穿透</strong>：overlay 用 <code>pointer-events: none</code>，标记用 <code>pointer-events: auto</code></li><li><strong>居中技巧</strong>：用 <code>transform: translateX(-50%)</code> 实现绝对定位元素的水平居中</li><li><strong>过渡动画</strong>：用 <code>transition</code> 让交互更平滑，特别是 transform 和 opacity</li><li><strong>层级管理</strong>：用 <code>z-index</code> 控制元素层级，控制栏和全屏模式需要较高层级</li><li><strong>响应式</strong>：用 <code>max-width</code> 和 <code>max-height</code> 配合 <code>object-fit: contain</code> 保持比例</li></ol><h2 id=一些其他的预览-pdf-方法>一些其他的预览 PDF 方法<a hidden class=anchor aria-hidden=true href=#一些其他的预览-pdf-方法>#</a></h2><ol><li>使用 @vue-office/pdf 库</li><li>微软官方的 Office Online 预览 （https://view.officeapps.live.com/op/view.aspx?src=https://501351981.github.io/vue-office/examples/dist/static/test-files/test.docx） 需要第三方域名支持</li></ol></div><footer class=post-footer><ul class=post-tags><li><a href=https://waite.wang/tags/vue/>Vue</a></li><li><a href=https://waite.wang/tags/web/>Web</a></li></ul><nav class=paginav><a class=next href=https://waite.wang/posts/python/ws_connect_manage_with_redis/><span class=title>下一页 »</span><br><span>WebSocket连接管理与Redis集成实现</span></a></nav></footer><script src=https://utteranc.es/client.js repo=Waite0603/HugoBlog issue-term=pathname theme=github-light crossorigin=anonymous async></script></article></main><footer class=footer><span><a href=https://beian.miit.gov.cn/ target=_blank rel="noopener noreferrer">粤ICP备2022028437号-1</a></span><br><span>Copyright &copy; 2018 - 2025 By <a href=https://waite.wang/>Waite</a>, All Rights
Reserved.</span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script src=/js/jquery-3.5.1.min.js></script><link rel=stylesheet href=/css/jquery.fancybox.min.css><script src=/js/jquery.fancybox.min.js></script></body></html>