<!doctype html><html lang=zh-cn dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>鸿蒙学习笔记2 | 隶笔难书</title>
<meta name=keywords content="Harmony"><meta name=description content="页面路由
页面路由指在应用程序中实现不同页面之间的跳转和数据传递。HarmonyOS提供了Router模块，通过不同的url地址，可以方便地进行页面路由，轻松地访问不同的页面。"><meta name=author content><link rel=canonical href=https://waite.wang/posts/harmony/learn-harmony-2/><link crossorigin=anonymous href=/assets/css/stylesheet.55a367dc6d933e003fb3fd16c9379f270dd169dcc4381f8e7524d92feb9add90.css integrity="sha256-VaNn3G2TPgA/s/0WyTefJw3RadzEOB+OdSTZL+ua3ZA=" rel="preload stylesheet" as=style><link rel=icon href=https://waite.wang/images/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://waite.wang/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://waite.wang/favicon-32x32.png><link rel=apple-touch-icon href=https://waite.wang/apple-touch-icon.png><link rel=mask-icon href=https://waite.wang/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh-cn href=https://waite.wang/posts/harmony/learn-harmony-2/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://waite.wang/posts/harmony/learn-harmony-2/"><meta property="og:site_name" content="隶笔难书"><meta property="og:title" content="鸿蒙学习笔记2"><meta property="og:description" content="页面路由 页面路由指在应用程序中实现不同页面之间的跳转和数据传递。HarmonyOS提供了Router模块，通过不同的url地址，可以方便地进行页面路由，轻松地访问不同的页面。"><meta property="og:locale" content="zh-cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-03-29T16:04:23+08:00"><meta property="article:modified_time" content="2024-03-29T16:04:23+08:00"><meta property="article:tag" content="Harmony"><meta name=twitter:card content="summary"><meta name=twitter:title content="鸿蒙学习笔记2"><meta name=twitter:description content="页面路由
页面路由指在应用程序中实现不同页面之间的跳转和数据传递。HarmonyOS提供了Router模块，通过不同的url地址，可以方便地进行页面路由，轻松地访问不同的页面。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://waite.wang/posts/"},{"@type":"ListItem","position":2,"name":"鸿蒙学习笔记2","item":"https://waite.wang/posts/harmony/learn-harmony-2/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"鸿蒙学习笔记2","name":"鸿蒙学习笔记2","description":"页面路由 页面路由指在应用程序中实现不同页面之间的跳转和数据传递。HarmonyOS提供了Router模块，通过不同的url地址，可以方便地进行页面路由，轻松地访问不同的页面。\n","keywords":["Harmony"],"articleBody":"页面路由 页面路由指在应用程序中实现不同页面之间的跳转和数据传递。HarmonyOS提供了Router模块，通过不同的url地址，可以方便地进行页面路由，轻松地访问不同的页面。\nhttps://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/arkts-routing-0000001503325125-V2#section6414655195312\n页面跳转 页面跳转是开发过程中的一个重要组成部分。在使用应用程序时，通常需要在不同的页面之间跳转，有时还需要将数据从一个页面传递到另一个页面。\nRouter模块提供了两种跳转模式，分别是router.pushUrl()和router.replaceUrl()。这两种模式决定了目标页是否会替换当前页。\nrouter.pushUrl()：目标页不会替换当前页，而是压入页面栈。这样可以保留当前页的状态，并且可以通过返回键或者调用router.back()方法返回到当前页。 router.replaceUrl()：目标页会替换当前页，并销毁当前页。这样可以释放当前页的资源，并且无法返回到当前页。 页面栈的最大容量为32个页面。如果超过这个限制，可以调用router.clear()方法清空历史页面栈，释放内存空间。\n同时，Router模块提供了两种实例模式，分别是Standard和Single。这两种模式决定了目标url是否会对应多个实例。\nStandard：标准实例模式，也是默认情况下的实例模式。每次调用该方法都会新建一个目标页，并压入栈顶。\nSingle：单实例模式。即如果目标页的url在页面栈中已经存在同url页面，则离栈顶最近的同url页面会被移动到栈顶，并重新加载；如果目标页的url在页面栈中不存在同url页面，则按照标准模式跳转。\n在使用页面路由Router相关功能之前，需要在代码中先导入Router模块。\nimport router from '@ohos.router'; 场景一：有一个主页（Home）和一个详情页（Detail），希望从主页点击一个商品，跳转到详情页。同时，需要保留主页在页面栈中，以便返回时恢复状态。这种场景下，可以使用pushUrl()方法，并且使用Standard实例模式（或者省略）。\n// 在Home页面中 function onJumpClick(): void { router.pushUrl({ url: 'pages/Detail' // 目标url }, router.RouterMode.Standard, (err) =\u003e { if (err) { console.error(`Invoke pushUrl failed, code is ${err.code}, message is ${err.message}`); return; } console.info('Invoke pushUrl succeeded.'); }); } 标准实例模式下，router.RouterMode.Standard参数可以省略。\n场景二：有一个登录页（Login）和一个个人中心页（Profile），希望从登录页成功登录后，跳转到个人中心页。同时，销毁登录页，在返回时直接退出应用。这种场景下，可以使用replaceUrl()方法，并且使用Standard实例模式（或者省略）。\n// 在Login页面中 function onJumpClick(): void { router.replaceUrl({ url: 'pages/Profile' // 目标url }, router.RouterMode.Standard, (err) =\u003e { if (err) { console.error(`Invoke replaceUrl failed, code is ${err.code}, message is ${err.message}`); return; } console.info('Invoke replaceUrl succeeded.'); }) } 场景三：有一个设置页（Setting）和一个主题切换页（Theme），希望从设置页点击主题选项，跳转到主题切换页。同时，需要保证每次只有一个主题切换页存在于页面栈中，在返回时直接回到设置页。这种场景下，可以使用pushUrl()方法，并且使用Single实例模式。\n// 在Setting页面中 function onJumpClick(): void { router.pushUrl({ url: 'pages/Theme' // 目标url }, router.RouterMode.Single, (err) =\u003e { if (err) { console.error(`Invoke pushUrl failed, code is ${err.code}, message is ${err.message}`); return; } console.info('Invoke pushUrl succeeded.'); }); } 场景四：有一个搜索结果列表页（SearchResult）和一个搜索结果详情页（SearchDetail），希望从搜索结果列表页点击某一项结果，跳转到搜索结果详情页。同时，如果该结果已经被查看过，则不需要再新建一个详情页，而是直接跳转到已经存在的详情页。这种场景下，可以使用replaceUrl()方法，并且使用Single实例模式。\n// 在SearchResult页面中 function onJumpClick(): void { router.replaceUrl({ url: 'pages/SearchDetail' // 目标url }, router.RouterMode.Single, (err) =\u003e { if (err) { console.error(`Invoke replaceUrl failed, code is ${err.code}, message is ${err.message}`); return; } console.info('Invoke replaceUrl succeeded.');}) } 传递参数 如果需要在跳转时传递一些数据给目标页，则可以在调用Router模块的方法时，添加一个params属性，并指定一个对象作为参数。例如：\nclass DataModelInfo { age: number; } class DataModel { id: number; info: DataModelInfo; } function onJumpClick(): void { // 在Home页面中 let paramsInfo: DataModel = { id: 123, info: { age: 20 } }; router.pushUrl({ url: 'pages/Detail', // 目标url params: paramsInfo // 添加params属性，传递自定义参数 }, (err) =\u003e { if (err) { console.error(`Invoke pushUrl failed, code is ${err.code}, message is ${err.message}`); return; } console.info('Invoke pushUrl succeeded.'); }) } 在目标页中，可以通过调用Router模块的getParams()方法来获取传递过来的参数。例如：\nconst params = router.getParams(); // 获取传递过来的参数对象 const id = params['id']; // 获取id属性的值 const age = params['info'].age; // 获取age属性的值 页面返回 当用户在一个页面完成操作后，通常需要返回到上一个页面或者指定页面，这就需要用到页面返回功能。在返回的过程中，可能需要将数据传递给目标页，这就需要用到数据传递功能。\n方式一：返回到上一个页面。\nrouter.back(); 这种方式会返回到上一个页面，即上一个页面在页面栈中的位置。但是，上一个页面必须存在于页面栈中才能够返回，否则该方法将无效。\n方式二：返回到指定页面。\nrouter.back({ url: 'pages/Home' }); 这种方式可以返回到指定页面，需要指定目标页的路径。目标页必须存在于页面栈中才能够返回。\n方式三：返回到指定页面，并传递自定义参数信息。\nrouter.back({ url: 'pages/Home', params: { info: '来自Home页' } }); 这种方式不仅可以返回到指定页面，还可以在返回的同时传递自定义参数信息。这些参数信息可以在目标页中通过调用router.getParams()方法进行获取和解析。\n在目标页中，在需要获取参数的位置调用router.getParams()方法即可，例如在onPageShow()生命周期回调中：\nonPageShow() { const params = router.getParams(); // 获取传递过来的参数对象 const info = params['info']; // 获取info属性的值 } 自定义询问框 自定义询问框的方式，可以使用弹窗或者自定义弹窗实现。这样可以让应用界面与系统默认询问框有所区别，提高应用的用户体验度。本文以弹窗为例，介绍如何实现自定义询问框。\n在事件回调中，调用弹窗的promptAction.showDialog()方法：\nfunction onBackClick() { // 弹出自定义的询问框 promptAction.showDialog({ message: '您还没有完成支付，确定要返回吗？', buttons: [ { text: '取消', color: '#FF0000' }, { text: '确认', color: '#0099FF' } ] }).then((result) =\u003e { if (result.index === 0) { // 用户点击了“取消”按钮 console.info('User canceled the operation.'); } else if (result.index === 1) { // 用户点击了“确认”按钮 console.info('User confirmed the operation.'); // 调用router.back()方法，返回上一个页面 router.back(); } }).catch((err) =\u003e { console.error(`Invoke showDialog failed, code is ${err.code}, message is ${err.message}`); }) } 状态管理 在声明式UI编程框架中，UI是程序状态的运行结果，用户构建了一个UI模型，其中应用的运行时的状态是参数。当参数改变时，UI作为返回结果，也将进行对应的改变。这些运行时的状态变化所带来的UI的重新渲染，在ArkUI中统称为状态管理机制。\n自定义组件拥有变量，变量必须被装饰器装饰才可以成为状态变量，状态变量的改变会引起UI的渲染刷新。如果不使用状态变量，UI只能在初始化时渲染，后续将不会再刷新。 下图展示了State和View（UI）之间的关系。\nhttps://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/arkts-state-management-overview-0000001524537145-V2\nView(UI)：UI渲染，指将build方法内的UI描述和@Builder装饰的方法内的UI描述映射到界面。\nState：状态，指驱动UI更新的数据。用户通过触发组件的事件方法，改变状态数据。状态数据的改变，引起UI的重新渲染。\n基本概念 状态变量：被状态装饰器装饰的变量，状态变量值的改变会引起UI的渲染更新。示例：@State num: number = 1,其中，@State是状态装饰器，num是状态变量。 常规变量：没有被状态装饰器装饰的变量，通常应用于辅助计算。它的改变永远不会引起UI的刷新。以下示例中increaseBy变量为常规变量。 数据源/同步源：状态变量的原始来源，可以同步给不同的状态数据。通常意义为父组件传给子组件的数据。以下示例中数据源为count: 1。 命名参数机制：父组件通过指定参数传递给子组件的状态变量，为父子传递同步参数的主要手段。示例：CompA: ({ aProp: this.aProp })。 从父组件初始化：父组件使用命名参数机制，将指定参数传递给子组件。子组件初始化的默认值在有父组件传值的情况下，会被覆盖。示例： @Component struct MyComponent { @State count: number = 0; private increaseBy: number = 1; build() { } } @Component struct Parent { build() { Column() { // 从父组件初始化，覆盖本地定义的默认值 MyComponent({ count: 1, increaseBy: 2 }) } } } 初始化子节点：父组件中状态变量可以传递给子组件，初始化子组件对应的状态变量。示例同上。\n本地初始化：在变量声明的时候赋值，作为变量的默认值。示例：@State count: number = 0。\n管理组件拥有的状态 @State装饰器：组件内状态 @state 装饰器标记的变量必须初始化, 不能为空值\n@state 支持Object、class、string、number、boolean、enum类型，以及这些类型的数组。不支持any，不支持简单类型和复杂类型的联合类型，不允许使用undefined和null。\n嵌套类型以及数组中的对象属性无法触发视图更新\nclass Person { name: string age: number gf: Person constructor(name: string, age: number, gf?: Person) { this.age = age this.name = name this.gf = gf } } @Entry @Component struct Second { @State p: Person = new Person('jack', 21, new Person('aaa', 11)) build() { Column() { Text(`${this.p.name}: ${this.p.age}`) .fontSize(50) .onClick(() =\u003e { this.p.age ++ }) Text(`${this.p.gf.name}: ${this.p.gf.age}`) .fontSize(50) .onClick(() =\u003e { console.log(`${this.p.gf.name}: ${this.p.gf.age}`) this.p.gf.age ++ }) } .width(\"100%\") } } 当点击下面时，不会触发视图更新, 只有点击上面非嵌套属性时才会触发视图整体更新\n@State装饰的变量，或称为状态变量，一旦变量拥有了状态属性，就和自定义组件的渲染绑定起来。当状态改变时，UI会发生对应的渲染改变。\n在状态变量相关装饰器中，@State是最基础的，使变量拥有状态属性的装饰器，它也是大部分状态变量的数据源。\n@State装饰的变量，与声明式范式中的其他被装饰变量一样，是私有的，只能从组件内部访问，在声明时必须指定其类型和本地初始化。初始化也可选择使用命名参数机制从父组件完成初始化。\n@State装饰的变量拥有以下特点：\n@State装饰的变量与子组件中的@Prop装饰变量之间建立单向数据同步，与@Link、@ObjectLink装饰变量之间建立双向数据同步。 @State装饰的变量生命周期与其所属自定义组件的生命周期相同。 案例 class Task { static id: number = 1 name: string = `Task${Task.id++}` finished: boolean = false } @Styles function card() { .width(\"95%\") .padding(20) .backgroundColor(Color.White) .borderRadius(15) .shadow( { radius: 6, color: \"#1F000000\", offsetX: 2, offsetY: 4 } ) } @Extend(Text) function finishedTask() { .decoration({ type: TextDecorationType.LineThrough }) .fontSize(\"##B1B2B1\") } @Entry @Component struct Second { @State totalTask: number = 0 @State finishTask: number = 0 @State task: Task[] = [] handTaskChange() { this.totalTask = this.task.length this.finishTask = this.task.filter(item =\u003e item.finished).length } build() { Column({ space: 10 }) { // 任务进度卡片 Row() { Text(\"任务进度: \") .fontSize(30) .fontWeight(FontWeight.Bold) Stack() { Progress({ value: this.finishTask, total: this.totalTask, type: ProgressType.Ring }) .width(100) Row() { Text(this.finishTask.toString()) .fontSize(24) .fontColor(\"#36D\") Text(\"/\" + this.totalTask.toString()) .fontSize(24) } } } .card() .margin({ top: 20, bottom: 10 }) .justifyContent(FlexAlign.SpaceEvenly) // 新增任务按钮 Button(\"添加任务\") .width(200) .onClick(() =\u003e { this.task.push(new Task()) this.handTaskChange() }) // 渲染任务列表 List({ space: 10 }) { ForEach( this.task, (item: Task, index) =\u003e { ListItem() { Row() { Text(item.name) .fontSize(24) Checkbox() .select(item.finished) .onChange(value =\u003e { item.finished = value this.handTaskChange() }) } .card() .justifyContent(FlexAlign.SpaceBetween) } .swipeAction({ end: this.DeleteButton(index) }) } ) } .width(\"100%\") .alignListItem(ListItemAlign.Center) .layoutWeight(1) } .width(\"100%\") .height(\"100%\") .backgroundColor(\"#F1F2F3\") } // 构建函数 @Builder DeleteButton(index: number) { Text(\"Del\") .fontColor(Color.White) .padding(20) .backgroundColor(Color.Red) .borderRadius(\"50%\") .margin(5) .onClick(() =\u003e { this.task.splice(index, 1) this.handTaskChange() }) } } @Prop/ @Link 装饰器 @Prop 父子组件单向同步: @Prop装饰的变量可以和父组件建立单向的同步关系。@Prop装饰的变量是可变的，但是变化不会同步回其父组件。 @Link 父子组件双向同步: 子组件中被@Link装饰的变量与其父组件中对应的数据源建立双向数据绑定。@Link装饰的变量与其父组件中的数据源共享相同的值。\n在最新版本中, @Prop 可以在子组件初始化, 但是编辑器 eslint 会报错\n@Component struct Child { @Prop value: number; build() { Text(`${this.value}`) .fontSize(50) .onClick(() =\u003e { console.log(`${this.value}`) this.value++ }) } } @Entry @Component struct Index { @State arr: number[] = [1, 2, 3]; build() { Row() { Column() { Child({ value: this.arr[0] }) Child({ value: this.arr[1] }) Child({ value: this.arr[2] }) Divider().height(5) ForEach(this.arr, item =\u003e { Child({ 'value': item } as Record\u003cstring, number\u003e) }, item =\u003e item.toString() ) Text('replace entire arr') .fontSize(50) .onClick(() =\u003e { // 两个数组都包含项“3”。 this.arr = this.arr[0] == 1 ? [3, 4, 5] : [1, 2, 3]; }) } } } } 如果点击界面上的“1”六次、“2”五次、“3”四次，将所有变量的本地取值都变为“7”。\n7 7 7 ---- 7 7 7 单击replace entire arr后，屏幕将显示以下信息，为什么？\n3 4 5 ---- 7 4 5 在子组件Child中做的所有的修改都不会同步回父组件Index组件，所以即使6个组件显示都为7，但在父组件Index中，this.arr保存的值依旧是[1,2,3]。 点击replace entire arr，this.arr[0] == 1成立，将this.arr赋值为[3, 4, 5]； 因为this.arr[0]已更改，Child({value: this.arr[0]})组件将this.arr[0]更新同步到实例@Prop装饰的变量。Child({value: this.arr[1]})和Child({value: this.arr[2]})的情况也类似。 this.arr的更改触发ForEach更新，this.arr更新的前后都有数值为3的数组项：[3, 4, 5] 和[1, 2, 3]。根据diff算法，数组项“3”将被保留，删除“1”和“2”的数组项，添加为“4”和“5”的数组项。这就意味着，数组项“3”的组件不会重新生成，而是将其移动到第一位。所以“3”对应的组件不会更新，此时“3”对应的组件数值为“7”，ForEach最终的渲染结果是“7”，“4”，“5”。 diff算法是一种用于比较两个数据结构（比如两个数组或两个树）之间差异的算法。在前端开发中，diff算法通常用于虚拟DOM的更新和渲染优化。\n在React等前端框架中，当数据发生变化时，diff算法可以帮助确定哪些DOM节点需要被更新，哪些需要被添加或删除，以及哪些可以被保留而不进行重新渲染。这可以提高性能并减少不必要的DOM操作。\ndiff算法通常包括以下步骤：\n比较两个数据结构的差异，找出新增、删除和更新的部分。 标记需要进行更新的部分，并记录其变化。 应用这些变化，更新DOM或其他视图。 @Styles function btn() { .margin(12) .width(312) .height(40) } @Component struct Child { @Link items: number[]; build() { Column() { Button(`Button1: push`) .btn() .onClick(() =\u003e { this.items.push(this.items.length + 1); }) Button(`Button2: replace whole item`) .btn() .onClick(() =\u003e { this.items = [100, 200, 300]; }) } } } @Entry @Component struct Parent { @State arr: number[] = [1, 2, 3]; build() { Column() { Button('Button Parent push') .btn() .onClick(() =\u003e { this.arr.push(this.arr.length + 1); }) Child({ items: $arr }) .margin(12) ForEach(this.arr, (item: number) =\u003e { Button(`${item}`) .margin(12) .width(312) .height(40) .backgroundColor('#11a2a2a2') .fontColor('#e6000000') }, (item: ForEachInterface) =\u003e item.toString() ) } } } @Observed装饰器和@ObjectLink装饰器：嵌套类对象属性变化 上文所述的装饰器仅能观察到第一层的变化，但是在实际应用开发中，应用会根据开发需要，封装自己的数据模型。对于多层嵌套的情况，比如二维数组，或者数组项class，或者class的属性是class，他们的第二层的属性变化是无法观察到的。这就引出了@Observed/@ObjectLink装饰器。\n以下是引入@Observed/@ObjectLink装饰器的示例：\n@Observed class Person { name: string age: number gf: Person constructor(name: string, age: number, gf?: Person) { this.name = name this.age = age this.gf = gf } } @Entry @Component struct Child { @State p: Person = new Person(\"Waite\", 18, new Person(\"www\", 11)) @State gfs: Person[] = [ new Person(\"Jack\", 18), new Person(\"XiaoMing\", 20) ] build() { Column({ space: 10 }) { PersonChild({ p: this.p.gf }) .onClick(() =\u003e { console.log(`${this.p.gf.age}`) this.p.gf.age++ }) Text(\"Girl Friends List\") ForEach( this.gfs, item =\u003e { PersonChild({ p: item }) .onClick(() =\u003e item.age++) } ) } } } @Component struct PersonChild { @ObjectLink p: Person build() { Column() { Text(`${this.p.name}: ${this.p.age}`) } } } 为了给变量加 @ObjectLink 装饰器, 写成组件 -\u003e 因为装饰器没法装饰一个参数\n@Observed class 不管嵌套几个类型, 凡是嵌套的, 都要加上 @Observed 装饰器\n完善案例, 当 Checkbox 选中时, 会触发对应的任务完成状态, 任务完成状态改变时, 会触发任务进度的更新\n@Observed class Task { static id: number = 1 name: string = `Task${Task.id++}` finished: boolean = false } @Styles function card() { .width(\"95%\") .padding(20) .backgroundColor(Color.White) .borderRadius(15) .shadow( { radius: 6, color: \"#1F000000\", offsetX: 2, offsetY: 4 } ) } @Extend(Text) function finishedTask() { .fontColor(\"#B1B2B1\") } @Entry @Component struct Second { @State totalTask: number = 0 @State finishTask: number = 0 @State task: Task[] = [] handTaskChange() { this.totalTask = this.task.length this.finishTask = this.task.filter(item =\u003e item.finished).length } build() { Column({ space: 10 }) { // 任务进度卡片 TaskStatistics({ finishTask: this.finishTask, totalTask: this.totalTask }) // 新增任务按钮 Button(\"添加任务\") .width(200) .onClick(() =\u003e { this.task.push(new Task()) this.handTaskChange() }) // 渲染任务列表 List({ space: 10 }) { ForEach( this.task, (item: Task, index) =\u003e { ListItem() { itemChild({item: item, onTaskChanged: () =\u003e this.handTaskChange()}) } .swipeAction({ end: this.DeleteButton(index) }) } ) } .width(\"100%\") .height(0) .alignListItem(ListItemAlign.Center) .layoutWeight(1) } .width(\"100%\") .height(\"100%\") .backgroundColor(\"#F1F2F3\") } // 构建函数 @Builder DeleteButton(index: number) { Text(\"Del\") .fontColor(Color.White) .padding(20) .backgroundColor(Color.Red) .borderRadius(\"50%\") .margin(5) .onClick(() =\u003e { this.task.splice(index, 1) this.handTaskChange() }) } } @Component struct TaskStatistics { @Prop finishTask: number @Prop totalTask: number build() { Row() { Text(\"任务进度: \") .fontSize(30) .fontWeight(FontWeight.Bold) Stack() { Progress({ value: this.finishTask, total: this.totalTask, type: ProgressType.Ring }) .width(100) Row() { Text(this.finishTask.toString()) .fontSize(24) .fontColor(\"#36D\") Text(\"/\" + this.totalTask.toString()) .fontSize(24) } } } .card() .margin({ top: 20, bottom: 10 }) .justifyContent(FlexAlign.SpaceEvenly) } } @Component struct itemChild { @ObjectLink item: Task onTaskChanged: () =\u003e void build(){ Row() { if (this.item.finished) { Text(this.item.name) .finishedTask() } else { Text(this.item.name) } Checkbox() .select(this.item.finished) .onChange(value =\u003e { this.item.finished = value this.onTaskChanged() }) } .card() .justifyContent(FlexAlign.SpaceBetween) } } 动画 基础通知 https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V3/notification-guidelines-0000001281360946-V3\nhttps://developer.huawei.com/consumer/cn/doc/harmonyos-references-V3/js-apis-notification-0000001333321097-V3\n名称 值 说明 NOTIFICATION_CONTENT_BASIC_TEXT ContentType 普通类型通知。 NOTIFICATION_CONTENT_LONG_TEXT ContentType 长文本类型通知。 NOTIFICATION_CONTENT_PICTURE ContentType 图片类型通知。 NOTIFICATION_CONTENT_CONVERSATION ContentType 社交类型通知。 NOTIFICATION_CONTENT_MULTILINE ContentType 多行文本类型通知。 系统能力：以下各项对应的系统能力均为SystemCapability.Notification.Notification\n名称 可读 可写 类型 必填 描述 content 是 是 NotificationContent 是 通知内容。 id 是 是 number 否 通知ID。 slotType 是 是 SlotType 否 通道类型。 isOngoing 是 是 boolean 否 是否进行时通知。 isUnremovable 是 是 boolean 否 是否可移除。 deliveryTime 是 是 number 否 通知发送时间。 tapDismissed 是 是 boolean 否 通知是否自动清除。 autoDeletedTime 是 是 number 否 自动清除的时间。 wantAgent 是 是 WantAgent 否 点击跳转的WantAgent。 extraInfo 是 是 {[key: string]: any} 否 扩展参数。 color 是 是 number 否 通知背景颜色。 colorEnabled 是 是 boolean 否 通知背景颜色是否使能。 isAlertOnce 是 是 boolean 否 设置是否仅有一次此通知警报。 isStopwatch 是 是 boolean 否 是否显示已用时间。 isCountDown 是 是 boolean 否 是否显示倒计时时间。 isFloatingIcon 是 是 boolean 否 是否显示状态栏图标。 label 是 是 string 否 通知标签。 badgeIconStyle 是 是 number 否 通知角标类型。 showDeliveryTime 是 是 boolean 否 是否显示分发时间。 actionButtons 是 是 Array\u003c NotificationActionButton\u003e 否 通知按钮，最多两个按钮。 smallIcon 是 是 PixelMap 否 通知小图标。 largeIcon 是 是 PixelMap 否 通知大图标。 creatorBundleName 是 否 string 否 创建通知的包名。 creatorUid 是 否 number 否 创建通知的UID。 creatorPid 是 否 number 否 创建通知的PID。 creatorUserId8+ 是 否 number 否 创建通知的UserId。 hashCode 是 否 string 否 通知唯一标识。 groupName8+ 是 是 string 否 组通知名称。 template8+ 是 是 NotificationTemplate 否 通知模板。 distributedOption8+ 是 是 DistributedOptions 否 分布式通知的选项。 notificationFlags8+ 是 否 NotificationFlags 否 获取NotificationFlags。 import notify from '@ohos.notificationManager' import image from '@ohos.multimedia.image' @Entry @Component struct Index { // 全局任务 id idx: number = 100 // 图像 pixel: PixelMap async aboutToAppear() { // 获取资源管理器 let rm = getContext(this).resourceManager // 读取图片 let file = await rm.getMediaContent($r('app.media.watchGT4')) // 创建 PixelMap image.createImageSource(file.buffer).createPixelMap() .then(value =\u003e this.pixel = value) .catch(reason =\u003e console.error(reason)) } build() { Column({ space: 10 }) { Button(`发送normalText通知`) .onClick(() =\u003e this.publishNormalTextNotification()) Button(`发送longText通知`) .onClick(() =\u003e this.publishLongTextNotification()) Button(`发送multiLine通知`) .onClick(() =\u003e this.publishMultiLineNotification()) Button(`发送Picture通知`) .onClick(() =\u003e this.publishPictureNotification()) } .width('100%') } publishNormalTextNotification() { let request: notify.NotificationRequest = { id: this.idx++, content: { contentType: notify.ContentType.NOTIFICATION_CONTENT_BASIC_TEXT, normal: { title: '通知标题' + this.idx, text: '通知内容详情', additionalText: '通知附加内容' } }, showDeliveryTime: true, deliveryTime: new Date().getTime(), groupName: 'wechat', slotType: notify.SlotType.SOCIAL_COMMUNICATION } this.publish(request) } publishLongTextNotification() { let request: notify.NotificationRequest = { id: this.idx++, content: { contentType: notify.ContentType.NOTIFICATION_CONTENT_LONG_TEXT, longText: { title: '通知标题' + this.idx, text: '通知内容详情', additionalText: '通知附加内容', longText: '通知中的长文本，我很长，我很长，我很长，我很长，我很长，我很长，我很长', briefText: '通知概要和总结', expandedTitle: '通知展开时的标题' + this.idx } } } this.publish(request) } publishMultiLineNotification() { let request: notify.NotificationRequest = { id: this.idx++, content: { contentType: notify.ContentType.NOTIFICATION_CONTENT_MULTILINE, multiLine: { title: '通知标题' + this.idx, text: '通知内容详情', additionalText: '通知附加内容', briefText: '通知概要和总结', longTitle: '展开时的标题，我很宽，我很宽，我很宽', lines: [ '第一行', '第二行', '第三行', '第四行', ] } } } this.publish(request) } publishPictureNotification() { let request: notify.NotificationRequest = { id: this.idx++, content: { contentType: notify.ContentType.NOTIFICATION_CONTENT_PICTURE, picture: { title: '通知标题' + this.idx, text: '通知内容详情', additionalText: '通知附加内容', briefText: '通知概要和总结', expandedTitle: '展开后标题' + this.idx, picture: this.pixel } } } this.publish(request) } private publish(request: notify.NotificationRequest) { notify.publish(request) .then(() =\u003e console.log('notify test', '发送通知成功')) .then(reason =\u003e console.log('notify test', '发送通知失败', JSON.stringify(reason))) } } 进度条通知 import Notification from '@ohos.notificationManager' import wantAgent, { WantAgent } from '@ohos.app.ability.wantAgent' import promptAction from '@ohos.promptAction' import Prompt from '@system.prompt' enum DownloadState { NOT_BEGIN = '未开始', DOWNLOADING = '下载中', PAUSE = '已暂停', FINISHED = '已完成', } @Entry @Component struct Index { // 下载进度 @State progressValue: number = 0 progressMaxValue: number = 100 // 任务状态 @State state: DownloadState = DownloadState.NOT_BEGIN // 下载的文件名 filename: string = '圣诞星.mp4' // 模拟下载的任务的id taskId: number = -1 // 通知id notificationId: number = 999 isSupport: boolean = false wantAgentInstance: WantAgent async aboutToAppear() { // 1.判断当前系统是否支持进度条模板 this.isSupport = await Notification.isSupportTemplate('downloadTemplate') // 2.创建拉取当前应用的行为意图 // 2.1.创建wantInfo信息 let wantInfo: wantAgent.WantAgentInfo = { wants: [ { bundleName: 'com.example.myapplication', abilityName: 'EntryAbility', } ], requestCode: 0, operationType: wantAgent.OperationType.START_ABILITY, wantAgentFlags: [wantAgent.WantAgentFlags.CONSTANT_FLAG] } // 2.2.创建wantAgent实例 this.wantAgentInstance = await wantAgent.getWantAgent(wantInfo) } build() { Row({ space: 10 }) { Image($r('app.media.ic_files_video')).width(50) Column({ space: 5 }) { Row() { Text(this.filename) Text(`${this.progressValue}%`).fontColor('#c1c2c1') } .width('100%') .justifyContent(FlexAlign.SpaceBetween) Progress({ value: this.progressValue, total: this.progressMaxValue, }) Row({ space: 5 }) { Text(`${(this.progressValue * 0.43).toFixed(2)}MB`) .fontSize(14).fontColor('#c1c2c1') Blank() if (this.state === DownloadState.NOT_BEGIN) { Button('开始').downloadButton() .onClick(() =\u003e this.download()) } else if (this.state === DownloadState.DOWNLOADING) { Button('取消').downloadButton().backgroundColor('#d1d2d3') .onClick(() =\u003e this.cancel()) Button('暂停').downloadButton() .onClick(() =\u003e this.pause()) } else if (this.state === DownloadState.PAUSE) { Button('取消').downloadButton().backgroundColor('#d1d2d3') .onClick(() =\u003e this.cancel()) Button('继续').downloadButton() .onClick(() =\u003e this.download()) } else { Button('打开').downloadButton() .onClick(() =\u003e this.open()) } }.width('100%') } .layoutWeight(1) } .width('100%') .borderRadius(20) .padding(15) .backgroundColor(Color.White) } cancel() { // 取消定时任务 if (this.taskId \u003e 0) { clearInterval(this.taskId); this.taskId = -1 } console.log(this.notificationId.toString()) // 清理下载任务进度 this.progressValue = 0 // 标记任务状态：未开始 this.state = DownloadState.NOT_BEGIN // 取消通知 Notification.cancel(this.notificationId).then((response) =\u003e { console.log('ssssss', JSON.stringify(response)) }) } download() { // 清理旧任务 if (this.taskId \u003e 0) { clearInterval(this.taskId); } // 开启定时任务，模拟下载 this.taskId = setInterval(() =\u003e { // 判断任务进度是否达到100 if (this.progressValue \u003e= 100) { // 任务完成了，应该取消定时任务 clearInterval(this.taskId) this.taskId = -1 // 并且标记任务状态为已完成 this.state = DownloadState.FINISHED // 发送通知 this.publishProgressNotification() return } // 模拟任务进度变更 this.progressValue += 2 // 发送通知 this.publishProgressNotification() }, 500) // 标记任务状态：下载中 this.state = DownloadState.DOWNLOADING } pause() { // 取消定时任务 if (this.taskId \u003e 0) { clearInterval(this.taskId); this.taskId = -1 } // 标记任务状态：已暂停 this.state = DownloadState.PAUSE // 发送通知 this.publishProgressNotification() } open() { promptAction.showToast({ message: '功能未实现' }) } async publishProgressNotification() { let isSupportTpl: boolean; await Notification.isSupportTemplate('downloadTemplate').then((data) =\u003e { isSupportTpl = data; }).catch((err) =\u003e { Prompt.showToast({ message: `判断是否支持进度条模板时报错,error[${err}]`, duration: 2000 }) }) if (isSupportTpl) { // 构造模板 let template = { name: 'downloadTemplate', data: { progressValue: this.progressValue, // 当前进度值 progressMaxValue: this.progressMaxValue // 最大进度值 } }; let notificationRequest: Notification.NotificationRequest = { id: this.notificationId, content: { contentType: Notification.ContentType.NOTIFICATION_CONTENT_BASIC_TEXT, normal: { title: this.filename + ': ' + this.state, text: '', additionalText: this.progressValue + '%' } }, template: template }; // 发布通知 Notification.publish(notificationRequest).then(() =\u003e { Prompt.showToast({ message: `发布通知成功！`, duration: 2000 }) }).catch((err) =\u003e { Prompt.showToast({ message: `发布通知失败,error[${err}]`, duration: 2000 }) }) } else { Prompt.showToast({ message: '不支持downloadTemplate进度条通知模板', duration: 2000 }) } } publishDownloadNotification() { // 1.判断当前系统是否支持进度条模板 if (!this.isSupport) { // 当前系统不支持进度条模板 console.log(\"not support\") return } // 2.准备进度条模板的参数 let template = { name: 'downloadTemplate', data: { progressValue: this.progressValue, progressMaxValue: this.progressMaxValue } } let request: Notification.NotificationRequest = { id: this.notificationId, template: template, wantAgent: this.wantAgentInstance, content: { contentType: Notification.ContentType.NOTIFICATION_CONTENT_BASIC_TEXT, normal: { title: this.filename + ': ' + this.state, text: '', additionalText: this.progressValue + '%' } } } // 3.发送通知 Notification.publish(request) .then(() =\u003e console.log('test', '通知发送成功')) .catch(reason =\u003e console.log('test', '通知发送失败！', JSON.stringify(reason))) } } @Extend(Button) function downloadButton() { .width(75).height(28).fontSize(14) } 通知意图 具体参数看官方文档\nhttps://developer.huawei.com/consumer/cn/doc/harmonyos-references-V2/js-apis-app-ability-wantagent-0000001493424324-V2\n​ async aboutToAppear() { // 1.判断当前系统是否支持进度条模板 this.isSupport = await Notification.isSupportTemplate('downloadTemplate') // 2.创建拉取当前应用的行为意图 // 2.1.创建wantInfo信息 let wantInfo: wantAgent.WantAgentInfo = { wants: [ { bundleName: 'com.example.learn_2', abilityName: 'EntryAbility', } ], requestCode: 0, operationType: wantAgent.OperationType.START_ABILITY, wantAgentFlags: [wantAgent.WantAgentFlags.CONSTANT_FLAG] } // 2.2.创建wantAgent实例 this.wantAgentInstance = await wantAgent.getWantAgent(wantInfo) } async publishProgressNotification() { let isSupportTpl: boolean; await Notification.isSupportTemplate('downloadTemplate').then((data) =\u003e { isSupportTpl = data; }).catch((err) =\u003e { Prompt.showToast({ message: `判断是否支持进度条模板时报错,error[${err}]`, duration: 2000 }) }) if (isSupportTpl) { // 构造模板 let template = { name: 'downloadTemplate', data: { progressValue: this.progressValue, // 当前进度值 progressMaxValue: this.progressMaxValue // 最大进度值 } }; let notificationRequest: Notification.NotificationRequest = { id: this.notificationId, wantAgent: this.wantAgentInstance, content: { contentType: Notification.ContentType.NOTIFICATION_CONTENT_BASIC_TEXT, normal: { title: this.filename + ': ' + this.state, text: '', additionalText: this.progressValue + '%' } }, template: template }; // 发布通知 Notification.publish(notificationRequest).then(() =\u003e { Prompt.showToast({ message: `发布通知成功！`, duration: 2000 }) }).catch((err) =\u003e { Prompt.showToast({ message: `发布通知失败,error[${err}]`, duration: 2000 }) }) } else { Prompt.showToast({ message: '不支持downloadTemplate进度条通知模板', duration: 2000 }) } } ","wordCount":"8980","inLanguage":"zh-cn","datePublished":"2024-03-29T16:04:23+08:00","dateModified":"2024-03-29T16:04:23+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://waite.wang/posts/harmony/learn-harmony-2/"},"publisher":{"@type":"Organization","name":"隶笔难书","logo":{"@type":"ImageObject","url":"https://waite.wang/images/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://waite.wang/ accesskey=h title="隶笔难书 (Alt + H)">隶笔难书</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://waite.wang/ title=首页><span>首页</span></a></li><li><a href=https://waite.wang/search title=搜索><span>搜索</span></a></li><li><a href=https://waite.wang/categories title=分类><span>分类</span></a></li><li><a href=https://waite.wang/tags title=标签><span>标签</span></a></li><li><a href=https://waite.wang/archives title=归档><span>归档</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">鸿蒙学习笔记2</h1><div class=post-meta>Created: &nbsp;<span title='2024-03-29 16:04:23 +0800 +0800'>2024-03-29</span>&nbsp;·&nbsp;18 min&nbsp;·&nbsp;8980 words&nbsp;|&nbsp;<a href=https://github.com/Waite0603/HugoBlog/edit/main/content/posts/harmony/learn-harmony-2.md rel="noopener noreferrer" target=_blank>在 GitHub 编辑</a></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e9%a1%b5%e9%9d%a2%e8%b7%af%e7%94%b1 aria-label=页面路由>页面路由</a><ul><li><a href=#%e9%a1%b5%e9%9d%a2%e8%b7%b3%e8%bd%ac aria-label=页面跳转>页面跳转</a><ul><li><a href=#%e4%bc%a0%e9%80%92%e5%8f%82%e6%95%b0 aria-label=传递参数>传递参数</a></li></ul></li><li><a href=#%e9%a1%b5%e9%9d%a2%e8%bf%94%e5%9b%9e aria-label=页面返回>页面返回</a></li><li><a href=#%e8%87%aa%e5%ae%9a%e4%b9%89%e8%af%a2%e9%97%ae%e6%a1%86 aria-label=自定义询问框>自定义询问框</a></li></ul></li><li><a href=#%e7%8a%b6%e6%80%81%e7%ae%a1%e7%90%86 aria-label=状态管理>状态管理</a><ul><li><a href=#%e5%9f%ba%e6%9c%ac%e6%a6%82%e5%bf%b5 aria-label=基本概念>基本概念</a></li><li><a href=#%e7%ae%a1%e7%90%86%e7%bb%84%e4%bb%b6%e6%8b%a5%e6%9c%89%e7%9a%84%e7%8a%b6%e6%80%81 aria-label=管理组件拥有的状态>管理组件拥有的状态</a><ul><li><a href=#state%e8%a3%85%e9%a5%b0%e5%99%a8%e7%bb%84%e4%bb%b6%e5%86%85%e7%8a%b6%e6%80%81 aria-label=@State装饰器：组件内状态>@State装饰器：组件内状态</a><ul><li><a href=#%e6%a1%88%e4%be%8b aria-label=案例>案例</a></li></ul></li><li><a href=#prop-link-%e8%a3%85%e9%a5%b0%e5%99%a8 aria-label="@Prop/ @Link 装饰器">@Prop/ @Link 装饰器</a></li><li><a href=#observed%e8%a3%85%e9%a5%b0%e5%99%a8%e5%92%8cobjectlink%e8%a3%85%e9%a5%b0%e5%99%a8%e5%b5%8c%e5%a5%97%e7%b1%bb%e5%af%b9%e8%b1%a1%e5%b1%9e%e6%80%a7%e5%8f%98%e5%8c%96 aria-label=@Observed装饰器和@ObjectLink装饰器：嵌套类对象属性变化>@Observed装饰器和@ObjectLink装饰器：嵌套类对象属性变化</a></li></ul></li></ul></li><li><a href=#%e5%8a%a8%e7%94%bb aria-label=动画>动画</a><ul><li><a href=#%e5%9f%ba%e7%a1%80%e9%80%9a%e7%9f%a5 aria-label=基础通知>基础通知</a></li><li><a href=#%e8%bf%9b%e5%ba%a6%e6%9d%a1%e9%80%9a%e7%9f%a5 aria-label=进度条通知>进度条通知</a></li><li><a href=#%e9%80%9a%e7%9f%a5%e6%84%8f%e5%9b%be aria-label=通知意图>通知意图</a></li></ul></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h2 id=页面路由>页面路由<a hidden class=anchor aria-hidden=true href=#页面路由>#</a></h2><p>页面路由指在应用程序中实现不同页面之间的跳转和数据传递。HarmonyOS提供了Router模块，通过不同的url地址，可以方便地进行页面路由，轻松地访问不同的页面。</p><blockquote><p><a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/arkts-routing-0000001503325125-V2#section6414655195312 target=_blank>https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/arkts-routing-0000001503325125-V2#section6414655195312</a></p></blockquote><h3 id=页面跳转>页面跳转<a hidden class=anchor aria-hidden=true href=#页面跳转>#</a></h3><p>页面跳转是开发过程中的一个重要组成部分。在使用应用程序时，通常需要在不同的页面之间跳转，有时还需要将数据从一个页面传递到另一个页面。</p><p>Router模块提供了两种跳转模式，分别是router.pushUrl()和router.replaceUrl()。这两种模式决定了目标页是否会替换当前页。</p><ul><li>router.pushUrl()：目标页不会替换当前页，而是压入页面栈。这样可以保留当前页的状态，并且可以通过返回键或者调用router.back()方法返回到当前页。</li><li>router.replaceUrl()：目标页会替换当前页，并销毁当前页。这样可以释放当前页的资源，并且无法返回到当前页。</li></ul><blockquote><p>页面栈的最大容量为32个页面。如果超过这个限制，可以调用router.clear()方法清空历史页面栈，释放内存空间。</p></blockquote><p>同时，Router模块提供了两种实例模式，分别是Standard和Single。这两种模式决定了目标url是否会对应多个实例。</p><ul><li><p>Standard：标准实例模式，也是默认情况下的实例模式。每次调用该方法都会新建一个目标页，并压入栈顶。</p></li><li><p>Single：单实例模式。即如果目标页的url在页面栈中已经存在同url页面，则离栈顶最近的同url页面会被移动到栈顶，并重新加载；如果目标页的url在页面栈中不存在同url页面，则按照标准模式跳转。</p></li></ul><p>在使用页面路由Router相关功能之前，需要在代码中先导入Router模块。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>import</span> <span class=nx>router</span> <span class=kr>from</span> <span class=s1>&#39;@ohos.router&#39;</span><span class=p>;</span>
</span></span></code></pre></div><p>场景一：有一个主页（Home）和一个详情页（Detail），希望从主页点击一个商品，跳转到详情页。同时，需要保留主页在页面栈中，以便返回时恢复状态。这种场景下，可以使用pushUrl()方法，并且使用Standard实例模式（或者省略）。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=c1>// 在Home页面中
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>function</span> <span class=nx>onJumpClick</span><span class=p>()</span><span class=o>:</span> <span class=k>void</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>router</span><span class=p>.</span><span class=nx>pushUrl</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>url</span><span class=o>:</span> <span class=s1>&#39;pages/Detail&#39;</span> <span class=c1>// 目标url
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>},</span> <span class=nx>router</span><span class=p>.</span><span class=nx>RouterMode</span><span class=p>.</span><span class=nx>Standard</span><span class=p>,</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=sb>`Invoke pushUrl failed, code is </span><span class=si>${</span><span class=nx>err</span><span class=p>.</span><span class=nx>code</span><span class=si>}</span><span class=sb>, message is </span><span class=si>${</span><span class=nx>err</span><span class=p>.</span><span class=nx>message</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>info</span><span class=p>(</span><span class=s1>&#39;Invoke pushUrl succeeded.&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><blockquote><p>标准实例模式下，router.RouterMode.Standard参数可以省略。</p></blockquote><p>场景二：有一个登录页（Login）和一个个人中心页（Profile），希望从登录页成功登录后，跳转到个人中心页。同时，销毁登录页，在返回时直接退出应用。这种场景下，可以使用replaceUrl()方法，并且使用Standard实例模式（或者省略）。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=c1>// 在Login页面中
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>function</span> <span class=nx>onJumpClick</span><span class=p>()</span><span class=o>:</span> <span class=k>void</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>router</span><span class=p>.</span><span class=nx>replaceUrl</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>url</span><span class=o>:</span> <span class=s1>&#39;pages/Profile&#39;</span> <span class=c1>// 目标url
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>},</span> <span class=nx>router</span><span class=p>.</span><span class=nx>RouterMode</span><span class=p>.</span><span class=nx>Standard</span><span class=p>,</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=sb>`Invoke replaceUrl failed, code is </span><span class=si>${</span><span class=nx>err</span><span class=p>.</span><span class=nx>code</span><span class=si>}</span><span class=sb>, message is </span><span class=si>${</span><span class=nx>err</span><span class=p>.</span><span class=nx>message</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>info</span><span class=p>(</span><span class=s1>&#39;Invoke replaceUrl succeeded.&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>场景三：有一个设置页（Setting）和一个主题切换页（Theme），希望从设置页点击主题选项，跳转到主题切换页。同时，需要保证每次只有一个主题切换页存在于页面栈中，在返回时直接回到设置页。这种场景下，可以使用pushUrl()方法，并且使用Single实例模式。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=c1>// 在Setting页面中
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>function</span> <span class=nx>onJumpClick</span><span class=p>()</span><span class=o>:</span> <span class=k>void</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>router</span><span class=p>.</span><span class=nx>pushUrl</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>url</span><span class=o>:</span> <span class=s1>&#39;pages/Theme&#39;</span> <span class=c1>// 目标url
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>},</span> <span class=nx>router</span><span class=p>.</span><span class=nx>RouterMode</span><span class=p>.</span><span class=nx>Single</span><span class=p>,</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=sb>`Invoke pushUrl failed, code is </span><span class=si>${</span><span class=nx>err</span><span class=p>.</span><span class=nx>code</span><span class=si>}</span><span class=sb>, message is </span><span class=si>${</span><span class=nx>err</span><span class=p>.</span><span class=nx>message</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>info</span><span class=p>(</span><span class=s1>&#39;Invoke pushUrl succeeded.&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>场景四：有一个搜索结果列表页（SearchResult）和一个搜索结果详情页（SearchDetail），希望从搜索结果列表页点击某一项结果，跳转到搜索结果详情页。同时，如果该结果已经被查看过，则不需要再新建一个详情页，而是直接跳转到已经存在的详情页。这种场景下，可以使用replaceUrl()方法，并且使用Single实例模式。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=c1>// 在SearchResult页面中
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>function</span> <span class=nx>onJumpClick</span><span class=p>()</span><span class=o>:</span> <span class=k>void</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>router</span><span class=p>.</span><span class=nx>replaceUrl</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>url</span><span class=o>:</span> <span class=s1>&#39;pages/SearchDetail&#39;</span> <span class=c1>// 目标url
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>},</span> <span class=nx>router</span><span class=p>.</span><span class=nx>RouterMode</span><span class=p>.</span><span class=nx>Single</span><span class=p>,</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=sb>`Invoke replaceUrl failed, code is </span><span class=si>${</span><span class=nx>err</span><span class=p>.</span><span class=nx>code</span><span class=si>}</span><span class=sb>, message is </span><span class=si>${</span><span class=nx>err</span><span class=p>.</span><span class=nx>message</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>info</span><span class=p>(</span><span class=s1>&#39;Invoke replaceUrl succeeded.&#39;</span><span class=p>);})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h4 id=传递参数>传递参数<a hidden class=anchor aria-hidden=true href=#传递参数>#</a></h4><p>如果需要在跳转时传递一些数据给目标页，则可以在调用Router模块的方法时，添加一个params属性，并指定一个对象作为参数。例如：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>class</span> <span class=nx>DataModelInfo</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>age</span>: <span class=kt>number</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>DataModel</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>id</span>: <span class=kt>number</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>info</span>: <span class=kt>DataModelInfo</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>onJumpClick</span><span class=p>()</span><span class=o>:</span> <span class=k>void</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 在Home页面中
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kd>let</span> <span class=nx>paramsInfo</span>: <span class=kt>DataModel</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>id</span>: <span class=kt>123</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>info</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>age</span>: <span class=kt>20</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>router</span><span class=p>.</span><span class=nx>pushUrl</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>url</span><span class=o>:</span> <span class=s1>&#39;pages/Detail&#39;</span><span class=p>,</span> <span class=c1>// 目标url
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>params</span>: <span class=kt>paramsInfo</span> <span class=c1>// 添加params属性，传递自定义参数
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>},</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=sb>`Invoke pushUrl failed, code is </span><span class=si>${</span><span class=nx>err</span><span class=p>.</span><span class=nx>code</span><span class=si>}</span><span class=sb>, message is </span><span class=si>${</span><span class=nx>err</span><span class=p>.</span><span class=nx>message</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>info</span><span class=p>(</span><span class=s1>&#39;Invoke pushUrl succeeded.&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>在目标页中，可以通过调用Router模块的getParams()方法来获取传递过来的参数。例如：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>const</span> <span class=nx>params</span> <span class=o>=</span> <span class=nx>router</span><span class=p>.</span><span class=nx>getParams</span><span class=p>();</span> <span class=c1>// 获取传递过来的参数对象
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>id</span> <span class=o>=</span> <span class=nx>params</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>];</span> <span class=c1>// 获取id属性的值
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>age</span> <span class=o>=</span> <span class=nx>params</span><span class=p>[</span><span class=s1>&#39;info&#39;</span><span class=p>].</span><span class=nx>age</span><span class=p>;</span> <span class=c1>// 获取age属性的值
</span></span></span></code></pre></div><h3 id=页面返回>页面返回<a hidden class=anchor aria-hidden=true href=#页面返回>#</a></h3><p>当用户在一个页面完成操作后，通常需要返回到上一个页面或者指定页面，这就需要用到页面返回功能。在返回的过程中，可能需要将数据传递给目标页，这就需要用到数据传递功能。</p><p>方式一：返回到上一个页面。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=nx>router</span><span class=p>.</span><span class=nx>back</span><span class=p>();</span>
</span></span></code></pre></div><p>这种方式会返回到上一个页面，即上一个页面在页面栈中的位置。但是，上一个页面必须存在于页面栈中才能够返回，否则该方法将无效。</p><p>方式二：返回到指定页面。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=nx>router</span><span class=p>.</span><span class=nx>back</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>url</span><span class=o>:</span> <span class=s1>&#39;pages/Home&#39;</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><p>这种方式可以返回到指定页面，需要指定目标页的路径。目标页必须存在于页面栈中才能够返回。</p><p>方式三：返回到指定页面，并传递自定义参数信息。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=nx>router</span><span class=p>.</span><span class=nx>back</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>url</span><span class=o>:</span> <span class=s1>&#39;pages/Home&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>params</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>info</span><span class=o>:</span> <span class=s1>&#39;来自Home页&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><p>这种方式不仅可以返回到指定页面，还可以在返回的同时传递自定义参数信息。这些参数信息可以在目标页中通过调用router.getParams()方法进行获取和解析。</p><p>在目标页中，在需要获取参数的位置调用router.getParams()方法即可，例如在onPageShow()生命周期回调中：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=nx>onPageShow() {</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>params</span> <span class=o>=</span> <span class=nx>router</span><span class=p>.</span><span class=nx>getParams</span><span class=p>();</span> <span class=c1>// 获取传递过来的参数对象
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>info</span> <span class=o>=</span> <span class=nx>params</span><span class=p>[</span><span class=s1>&#39;info&#39;</span><span class=p>];</span> <span class=c1>// 获取info属性的值
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><h3 id=自定义询问框>自定义询问框<a hidden class=anchor aria-hidden=true href=#自定义询问框>#</a></h3><p>自定义询问框的方式，可以使用弹窗或者自定义弹窗实现。这样可以让应用界面与系统默认询问框有所区别，提高应用的用户体验度。本文以弹窗为例，介绍如何实现自定义询问框。</p><p>在事件回调中，调用弹窗的promptAction.showDialog()方法：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kd>function</span> <span class=nx>onBackClick() {</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 弹出自定义的询问框
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>promptAction</span><span class=p>.</span><span class=nx>showDialog</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;您还没有完成支付，确定要返回吗？&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>buttons</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>text</span><span class=o>:</span> <span class=s1>&#39;取消&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>color</span><span class=o>:</span> <span class=s1>&#39;#FF0000&#39;</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>text</span><span class=o>:</span> <span class=s1>&#39;确认&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>color</span><span class=o>:</span> <span class=s1>&#39;#0099FF&#39;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>}).</span><span class=nx>then</span><span class=p>((</span><span class=nx>result</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>result</span><span class=p>.</span><span class=nx>index</span> <span class=o>===</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 用户点击了“取消”按钮
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>console</span><span class=p>.</span><span class=nx>info</span><span class=p>(</span><span class=s1>&#39;User canceled the operation.&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=nx>result</span><span class=p>.</span><span class=nx>index</span> <span class=o>===</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 用户点击了“确认”按钮
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>console</span><span class=p>.</span><span class=nx>info</span><span class=p>(</span><span class=s1>&#39;User confirmed the operation.&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 调用router.back()方法，返回上一个页面
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>router</span><span class=p>.</span><span class=nx>back</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}).</span><span class=k>catch</span><span class=p>((</span><span class=nx>err</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=sb>`Invoke showDialog failed, code is </span><span class=si>${</span><span class=nx>err</span><span class=p>.</span><span class=nx>code</span><span class=si>}</span><span class=sb>, message is </span><span class=si>${</span><span class=nx>err</span><span class=p>.</span><span class=nx>message</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=状态管理>状态管理<a hidden class=anchor aria-hidden=true href=#状态管理>#</a></h2><p>在声明式UI编程框架中，UI是程序状态的运行结果，用户构建了一个UI模型，其中应用的运行时的状态是参数。当参数改变时，UI作为返回结果，也将进行对应的改变。这些运行时的状态变化所带来的UI的重新渲染，在ArkUI中统称为状态管理机制。</p><p>自定义组件拥有变量，变量必须被装饰器装饰才可以成为状态变量，状态变量的改变会引起UI的渲染刷新。如果不使用状态变量，UI只能在初始化时渲染，后续将不会再刷新。 下图展示了State和View（UI）之间的关系。</p><p><a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/arkts-state-management-overview-0000001524537145-V2 target=_blank>https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/arkts-state-management-overview-0000001524537145-V2</a></p><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202404211849420.png><img src=https://qiniu.waite.wang/202404211849420.png alt></a></div></p><ul><li><p>View(UI)：UI渲染，指将build方法内的UI描述和@Builder装饰的方法内的UI描述映射到界面。</p></li><li><p>State：状态，指驱动UI更新的数据。用户通过触发组件的事件方法，改变状态数据。状态数据的改变，引起UI的重新渲染。</p></li></ul><h3 id=基本概念>基本概念<a hidden class=anchor aria-hidden=true href=#基本概念>#</a></h3><ul><li>状态变量：被状态装饰器装饰的变量，状态变量值的改变会引起UI的渲染更新。示例：@State num: number = 1,其中，@State是状态装饰器，num是状态变量。</li><li>常规变量：没有被状态装饰器装饰的变量，通常应用于辅助计算。它的<strong>改变永远不会引起UI的刷新</strong>。以下示例中increaseBy变量为常规变量。</li><li>数据源/同步源：状态变量的原始来源，可以同步给不同的状态数据。通常意义为父组件传给子组件的数据。以下示例中数据源为count: 1。</li><li>命名参数机制：父组件通过指定参数传递给子组件的状态变量，为父子传递同步参数的主要手段。示例：CompA: ({ aProp: this.aProp })。</li><li>从父组件初始化：父组件使用命名参数机制，将指定参数传递给子组件。子组件初始化的默认值在有父组件传值的情况下，会被覆盖。示例：</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kd>@Component</span>
</span></span><span class=line><span class=cl><span class=nx>struct</span> <span class=nx>MyComponent</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>@State</span> <span class=nx>count</span>: <span class=kt>number</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kr>private</span> <span class=nx>increaseBy</span>: <span class=kt>number</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>build() {</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>@Component</span>
</span></span><span class=line><span class=cl><span class=nx>struct</span> <span class=nx>Parent</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>build() {</span>
</span></span><span class=line><span class=cl>    <span class=nx>Column() {</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 从父组件初始化，覆盖本地定义的默认值
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>MyComponent</span><span class=p>({</span> <span class=nx>count</span>: <span class=kt>1</span><span class=p>,</span> <span class=nx>increaseBy</span>: <span class=kt>2</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202404211855789.png><img src=https://qiniu.waite.wang/202404211855789.png alt></a></div></p><ul><li><p>初始化子节点：父组件中状态变量可以传递给子组件，初始化子组件对应的状态变量。示例同上。</p></li><li><p>本地初始化：在变量声明的时候赋值，作为变量的默认值。示例：@State count: number = 0。</p></li></ul><h3 id=管理组件拥有的状态>管理组件拥有的状态<a hidden class=anchor aria-hidden=true href=#管理组件拥有的状态>#</a></h3><h4 id=state装饰器组件内状态>@State装饰器：组件内状态<a hidden class=anchor aria-hidden=true href=#state装饰器组件内状态>#</a></h4><blockquote><p>@state 装饰器标记的变量必须初始化, 不能为空值</p></blockquote><blockquote><p>@state 支持Object、class、string、number、boolean、enum类型，以及这些类型的数组。不支持any，不支持简单类型和复杂类型的联合类型，不允许使用undefined和null。</p></blockquote><blockquote><p>嵌套类型以及数组中的对象属性无法触发视图更新</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Person</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span>: <span class=kt>string</span>
</span></span><span class=line><span class=cl>  <span class=nx>age</span>: <span class=kt>number</span>
</span></span><span class=line><span class=cl>  <span class=nx>gf</span>: <span class=kt>Person</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>constructor</span><span class=p>(</span><span class=nx>name</span>: <span class=kt>string</span><span class=p>,</span> <span class=nx>age</span>: <span class=kt>number</span><span class=p>,</span> <span class=nx>gf?</span>: <span class=kt>Person</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>age</span> <span class=o>=</span> <span class=nx>age</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>name</span> <span class=o>=</span> <span class=nx>name</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>gf</span> <span class=o>=</span> <span class=nx>gf</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>@Entry</span>
</span></span><span class=line><span class=cl><span class=kd>@Component</span>
</span></span><span class=line><span class=cl><span class=nx>struct</span> <span class=nx>Second</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>@State</span> <span class=nx>p</span>: <span class=kt>Person</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Person</span><span class=p>(</span><span class=s1>&#39;jack&#39;</span><span class=p>,</span> <span class=mi>21</span><span class=p>,</span> <span class=k>new</span> <span class=nx>Person</span><span class=p>(</span><span class=s1>&#39;aaa&#39;</span><span class=p>,</span> <span class=mi>11</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>build() {</span>
</span></span><span class=line><span class=cl>    <span class=nx>Column() {</span>
</span></span><span class=line><span class=cl>      <span class=nx>Text</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>p</span><span class=p>.</span><span class=nx>name</span><span class=si>}</span><span class=sb>: </span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>p</span><span class=p>.</span><span class=nx>age</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>fontSize</span><span class=p>(</span><span class=mi>50</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>onClick</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=k>this</span><span class=p>.</span><span class=nx>p</span><span class=p>.</span><span class=nx>age</span> <span class=o>++</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=nx>Text</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>p</span><span class=p>.</span><span class=nx>gf</span><span class=p>.</span><span class=nx>name</span><span class=si>}</span><span class=sb>: </span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>p</span><span class=p>.</span><span class=nx>gf</span><span class=p>.</span><span class=nx>age</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>fontSize</span><span class=p>(</span><span class=mi>50</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>onClick</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>p</span><span class=p>.</span><span class=nx>gf</span><span class=p>.</span><span class=nx>name</span><span class=si>}</span><span class=sb>: </span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>p</span><span class=p>.</span><span class=nx>gf</span><span class=p>.</span><span class=nx>age</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=k>this</span><span class=p>.</span><span class=nx>p</span><span class=p>.</span><span class=nx>gf</span><span class=p>.</span><span class=nx>age</span> <span class=o>++</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>width</span><span class=p>(</span><span class=s2>&#34;100%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202404212244227.png><img src=https://qiniu.waite.wang/202404212244227.png alt></a></div></p><p>当点击下面时，不会触发视图更新, 只有点击上面非嵌套属性时才会触发视图整体更新</p><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202404212001481.png><img src=https://qiniu.waite.wang/202404212001481.png alt></a></div></p><p>@State装饰的变量，或称为状态变量，一旦变量拥有了状态属性，就和自定义组件的渲染绑定起来。当状态改变时，UI会发生对应的渲染改变。</p><p>在状态变量相关装饰器中，@State是最基础的，使变量拥有状态属性的装饰器，它也是大部分状态变量的数据源。</p><p>@State装饰的变量，与声明式范式中的其他被装饰变量一样，是私有的，只能从组件内部访问，在声明时必须指定其类型和本地初始化。初始化也可选择使用命名参数机制从父组件完成初始化。</p><p>@State装饰的变量拥有以下特点：</p><ul><li>@State装饰的变量与子组件中的@Prop装饰变量之间建立单向数据同步，与@Link、@ObjectLink装饰变量之间建立双向数据同步。</li><li>@State装饰的变量生命周期与其所属自定义组件的生命周期相同。</li></ul><h5 id=案例>案例<a hidden class=anchor aria-hidden=true href=#案例>#</a></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Task</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>static</span> <span class=nx>id</span>: <span class=kt>number</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span>: <span class=kt>string</span> <span class=o>=</span> <span class=sb>`Task</span><span class=si>${</span><span class=nx>Task</span><span class=p>.</span><span class=nx>id</span><span class=o>++</span><span class=si>}</span><span class=sb>`</span>
</span></span><span class=line><span class=cl>  <span class=nx>finished</span>: <span class=kt>boolean</span> <span class=o>=</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>@Styles</span> <span class=kd>function</span> <span class=nx>card() {</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>width</span><span class=p>(</span><span class=s2>&#34;95%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>padding</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>backgroundColor</span><span class=p>(</span><span class=nx>Color</span><span class=p>.</span><span class=nx>White</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>borderRadius</span><span class=p>(</span><span class=mi>15</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>shadow</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>radius</span>: <span class=kt>6</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>color</span><span class=o>:</span> <span class=s2>&#34;#1F000000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>offsetX</span>: <span class=kt>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>offsetY</span>: <span class=kt>4</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>@Extend</span><span class=p>(</span><span class=nx>Text</span><span class=p>)</span> <span class=kd>function</span> <span class=nx>finishedTask() {</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>decoration</span><span class=p>({</span> <span class=kr>type</span><span class=o>:</span> <span class=nx>TextDecorationType</span><span class=p>.</span><span class=nx>LineThrough</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>fontSize</span><span class=p>(</span><span class=s2>&#34;##B1B2B1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>@Entry</span>
</span></span><span class=line><span class=cl><span class=kd>@Component</span>
</span></span><span class=line><span class=cl><span class=nx>struct</span> <span class=nx>Second</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>@State</span> <span class=nx>totalTask</span>: <span class=kt>number</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>  <span class=kd>@State</span> <span class=nx>finishTask</span>: <span class=kt>number</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>  <span class=kd>@State</span> <span class=nx>task</span>: <span class=kt>Task</span><span class=p>[]</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>handTaskChange() {</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>totalTask</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>task</span><span class=p>.</span><span class=nx>length</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>finishTask</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>task</span><span class=p>.</span><span class=nx>filter</span><span class=p>(</span><span class=nx>item</span> <span class=o>=&gt;</span> <span class=nx>item</span><span class=p>.</span><span class=nx>finished</span><span class=p>).</span><span class=nx>length</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>build() {</span>
</span></span><span class=line><span class=cl>    <span class=nx>Column</span><span class=p>({</span> <span class=nx>space</span>: <span class=kt>10</span> <span class=p>})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 任务进度卡片
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>Row() {</span>
</span></span><span class=line><span class=cl>        <span class=nx>Text</span><span class=p>(</span><span class=s2>&#34;任务进度: &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=p>.</span><span class=nx>fontSize</span><span class=p>(</span><span class=mi>30</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=p>.</span><span class=nx>fontWeight</span><span class=p>(</span><span class=nx>FontWeight</span><span class=p>.</span><span class=nx>Bold</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nx>Stack() {</span>
</span></span><span class=line><span class=cl>          <span class=nx>Progress</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=nx>value</span>: <span class=kt>this.finishTask</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>total</span>: <span class=kt>this.totalTask</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=kr>type</span><span class=o>:</span> <span class=nx>ProgressType</span><span class=p>.</span><span class=nx>Ring</span>
</span></span><span class=line><span class=cl>          <span class=p>})</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=nx>width</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>          <span class=nx>Row() {</span>
</span></span><span class=line><span class=cl>            <span class=nx>Text</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>finishTask</span><span class=p>.</span><span class=nx>toString</span><span class=p>())</span>
</span></span><span class=line><span class=cl>              <span class=p>.</span><span class=nx>fontSize</span><span class=p>(</span><span class=mi>24</span><span class=p>)</span>
</span></span><span class=line><span class=cl>              <span class=p>.</span><span class=nx>fontColor</span><span class=p>(</span><span class=s2>&#34;#36D&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nx>Text</span><span class=p>(</span><span class=s2>&#34;/&#34;</span> <span class=o>+</span> <span class=k>this</span><span class=p>.</span><span class=nx>totalTask</span><span class=p>.</span><span class=nx>toString</span><span class=p>())</span>
</span></span><span class=line><span class=cl>              <span class=p>.</span><span class=nx>fontSize</span><span class=p>(</span><span class=mi>24</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>card</span><span class=p>()</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>margin</span><span class=p>({</span> <span class=nx>top</span>: <span class=kt>20</span><span class=p>,</span> <span class=nx>bottom</span>: <span class=kt>10</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>justifyContent</span><span class=p>(</span><span class=nx>FlexAlign</span><span class=p>.</span><span class=nx>SpaceEvenly</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=c1>// 新增任务按钮
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>Button</span><span class=p>(</span><span class=s2>&#34;添加任务&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>width</span><span class=p>(</span><span class=mi>200</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>onClick</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=k>this</span><span class=p>.</span><span class=nx>task</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=k>new</span> <span class=nx>Task</span><span class=p>())</span>
</span></span><span class=line><span class=cl>          <span class=k>this</span><span class=p>.</span><span class=nx>handTaskChange</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=c1>// 渲染任务列表
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>List</span><span class=p>({</span> <span class=nx>space</span>: <span class=kt>10</span> <span class=p>})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>ForEach</span><span class=p>(</span>
</span></span><span class=line><span class=cl>          <span class=k>this</span><span class=p>.</span><span class=nx>task</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=p>(</span><span class=nx>item</span>: <span class=kt>Task</span><span class=p>,</span> <span class=nx>index</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>ListItem() {</span>
</span></span><span class=line><span class=cl>              <span class=nx>Row() {</span>
</span></span><span class=line><span class=cl>                <span class=nx>Text</span><span class=p>(</span><span class=nx>item</span><span class=p>.</span><span class=nx>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                  <span class=p>.</span><span class=nx>fontSize</span><span class=p>(</span><span class=mi>24</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=nx>Checkbox</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                  <span class=p>.</span><span class=nx>select</span><span class=p>(</span><span class=nx>item</span><span class=p>.</span><span class=nx>finished</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                  <span class=p>.</span><span class=nx>onChange</span><span class=p>(</span><span class=nx>value</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nx>item</span><span class=p>.</span><span class=nx>finished</span> <span class=o>=</span> <span class=nx>value</span>
</span></span><span class=line><span class=cl>                    <span class=k>this</span><span class=p>.</span><span class=nx>handTaskChange</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                  <span class=p>})</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>.</span><span class=nx>card</span><span class=p>()</span>
</span></span><span class=line><span class=cl>              <span class=p>.</span><span class=nx>justifyContent</span><span class=p>(</span><span class=nx>FlexAlign</span><span class=p>.</span><span class=nx>SpaceBetween</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=nx>swipeAction</span><span class=p>({</span>
</span></span><span class=line><span class=cl>              <span class=nx>end</span>: <span class=kt>this.DeleteButton</span><span class=p>(</span><span class=nx>index</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>})</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>width</span><span class=p>(</span><span class=s2>&#34;100%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>alignListItem</span><span class=p>(</span><span class=nx>ListItemAlign</span><span class=p>.</span><span class=nx>Center</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>layoutWeight</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>width</span><span class=p>(</span><span class=s2>&#34;100%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>height</span><span class=p>(</span><span class=s2>&#34;100%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>backgroundColor</span><span class=p>(</span><span class=s2>&#34;#F1F2F3&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 构建函数
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kd>@Builder</span> <span class=nx>DeleteButton</span><span class=p>(</span><span class=nx>index</span>: <span class=kt>number</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>Text</span><span class=p>(</span><span class=s2>&#34;Del&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>fontColor</span><span class=p>(</span><span class=nx>Color</span><span class=p>.</span><span class=nx>White</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>padding</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>backgroundColor</span><span class=p>(</span><span class=nx>Color</span><span class=p>.</span><span class=nx>Red</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>borderRadius</span><span class=p>(</span><span class=s2>&#34;50%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>margin</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>onClick</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>task</span><span class=p>.</span><span class=nx>splice</span><span class=p>(</span><span class=nx>index</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>handTaskChange</span><span class=p>()</span>
</span></span><span class=line><span class=cl>      <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202404220020396.png><img src=https://qiniu.waite.wang/202404220020396.png alt></a></div></p><h4 id=prop-link-装饰器>@Prop/ @Link 装饰器<a hidden class=anchor aria-hidden=true href=#prop-link-装饰器>#</a></h4><blockquote><p>@Prop 父子组件单向同步: @Prop装饰的变量可以和父组件建立单向的同步关系。@Prop装饰的变量是可变的，但是变化不会同步回其父组件。
@Link 父子组件双向同步: 子组件中被@Link装饰的变量与其父组件中对应的数据源建立双向数据绑定。@Link装饰的变量与其父组件中的数据源共享相同的值。</p></blockquote><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202404241715871.png><img src=https://qiniu.waite.wang/202404241715871.png alt></a></div></p><blockquote><p>在最新版本中, @Prop 可以在子组件初始化, 但是编辑器 eslint 会报错</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kd>@Component</span>
</span></span><span class=line><span class=cl><span class=nx>struct</span> <span class=nx>Child</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>@Prop</span> <span class=nx>value</span>: <span class=kt>number</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>build() {</span>
</span></span><span class=line><span class=cl>    <span class=nx>Text</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>value</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>fontSize</span><span class=p>(</span><span class=mi>50</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>onClick</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>value</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>value</span><span class=o>++</span>
</span></span><span class=line><span class=cl>      <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>@Entry</span>
</span></span><span class=line><span class=cl><span class=kd>@Component</span>
</span></span><span class=line><span class=cl><span class=nx>struct</span> <span class=nx>Index</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>@State</span> <span class=nx>arr</span>: <span class=kt>number</span><span class=p>[]</span> <span class=o>=</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>build() {</span>
</span></span><span class=line><span class=cl>    <span class=nx>Row() {</span>
</span></span><span class=line><span class=cl>      <span class=nx>Column() {</span>
</span></span><span class=line><span class=cl>        <span class=nx>Child</span><span class=p>({</span> <span class=nx>value</span>: <span class=kt>this.arr</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>        <span class=nx>Child</span><span class=p>({</span> <span class=nx>value</span>: <span class=kt>this.arr</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>        <span class=nx>Child</span><span class=p>({</span> <span class=nx>value</span>: <span class=kt>this.arr</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nx>Divider</span><span class=p>().</span><span class=nx>height</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nx>ForEach</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>arr</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>item</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>Child</span><span class=p>({</span> <span class=s1>&#39;value&#39;</span><span class=o>:</span> <span class=nx>item</span> <span class=p>}</span> <span class=kr>as</span> <span class=nx>Record</span><span class=p>&lt;</span><span class=nt>string</span><span class=p>,</span> <span class=na>number</span><span class=p>&gt;)</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=nx>item</span> <span class=o>=&gt;</span> <span class=nx>item</span><span class=p>.</span><span class=nx>toString</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>Text</span><span class=p>(</span><span class=s1>&#39;replace entire arr&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=p>.</span><span class=nx>fontSize</span><span class=p>(</span><span class=mi>50</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=p>.</span><span class=nx>onClick</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 两个数组都包含项“3”。
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>this</span><span class=p>.</span><span class=nx>arr</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>arr</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>==</span> <span class=mi>1</span> <span class=o>?</span> <span class=p>[</span><span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>]</span> <span class=o>:</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>];</span>
</span></span><span class=line><span class=cl>          <span class=p>})</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>如果点击界面上的“1”六次、“2”五次、“3”四次，将所有变量的本地取值都变为“7”。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>7
</span></span><span class=line><span class=cl>7
</span></span><span class=line><span class=cl>7
</span></span><span class=line><span class=cl>----
</span></span><span class=line><span class=cl>7
</span></span><span class=line><span class=cl>7
</span></span><span class=line><span class=cl>7
</span></span></code></pre></div><p>单击replace entire arr后，屏幕将显示以下信息，为什么？</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>3
</span></span><span class=line><span class=cl>4
</span></span><span class=line><span class=cl>5
</span></span><span class=line><span class=cl>----
</span></span><span class=line><span class=cl>7
</span></span><span class=line><span class=cl>4
</span></span><span class=line><span class=cl>5
</span></span></code></pre></div><ul><li>在子组件Child中做的所有的修改都不会同步回父组件Index组件，所以即使6个组件显示都为7，但在父组件Index中，this.arr保存的值依旧是[1,2,3]。</li><li>点击replace entire arr，this.arr[0] == 1成立，将this.arr赋值为[3, 4, 5]；</li><li>因为this.arr[0]已更改，Child({value: this.arr[0]})组件将this.arr[0]更新同步到实例@Prop装饰的变量。Child({value: this.arr[1]})和Child({value: this.arr[2]})的情况也类似。</li><li>this.arr的更改触发ForEach更新，this.arr更新的前后都有数值为3的数组项：[3, 4, 5] 和[1, 2, 3]。根据diff算法，数组项“3”将被保留，删除“1”和“2”的数组项，添加为“4”和“5”的数组项。这就意味着，数组项“3”的组件不会重新生成，而是将其移动到第一位。所以“3”对应的组件不会更新，此时“3”对应的组件数值为“7”，ForEach最终的渲染结果是“7”，“4”，“5”。</li></ul><blockquote><p>diff算法是一种用于比较两个数据结构（比如两个数组或两个树）之间差异的算法。在前端开发中，diff算法通常用于虚拟DOM的更新和渲染优化。</p><p>在React等前端框架中，当数据发生变化时，diff算法可以帮助确定哪些DOM节点需要被更新，哪些需要被添加或删除，以及哪些可以被保留而不进行重新渲染。这可以提高性能并减少不必要的DOM操作。</p><p>diff算法通常包括以下步骤：</p><ul><li>比较两个数据结构的差异，找出新增、删除和更新的部分。</li><li>标记需要进行更新的部分，并记录其变化。</li><li>应用这些变化，更新DOM或其他视图。</li></ul></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kd>@Styles</span> <span class=kd>function</span> <span class=nx>btn() {</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>margin</span><span class=p>(</span><span class=mi>12</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>width</span><span class=p>(</span><span class=mi>312</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>height</span><span class=p>(</span><span class=mi>40</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>@Component</span>
</span></span><span class=line><span class=cl><span class=nx>struct</span> <span class=nx>Child</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>@Link</span> <span class=nx>items</span>: <span class=kt>number</span><span class=p>[];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>build() {</span>
</span></span><span class=line><span class=cl>    <span class=nx>Column() {</span>
</span></span><span class=line><span class=cl>      <span class=nx>Button</span><span class=p>(</span><span class=sb>`Button1: push`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>btn</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>onClick</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=k>this</span><span class=p>.</span><span class=nx>items</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>items</span><span class=p>.</span><span class=nx>length</span> <span class=o>+</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>      <span class=nx>Button</span><span class=p>(</span><span class=sb>`Button2: replace whole item`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>btn</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>onClick</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=k>this</span><span class=p>.</span><span class=nx>items</span> <span class=o>=</span> <span class=p>[</span><span class=mi>100</span><span class=p>,</span> <span class=mi>200</span><span class=p>,</span> <span class=mi>300</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>@Entry</span>
</span></span><span class=line><span class=cl><span class=kd>@Component</span>
</span></span><span class=line><span class=cl><span class=nx>struct</span> <span class=nx>Parent</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>@State</span> <span class=nx>arr</span>: <span class=kt>number</span><span class=p>[]</span> <span class=o>=</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>build() {</span>
</span></span><span class=line><span class=cl>    <span class=nx>Column() {</span>
</span></span><span class=line><span class=cl>      <span class=nx>Button</span><span class=p>(</span><span class=s1>&#39;Button Parent push&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>btn</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>onClick</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=k>this</span><span class=p>.</span><span class=nx>arr</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>arr</span><span class=p>.</span><span class=nx>length</span> <span class=o>+</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>      <span class=nx>Child</span><span class=p>({</span> <span class=nx>items</span>: <span class=kt>$arr</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>margin</span><span class=p>(</span><span class=mi>12</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=nx>ForEach</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>arr</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=nx>item</span>: <span class=kt>number</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>Button</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=nx>item</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=nx>margin</span><span class=p>(</span><span class=mi>12</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=nx>width</span><span class=p>(</span><span class=mi>312</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=nx>height</span><span class=p>(</span><span class=mi>40</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=nx>backgroundColor</span><span class=p>(</span><span class=s1>&#39;#11a2a2a2&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=nx>fontColor</span><span class=p>(</span><span class=s1>&#39;#e6000000&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=nx>item</span>: <span class=kt>ForEachInterface</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=nx>item</span><span class=p>.</span><span class=nx>toString</span><span class=p>()</span>
</span></span><span class=line><span class=cl>      <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202404241724695.png><img src=https://qiniu.waite.wang/202404241724695.png alt></a></div></p><h4 id=observed装饰器和objectlink装饰器嵌套类对象属性变化>@Observed装饰器和@ObjectLink装饰器：嵌套类对象属性变化<a hidden class=anchor aria-hidden=true href=#observed装饰器和objectlink装饰器嵌套类对象属性变化>#</a></h4><blockquote><p>上文所述的装饰器仅能观察到第一层的变化，但是在实际应用开发中，应用会根据开发需要，封装自己的数据模型。对于多层嵌套的情况，比如二维数组，或者数组项class，或者class的属性是class，他们的第二层的属性变化是无法观察到的。这就引出了@Observed/@ObjectLink装饰器。</p></blockquote><p>以下是引入@Observed/@ObjectLink装饰器的示例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kd>@Observed</span>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Person</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span>: <span class=kt>string</span>
</span></span><span class=line><span class=cl>  <span class=nx>age</span>: <span class=kt>number</span>
</span></span><span class=line><span class=cl>  <span class=nx>gf</span>: <span class=kt>Person</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>constructor</span><span class=p>(</span><span class=nx>name</span>: <span class=kt>string</span><span class=p>,</span> <span class=nx>age</span>: <span class=kt>number</span><span class=p>,</span> <span class=nx>gf?</span>: <span class=kt>Person</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>name</span> <span class=o>=</span> <span class=nx>name</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>age</span> <span class=o>=</span> <span class=nx>age</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>gf</span> <span class=o>=</span> <span class=nx>gf</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>@Entry</span>
</span></span><span class=line><span class=cl><span class=kd>@Component</span>
</span></span><span class=line><span class=cl><span class=nx>struct</span> <span class=nx>Child</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>@State</span> <span class=nx>p</span>: <span class=kt>Person</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Person</span><span class=p>(</span><span class=s2>&#34;Waite&#34;</span><span class=p>,</span> <span class=mi>18</span><span class=p>,</span> <span class=k>new</span> <span class=nx>Person</span><span class=p>(</span><span class=s2>&#34;www&#34;</span><span class=p>,</span> <span class=mi>11</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=kd>@State</span> <span class=nx>gfs</span>: <span class=kt>Person</span><span class=p>[]</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=k>new</span> <span class=nx>Person</span><span class=p>(</span><span class=s2>&#34;Jack&#34;</span><span class=p>,</span> <span class=mi>18</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=k>new</span> <span class=nx>Person</span><span class=p>(</span><span class=s2>&#34;XiaoMing&#34;</span><span class=p>,</span> <span class=mi>20</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>build() {</span>
</span></span><span class=line><span class=cl>    <span class=nx>Column</span><span class=p>({</span> <span class=nx>space</span>: <span class=kt>10</span> <span class=p>})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>PersonChild</span><span class=p>({</span> <span class=nx>p</span>: <span class=kt>this.p.gf</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>onClick</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>p</span><span class=p>.</span><span class=nx>gf</span><span class=p>.</span><span class=nx>age</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=k>this</span><span class=p>.</span><span class=nx>p</span><span class=p>.</span><span class=nx>gf</span><span class=p>.</span><span class=nx>age</span><span class=o>++</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=nx>Text</span><span class=p>(</span><span class=s2>&#34;Girl Friends List&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=nx>ForEach</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>gfs</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>item</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>PersonChild</span><span class=p>({</span> <span class=nx>p</span>: <span class=kt>item</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=nx>onClick</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=nx>item</span><span class=p>.</span><span class=nx>age</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>@Component</span>
</span></span><span class=line><span class=cl><span class=nx>struct</span> <span class=nx>PersonChild</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>@ObjectLink</span> <span class=nx>p</span>: <span class=kt>Person</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>build() {</span>
</span></span><span class=line><span class=cl>    <span class=nx>Column() {</span>
</span></span><span class=line><span class=cl>      <span class=nx>Text</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>p</span><span class=p>.</span><span class=nx>name</span><span class=si>}</span><span class=sb>: </span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>p</span><span class=p>.</span><span class=nx>age</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><blockquote><p>为了给变量加 @ObjectLink 装饰器, 写成组件 -> 因为装饰器没法装饰一个参数</p><p>@Observed class 不管嵌套几个类型, 凡是嵌套的, 都要加上 @Observed 装饰器</p></blockquote><blockquote><p>完善案例, 当 Checkbox 选中时, 会触发对应的任务完成状态, 任务完成状态改变时, 会触发任务进度的更新</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kd>@Observed</span>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Task</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>static</span> <span class=nx>id</span>: <span class=kt>number</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span>: <span class=kt>string</span> <span class=o>=</span> <span class=sb>`Task</span><span class=si>${</span><span class=nx>Task</span><span class=p>.</span><span class=nx>id</span><span class=o>++</span><span class=si>}</span><span class=sb>`</span>
</span></span><span class=line><span class=cl>  <span class=nx>finished</span>: <span class=kt>boolean</span> <span class=o>=</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>@Styles</span> <span class=kd>function</span> <span class=nx>card() {</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>width</span><span class=p>(</span><span class=s2>&#34;95%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>padding</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>backgroundColor</span><span class=p>(</span><span class=nx>Color</span><span class=p>.</span><span class=nx>White</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>borderRadius</span><span class=p>(</span><span class=mi>15</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>shadow</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>radius</span>: <span class=kt>6</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>color</span><span class=o>:</span> <span class=s2>&#34;#1F000000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>offsetX</span>: <span class=kt>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>offsetY</span>: <span class=kt>4</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>@Extend</span><span class=p>(</span><span class=nx>Text</span><span class=p>)</span> <span class=kd>function</span> <span class=nx>finishedTask() {</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>fontColor</span><span class=p>(</span><span class=s2>&#34;#B1B2B1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>@Entry</span>
</span></span><span class=line><span class=cl><span class=kd>@Component</span>
</span></span><span class=line><span class=cl><span class=nx>struct</span> <span class=nx>Second</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>@State</span> <span class=nx>totalTask</span>: <span class=kt>number</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>  <span class=kd>@State</span> <span class=nx>finishTask</span>: <span class=kt>number</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>  <span class=kd>@State</span> <span class=nx>task</span>: <span class=kt>Task</span><span class=p>[]</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>handTaskChange() {</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>totalTask</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>task</span><span class=p>.</span><span class=nx>length</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>finishTask</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>task</span><span class=p>.</span><span class=nx>filter</span><span class=p>(</span><span class=nx>item</span> <span class=o>=&gt;</span> <span class=nx>item</span><span class=p>.</span><span class=nx>finished</span><span class=p>).</span><span class=nx>length</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>build() {</span>
</span></span><span class=line><span class=cl>    <span class=nx>Column</span><span class=p>({</span> <span class=nx>space</span>: <span class=kt>10</span> <span class=p>})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 任务进度卡片
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>TaskStatistics</span><span class=p>({</span> <span class=nx>finishTask</span>: <span class=kt>this.finishTask</span><span class=p>,</span> <span class=nx>totalTask</span>: <span class=kt>this.totalTask</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=c1>// 新增任务按钮
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>Button</span><span class=p>(</span><span class=s2>&#34;添加任务&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>width</span><span class=p>(</span><span class=mi>200</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>onClick</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=k>this</span><span class=p>.</span><span class=nx>task</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=k>new</span> <span class=nx>Task</span><span class=p>())</span>
</span></span><span class=line><span class=cl>          <span class=k>this</span><span class=p>.</span><span class=nx>handTaskChange</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=c1>// 渲染任务列表
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>List</span><span class=p>({</span> <span class=nx>space</span>: <span class=kt>10</span> <span class=p>})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>ForEach</span><span class=p>(</span>
</span></span><span class=line><span class=cl>          <span class=k>this</span><span class=p>.</span><span class=nx>task</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=p>(</span><span class=nx>item</span>: <span class=kt>Task</span><span class=p>,</span> <span class=nx>index</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>ListItem() {</span>
</span></span><span class=line><span class=cl>              <span class=nx>itemChild</span><span class=p>({</span><span class=nx>item</span>: <span class=kt>item</span><span class=p>,</span> <span class=nx>onTaskChanged</span><span class=o>:</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>handTaskChange</span><span class=p>()})</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=nx>swipeAction</span><span class=p>({</span>
</span></span><span class=line><span class=cl>              <span class=nx>end</span>: <span class=kt>this.DeleteButton</span><span class=p>(</span><span class=nx>index</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>})</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>width</span><span class=p>(</span><span class=s2>&#34;100%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>height</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>alignListItem</span><span class=p>(</span><span class=nx>ListItemAlign</span><span class=p>.</span><span class=nx>Center</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>layoutWeight</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>width</span><span class=p>(</span><span class=s2>&#34;100%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>height</span><span class=p>(</span><span class=s2>&#34;100%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>backgroundColor</span><span class=p>(</span><span class=s2>&#34;#F1F2F3&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 构建函数
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kd>@Builder</span> <span class=nx>DeleteButton</span><span class=p>(</span><span class=nx>index</span>: <span class=kt>number</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>Text</span><span class=p>(</span><span class=s2>&#34;Del&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>fontColor</span><span class=p>(</span><span class=nx>Color</span><span class=p>.</span><span class=nx>White</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>padding</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>backgroundColor</span><span class=p>(</span><span class=nx>Color</span><span class=p>.</span><span class=nx>Red</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>borderRadius</span><span class=p>(</span><span class=s2>&#34;50%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>margin</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>onClick</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>task</span><span class=p>.</span><span class=nx>splice</span><span class=p>(</span><span class=nx>index</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>handTaskChange</span><span class=p>()</span>
</span></span><span class=line><span class=cl>      <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>@Component</span>
</span></span><span class=line><span class=cl><span class=nx>struct</span> <span class=nx>TaskStatistics</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>@Prop</span> <span class=nx>finishTask</span>: <span class=kt>number</span>
</span></span><span class=line><span class=cl>  <span class=kd>@Prop</span> <span class=nx>totalTask</span>: <span class=kt>number</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>build() {</span>
</span></span><span class=line><span class=cl>    <span class=nx>Row() {</span>
</span></span><span class=line><span class=cl>      <span class=nx>Text</span><span class=p>(</span><span class=s2>&#34;任务进度: &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>fontSize</span><span class=p>(</span><span class=mi>30</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>fontWeight</span><span class=p>(</span><span class=nx>FontWeight</span><span class=p>.</span><span class=nx>Bold</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=nx>Stack() {</span>
</span></span><span class=line><span class=cl>        <span class=nx>Progress</span><span class=p>({</span>
</span></span><span class=line><span class=cl>          <span class=nx>value</span>: <span class=kt>this.finishTask</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>total</span>: <span class=kt>this.totalTask</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=kr>type</span><span class=o>:</span> <span class=nx>ProgressType</span><span class=p>.</span><span class=nx>Ring</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>          <span class=p>.</span><span class=nx>width</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nx>Row() {</span>
</span></span><span class=line><span class=cl>          <span class=nx>Text</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>finishTask</span><span class=p>.</span><span class=nx>toString</span><span class=p>())</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=nx>fontSize</span><span class=p>(</span><span class=mi>24</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=nx>fontColor</span><span class=p>(</span><span class=s2>&#34;#36D&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=nx>Text</span><span class=p>(</span><span class=s2>&#34;/&#34;</span> <span class=o>+</span> <span class=k>this</span><span class=p>.</span><span class=nx>totalTask</span><span class=p>.</span><span class=nx>toString</span><span class=p>())</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=nx>fontSize</span><span class=p>(</span><span class=mi>24</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>card</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>margin</span><span class=p>({</span> <span class=nx>top</span>: <span class=kt>20</span><span class=p>,</span> <span class=nx>bottom</span>: <span class=kt>10</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>justifyContent</span><span class=p>(</span><span class=nx>FlexAlign</span><span class=p>.</span><span class=nx>SpaceEvenly</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>@Component</span>
</span></span><span class=line><span class=cl><span class=nx>struct</span> <span class=nx>itemChild</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>@ObjectLink</span> <span class=nx>item</span>: <span class=kt>Task</span>
</span></span><span class=line><span class=cl>  <span class=nx>onTaskChanged</span><span class=o>:</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=k>void</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>build</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>    <span class=nx>Row() {</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>item</span><span class=p>.</span><span class=nx>finished</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>Text</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>item</span><span class=p>.</span><span class=nx>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=p>.</span><span class=nx>finishedTask</span><span class=p>()</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>Text</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>item</span><span class=p>.</span><span class=nx>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=nx>Checkbox</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>select</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>item</span><span class=p>.</span><span class=nx>finished</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>onChange</span><span class=p>(</span><span class=nx>value</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=k>this</span><span class=p>.</span><span class=nx>item</span><span class=p>.</span><span class=nx>finished</span> <span class=o>=</span> <span class=nx>value</span>
</span></span><span class=line><span class=cl>          <span class=k>this</span><span class=p>.</span><span class=nx>onTaskChanged</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>card</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>justifyContent</span><span class=p>(</span><span class=nx>FlexAlign</span><span class=p>.</span><span class=nx>SpaceBetween</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=动画>动画<a hidden class=anchor aria-hidden=true href=#动画>#</a></h2><h3 id=基础通知>基础通知<a hidden class=anchor aria-hidden=true href=#基础通知>#</a></h3><p><a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V3/notification-guidelines-0000001281360946-V3 target=_blank>https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V3/notification-guidelines-0000001281360946-V3</a></p><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202405062126248.png><img src=https://qiniu.waite.wang/202405062126248.png alt=image-20240506212640352></a></div></p><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202405062127967.png><img src=https://qiniu.waite.wang/202405062127967.png alt=image-20240506212749996></a></div></p><p><a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V3/js-apis-notification-0000001333321097-V3 target=_blank>https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V3/js-apis-notification-0000001333321097-V3</a></p><table><thead><tr><th>名称</th><th>值</th><th>说明</th></tr></thead><tbody><tr><td>NOTIFICATION_CONTENT_BASIC_TEXT</td><td>ContentType</td><td>普通类型通知。</td></tr><tr><td>NOTIFICATION_CONTENT_LONG_TEXT</td><td>ContentType</td><td>长文本类型通知。</td></tr><tr><td>NOTIFICATION_CONTENT_PICTURE</td><td>ContentType</td><td>图片类型通知。</td></tr><tr><td>NOTIFICATION_CONTENT_CONVERSATION</td><td>ContentType</td><td>社交类型通知。</td></tr><tr><td>NOTIFICATION_CONTENT_MULTILINE</td><td>ContentType</td><td>多行文本类型通知。</td></tr></tbody></table><p><strong>系统能力</strong>：以下各项对应的系统能力均为SystemCapability.Notification.Notification</p><table><thead><tr><th>名称</th><th>可读</th><th>可写</th><th>类型</th><th>必填</th><th>描述</th></tr></thead><tbody><tr><td>content</td><td>是</td><td>是</td><td><a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V3/js-apis-notification-0000001333321097-V3#ZH-CN_TOPIC_0000001333321097__notificationcontent target=_blank>NotificationContent</a></td><td>是</td><td>通知内容。</td></tr><tr><td>id</td><td>是</td><td>是</td><td>number</td><td>否</td><td>通知ID。</td></tr><tr><td>slotType</td><td>是</td><td>是</td><td><a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V3/js-apis-notification-0000001333321097-V3#ZH-CN_TOPIC_0000001333321097__slottype target=_blank>SlotType</a></td><td>否</td><td>通道类型。</td></tr><tr><td>isOngoing</td><td>是</td><td>是</td><td>boolean</td><td>否</td><td>是否进行时通知。</td></tr><tr><td>isUnremovable</td><td>是</td><td>是</td><td>boolean</td><td>否</td><td>是否可移除。</td></tr><tr><td>deliveryTime</td><td>是</td><td>是</td><td>number</td><td>否</td><td>通知发送时间。</td></tr><tr><td>tapDismissed</td><td>是</td><td>是</td><td>boolean</td><td>否</td><td>通知是否自动清除。</td></tr><tr><td>autoDeletedTime</td><td>是</td><td>是</td><td>number</td><td>否</td><td>自动清除的时间。</td></tr><tr><td>wantAgent</td><td>是</td><td>是</td><td>WantAgent</td><td>否</td><td>点击跳转的WantAgent。</td></tr><tr><td>extraInfo</td><td>是</td><td>是</td><td>{[key: string]: any}</td><td>否</td><td>扩展参数。</td></tr><tr><td>color</td><td>是</td><td>是</td><td>number</td><td>否</td><td>通知背景颜色。</td></tr><tr><td>colorEnabled</td><td>是</td><td>是</td><td>boolean</td><td>否</td><td>通知背景颜色是否使能。</td></tr><tr><td>isAlertOnce</td><td>是</td><td>是</td><td>boolean</td><td>否</td><td>设置是否仅有一次此通知警报。</td></tr><tr><td>isStopwatch</td><td>是</td><td>是</td><td>boolean</td><td>否</td><td>是否显示已用时间。</td></tr><tr><td>isCountDown</td><td>是</td><td>是</td><td>boolean</td><td>否</td><td>是否显示倒计时时间。</td></tr><tr><td>isFloatingIcon</td><td>是</td><td>是</td><td>boolean</td><td>否</td><td>是否显示状态栏图标。</td></tr><tr><td>label</td><td>是</td><td>是</td><td>string</td><td>否</td><td>通知标签。</td></tr><tr><td>badgeIconStyle</td><td>是</td><td>是</td><td>number</td><td>否</td><td>通知角标类型。</td></tr><tr><td>showDeliveryTime</td><td>是</td><td>是</td><td>boolean</td><td>否</td><td>是否显示分发时间。</td></tr><tr><td>actionButtons</td><td>是</td><td>是</td><td>Array&lt;
<a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V3/js-apis-notification-0000001333321097-V3#ZH-CN_TOPIC_0000001333321097__notificationactionbutton target=_blank>NotificationActionButton</a>></td><td>否</td><td>通知按钮，最多两个按钮。</td></tr><tr><td>smallIcon</td><td>是</td><td>是</td><td>PixelMap</td><td>否</td><td>通知小图标。</td></tr><tr><td>largeIcon</td><td>是</td><td>是</td><td>PixelMap</td><td>否</td><td>通知大图标。</td></tr><tr><td>creatorBundleName</td><td>是</td><td>否</td><td>string</td><td>否</td><td>创建通知的包名。</td></tr><tr><td>creatorUid</td><td>是</td><td>否</td><td>number</td><td>否</td><td>创建通知的UID。</td></tr><tr><td>creatorPid</td><td>是</td><td>否</td><td>number</td><td>否</td><td>创建通知的PID。</td></tr><tr><td>creatorUserId8+</td><td>是</td><td>否</td><td>number</td><td>否</td><td>创建通知的UserId。</td></tr><tr><td>hashCode</td><td>是</td><td>否</td><td>string</td><td>否</td><td>通知唯一标识。</td></tr><tr><td>groupName8+</td><td>是</td><td>是</td><td>string</td><td>否</td><td>组通知名称。</td></tr><tr><td>template8+</td><td>是</td><td>是</td><td><a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V3/js-apis-notification-0000001333321097-V3#ZH-CN_TOPIC_0000001333321097__notificationtemplate8 target=_blank>NotificationTemplate</a></td><td>否</td><td>通知模板。</td></tr><tr><td>distributedOption8+</td><td>是</td><td>是</td><td><a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V3/js-apis-notification-0000001333321097-V3#ZH-CN_TOPIC_0000001333321097__distributedoptions8 target=_blank>DistributedOptions</a></td><td>否</td><td>分布式通知的选项。</td></tr><tr><td>notificationFlags8+</td><td>是</td><td>否</td><td><a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V3/js-apis-notification-0000001333321097-V3#ZH-CN_TOPIC_0000001333321097__notificationflags8 target=_blank>NotificationFlags</a></td><td>否</td><td>获取NotificationFlags。</td></tr></tbody></table><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202405062132587.png><img src=https://qiniu.waite.wang/202405062132587.png alt=image-20240506213240105></a></div></p><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202405062234933.png><img src=https://qiniu.waite.wang/202405062234933.png alt=image-20240506223426686></a></div></p><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202405062234804.png><img src=https://qiniu.waite.wang/202405062234804.png alt=image-20240506223438334></a></div></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-tsx data-lang=tsx><span class=line><span class=cl><span class=kr>import</span> <span class=nx>notify</span> <span class=kr>from</span> <span class=s1>&#39;@ohos.notificationManager&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>image</span> <span class=kr>from</span> <span class=s1>&#39;@ohos.multimedia.image&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>@Entry</span>
</span></span><span class=line><span class=cl><span class=kd>@Component</span>
</span></span><span class=line><span class=cl><span class=nx>struct</span> <span class=nx>Index</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 全局任务 id
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>idx</span>: <span class=kt>number</span> <span class=o>=</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 图像
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>pixel</span>: <span class=kt>PixelMap</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>aboutToAppear() {</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 获取资源管理器
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>let</span> <span class=nx>rm</span> <span class=o>=</span> <span class=nx>getContext</span><span class=p>(</span><span class=k>this</span><span class=p>).</span><span class=nx>resourceManager</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 读取图片
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>let</span> <span class=nx>file</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>rm</span><span class=p>.</span><span class=nx>getMediaContent</span><span class=p>(</span><span class=nx>$r</span><span class=p>(</span><span class=s1>&#39;app.media.watchGT4&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 创建 PixelMap
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>image</span><span class=p>.</span><span class=nx>createImageSource</span><span class=p>(</span><span class=nx>file</span><span class=p>.</span><span class=nx>buffer</span><span class=p>).</span><span class=nx>createPixelMap</span><span class=p>()</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>value</span> <span class=o>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>pixel</span> <span class=o>=</span> <span class=nx>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=nx>reason</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>reason</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>build() {</span>
</span></span><span class=line><span class=cl>    <span class=nx>Column</span><span class=p>({</span> <span class=nx>space</span>: <span class=kt>10</span> <span class=p>})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>Button</span><span class=p>(</span><span class=sb>`发送normalText通知`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>onClick</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>publishNormalTextNotification</span><span class=p>())</span>
</span></span><span class=line><span class=cl>      <span class=nx>Button</span><span class=p>(</span><span class=sb>`发送longText通知`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>onClick</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>publishLongTextNotification</span><span class=p>())</span>
</span></span><span class=line><span class=cl>      <span class=nx>Button</span><span class=p>(</span><span class=sb>`发送multiLine通知`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>onClick</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>publishMultiLineNotification</span><span class=p>())</span>
</span></span><span class=line><span class=cl>      <span class=nx>Button</span><span class=p>(</span><span class=sb>`发送Picture通知`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>onClick</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>publishPictureNotification</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>width</span><span class=p>(</span><span class=s1>&#39;100%&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>publishNormalTextNotification() {</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>request</span>: <span class=kt>notify.NotificationRequest</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>id</span>: <span class=kt>this.idx</span><span class=o>++</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>content</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>contentType</span>: <span class=kt>notify.ContentType.NOTIFICATION_CONTENT_BASIC_TEXT</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>normal</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>title</span><span class=o>:</span> <span class=s1>&#39;通知标题&#39;</span> <span class=o>+</span> <span class=k>this</span><span class=p>.</span><span class=nx>idx</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>text</span><span class=o>:</span> <span class=s1>&#39;通知内容详情&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>additionalText</span><span class=o>:</span> <span class=s1>&#39;通知附加内容&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nx>showDeliveryTime</span>: <span class=kt>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>deliveryTime</span>: <span class=kt>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>getTime</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>      <span class=nx>groupName</span><span class=o>:</span> <span class=s1>&#39;wechat&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>slotType</span>: <span class=kt>notify.SlotType.SOCIAL_COMMUNICATION</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span><span class=nx>request</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>publishLongTextNotification() {</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>request</span>: <span class=kt>notify.NotificationRequest</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>id</span>: <span class=kt>this.idx</span><span class=o>++</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>content</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>contentType</span>: <span class=kt>notify.ContentType.NOTIFICATION_CONTENT_LONG_TEXT</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>longText</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>title</span><span class=o>:</span> <span class=s1>&#39;通知标题&#39;</span> <span class=o>+</span> <span class=k>this</span><span class=p>.</span><span class=nx>idx</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>text</span><span class=o>:</span> <span class=s1>&#39;通知内容详情&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>additionalText</span><span class=o>:</span> <span class=s1>&#39;通知附加内容&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>longText</span><span class=o>:</span> <span class=s1>&#39;通知中的长文本，我很长，我很长，我很长，我很长，我很长，我很长，我很长&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>briefText</span><span class=o>:</span> <span class=s1>&#39;通知概要和总结&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>expandedTitle</span><span class=o>:</span> <span class=s1>&#39;通知展开时的标题&#39;</span> <span class=o>+</span> <span class=k>this</span><span class=p>.</span><span class=nx>idx</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span><span class=nx>request</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>publishMultiLineNotification() {</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>request</span>: <span class=kt>notify.NotificationRequest</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>id</span>: <span class=kt>this.idx</span><span class=o>++</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>content</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>contentType</span>: <span class=kt>notify.ContentType.NOTIFICATION_CONTENT_MULTILINE</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>multiLine</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>title</span><span class=o>:</span> <span class=s1>&#39;通知标题&#39;</span> <span class=o>+</span> <span class=k>this</span><span class=p>.</span><span class=nx>idx</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>text</span><span class=o>:</span> <span class=s1>&#39;通知内容详情&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>additionalText</span><span class=o>:</span> <span class=s1>&#39;通知附加内容&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>briefText</span><span class=o>:</span> <span class=s1>&#39;通知概要和总结&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>longTitle</span><span class=o>:</span> <span class=s1>&#39;展开时的标题，我很宽，我很宽，我很宽&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>lines</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;第一行&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;第二行&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;第三行&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;第四行&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span><span class=nx>request</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>publishPictureNotification() {</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>request</span>: <span class=kt>notify.NotificationRequest</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>id</span>: <span class=kt>this.idx</span><span class=o>++</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>content</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>contentType</span>: <span class=kt>notify.ContentType.NOTIFICATION_CONTENT_PICTURE</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>picture</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>title</span><span class=o>:</span> <span class=s1>&#39;通知标题&#39;</span> <span class=o>+</span> <span class=k>this</span><span class=p>.</span><span class=nx>idx</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>text</span><span class=o>:</span> <span class=s1>&#39;通知内容详情&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>additionalText</span><span class=o>:</span> <span class=s1>&#39;通知附加内容&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>briefText</span><span class=o>:</span> <span class=s1>&#39;通知概要和总结&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>expandedTitle</span><span class=o>:</span> <span class=s1>&#39;展开后标题&#39;</span> <span class=o>+</span> <span class=k>this</span><span class=p>.</span><span class=nx>idx</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>picture</span>: <span class=kt>this.pixel</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span><span class=nx>request</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>private</span> <span class=nx>publish</span><span class=p>(</span><span class=nx>request</span>: <span class=kt>notify.NotificationRequest</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>notify</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span><span class=nx>request</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>then</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;notify test&#39;</span><span class=p>,</span> <span class=s1>&#39;发送通知成功&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>reason</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;notify test&#39;</span><span class=p>,</span> <span class=s1>&#39;发送通知失败&#39;</span><span class=p>,</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>reason</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=进度条通知>进度条通知<a hidden class=anchor aria-hidden=true href=#进度条通知>#</a></h3><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202405070825635.png><img src=https://qiniu.waite.wang/202405070825635.png alt=image-20240507082507831></a></div></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-tsx data-lang=tsx><span class=line><span class=cl><span class=kr>import</span> <span class=nx>Notification</span> <span class=kr>from</span> <span class=s1>&#39;@ohos.notificationManager&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>wantAgent</span><span class=p>,</span> <span class=p>{</span> <span class=nx>WantAgent</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;@ohos.app.ability.wantAgent&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>promptAction</span> <span class=kr>from</span> <span class=s1>&#39;@ohos.promptAction&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>Prompt</span> <span class=kr>from</span> <span class=s1>&#39;@system.prompt&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>enum</span> <span class=nx>DownloadState</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>NOT_BEGIN</span> <span class=o>=</span> <span class=s1>&#39;未开始&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>DOWNLOADING</span> <span class=o>=</span> <span class=s1>&#39;下载中&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>PAUSE</span> <span class=o>=</span> <span class=s1>&#39;已暂停&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>FINISHED</span> <span class=o>=</span> <span class=s1>&#39;已完成&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>@Entry</span>
</span></span><span class=line><span class=cl><span class=kd>@Component</span>
</span></span><span class=line><span class=cl><span class=nx>struct</span> <span class=nx>Index</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 下载进度
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kd>@State</span> <span class=nx>progressValue</span>: <span class=kt>number</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>  <span class=nx>progressMaxValue</span>: <span class=kt>number</span> <span class=o>=</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 任务状态
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kd>@State</span> <span class=nx>state</span>: <span class=kt>DownloadState</span> <span class=o>=</span> <span class=nx>DownloadState</span><span class=p>.</span><span class=nx>NOT_BEGIN</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 下载的文件名
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>filename</span>: <span class=kt>string</span> <span class=o>=</span> <span class=s1>&#39;圣诞星.mp4&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 模拟下载的任务的id
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>taskId</span>: <span class=kt>number</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 通知id
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>notificationId</span>: <span class=kt>number</span> <span class=o>=</span> <span class=mi>999</span>
</span></span><span class=line><span class=cl>  <span class=nx>isSupport</span>: <span class=kt>boolean</span> <span class=o>=</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>  <span class=nx>wantAgentInstance</span>: <span class=kt>WantAgent</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>aboutToAppear() {</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 1.判断当前系统是否支持进度条模板
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>this</span><span class=p>.</span><span class=nx>isSupport</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>Notification</span><span class=p>.</span><span class=nx>isSupportTemplate</span><span class=p>(</span><span class=s1>&#39;downloadTemplate&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 2.创建拉取当前应用的行为意图
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// 2.1.创建wantInfo信息
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>let</span> <span class=nx>wantInfo</span>: <span class=kt>wantAgent.WantAgentInfo</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>wants</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>bundleName</span><span class=o>:</span> <span class=s1>&#39;com.example.myapplication&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>abilityName</span><span class=o>:</span> <span class=s1>&#39;EntryAbility&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nx>requestCode</span>: <span class=kt>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>operationType</span>: <span class=kt>wantAgent.OperationType.START_ABILITY</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>wantAgentFlags</span><span class=o>:</span> <span class=p>[</span><span class=nx>wantAgent</span><span class=p>.</span><span class=nx>WantAgentFlags</span><span class=p>.</span><span class=nx>CONSTANT_FLAG</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 2.2.创建wantAgent实例
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>this</span><span class=p>.</span><span class=nx>wantAgentInstance</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>wantAgent</span><span class=p>.</span><span class=nx>getWantAgent</span><span class=p>(</span><span class=nx>wantInfo</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>build() {</span>
</span></span><span class=line><span class=cl>    <span class=nx>Row</span><span class=p>({</span> <span class=nx>space</span>: <span class=kt>10</span> <span class=p>})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>Image</span><span class=p>(</span><span class=nx>$r</span><span class=p>(</span><span class=s1>&#39;app.media.ic_files_video&#39;</span><span class=p>)).</span><span class=nx>width</span><span class=p>(</span><span class=mi>50</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=nx>Column</span><span class=p>({</span> <span class=nx>space</span>: <span class=kt>5</span> <span class=p>})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>Row() {</span>
</span></span><span class=line><span class=cl>          <span class=nx>Text</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>filename</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=nx>Text</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>progressValue</span><span class=si>}</span><span class=sb>%`</span><span class=p>).</span><span class=nx>fontColor</span><span class=p>(</span><span class=s1>&#39;#c1c2c1&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>width</span><span class=p>(</span><span class=s1>&#39;100%&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>justifyContent</span><span class=p>(</span><span class=nx>FlexAlign</span><span class=p>.</span><span class=nx>SpaceBetween</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nx>Progress</span><span class=p>({</span>
</span></span><span class=line><span class=cl>          <span class=nx>value</span>: <span class=kt>this.progressValue</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>total</span>: <span class=kt>this.progressMaxValue</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nx>Row</span><span class=p>({</span> <span class=nx>space</span>: <span class=kt>5</span> <span class=p>})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>Text</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>progressValue</span> <span class=o>*</span> <span class=mf>0.43</span><span class=p>).</span><span class=nx>toFixed</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span><span class=si>}</span><span class=sb>MB`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=nx>fontSize</span><span class=p>(</span><span class=mi>14</span><span class=p>).</span><span class=nx>fontColor</span><span class=p>(</span><span class=s1>&#39;#c1c2c1&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=nx>Blank</span><span class=p>()</span>
</span></span><span class=line><span class=cl>          <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>state</span> <span class=o>===</span> <span class=nx>DownloadState</span><span class=p>.</span><span class=nx>NOT_BEGIN</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>Button</span><span class=p>(</span><span class=s1>&#39;开始&#39;</span><span class=p>).</span><span class=nx>downloadButton</span><span class=p>()</span>
</span></span><span class=line><span class=cl>              <span class=p>.</span><span class=nx>onClick</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>download</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>          <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>state</span> <span class=o>===</span> <span class=nx>DownloadState</span><span class=p>.</span><span class=nx>DOWNLOADING</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>Button</span><span class=p>(</span><span class=s1>&#39;取消&#39;</span><span class=p>).</span><span class=nx>downloadButton</span><span class=p>().</span><span class=nx>backgroundColor</span><span class=p>(</span><span class=s1>&#39;#d1d2d3&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>              <span class=p>.</span><span class=nx>onClick</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>cancel</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=nx>Button</span><span class=p>(</span><span class=s1>&#39;暂停&#39;</span><span class=p>).</span><span class=nx>downloadButton</span><span class=p>()</span>
</span></span><span class=line><span class=cl>              <span class=p>.</span><span class=nx>onClick</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>pause</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>          <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>state</span> <span class=o>===</span> <span class=nx>DownloadState</span><span class=p>.</span><span class=nx>PAUSE</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>Button</span><span class=p>(</span><span class=s1>&#39;取消&#39;</span><span class=p>).</span><span class=nx>downloadButton</span><span class=p>().</span><span class=nx>backgroundColor</span><span class=p>(</span><span class=s1>&#39;#d1d2d3&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>              <span class=p>.</span><span class=nx>onClick</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>cancel</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=nx>Button</span><span class=p>(</span><span class=s1>&#39;继续&#39;</span><span class=p>).</span><span class=nx>downloadButton</span><span class=p>()</span>
</span></span><span class=line><span class=cl>              <span class=p>.</span><span class=nx>onClick</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>download</span><span class=p>())</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>Button</span><span class=p>(</span><span class=s1>&#39;打开&#39;</span><span class=p>).</span><span class=nx>downloadButton</span><span class=p>()</span>
</span></span><span class=line><span class=cl>              <span class=p>.</span><span class=nx>onClick</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>open</span><span class=p>())</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}.</span><span class=nx>width</span><span class=p>(</span><span class=s1>&#39;100%&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>layoutWeight</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>width</span><span class=p>(</span><span class=s1>&#39;100%&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>borderRadius</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>padding</span><span class=p>(</span><span class=mi>15</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>backgroundColor</span><span class=p>(</span><span class=nx>Color</span><span class=p>.</span><span class=nx>White</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>cancel() {</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 取消定时任务
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>taskId</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>clearInterval</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>taskId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>taskId</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>notificationId</span><span class=p>.</span><span class=nx>toString</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 清理下载任务进度
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>this</span><span class=p>.</span><span class=nx>progressValue</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 标记任务状态：未开始
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>this</span><span class=p>.</span><span class=nx>state</span> <span class=o>=</span> <span class=nx>DownloadState</span><span class=p>.</span><span class=nx>NOT_BEGIN</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 取消通知
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>Notification</span><span class=p>.</span><span class=nx>cancel</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>notificationId</span><span class=p>).</span><span class=nx>then</span><span class=p>((</span><span class=nx>response</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;ssssss&#39;</span><span class=p>,</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>response</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>download() {</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 清理旧任务
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>taskId</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>clearInterval</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>taskId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 开启定时任务，模拟下载
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>this</span><span class=p>.</span><span class=nx>taskId</span> <span class=o>=</span> <span class=nx>setInterval</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 判断任务进度是否达到100
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>progressValue</span> <span class=o>&gt;=</span> <span class=mi>100</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 任务完成了，应该取消定时任务
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>clearInterval</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>taskId</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>taskId</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 并且标记任务状态为已完成
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>this</span><span class=p>.</span><span class=nx>state</span> <span class=o>=</span> <span class=nx>DownloadState</span><span class=p>.</span><span class=nx>FINISHED</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 发送通知
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>this</span><span class=p>.</span><span class=nx>publishProgressNotification</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 模拟任务进度变更
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>this</span><span class=p>.</span><span class=nx>progressValue</span> <span class=o>+=</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 发送通知
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>this</span><span class=p>.</span><span class=nx>publishProgressNotification</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span> <span class=mi>500</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 标记任务状态：下载中
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>this</span><span class=p>.</span><span class=nx>state</span> <span class=o>=</span> <span class=nx>DownloadState</span><span class=p>.</span><span class=nx>DOWNLOADING</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>pause() {</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 取消定时任务
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>taskId</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>clearInterval</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>taskId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>taskId</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 标记任务状态：已暂停
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>this</span><span class=p>.</span><span class=nx>state</span> <span class=o>=</span> <span class=nx>DownloadState</span><span class=p>.</span><span class=nx>PAUSE</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 发送通知
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>this</span><span class=p>.</span><span class=nx>publishProgressNotification</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>open() {</span>
</span></span><span class=line><span class=cl>    <span class=nx>promptAction</span><span class=p>.</span><span class=nx>showToast</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;功能未实现&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>publishProgressNotification() {</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>isSupportTpl</span>: <span class=kt>boolean</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>await</span> <span class=nx>Notification</span><span class=p>.</span><span class=nx>isSupportTemplate</span><span class=p>(</span><span class=s1>&#39;downloadTemplate&#39;</span><span class=p>).</span><span class=nx>then</span><span class=p>((</span><span class=nx>data</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>isSupportTpl</span> <span class=o>=</span> <span class=nx>data</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}).</span><span class=k>catch</span><span class=p>((</span><span class=nx>err</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>Prompt</span><span class=p>.</span><span class=nx>showToast</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>message</span><span class=o>:</span> <span class=sb>`判断是否支持进度条模板时报错,error[</span><span class=si>${</span><span class=nx>err</span><span class=si>}</span><span class=sb>]`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>duration</span>: <span class=kt>2000</span>
</span></span><span class=line><span class=cl>      <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>isSupportTpl</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 构造模板
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kd>let</span> <span class=nx>template</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;downloadTemplate&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>data</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>progressValue</span>: <span class=kt>this.progressValue</span><span class=p>,</span> <span class=c1>// 当前进度值
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=nx>progressMaxValue</span>: <span class=kt>this.progressMaxValue</span> <span class=c1>// 最大进度值
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=kd>let</span> <span class=nx>notificationRequest</span>: <span class=kt>Notification.NotificationRequest</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>id</span>: <span class=kt>this.notificationId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>content</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>contentType</span>: <span class=kt>Notification.ContentType.NOTIFICATION_CONTENT_BASIC_TEXT</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>normal</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>title</span>: <span class=kt>this.filename</span> <span class=o>+</span> <span class=s1>&#39;:  &#39;</span> <span class=o>+</span> <span class=k>this</span><span class=p>.</span><span class=nx>state</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>text</span><span class=o>:</span> <span class=s1>&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>additionalText</span>: <span class=kt>this.progressValue</span> <span class=o>+</span> <span class=s1>&#39;%&#39;</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=nx>template</span>: <span class=kt>template</span>
</span></span><span class=line><span class=cl>      <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=c1>// 发布通知
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>Notification</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span><span class=nx>notificationRequest</span><span class=p>).</span><span class=nx>then</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>Prompt</span><span class=p>.</span><span class=nx>showToast</span><span class=p>({</span>
</span></span><span class=line><span class=cl>          <span class=nx>message</span><span class=o>:</span> <span class=sb>`发布通知成功！`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>duration</span>: <span class=kt>2000</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>      <span class=p>}).</span><span class=k>catch</span><span class=p>((</span><span class=nx>err</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>Prompt</span><span class=p>.</span><span class=nx>showToast</span><span class=p>({</span>
</span></span><span class=line><span class=cl>          <span class=nx>message</span><span class=o>:</span> <span class=sb>`发布通知失败,error[</span><span class=si>${</span><span class=nx>err</span><span class=si>}</span><span class=sb>]`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>duration</span>: <span class=kt>2000</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>      <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>Prompt</span><span class=p>.</span><span class=nx>showToast</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;不支持downloadTemplate进度条通知模板&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>duration</span>: <span class=kt>2000</span>
</span></span><span class=line><span class=cl>      <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>publishDownloadNotification() {</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 1.判断当前系统是否支持进度条模板
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=k>this</span><span class=p>.</span><span class=nx>isSupport</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 当前系统不支持进度条模板
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;not support&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 2.准备进度条模板的参数
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>let</span> <span class=nx>template</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;downloadTemplate&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>data</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>progressValue</span>: <span class=kt>this.progressValue</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>progressMaxValue</span>: <span class=kt>this.progressMaxValue</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>request</span>: <span class=kt>Notification.NotificationRequest</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>id</span>: <span class=kt>this.notificationId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>template</span>: <span class=kt>template</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>wantAgent</span>: <span class=kt>this.wantAgentInstance</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>content</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>contentType</span>: <span class=kt>Notification.ContentType.NOTIFICATION_CONTENT_BASIC_TEXT</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>normal</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>title</span>: <span class=kt>this.filename</span> <span class=o>+</span> <span class=s1>&#39;:  &#39;</span> <span class=o>+</span> <span class=k>this</span><span class=p>.</span><span class=nx>state</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>text</span><span class=o>:</span> <span class=s1>&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>additionalText</span>: <span class=kt>this.progressValue</span> <span class=o>+</span> <span class=s1>&#39;%&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 3.发送通知
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>Notification</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span><span class=nx>request</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>then</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;test&#39;</span><span class=p>,</span> <span class=s1>&#39;通知发送成功&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=nx>reason</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;test&#39;</span><span class=p>,</span> <span class=s1>&#39;通知发送失败！&#39;</span><span class=p>,</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>reason</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>@Extend</span><span class=p>(</span><span class=nx>Button</span><span class=p>)</span> <span class=kd>function</span> <span class=nx>downloadButton() {</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>width</span><span class=p>(</span><span class=mi>75</span><span class=p>).</span><span class=nx>height</span><span class=p>(</span><span class=mi>28</span><span class=p>).</span><span class=nx>fontSize</span><span class=p>(</span><span class=mi>14</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=通知意图>通知意图<a hidden class=anchor aria-hidden=true href=#通知意图>#</a></h3><blockquote><p>具体参数看官方文档</p></blockquote><p><a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V2/js-apis-app-ability-wantagent-0000001493424324-V2 target=_blank>https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V2/js-apis-app-ability-wantagent-0000001493424324-V2</a></p><p>​<div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202405070915916.png><img src=https://qiniu.waite.wang/202405070915916.png alt=image-20240507091512134></a></div></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-tsx data-lang=tsx><span class=line><span class=cl><span class=kr>async</span> <span class=nx>aboutToAppear() {</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 1.判断当前系统是否支持进度条模板
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>this</span><span class=p>.</span><span class=nx>isSupport</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>Notification</span><span class=p>.</span><span class=nx>isSupportTemplate</span><span class=p>(</span><span class=s1>&#39;downloadTemplate&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 2.创建拉取当前应用的行为意图
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// 2.1.创建wantInfo信息
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kd>let</span> <span class=nx>wantInfo</span>: <span class=kt>wantAgent.WantAgentInfo</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>wants</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>bundleName</span><span class=o>:</span> <span class=s1>&#39;com.example.learn_2&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>abilityName</span><span class=o>:</span> <span class=s1>&#39;EntryAbility&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=nx>requestCode</span>: <span class=kt>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>operationType</span>: <span class=kt>wantAgent.OperationType.START_ABILITY</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>wantAgentFlags</span><span class=o>:</span> <span class=p>[</span><span class=nx>wantAgent</span><span class=p>.</span><span class=nx>WantAgentFlags</span><span class=p>.</span><span class=nx>CONSTANT_FLAG</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 2.2.创建wantAgent实例
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>this</span><span class=p>.</span><span class=nx>wantAgentInstance</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>wantAgent</span><span class=p>.</span><span class=nx>getWantAgent</span><span class=p>(</span><span class=nx>wantInfo</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-tsx data-lang=tsx><span class=line><span class=cl><span class=kr>async</span> <span class=nx>publishProgressNotification() {</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>isSupportTpl</span>: <span class=kt>boolean</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>await</span> <span class=nx>Notification</span><span class=p>.</span><span class=nx>isSupportTemplate</span><span class=p>(</span><span class=s1>&#39;downloadTemplate&#39;</span><span class=p>).</span><span class=nx>then</span><span class=p>((</span><span class=nx>data</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>isSupportTpl</span> <span class=o>=</span> <span class=nx>data</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}).</span><span class=k>catch</span><span class=p>((</span><span class=nx>err</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>Prompt</span><span class=p>.</span><span class=nx>showToast</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>message</span><span class=o>:</span> <span class=sb>`判断是否支持进度条模板时报错,error[</span><span class=si>${</span><span class=nx>err</span><span class=si>}</span><span class=sb>]`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>duration</span>: <span class=kt>2000</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>isSupportTpl</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 构造模板
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>let</span> <span class=nx>template</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;downloadTemplate&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>data</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>progressValue</span>: <span class=kt>this.progressValue</span><span class=p>,</span> <span class=c1>// 当前进度值
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>progressMaxValue</span>: <span class=kt>this.progressMaxValue</span> <span class=c1>// 最大进度值
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>notificationRequest</span>: <span class=kt>Notification.NotificationRequest</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>id</span>: <span class=kt>this.notificationId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>wantAgent</span>: <span class=kt>this.wantAgentInstance</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>content</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>contentType</span>: <span class=kt>Notification.ContentType.NOTIFICATION_CONTENT_BASIC_TEXT</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>normal</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>title</span>: <span class=kt>this.filename</span> <span class=o>+</span> <span class=s1>&#39;:  &#39;</span> <span class=o>+</span> <span class=k>this</span><span class=p>.</span><span class=nx>state</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>text</span><span class=o>:</span> <span class=s1>&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>additionalText</span>: <span class=kt>this.progressValue</span> <span class=o>+</span> <span class=s1>&#39;%&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nx>template</span>: <span class=kt>template</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 发布通知
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>Notification</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span><span class=nx>notificationRequest</span><span class=p>).</span><span class=nx>then</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>Prompt</span><span class=p>.</span><span class=nx>showToast</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>message</span><span class=o>:</span> <span class=sb>`发布通知成功！`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>duration</span>: <span class=kt>2000</span>
</span></span><span class=line><span class=cl>      <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>}).</span><span class=k>catch</span><span class=p>((</span><span class=nx>err</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>Prompt</span><span class=p>.</span><span class=nx>showToast</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>message</span><span class=o>:</span> <span class=sb>`发布通知失败,error[</span><span class=si>${</span><span class=nx>err</span><span class=si>}</span><span class=sb>]`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>duration</span>: <span class=kt>2000</span>
</span></span><span class=line><span class=cl>      <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>Prompt</span><span class=p>.</span><span class=nx>showToast</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;不支持downloadTemplate进度条通知模板&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>duration</span>: <span class=kt>2000</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://waite.wang/tags/harmony/>Harmony</a></li></ul><nav class=paginav><a class=prev href=https://waite.wang/posts/harmony/learn-harmony-3/><span class=title>« 上一页</span><br><span>鸿蒙学习笔记3</span>
</a><a class=next href=https://waite.wang/posts/harmony/learn-harmony-1/><span class=title>下一页 »</span><br><span>鸿蒙学习笔记1</span></a></nav></footer><script src=https://utteranc.es/client.js repo=Waite0603/HugoBlog issue-term=pathname theme=github-light crossorigin=anonymous async></script></article></main><footer class=footer><span><a href=https://beian.miit.gov.cn/ target=_blank rel="noopener noreferrer">粤 ICP 备 2022028437 号</a></span><br><span>Copyright &copy; 2018 - 2025 By <a href=https://waite.wang/>Waite</a>, All Rights
Reserved.</span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script src=/js/jquery-3.5.1.min.js></script><link rel=stylesheet href=/css/jquery.fancybox.min.css><script src=/js/jquery.fancybox.min.js></script></body></html>