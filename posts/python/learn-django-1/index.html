<!doctype html><html lang=zh-cn dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>初识 Django | 隶笔难书</title><meta name=keywords content="Django"><meta name=description content="Django 是一个高级的 Python Web 框架，它鼓励快速开发和干净、实用的设计。"><meta name=author content="Waite Wang"><link rel=canonical href=https://waite.wang/posts/python/learn-django-1/><link crossorigin=anonymous href=/assets/css/stylesheet.9041998fdbb56016f4b1f4eb6c4346ccbebb6a409fae7cac2f4b8a9b83badf70.css integrity="sha256-kEGZj9u1YBb0sfTrbENGzL67akCfrnysL0uKm4O633A=" rel="preload stylesheet" as=style><link rel=icon href=https://waite.wang/images/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://waite.wang/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://waite.wang/favicon-32x32.png><link rel=apple-touch-icon href=https://waite.wang/apple-touch-icon.png><link rel=mask-icon href=https://waite.wang/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh-cn href=https://waite.wang/posts/python/learn-django-1/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://waite.wang/posts/python/learn-django-1/"><meta property="og:site_name" content="隶笔难书"><meta property="og:title" content="初识 Django"><meta property="og:description" content="Django 是一个高级的 Python Web 框架，它鼓励快速开发和干净、实用的设计。"><meta property="og:locale" content="zh-cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-09-02T20:40:50+08:00"><meta property="article:modified_time" content="2024-01-02T20:40:50+08:00"><meta property="article:tag" content="Django"><meta name=twitter:card content="summary"><meta name=twitter:title content="初识 Django"><meta name=twitter:description content="Django 是一个高级的 Python Web 框架，它鼓励快速开发和干净、实用的设计。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://waite.wang/posts/"},{"@type":"ListItem","position":2,"name":"初识 Django","item":"https://waite.wang/posts/python/learn-django-1/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"初识 Django","name":"初识 Django","description":"Django 是一个高级的 Python Web 框架，它鼓励快速开发和干净、实用的设计。","keywords":["Django"],"articleBody":"认识 Django 简介 Django(发音:[`dʒæŋɡəʊ]) 也有的小伙伴读成 “酱狗”，“贱狗”，“进狗”，“撞狗”，甚至还有读成\"打 狗\"。 官方： https://www.djangoproject.com/ Django是一个高级的Python Web框架，可以快速开发安全和可维护的网站。由经验丰富的开发者构 建，Django负责处理网站开发中麻烦的部分，可以专注于编写应用程序，而无需重新开发。它是免费和 开源的，有活跃繁荣的社区，丰富的文档，以及很多免费和付费的解决方案。目前最新版本：5.0.1\n安装 pip安装：\npip install Django==5.0.1 -i https://pypi.tuna.tsinghua.edu.cn/simple 执行安装完成后，在python目录的Scripts下，会多出一个diango-admin.exe 这个是django项目创建工具\n当然同时Lib下的site-packages下，也会有一个django目录，这个是后面我们开发项目会用到的django开发包。\n项目创建与项目配置 Django5创建项目用命令方式 通过以下命令可以查看版本号：\n## python3 -V Python 3.9.7 ## python3 -m django --version 4.2.7 django-admin startproject 项目名称 Django5创建项目用PyCharm工具 目录结构 使用 django-admin 来创建 HelloWorld 项目：\ndjango-admin startproject HelloWorld 创建完成后我们可以查看下项目的目录结构：\n$ cd HelloWorld/ $ tree . |-- HelloWorld | |-- __init__.py | |-- asgi.py | |-- settings.py | |-- urls.py | `-- wsgi.py `-- manage.py 目录说明：\nHelloWorld: 项目的容器。 manage.py: 一个实用的命令行工具，可让你以各种方式与该 Django 项目进行交互。 HelloWorld/init.py: 一个空文件，告诉 Python 该目录是一个 Python 包。 HelloWorld/asgi.py: 一个 ASGI 兼容的 Web 服务器的入口，以便运行你的项目。 HelloWorld/settings.py: 该 Django 项目的设置/配置。 HelloWorld/urls.py: 该 Django 项目的 URL 声明; 一份由 Django 驱动的网站\"目录\"。 HelloWorld/wsgi.py: 一个 WSGI 兼容的 Web 服务器的入口，以便运行你的项目。 接下来我们进入 HelloWorld 目录输入以下命令，启动服务器：\npython3 manage.py runserver 0.0.0.0:8000 0.0.0.0 让其它电脑可连接到开发服务器，8000 为端口号。如果不说明，那么端口号默认为 8000。\n在浏览器输入你服务器的 ip（这里我们输入本机 IP 地址： 127.0.0.1:8000） 及端口号，如果正常启动，输出结果如下：\n视图和 URL 配置 在先前创建的 HelloWorld 目录下的 HelloWorld 目录新建一个 views.py 文件，并输入代码：\nfrom django.http import HttpResponse def hello(request): return HttpResponse(\"Hello world ! \") 接着，绑定 URL 与视图函数。打开 urls.py 文件，删除原来代码，将以下代码复制粘贴到 urls.py 文件中：\nfrom django.urls import path from . import views urlpatterns = [ path(\"\", views.hello, name=\"hello\"), ] 整个目录结构如下：\n$ tree . |-- HelloWorld | |-- __init__.py | |-- __init__.pyc | |-- settings.py | |-- settings.pyc | |-- urls.py ## url 配置 | |-- urls.pyc | |-- views.py ## 添加的视图文件 | |-- views.pyc ## 编译后的视图文件 | |-- wsgi.py | `-- wsgi.pyc `-- manage.py 完成后，启动 Django 开发服务器，并在浏览器访问打开浏览器并访问：\n我们也可以修改以下规则：\n## HelloWorld/HelloWorld/urls.py 文件代码： from django.urls import path from . import views urlpatterns = [ path('hello/', views.hello), ] 通过浏览器打开 ** http://127.0.0.1:8000/hello**，输出结果如下：\n**注意：**项目中如果代码有改动，服务器会自动监测代码的改动并自动重新载入，所以如果你已经启动了服务器则不需手动重启。\n创建app - 项目 - app，用户管理【表结构、函数、HTML模板、CSS】 - app，订单管理【表结构、函数、HTML模板、CSS】 - app，后台管理【表结构、函数、HTML模板、CSS】 - app，网站 【表结构、函数、HTML模板、CSS】 - app，API 【表结构、函数、HTML模板、CSS】 .. 注意：我们开发比较简洁，用不到多app，一般情况下，项目下创建1个app即可。 ├── app01 │ ├── __init__.py │ ├── admin.py 【固定，不用动】django默认提供了admin后台管理。 │ ├── apps.py 【固定，不用动】app启动类 │ ├── migrations 【固定，不用动】数据库变更记录 │ │ └── __init__.py │ ├── models.py 【**重要**】，对数据库操作。 │ ├── tests.py 【固定，不用动】单元测试 │ └── views.py 【**重要**】，函数。 ├── manage.py └── mysite2 ├── __init__.py ├── asgi.py ├── settings.py ├── urls.py 【URL-\u003e函数】 └── wsgi.py Django 模板 我们接着上一章节的项目将在 HelloWorld 目录底下创建 templates 目录并建立hello.html文件，整个目录结构如下：\nHelloWorld/ |-- HelloWorld | |-- __init__.py | |-- __init__.pyc | |-- settings.py | |-- settings.pyc | |-- urls.py | |-- urls.pyc | |-- views.py | |-- views.pyc | |-- wsgi.py | `-- wsgi.pyc |-- manage.py `-- templates `-- hello.html \u003ch1\u003e {{ hello }} \u003c/h1\u003e 我们现在修改 views.py，增加一个新的对象，用于向模板提交数据：\n## views.py def hello_world(request): context = {'hello': 'Hello World11!'} return render(request, 'hello.html', context) ## urls from django.urls import path from . import views urlpatterns = [ path(\"hello/\", views.hello_world, name=\"hello_world\"), ] Django 模板标签 变量 模板语法：\nview：｛\"HTML变量名\" : \"views变量名\"｝ HTML：｛｛变量名｝｝ ## views.py from django.shortcuts import render def runoob(request): views_name = \"菜鸟教程\" return render(request,\"runoob.html\", {\"name\":views_name}) templates 中的 runoob.html ：\n{{ name }}\n列表 from django.shortcuts import render def runoob(request): views_list = [\"菜鸟教程1\",\"菜鸟教程2\",\"菜鸟教程3\"] return render(request, \"runoob.html\", {\"views_list\": views_list}) \u003cp\u003e{{ views_list }}\u003c/p\u003e ## 取出整个列表 \u003cp\u003e{{ views_list.0 }}\u003c/p\u003e ## 取出列表的第一个元素 过滤器 模板语法：\n{{ 变量名 | 过滤器：可选参数 }} 模板过滤器可以在变量被显示前修改它，过滤器使用管道字符，如下所示：\n{{ name|lower }} {{ name }} 变量被过滤器 lower 处理后，文档大写转换文本为小写。\n过滤管道可以被套接 ，既是说，一个过滤器管道的输出又可以作为下一个管道的输入：\n{{ my_list|first|upper }} 以上实例将第一个元素并将其转化为大写。\n有些过滤器有参数。 过滤器的参数跟随冒号之后并且总是以双引号包含。 例如：\n{{ bio|truncatewords:\"30\" }} 这个将显示变量 bio 的前30个词。\n其他过滤器：\naddslashes : 添加反斜杠到任何反斜杠、单引号或者双引号前面。\ndate : 按指定的格式字符串参数格式化 date 或者 datetime 对象，实例：\n{{ pub_date|date:\"F j, Y\" }} length : 返回变量的长度。\ndefault\ndefault 为变量提供一个默认值。\n如果 views 传的变量的布尔值是 false，则使用指定的默认值。\n以下值为 false：\n0 0.0 False 0j \"\" [] () set() {} None from django.shortcuts import render def runoob(request): name =0 return render(request, \"runoob.html\", {\"name\": name}) {{ name|default:\"菜鸟教程666\" }} length\n返回对象的长度，适用于字符串和列表。\n字典返回的是键值对的数量，集合返回的是去重后的长度。\n{{ name|length}} filesizeformat\n以更易读的方式显示文件的大小（即'13 KB’, ‘4.1 MB’, ‘102 bytes’等）。\n字典返回的是键值对的数量，集合返回的是去重后的长度。\nfrom django.shortcuts import render def runoob(request): num=1024 return render(request, \"runoob.html\", {\"num\": num}) {{ num|filesizeformat}} date\n根据给定格式对一个日期变量进行格式化。\n格式 Y-m-d H:i:s返回 年-月-日 小时:分钟:秒 的格式时间。\nfrom django.shortcuts import render def runoob(request): import datetime now =datetime.datetime.now() return render(request, \"runoob.html\", {\"time\": now}) {{ time|date:\"Y-m-d\" }} truncatechars\n如果字符串包含的字符总个数多于指定的字符数量，那么会被截断掉后面的部分。\n截断的字符串将以 … 结尾。\nfrom django.shortcuts import render def runoob(request): views_str = \"菜鸟教程\" return render(request, \"runoob.html\", {\"views_str\": views_str}) {{ views_str|truncatechars:2}} safe\n将字符串标记为安全，不需要转义。\n要保证 views.py 传过来的数据绝对安全，才能用 safe。\n和后端 views.py 的 mark_safe 效果相同。\nDjango 会自动对 views.py 传到HTML文件中的标签语法进行转义，令其语义失效。加 safe 过滤器是告诉 Django 该数据是安全的，不必对其进行转义，可以让该数据语义生效。\nfrom django.shortcuts import render def runoob(request): views_str = \"点击跳转\" return render(request, \"runoob.html\", {\"views_str\": views_str}) {{ views_str|safe }} 对比\nif/else 标签 基本语法格式如下：\n{% if condition %} ... display {% endif %} 或者：\n{% if condition1 %} ... display 1 {% elif condition2 %} ... display 2 {% else %} ... display 3 {% endif %} 根据条件判断是否输出。if/else 支持嵌套。\n{% if %} 标签接受 and ， or 或者 not 关键字来对多个变量做判断 ，或者对变量取反（ not )，例如：\n{% if athlete_list and coach_list %} athletes 和 coaches 变量都是可用的。 {% endif %} for 标签 {% for %} 允许我们在一个序列上迭代。\n与 Python 的 for 语句的情形类似，循环语法是 for X in Y ，Y 是要迭代的序列而 X 是在每一个特定的循环中使用的变量名称。\n每一次循环中，模板系统会渲染在 {% for %} 和 {% endfor %} 之间的所有内容。\n例如，给定一个运动员列表 athlete_list 变量，我们可以使用下面的代码来显示这个列表：\n{% for athlete in athlete_list %} {{ athlete.name }} {% endfor %} 给标签增加一个 reversed 使得该列表被反向迭代：\n{% for athlete in athlete_list reversed %} ... {% endfor %} 遍历字典: 可以直接用字典 .items 方法，用变量的解包分别获取键和值。\n在 {% for %} 标签里可以通过 {{forloop}} 变量获取循环序号。\nforloop.counter: 顺序获取循环序号，从 1 开始计算 forloop.counter0: 顺序获取循环序号，从 0 开始计算 forloop.revcounter: 倒序获取循环序号，结尾序号为 1 forloop.revcounter0: 倒序获取循环序号，结尾序号为 0 forloop.first（一般配合if标签使用）: 第一条数据返回 True，其他数据返回 False forloop.last（一般配合if标签使用）: 最后一条数据返回 True，其他数据返回 False 模块化 调整 djangoProject/urls.py\nfrom django.urls import path, include from app import views ## from . import views urlpatterns = [ path('book/', include(\"app.urls\")), ] app/urls.py\nfrom django.urls import path from app import views urlpatterns = [ path(\"home\", views.home, name=\"home\"), path(\"add\", views.add_book, name=\"add_book\"), path(\"query\", views.query_book, name=\"query_book\"), path(\"delete\", views.delete_book, name=\"delete_book\"), path(\"update\", views.update_book, name=\"update_book\"), ] 数据库操作 数据库配置 安装环境\npip install mysqlclient 更改 settings.py 中的配置\nDATABASES = { 'default': { 'ENGINE': 'django.db.backends.mysql', ## 数据库引擎 'NAME': 'runoob', ## 数据库名称 'HOST': '127.0.0.1', ## 数据库地址，本机 ip 地址 127.0.0.1 'PORT': 3306, ## 端口 'USER': 'root', ## 数据库用户名 'PASSWORD': '123456', ## 数据库密码 } } 数据库配置是选择项目所使用的数据库的类型，不同的数据库需要设置不同的数据库引擎，数据库引擎\n用于实现项目与数据库的连接，Django提供4种数据库引擎:\n‘django.db.backends.postgresql’ ‘django.db.backends.mysql’ ‘django.db.backends.sqlite3’ ‘django.db.backends.oracle’ 我们有两种方式进行数据库的操作, 如下\n普通 SQL 增删查改 ## app/views from django.shortcuts import render from django.db import connection ## Create your views here. def home(request): ## 获取数据库连接 cursor = connection.cursor() ## 创建 book 表如果不存在 cursor.execute(\"CREATE TABLE IF NOT EXISTS book (id INT PRIMARY KEY AUTO_INCREMENT, name VARCHAR(255))\") ## 插入数据 cursor.execute(\"INSERT INTO book (name) VALUES ('Python')\") ## 查询数据 cursor.execute(\"SELECT * FROM book\") ## 获取所有数据 books = cursor.fetchall() ## 更改数据 if books[0][1] == 'Python': cursor.execute(\"UPDATE book SET name = 'Java' WHERE id = 1\") else: cursor.execute(\"UPDATE book SET name = 'Python' WHERE id = 1\") ## 输出数据 for book in books: print(book) ## 关闭数据库连接 cursor.close() return render(request, \"home.html\", {\"books\": books}) ## 主项目/urls from django.urls import path from app import views urlpatterns = [ path(\"home/\", views.home, name=\"home\"), ] \u003c!DOCTYPE html\u003e \u003chtml lang=\"en\"\u003e \u003chead\u003e \u003cmeta charset=\"UTF-8\"\u003e \u003ctitle\u003eTitle\u003c/title\u003e \u003c/head\u003e \u003cbody\u003e {% for book in books %} \u003ch1\u003e{{ book}}\u003c/h1\u003e {% endfor %} \u003c/body\u003e \u003c/html\u003e 效果如下\nDjango ORM Django 模型使用自带的 ORM。\n对象关系映射（Object Relational Mapping，简称 ORM ）用于实现面向对象编程语言里不同类型系统的数据之间的转换。\nORM 在业务逻辑层和数据库层之间充当了桥梁的作用。\nORM 是通过使用描述对象和数据库之间的映射的元数据，将程序中的对象自动持久化到数据库中。\n使用 ORM 的好处：\n提高开发效率。 不同数据库可以平滑切换。 使用 ORM 的缺点：\nORM 代码转换为 SQL 语句时，需要花费一定的时间，执行效率会有所降低。 长期写 ORM 代码，会降低编写 SQL 语句的能力。 ORM 解析过程:\n1、ORM 会将 Python 代码转成为 SQL 语句。 2、SQL 语句通过 pymysql 传送到数据库服务端。 3、在数据库中执行 SQL 语句并将结果返回。 ORM 对应关系表：\n定义模型 Django 规定，如果要使用模型，必须要创建一个 app。我们使用以下命令创建一个 app 的 app:\ndjango-admin startapp app 创建一个新的 模块, 更改其中的 app.models\nfrom django.db import models ## Create your models here. class Book(models.Model): name = models.CharField(max_length=255) author = models.CharField(max_length=255) pub_time = models.DateField(auto_now_add=True) price = models.FloatField(default=0) 以上的类名代表了数据库表名，且继承了models.Model，类里面的字段代表数据表中的字段(name)，数据类型则由CharField（相当于varchar）、DateField（相当于datetime）， max_length 参数限定长度。\n接下来在 settings.py 中找到INSTALLED_APPS这一项，如下：\nINSTALLED_APPS = ( 'django.contrib.admin', 'django.contrib.auth', 'django.contrib.contenttypes', 'django.contrib.sessions', 'django.contrib.messages', 'django.contrib.staticfiles', 'app', ## 添加此项 ) 在命令行中运行：\npython3 manage.py makemigrations ## 让 Django 知道我们在我们的模型有一些变更 python3 manage.py migrate ## 创建表结构 执行此命令, 也会把 django 自带的数据库导入进数据库中\n编辑 mysite/settings.py 文件前，先设置 TIME_ZONE 为你自己时区。\n此外，关注一下文件头部的 INSTALLED_APPS 设置项。这里包括了会在你项目中启用的所有 Django 应用。应用能在多个项目中使用，你也可以打包并且发布应用，让别人使用它们。\n通常， INSTALLED_APPS 默认包括了以下 Django 的自带应用：\ndjango.contrib.admin – 管理员站点， 你很快就会使用它。 django.contrib.auth – 认证授权系统。 django.contrib.contenttypes – 内容类型框架。 django.contrib.sessions – 会话框架。 django.contrib.messages – 消息框架。 django.contrib.staticfiles – 管理静态文件的框架。 这些应用被默认启用是为了给常规项目提供方便。\n默认开启的某些应用需要至少一个数据表，所以，在使用他们之前需要在数据库中创建一些表。请执行以下命令：\npython manage.py migrate 这个 migrate 命令查看 INSTALLED_APPS 配置，并根据 mysite/settings.py 文件中的数据库配置和随应用提供的数据库迁移文件（我们将在后面介绍这些），创建任何必要的数据库表。你会看到它应用的每一个迁移都有一个消息。如果你有兴趣，运行你的数据库的命令行客户端，输入 \\dt （PostgreSQL）， SHOW TABLES; （MariaDB，MySQL）， .tables （SQLite）或 SELECT TABLE_NAME FROM USER_TABLES; （Oracle）来显示 Django 创建的表。\n就像之前说的，为了方便大多数项目，我们默认激活了一些应用，但并不是每个人都需要它们。如果你不需要某个或某些应用，你可以在运行 migrate 前毫无顾虑地从 INSTALLED_APPS 里注释或者删除掉它们。 migrate 命令只会为在 INSTALLED_APPS 里声明了的应用进行数据库迁移。\n实现基本 CRUD 操作 数据库添加 def add_book(request): book = Book(name=\"Python\", author=\"菜鸟教程\", price=1024) book.save() ## books = Book.objects.create(name=\"如来神掌\", price=200, author=\"功夫出版社\", pub_time=\"2010-10-10\") return HttpResponse(\"添加数据成功！\") 数据库查询 以下可能不全 具体可以参看官方文档\n使用 all() 方法来查询所有内容。返回的是 QuerySet 类型数据，类似于 list，里面放的是一个个模型类的对象，可用索引下标取出模型类的对象。\nfilter() 方法用于查询符合条件的数据。返回的是 QuerySet 类型数据，类似于 list，里面放的是满足条件的模型类的对象，可用索引下标取出模型类的对象。pk=3 的意思是主键 primary key=3，相当于 id=3。因为 id 在 pycharm 里有特殊含义，是看内存地址的内置函数 id()，因此用 pk。\nexclude() 方法用于查询不符合条件的数据。返回的是 QuerySet 类型数据，类似于 list，里面放的是不满足条件的模型类的对象，可用索引下标取出模型类的对象。\nget() 方法用于查询符合条件的返回模型类的对象符合条件的对象只能为一个，如果符合筛选条件的对象超过了一个或者没有一个都会抛出错误。\norder_by() 方法用于对查询结果进行排序。返回的是 QuerySet类型数据，类似于list，里面放的是排序后的模型类的对象，可用索引下标取出模型类的对象。\n注意：\na、参数的字段名要加引号。 b、降序为在字段前面加个负号 -。 reverse() 方法用于对查询结果进行反转。返回的是 QuerySe t类型数据，类似于 list，里面放的是反转后的模型类的对象，可用索引下标取出模型类的对象。\ncount() 方法用于查询数据的数量返回的数据是整数。\nfirst() 方法返回第一条数据返回的数据是模型类的对象也可以用索引下标 [0]。\nlast() 方法返回最后一条数据返回的数据是模型类的对象不能用索引下标 [-1]，ORM 没有逆序索引。\nexists() 方法用于判断查询的结果 QuerySet 列表里是否有数据。返回的数据类型是布尔，有为 true，没有为 false。**注意：**判断的数据类型只能为 QuerySet 类型数据，不能为整型和模型类的对象。\nvalues() 方法用于查询部分字段的数据。返回的是 QuerySet 类型数据，类似于 list，里面不是模型类的对象，而是一个可迭代的字典序列，字典里的键是字段，值是数据。\n注意：\n参数的字段名要加引号 想要字段名和数据用 values实例 def query_book(request): books = Book.objects.all() ## books = Book.objects.filter(name=\"Python\") for book in books: print(book.name) book_return = [ { \"id\": book.id, \"name\": book.name, \"author\": book.author, \"price\": book.price } for book in books ] return HttpResponse(\"查询数据成功！\" + str(book_return)) 删除 **方式一：**使用模型类的 对象.delete()。\n**返回值：**元组，第一个元素为受影响的行数。\nbooks=models.Book.objects.filter(pk=8).first().delete() 方式二：使用 QuerySet 类型数据.delete()(推荐)\n**返回值：**元组，第一个元素为受影响的行数。\nbooks=models.Book.objects.filter(pk__in=[1,2]).delete() def delete_book(request): ## 使用 QuerySet 类型数据.delete()(推荐) books = Book.objects.filter(pk__in=[1, 2]).delete() print(books) ## 使用模型类的 对象.delete()。 books = Book.objects.filter(name=\"Python\").first().delete() print(books) return HttpResponse(\"删除数据成功！\") 注意：\na. Django 删除数据时，会模仿 SQL约束 ON DELETE CASCADE 的行为，也就是删除一个对象时也会删除与它相关联的外键对象。 b. delete() 方法是 QuerySet 数据类型的方法，但并不适用于 Manager 本身。也就是想要删除所有数据，不能不写 all。 books=models.Book.objects.delete()　## 报错 books=models.Book.objects.all().delete()　## 删除成功 修改 方式一：\n模型类的对象.属性 = 更改的属性值 模型类的对象.save() **返回值：**编辑的模型类的对象。\ndef update_book(request): book = Book.objects.filter(name=\"Python\").first() book.name = \"Java\" book.save() return HttpResponse(\"更新数据成功！\") **方式二：**QuerySet 类型数据.update(字段名=更改的数据)（推荐）\n**返回值：**整数，受影响的行数\nBook.objects.filter(name=\"Java\").update(price=100) 模型常用Field和参数 常用字段 在Django中，定义了一些Field来与数据库表中的字段类型来进行映射。以下将介绍那些常用的字段类\n型。\nAutoField：映射到数据库中是int类型，可以有自动增长的特性。一般不需要使用这个类型，如果不指定主键，那么模型会自动的生成一个叫做id的自动增长的主键。如果你想指定一个其他名字的并且具有自动增长的主键，使用AutoField也是可以的。\nBigAutoField：64 位的整形，类似于AutoField，只不过是产生的数据的范围是从1-9223372036854775807。\nBooleanField：在模型层面接收的是True/False。在数据库层面是tinyint类型。如果没有指定默认值，默认值是None。\nCharField：在数据库层面是varchar类型。在Python层面就是普通的字符串。这个类型在使用的时候必须要指定最大的长度，也即必须要传递max_length这个关键字参数进去。\nDateField：日期类型。在Python中是datetime.date类型，可以记录年月日。在映射到数据库中也是date类型。使用这个Field可以传递以下几个参数：\nauto_now：在每次这个数据保存的时候，都使用当前的时间。比如作为一个记录修改日期的字段，可以将这个属性设置为True。\nauto_now_add：在每次数据第一次被添加进去的时候，都使用当前的时间。比如作为一个记录第一次入库的字段，可以将这个属性设置为True。\nDateTimeField：日期时间类型，类似于DateField。不仅仅可以存储日期，还可以存储时间。映射到数据库中是datetime类型。这个Field也可以使用auto_now和auto_now_add两个属性。\nTimeField：时间类型。在数据库中是time类型。在Python中是datetime.time类型。\nEmailField：类似于CharField。在数据库底层也是一个varchar类型。最大长度是 254 个字符。\nFileField：用来存储文件的。这个请参考后面的文件上传章节部分。\nImageField：用来存储图片文件的。这个请参考后面的图片上传章节部分。\nFloatField：浮点类型。映射到数据库中是float类型。\nIntegerField：整形。值的区间是-2147483648——2147483647。\nBigIntegerField：大整形。值的区间是-9223372036854775808——9223372036854775807。\nPositiveIntegerField：正整形。值的区间是0——2147483647。\nSmallIntegerField：小整形。值的区间是-32768——32767。\nPositiveSmallIntegerField：正小整形。值的区间是0——32767。\nTextField：大量的文本类型。映射到数据库中是longtext类型。\nUUIDField：只能存储uuid格式的字符串。uuid是一个 32 位的全球唯一的字符串，一般用来作为主键。\nURLField：类似于CharField，只不过只能用来存储url格式的字符串。并且默认的max_length是 200 。\nField的常用参数 null：如果设置为True，Django将会在映射表的时候指定是否为空。默认是为False。在使用字符串相关的Field（CharField/TextField）的时候，官方推荐尽量不要使用这个参数，也就是保持默认值False。因为Django在处理字符串相关的Field的时候，即使这个Field的null=False，如果你没有给这个Field传递任何值，那么Django也会使用一个空的字符串\"“来作为默认值存储进去。因此如果再使用null=True，Django会产生两种空值的情形（NULL或者空字符串）。如果想要在表单验证的时候允许这个字符串为空，那么建议使用blank=True。如果你的Field是BooleanField，那么对应的可空的字段则为NullBooleanField。\nblank：标识这个字段在表单验证的时候是否可以为空。默认是False。这个和null是有区别的，null是一个纯数据库级别的。而blank是表单验证级别的。\ndb_column：这个字段在数据库中的名字。如果没有设置这个参数，那么将会使用模型中属性的名字。\ndefault：默认值。可以为一个值，或者是一个函数，但是不支持lambda表达式。并且不支持列表/字典/集合等可变的数据结构。\nprimary_key：是否为主键。默认是False。\nunique：在表中这个字段的值是否唯一。一般是设置手机号码/邮箱等。\n更多Field参数请参考官方文档： https://docs.djangoproject.com/zh-hans/5.0/ref/models/fields/\n模型中 Meta 配置 db_table：这个模型映射到数据库中的表名。如果没有指定这个参数，那么在映射的时候将会使用模型名来作为默认的表名。 ordering：设置在提取数据的排序方式。后面章节会讲到如何查找数据。比如我想在查找数据的时候根据添加的时间排序，那么示例代码如下： class Book(models.Model): name = models.CharField(max_length=20,null=False) desc = models.CharField(max_length=100,name='description',db_column=\"description1\") pub_date = models.DateTimeField(auto_now_add=True) class Meta: db_table = 'book_model' ordering = ['pub_date'] 更多的配置后面会慢慢介绍到。 官方文档： https://docs.djangoproject.com/zh-hans/5.0/ref/models/\n外键使用 在MySQL中，表有两种引擎，一种是InnoDB，另外一种是myisam。如果使用的是InnoDB引擎，是支持外键约束的。外键的存在使得ORM框架在处理表关系的时候异常的强大。因此这里我们首先来介绍下外键在Django中的使用。\nInnoDB: 事务支持：InnoDB支持事务处理，具有提交(commit)、回滚(rollback)和崩溃恢复能力，适合需要事务处理的应用。 行级锁定：InnoDB使用行级锁定和MVCC（多版本并发控制），在高并发环境下性能更好。 外键约束：InnoDB支持外键约束，有助于保持数据的完整性。 崩溃恢复：InnoDB具有崩溃恢复的能力，可以保证数据的安全性。 存储限制：InnoDB表有16TB的存储限制。 默认引擎：从MySQL 5.5.5版本开始，InnoDB成为了MySQL的默认存储引擎。 MyISAM: 表级锁定：MyISAM使用表级锁定，这意味着在高并发环境下，性能可能不如InnoDB。 全文索引：MyISAM提供了全文索引功能，适合需要全文搜索的应用。 没有事务支持：MyISAM不支持事务处理，适用于不需要事务的应用。 存储限制：MyISAM表有256TB的存储限制。 快速读取：MyISAM通常在读取密集型的应用中表现更好，因为它的索引结构设计得更简单。 选择哪种存储引擎取决于你的应用需求。如果需要事务支持、行级锁定和外键约束，InnoDB通常是更好的选择。如果应用主要是读取密集型，并且需要全文索引功能，那么MyISAM可能更合适。不过，由于InnoDB的广泛特性和性能优势，它在现代应用中被广泛使用。\n定义 类定义为 class ForeignKey(to,on_delete,**options) 。第一个参数是引用的是哪个模型，第二个参数是在使用外键引用的模型数据被删除了，这个字段该如何处理，比如有 CASCADE 、 SET_NULL 等。这里以一个实际案例来说明。比如有一个 User 和一个 Article 两个模型。一个 User 可以发表多篇文章，一个 Article 只能有一个 Author ，并且通过外键进行引用。那么相关的示例代码如下：\nfrom django.db import models class User(models.Model): username = models.CharField(max_length=255) password = models.CharField(max_length=255) class Article(models.Model): title = models.CharField(max_length=255) content = models.TextField() ## 外键 author = models.ForeignKey('User', on_delete=models.CASCADE) 如果不同的 app, 可以这样子使用外键 author = models.ForeignKey('app.User', on_delete=models.CASCADE)\n以上使用 ForeignKey 来定义模型之间的关系。即在 article 的实例中可以通过 author 属性来操作对应的 User 模型。这样使用起来非常的方便。示例代码如下：\nfrom django.shortcuts import HttpResponse from .models import User, Article def article_test(request): ## user = User(username=\"admin\", password=\"123456\") ## user.save() # ## article = Article(title=\"Django\", content=\"Django 是一个开放源代码的 Web 应用框架，由 Python 编写。\", author=user) ## article.save() article = Article.objects.first() return HttpResponse(article.author.username) 如果模型的外键引用的是本身自己这个模型，那么 to 参数可以为 ‘self’ ，或者是这个模型的名字。在论坛开发中，一般评论都可以进行二级评论，即可以针对另外一个评论进行评论，那么在定义模型的时候就需要使用外键来引用自身。示例代码如下：\nclass Comment(models.Model): content = models.TextField() article = models.ForeignKey('self', on_delete=models.CASCADE, null=True) ## or article = models.ForeignKey('Comment', on_delete=models.CASCADE, null=True) 外键删除操作 在数据库中使用外键（Foreign Key）时，我们需要考虑当外键所引用的记录被删除时，应如何处理与该记录相关联的其他记录。Django ORM 提供了几种 on_delete 选项来处理这种情况，每种选项都定义了不同的行为。以下是这些选项的解释：\nCASCADE：当外键所引用的主键记录被删除时，所有引用该记录的外键记录也将被自动删除。这种操作称为级联删除，它确保了数据库的引用完整性。 PROTECT：当尝试删除一个被外键引用的主键记录时，如果存在引用，Django 会抛出一个 ProtectedError 异常，阻止删除操作。这是一种保护机制，确保数据的完整性不被破坏。 SET_NULL：如果外键所引用的主键记录被删除，那么所有引用该记录的外键字段将被设置为 NULL。使用这个选项之前，需要确保外键字段在数据库中允许为空（null=True）。 SET_DEFAULT：当外键所引用的主键记录被删除时，所有引用该记录的外键字段将被设置为字段的默认值。这要求外键字段在定义时有一个默认值。 SET()：允许你指定一个可调用的对象（如函数或方法），当外键所引用的主键记录被删除时，Django 会调用这个对象，并使用返回的值来更新外键字段。这提供了高度的灵活性，可以根据业务逻辑来决定如何更新外键字段。 DO_NOTHING：这个选项不会在 Django 层面上做任何操作，所有的约束都依赖于数据库级别的约束。如果数据库设置为不允许删除被引用的记录（如 RESTRICT），那么删除操作将会失败。 需要注意的是，尽管 Django 提供了多种 on_delete 选项，但数据库层面的行为不会改变。例如，如果数据库设置为 RESTRICT，则即使 Django 设置为 CASCADE，数据库也不会执行级联删除，而是会阻止删除操作。因此，在使用 on_delete 选项时，还需要考虑数据库层面的约束。\n表的关系 表与表之间的关系可分为以下三种：\n一对一: 一个人对应一个身份证号码，数据字段设置 unique。 一对多: 一个家庭有多个人，一般通过外键来实现。 多对多: 一个学生有多门课程，一个课程有很多学生，一般通过第三个表来实现关联。 一对多 应用场景：比如文章和作者之间的关系。一个文章只能由一个作者编写，但是一个作者可以写多篇文章。文章和作者之间的关系就是典型的多对一的关系。\n实现方式：一对多或者多对一，都是通过ForeignKey来实现的。还是以文章和作者的案例进行讲解。那么以后在给Article对象指定author，就可以使用以下代码来完成：\nfrom django.db import models class User(models.Model): username = models.CharField(max_length=255) password = models.CharField(max_length=255) class Article(models.Model): title = models.CharField(max_length=255) content = models.TextField() ## 外键 author = models.ForeignKey('User', on_delete=models.CASCADE) 并且以后如果想要获取某个用户下所有的文章，可以通过article_set来实现。示例代码如下：\ndef article_test(request): user = User.objects.first() ## ## user.save() ## # ## article = Article(title=\"Django12\", content=\"Django 是一个开放源代码的 Web 应用框架，由 Python 编写。\", author=user) ## article.save() article = user.article_set.all() for a in article: print(a.title) print(a.content) print(a.author.username) return HttpResponse(\"添加数据成功！\") 一对一 应用场景：比如一个用户表和一个用户信息表。在实际网站中，可能需要保存用户的许多信息，但是有些信息是不经常用的。如果把所有信息都存放到一张表中可能会影响查询效率，因此可以把用户的一些不常用的信息存放到另外一张表中我们叫做UserExtension。但是用户表User和用户信息表UserExtension就是典型的一对一了。\n实现方式：Django为一对一提供了一个专门的Field叫做OneToOneField来实现一对一操作。示例代码如下：\nfrom django.db import models class User(models.Model): username = models.CharField(max_length=255) password = models.CharField(max_length=255) class UserExtension(models.Model): birthday = models.DateField(null=True) school = models.CharField(max_length=255) ## user = models.OneToOneField('User', on_delete=models.CASCADE, related_name='extension') user = models.OneToOneField('User', on_delete=models.CASCADE) 只允许一对一, 超过既会报错,\n在UserExtension模型上增加了一个一对一的关系映射。其实底层是在UserExtension这个表上增加了一个user_id，来和user表进行关联，并且这个外键数据在表中必须是唯一的，来保证一对一。\n多对多 应用场景：比如文章和标签的关系。一篇文章可以有多个标签，一个标签可以被多个文章所引用。因此标签和文章的关系是典型的多对多的关系。\n实现方式：Django为这种多对多的实现提供了专门的Field。叫做ManyToManyField。还是拿文章和标签为例进行讲解。示例代码如下：\nclass Article(models.Model): title = models.CharField(max_length=255) content = models.TextField() ## 外键 author = models.ForeignKey('User', on_delete=models.CASCADE) ## 多对多 tags = models.ManyToManyField('Tag') class Tag(models.Model): name = models.CharField(max_length=255) 在数据库层面，实际上Django是为这种多对多的关系建立了一个中间表。这个中间表分别定义了两个外键，引用到article和tag两张表的主键。\nrelated_name和related_query_name 在 Django 中，related_name 和 related_query_name 是两个与模型的外键关系相关的参数，它们允许你自定义反向关系和查询的名称。\nrelated_name related_name 是 ForeignKey 或 ManyToManyField 字段的一个选项，它允许你为反向关系指定一个自定义名称。默认情况下，Django 会使用 \u003c模型名\u003e_set 作为反向关系的名称（例如，Article 模型的反向关系默认为 article_set）。但是，如果你想要一个更有意义的名称或避免名称冲突，你可以使用 related_name 来指定。\n例如，如果你有一个 User 模型和一个 Article 模型，并且每个用户可以有多个文章，你可以这样定义模型：\nclass Article(models.Model): title = models.CharField(max_length=100) content = models.TextField() ## 使用related_name指定反向关系名称为'articles' author = models.ForeignKey(\"User\", on_delete=models.SET_NULL, null=True, related_name='articles') 这样，你就可以通过 user.articles.all() 来获取一个用户的所有文章。\n如果你不想使用任何自定义的反向关系名称，可以设置 related_name='+'，这将禁用自动生成的 \u003c模型名\u003e_set 名称。\nclass Article(models.Model): title = models.CharField(max_length=100) content = models.TextField() ## 传递related_name参数，以后在方向引用的时候使用articles进行访问 author = models.ForeignKey(\"User\",on_delete=models.SET_NULL,null=True,related_name='+') related_query_name related_query_name 是 related_name 的一个补充选项，它允许你自定义在查询集中使用 filter 方法时反向关系的名称。默认情况下，Django 会使用 related_name 的值加上下划线和字段名来生成查询名称（例如，articles_title）。\n如果你设置了 related_name='articles'，那么在进行反向查询时，你可以这样写：\nusers = User.objects.filter(articles__title='abc') 如果你想要一个不同的查询名称，可以使用 related_query_name 来指定：\nclass Article(models.Model): title = models.CharField(max_length=100) content = models.TextField() ## 使用related_name指定反向关系名称为'articles' ## 使用related_query_name指定查询时的名称为'article' author = models.ForeignKey(\"User\", on_delete=models.SET_NULL, null=True, related_name='articles', related_query_name='article') 这样，你就可以使用 article__title 来进行查询：\nusers = User.objects.filter(article__title='abc') 请注意，related_query_name 只在反向查询中使用，而 related_name 用于定义反向关系名称。\n最后，你提供的代码片段中有一些格式错误和不完整的部分，我已经根据上下文进行了修正。如果你有更具体的问题或需要进一步的帮助，请随时提问。\n查询操作 查找是数据库操作中一个非常重要的技术。查询一般就是使用 filter 、 exclude 以及 get 三个方法来实现。我们可以在调用这些方法的时候传递不同的参数来实现查询需求。在 ORM 层面，这些查询条件都是使用 field + __ + condition 的方式来使用的。以下将那些常用的查询条件来一一解释。\n在 Django 中，查询集（QuerySet）提供了多种方法来过滤和查询数据库中的数据。以下是对您提供的查询条件的优化格式和解释：\n1. exact 执行精确匹配，相当于 SQL 中的 = 操作符。如果查询值为 None，则在 SQL 中对应 IS NULL 示例:\narticle = Article.objects.get(id__exact=14) article = Article.objects.get(id__exact=None) SQL 翻译:\nSELECT ... FROM article WHERE id = 14; SELECT ... FROM article WHERE id IS NULL; 2. iexact 执行不区分大小写的模糊匹配，相当于 SQL 中的 LIKE 操作符。\n示例:\narticle = Article.objects.filter(title__iexact='hello world') SQL 翻译:\nSELECT ... FROM article WHERE title LIKE 'hello world'; 3. contains 执行大小写敏感的模糊匹配，字段值包含给定的字符串。\n示例:\narticles = Article.objects.filter(title__contains='hello') SQL 翻译:\nSELECT ... WHERE title LIKE BINARY '%hello%'; 4. icontains 与 contains 类似，但不区分大小写。\n示例:\narticles = Article.objects.filter(title__icontains='hello') SQL 翻译:\nSELECT ... WHERE title LIKE '%hello%'; 5. in 检查字段值是否包含在给定的容器中，容器可以是列表、元组或任何可迭代对象。\n示例:\narticles = Article.objects.filter(id__in=[1, 2, 3]) SQL 翻译:\nSELECT ... WHERE id IN (1, 2, 3); 6. gt 检查字段值是否大于给定值。\n示例:\narticles = Article.objects.filter(id__gt=4) SQL 翻译:\nSELECT ... WHERE id \u003e 4; 7. gte 检查字段值是否大于或等于给定值。\n8. lt 检查字段值是否小于给定值。\n9. lte 检查字段值是否小于或等于给定值。\n10. startswith 检查字段值是否以特定字符串开始，大小写敏感。\n示例:\narticles = Article.objects.filter(title__startswith='hello') SQL 翻译:\nSELECT ... WHERE title LIKE 'hello%'; 11. istartswith 与 startswith 类似，但不区分大小写。\n12. endswith 检查字段值是否以特定字符串结束，大小写敏感。\n示例:\narticles = Article.objects.filter(title__endswith='world') SQL 翻译:\nSELECT ... WHERE title LIKE '%world'; 13. iendswith 与 endswith 类似，但不区分大小写。\n14. range 检查字段值是否在给定的范围内。\n示例:\nstart_date = datetime(2018, 1, 1) end_date = datetime(2018, 12, 31) articles = Article.objects.filter(pub_date__range=(start_date, end_date)) SQL 翻译:\nSELECT ... FROM article WHERE pub_date BETWEEN '2018-01-01' AND '2018-12-31'; 15. date 针对 DateField 或 DateTimeField 类型的字段，可以指定日期的范围。\n示例:\narticles = Article.objects.filter(pub_date__date=date(2018, 3, 29)) SQL 翻译:\nSELECT ... WHERE DATE(pub_date) = '2018-03-29'; 16. year、month、day、week_day、time 这些查询条件允许你根据日期和时间的特定部分进行过滤。\n示例:\narticles = Article.objects.filter(pub_date__year=2018) articles = Article.objects.filter(pub_date__time=datetime.time(12, 12, 12)) SQL 翻译:\nSELECT ... WHERE YEAR(pub_date) = 2018; SELECT ... WHERE TIME(pub_date) = '12:12:12'; 这些查询条件使得在 Django 中进行数据库查询变得非常灵活和强大。你可以根据需要选择合适的查询条件来获取所需的数据。更多详细信息和高级用法，请参考 Django 官方文档。\n聚合函数 前期准备\nfrom django.db import models class Author(models.Model): \"\"\"作者模型\"\"\" name = models.CharField(max_length=100) age = models.IntegerField() email = models.EmailField() class Meta: db_table = 'front_author' class Publisher(models.Model): \"\"\"出版社模型\"\"\" name = models.CharField(max_length=300) class Meta: db_table = 'front_publisher' class Book(models.Model): \"\"\"图书模型\"\"\" name = models.CharField(max_length=300) pages = models.IntegerField() price = models.FloatField() rating = models.FloatField() author = models.ForeignKey(Author, on_delete=models.CASCADE) publisher = models.ForeignKey(Publisher, on_delete=models.CASCADE) class Meta: db_table = 'front_book' class BookOrder(models.Model): \"\"\"图书订单模型\"\"\" book = models.ForeignKey(\"Book\", on_delete=models.CASCADE) price = models.FloatField() class Meta: db_table = 'front_book_order' /* Navicat MySQL Data Transfer Source Server : zhiliao Source Server Version : 50718 Source Host : localhost:3306 Source Database : orm_aggregate_demo2 Target Server Type : MYSQL Target Server Version : 50718 File Encoding : 65001 */ SET FOREIGN_KEY_CHECKS=0; -- ---------------------------- -- Records of author -- ---------------------------- INSERT INTO `front_author` VALUES (1, '曹雪芹', '35', 'cxq@qq.com'); INSERT INTO `front_author` VALUES (2, '吴承恩', '28', 'wce@qq.com'); INSERT INTO `front_author` VALUES (3, '罗贯中', '36', 'lgz@qq.com'); INSERT INTO `front_author` VALUES (4, '施耐庵', '46', 'sna@qq.com'); -- ---------------------------- -- Records of book -- ---------------------------- INSERT INTO `front_book` VALUES ('1', '三国演义', '987', '98', '4.8', '3', '1'); INSERT INTO `front_book` VALUES ('2', '水浒传', '967', '97', '4.83', '4', '1'); INSERT INTO `front_book` VALUES ('3', '西游记', '1004', '95', '4.85', '2', '2'); INSERT INTO `front_book` VALUES ('4', '红楼梦', '1007', '99', '4.9', '1', '2'); -- ---------------------------- -- Records of book_order -- ---------------------------- INSERT INTO `front_book_order` VALUES ('1', '95', '1'); INSERT INTO `front_book_order` VALUES ('2', '85', '1'); INSERT INTO `front_book_order` VALUES ('3', '88', '1'); INSERT INTO `front_book_order` VALUES ('4', '94', '2'); INSERT INTO `front_book_order` VALUES ('5', '93', '2'); -- ---------------------------- -- Records of publisher -- ---------------------------- INSERT INTO `front_publisher` VALUES ('1', '中国邮电出版社'); INSERT INTO `front_publisher` VALUES ('2', '清华大学出版社'); 聚合查询 聚合查询函数是对一组值执行计算，并返回单个值。Django 使用聚合查询前要先从 django.db.models 引入 Avg、Max、Min、Count、Sum（首字母大写）。\nfrom .models import Book from django.db.models import Avg, Max, Min, Count, Sum def test(request): ## 查询所有图书的平均价格 avg_price = Book.objects.aggregate(Avg('price')) print(avg_price) ## 查询所有图书的最高价格 max_price = Book.objects.aggregate(Max('price')) print(max_price) ## 查询所有图书的最低价格 min_price = Book.objects.aggregate(Min('price')) print(min_price) ## 查询所有图书的价格之和 sum_price = Book.objects.aggregate(Sum('price')) print(sum_price) ## 查询所有图书的数量 count = Book.objects.aggregate(Count('id')) print(count) return HttpResponse(\"查询数据成功！\") aggregate() 示例 假设我们想要计算所有书籍的平均价格。\nfrom django.db.models import Avg from .models import Book ## 使用 aggregate() 方法来计算书籍的平均价格 average_price = Book.objects.aggregate(average=Avg('price')) ## average_price 是一个字典，包含键 'average'，其值为平均价格 print(average_price) ## 输出: {'average': 25.5} 假设平均价格为25.5 annotate() 示例 假设我们想要为每个出版社添加一个字段，表示该出版社出版的所有书籍的平均价格。\nfrom django.db.models import Avg from .models import Publisher, Book ## 使用 annotate() 方法为每个出版社添加一个平均价格字段 publishers_with_average_price = Publisher.objects.annotate(average_price=Avg('book__price')) ## 现在 publishers_with_average_price 是一个查询集，我们可以通过迭代来查看每个出版社及其平均价格 for publisher in publishers_with_average_price: print(f\"{publisher.name}: Average Book Price = {publisher.average_price}\") 在这个例子中，annotate() 方法为 Publisher 查询集中的每个出版社对象添加了一个 average_price 属性，表示该出版社出版的所有书籍的平均价格。\naggregate() 返回一个字典，其中包含了聚合函数的结果，适用于计算总和、平均值、最大值、最小值等聚合数据。 annotate() 返回一个查询集，其中的每个对象都添加了聚合字段，适用于为查询集中的每个对象添加聚合数据相关的字段。 这两个方法都使用 Django 的聚合函数，如 Sum、Avg、Max、Min 等，但是它们的使用场景和返回结果不同。aggregate() 用于获取单个或多个聚合值，而 annotate() 用于扩展查询集中每个对象的属性。\nF 表达式 以及 Q表达式 F 表达式 F 表达式（Field expressions）允许你引用模型字段，并在数据库层面上执行操作，而不是在 Python 层面上。这意味着你可以在查询中使用字段的当前值，而无需在 Python 中加载整个对象。\n使用场景:\n当你想基于现有字段的值进行计算或条件判断时。 当你想避免在 Python 层面上加载对象，从而提高查询效率时。 示例: 假设我们有一个 Book 模型，我们想要更新所有书籍的价格，使其变为当前价格的两倍。\nfrom .models import Book Book.objects.update(price=F('price') * 2) 在这个例子中，我们没有首先加载所有的 Book 对象到 Python 中，而是直接在数据库层面上将 price 字段的值乘以 2。\nQ 表达式 Q 表达式（Query expressions）提供了一种查询接口，允许你构建复杂的查询，可以包含多个条件，并且这些条件可以使用 \u0026（和）、|（或）和 ~（非）运算符来组合。\n使用场景:\n当你想构建包含多个条件的复杂查询时。 当你想使用逻辑运算符组合查询条件时。 示例: 假设我们想要查询所有由特定作者编写，并且价格大于 10 的书籍。\nfrom .models import Book from django.db.models import Q query = Q(author__name='John Doe') \u0026 Q(price__gt=10) books = Book.objects.filter(query) 在这个例子中，我们创建了一个 Q 对象，它表示作者是 “John Doe” 并且价格大于 10 的书籍。然后我们使用 filter() 方法来获取匹配这些条件的书籍。\nF 表达式 用于引用模型字段并在数据库层面上执行操作，如字段值的计算。 Q 表达式 用于构建复杂的查询，可以包含多个逻辑条件，并使用逻辑运算符进行组合。 F 表达式和 Q 表达式都是 Django ORM 中不可或缺的工具，它们可以帮助你编写更高效、更灵活的数据库查询。\nCookie 和 Session 操作 Cookie和Session简介 1. Cookie Cookies用于解决HTTP协议无状态的问题。当用户登录成功后，服务器会返回一些数据（cookie）给浏览器，浏览器将其保存。随后的请求中，浏览器自动携带cookie，服务器通过这些数据识别用户。\n限制: Cookie的数据量有限，通常不超过4KB，因此只能存储少量数据。 2. Session Session用于存储用户信息，与Cookie类似但更安全，因为数据存储在服务器端。不同服务器和框架有不同的实现方式。\n3. 使用场景 Server Side Session: 通过cookie存储session ID，数据存储在服务器的session中。 Client Side Session: Session数据加密后存储在cookie中。 Django中操作Cookie 设置Cookie 使用response.set_cookie方法，参数包括：\nkey: Cookie的键名。 value: Cookie的值。 max_age: 生命周期（秒）。 expires: 过期日期。 path: 有效的路径。 domain: 有效的域名。 secure: 是否仅在HTTPS下有效。 httponly: 是否禁止客户端脚本访问。 删除Cookie 使用delete_cookie，将cookie的值设置为空字符串，并设置过期时间为0。\n获取Cookie 通过request.COOKIES获取，这是一个字典类型对象。\nDjango中操作Session Django的session默认存储在数据库中，通过session ID与cookie交互。操作session使用request.session，包括：\nget: 获取值。 pop: 删除值。 keys: 获取所有键。 items: 获取所有项。 clear: 清除session数据。 flush: 删除session及cookie中的session ID。 set_expiry: 设置过期时间。 clear_expired: 清理过期session。 示例代码：\n# 获取所有cookie cookies = request.COOKIES for cookie_key, cookie_value in cookies.items(): print(cookie_key, cookie_value) # 使用session def index(request): username = request.session.get('username') return HttpResponse('index') 修改Session的存储机制 Django默认将Session数据存储在数据库中。但您可以通过设置SESSION_ENGINE来更改Session的存储位置。以下是几种可选的存储方案：\n数据库存储 (django.contrib.sessions.backends.db): 默认方案，Session数据存储在数据库中。 文件存储 (django.contrib.sessions.backends.file): Session数据存储在服务器的文件系统中。 缓存存储 (django.contrib.sessions.backends.cache): 将Session数据存储在缓存中，如Memcached。 需要在settings.py中配置CACHES。 缓存数据库混合存储 (django.contrib.sessions.backends.cached_db): 首先将Session数据存储在缓存中，然后同步到数据库。 即使缓存系统出现问题，Session数据也不会丢失。 加密Cookie存储 (django.contrib.sessions.backends.signed_cookies): 将Session信息加密后存储在浏览器的Cookie中。 需要考虑安全性，建议设置SESSION_COOKIE_HTTPONLY=True以防止通过JavaScript操作Session数据。 保护settings.py中的SECRET_KEY，防止解密Session数据。 Cookie中存储的数据量不能超过4KB。 请注意，选择存储方案时，需要根据您的应用需求和安全要求来决定最合适的方法。\n","wordCount":"15976","inLanguage":"zh-cn","datePublished":"2023-09-02T20:40:50+08:00","dateModified":"2024-01-02T20:40:50+08:00","author":{"@type":"Person","name":"Waite Wang"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://waite.wang/posts/python/learn-django-1/"},"publisher":{"@type":"Organization","name":"隶笔难书","logo":{"@type":"ImageObject","url":"https://waite.wang/images/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://waite.wang/ accesskey=h title="隶笔难书 (Alt + H)">隶笔难书</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://waite.wang/ title=首页><span>首页</span></a></li><li><a href=https://waite.wang/search title=搜索><span>搜索</span></a></li><li><a href=https://waite.wang/categories title=分类><span>分类</span></a></li><li><a href=https://waite.wang/tags title=标签><span>标签</span></a></li><li><a href=https://waite.wang/archives title=归档><span>归档</span></a></li><li><a href=https://waite.wang/links title=友链><span>友链</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://waite.wang/>Home</a>&nbsp;»&nbsp;<a href=https://waite.wang/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">初识 Django</h1><div class=post-description>Django 是一个高级的 Python Web 框架，它鼓励快速开发和干净、实用的设计。</div><div class=post-meta><span title='2023-09-02 20:40:50 +0800 +0800'>2023-09-02</span>&nbsp;·&nbsp;32 min&nbsp;·&nbsp;15976 words&nbsp;·&nbsp;Waite Wang&nbsp;|&nbsp;<a href=https://github.com/Waite0603/HugoBlog/edit/main/content/posts/python/learn-django-1.md rel="noopener noreferrer" target=_blank>在 GitHub 编辑</a>
&nbsp; | Last Updated:&nbsp;2024-01-02</div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e8%ae%a4%e8%af%86-django aria-label="认识 Django">认识 Django</a><ul><li><a href=#%e7%ae%80%e4%bb%8b aria-label=简介>简介</a></li><li><a href=#%e5%ae%89%e8%a3%85 aria-label=安装>安装</a></li><li><a href=#%e9%a1%b9%e7%9b%ae%e5%88%9b%e5%bb%ba%e4%b8%8e%e9%a1%b9%e7%9b%ae%e9%85%8d%e7%bd%ae aria-label=项目创建与项目配置>项目创建与项目配置</a><ul><li><a href=#django5%e5%88%9b%e5%bb%ba%e9%a1%b9%e7%9b%ae%e7%94%a8%e5%91%bd%e4%bb%a4%e6%96%b9%e5%bc%8f aria-label=Django5创建项目用命令方式>Django5创建项目用命令方式</a></li><li><a href=#django5%e5%88%9b%e5%bb%ba%e9%a1%b9%e7%9b%ae%e7%94%a8pycharm%e5%b7%a5%e5%85%b7 aria-label=Django5创建项目用PyCharm工具>Django5创建项目用PyCharm工具</a></li></ul></li><li><a href=#%e7%9b%ae%e5%bd%95%e7%bb%93%e6%9e%84 aria-label=目录结构>目录结构</a></li><li><a href=#%e8%a7%86%e5%9b%be%e5%92%8c-url-%e9%85%8d%e7%bd%ae aria-label="视图和 URL 配置">视图和 URL 配置</a></li><li><a href=#%e5%88%9b%e5%bb%baapp aria-label=创建app>创建app</a></li></ul></li><li><a href=#django-%e6%a8%a1%e6%9d%bf aria-label="Django 模板">Django 模板</a><ul><li><a href=#django-%e6%a8%a1%e6%9d%bf%e6%a0%87%e7%ad%be aria-label="Django 模板标签">Django 模板标签</a><ul><li><a href=#%e5%8f%98%e9%87%8f aria-label=变量>变量</a></li><li><a href=#%e5%88%97%e8%a1%a8 aria-label=列表>列表</a></li><li><a href=#%e8%bf%87%e6%bb%a4%e5%99%a8 aria-label=过滤器>过滤器</a></li><li><a href=#ifelse-%e6%a0%87%e7%ad%be aria-label="if/else 标签">if/else 标签</a></li><li><a href=#for-%e6%a0%87%e7%ad%be aria-label="for 标签">for 标签</a></li></ul></li><li><a href=#%e6%a8%a1%e5%9d%97%e5%8c%96 aria-label=模块化>模块化</a></li></ul></li><li><a href=#%e6%95%b0%e6%8d%ae%e5%ba%93%e6%93%8d%e4%bd%9c aria-label=数据库操作>数据库操作</a><ul><li><a href=#%e6%95%b0%e6%8d%ae%e5%ba%93%e9%85%8d%e7%bd%ae aria-label=数据库配置>数据库配置</a></li><li><a href=#%e6%99%ae%e9%80%9a-sql-%e5%a2%9e%e5%88%a0%e6%9f%a5%e6%94%b9 aria-label="普通 SQL 增删查改">普通 SQL 增删查改</a></li><li><a href=#django-orm aria-label="Django ORM">Django ORM</a><ul><li><a href=#%e5%ae%9a%e4%b9%89%e6%a8%a1%e5%9e%8b aria-label=定义模型>定义模型</a></li><li><a href=#%e5%ae%9e%e7%8e%b0%e5%9f%ba%e6%9c%ac-crud-%e6%93%8d%e4%bd%9c aria-label="实现基本 CRUD 操作">实现基本 CRUD 操作</a><ul><li><a href=#%e6%95%b0%e6%8d%ae%e5%ba%93%e6%b7%bb%e5%8a%a0 aria-label=数据库添加>数据库添加</a></li></ul></li><li><a href=#%e6%95%b0%e6%8d%ae%e5%ba%93%e6%9f%a5%e8%af%a2 aria-label=数据库查询>数据库查询</a><ul><li><a href=#%e5%88%a0%e9%99%a4 aria-label=删除>删除</a></li><li><a href=#%e4%bf%ae%e6%94%b9 aria-label=修改>修改</a></li></ul></li><li><a href=#%e6%a8%a1%e5%9e%8b%e5%b8%b8%e7%94%a8field%e5%92%8c%e5%8f%82%e6%95%b0 aria-label=模型常用Field和参数>模型常用Field和参数</a><ul><li><a href=#%e5%b8%b8%e7%94%a8%e5%ad%97%e6%ae%b5 aria-label=常用字段>常用字段</a></li><li><a href=#field%e7%9a%84%e5%b8%b8%e7%94%a8%e5%8f%82%e6%95%b0 aria-label=Field的常用参数>Field的常用参数</a></li><li><a href=#%e6%a8%a1%e5%9e%8b%e4%b8%ad-meta-%e9%85%8d%e7%bd%ae aria-label="模型中 Meta 配置">模型中 Meta 配置</a></li></ul></li><li><a href=#%e5%a4%96%e9%94%ae%e4%bd%bf%e7%94%a8 aria-label=外键使用>外键使用</a><ul><li><a href=#%e5%ae%9a%e4%b9%89 aria-label=定义>定义</a></li><li><a href=#%e5%a4%96%e9%94%ae%e5%88%a0%e9%99%a4%e6%93%8d%e4%bd%9c aria-label=外键删除操作>外键删除操作</a></li></ul></li><li><a href=#%e8%a1%a8%e7%9a%84%e5%85%b3%e7%b3%bb aria-label=表的关系>表的关系</a><ul><li><a href=#%e4%b8%80%e5%af%b9%e5%a4%9a aria-label=一对多>一对多</a></li><li><a href=#%e4%b8%80%e5%af%b9%e4%b8%80 aria-label=一对一>一对一</a></li><li><a href=#%e5%a4%9a%e5%af%b9%e5%a4%9a aria-label=多对多>多对多</a></li></ul></li><li><a href=#related_name%e5%92%8crelated_query_name aria-label=related_name和related_query_name>related_name和related_query_name</a></li><li><a href=#%e6%9f%a5%e8%af%a2%e6%93%8d%e4%bd%9c aria-label=查询操作>查询操作</a><ul><li><a href=#1-exact aria-label="1. exact">1. <code>exact</code></a></li><li><a href=#%e6%89%a7%e8%a1%8c%e7%b2%be%e7%a1%ae%e5%8c%b9%e9%85%8d%e7%9b%b8%e5%bd%93%e4%ba%8e-sql-%e4%b8%ad%e7%9a%84--%e6%93%8d%e4%bd%9c%e7%ac%a6%e5%a6%82%e6%9e%9c%e6%9f%a5%e8%af%a2%e5%80%bc%e4%b8%ba-none%e5%88%99%e5%9c%a8-sql-%e4%b8%ad%e5%af%b9%e5%ba%94-is-null aria-label="执行精确匹配，相当于 SQL 中的 = 操作符。如果查询值为 None，则在 SQL 中对应 IS NULL">执行精确匹配，相当于 SQL 中的 <code>=</code> 操作符。如果查询值为 <code>None</code>，则在 SQL 中对应 <code>IS NULL</code></a></li><li><a href=#2-iexact aria-label="2. iexact">2. <code>iexact</code></a></li><li><a href=#3-contains aria-label="3. contains">3. <code>contains</code></a></li><li><a href=#4-icontains aria-label="4. icontains">4. <code>icontains</code></a></li><li><a href=#5-in aria-label="5. in">5. <code>in</code></a></li><li><a href=#6-gt aria-label="6. gt">6. <code>gt</code></a></li><li><a href=#7-gte aria-label="7. gte">7. <code>gte</code></a></li><li><a href=#8-lt aria-label="8. lt">8. <code>lt</code></a></li><li><a href=#9-lte aria-label="9. lte">9. <code>lte</code></a></li><li><a href=#10-startswith aria-label="10. startswith">10. <code>startswith</code></a></li><li><a href=#11-istartswith aria-label="11. istartswith">11. <code>istartswith</code></a></li><li><a href=#12-endswith aria-label="12. endswith">12. <code>endswith</code></a></li><li><a href=#13-iendswith aria-label="13. iendswith">13. <code>iendswith</code></a></li><li><a href=#14-range aria-label="14. range">14. <code>range</code></a></li><li><a href=#15-date aria-label="15. date">15. <code>date</code></a></li><li><a href=#16-yearmonthdayweek_daytime aria-label="16. year、month、day、week_day、time">16. <code>year</code>、<code>month</code>、<code>day</code>、<code>week_day</code>、<code>time</code></a></li></ul></li><li><a href=#%e8%81%9a%e5%90%88%e5%87%bd%e6%95%b0 aria-label=聚合函数>聚合函数</a><ul><li><a href=#%e8%81%9a%e5%90%88%e6%9f%a5%e8%af%a2 aria-label=聚合查询>聚合查询</a></li><li><a href=#aggregate-%e7%a4%ba%e4%be%8b aria-label="aggregate() 示例">aggregate() 示例</a></li><li><a href=#annotate-%e7%a4%ba%e4%be%8b aria-label="annotate() 示例">annotate() 示例</a></li></ul></li><li><a href=#f-%e8%a1%a8%e8%be%be%e5%bc%8f-%e4%bb%a5%e5%8f%8a-q%e8%a1%a8%e8%be%be%e5%bc%8f aria-label="F 表达式 以及 Q表达式">F 表达式 以及 Q表达式</a><ul><li><a href=#f-%e8%a1%a8%e8%be%be%e5%bc%8f aria-label="F 表达式">F 表达式</a></li><li><a href=#q-%e8%a1%a8%e8%be%be%e5%bc%8f aria-label="Q 表达式">Q 表达式</a></li></ul></li></ul></li></ul></li><li><a href=#cookie-%e5%92%8c-session-%e6%93%8d%e4%bd%9c aria-label="Cookie 和 Session 操作">Cookie 和 Session 操作</a><ul><li><a href=#cookie%e5%92%8csession%e7%ae%80%e4%bb%8b aria-label=Cookie和Session简介>Cookie和Session简介</a><ul><li><a href=#1-cookie aria-label="1. Cookie">1. Cookie</a></li><li><a href=#2-session aria-label="2. Session">2. Session</a></li><li><a href=#3-%e4%bd%bf%e7%94%a8%e5%9c%ba%e6%99%af aria-label="3. 使用场景">3. 使用场景</a></li></ul></li><li><a href=#django%e4%b8%ad%e6%93%8d%e4%bd%9ccookie aria-label=Django中操作Cookie>Django中操作Cookie</a><ul><li><a href=#%e8%ae%be%e7%bd%aecookie aria-label=设置Cookie>设置Cookie</a></li><li><a href=#%e5%88%a0%e9%99%a4cookie aria-label=删除Cookie>删除Cookie</a></li><li><a href=#%e8%8e%b7%e5%8f%96cookie aria-label=获取Cookie>获取Cookie</a></li></ul></li><li><a href=#django%e4%b8%ad%e6%93%8d%e4%bd%9csession aria-label=Django中操作Session>Django中操作Session</a></li><li><a href=#%e4%bf%ae%e6%94%b9session%e7%9a%84%e5%ad%98%e5%82%a8%e6%9c%ba%e5%88%b6 aria-label=修改Session的存储机制>修改Session的存储机制</a></li></ul></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h2 id=认识-django>认识 Django<a hidden class=anchor aria-hidden=true href=#认识-django>#</a></h2><h3 id=简介>简介<a hidden class=anchor aria-hidden=true href=#简介>#</a></h3><p>Django(发音:[`dʒæŋɡəʊ]) 也有的小伙伴读成 “酱狗”，&ldquo;贱狗&rdquo;，&ldquo;进狗&rdquo;，&ldquo;撞狗&rdquo;，甚至还有读成"打
狗"。
官方：
<a href=https://www.djangoproject.com/ target=_blank>https://www.djangoproject.com/</a>
Django是一个高级的Python Web框架，可以快速开发安全和可维护的网站。由经验丰富的开发者构
建，Django负责处理网站开发中麻烦的部分，可以专注于编写应用程序，而无需重新开发。它是免费和
开源的，有活跃繁荣的社区，丰富的文档，以及很多免费和付费的解决方案。目前最新版本：5.0.1</p><h3 id=安装>安装<a hidden class=anchor aria-hidden=true href=#安装>#</a></h3><p>pip安装：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>pip install Django==5.0.1 -i https://pypi.tuna.tsinghua.edu.cn/simple
</span></span></code></pre></div><p>执行安装完成后，在python目录的Scripts下，会多出一个<code>diango-admin.exe</code> 这个是<code>django</code>项目创建工具</p><p><img alt=image-20240530202013347 loading=lazy src=https://qiniu.waite.wang/202405302020692.png></p><p>当然同时Lib下的<code>site-packages</code>下，也会有一个<code>django</code>目录，这个是后面我们开发项目会用到的<code>django</code>开发包。</p><p><img alt=image-20240530202047189 loading=lazy src=https://qiniu.waite.wang/202405302020300.png></p><h3 id=项目创建与项目配置>项目创建与项目配置<a hidden class=anchor aria-hidden=true href=#项目创建与项目配置>#</a></h3><h4 id=django5创建项目用命令方式>Django5创建项目用命令方式<a hidden class=anchor aria-hidden=true href=#django5创建项目用命令方式>#</a></h4><p>通过以下命令可以查看版本号：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>## python3 -V
</span></span><span class=line><span class=cl>Python 3.9.7
</span></span><span class=line><span class=cl>## python3 -m django --version
</span></span><span class=line><span class=cl>4.2.7
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>django-admin startproject 项目名称
</span></span></code></pre></div><p><img alt=image-20240530202153533 loading=lazy src=https://qiniu.waite.wang/202405302021361.png></p><h4 id=django5创建项目用pycharm工具>Django5创建项目用PyCharm工具<a hidden class=anchor aria-hidden=true href=#django5创建项目用pycharm工具>#</a></h4><p><img alt=image-20240530202246884 loading=lazy src=https://qiniu.waite.wang/202405302022094.png></p><h3 id=目录结构>目录结构<a hidden class=anchor aria-hidden=true href=#目录结构>#</a></h3><p>使用 django-admin 来创建 HelloWorld 项目：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>django-admin startproject HelloWorld
</span></span></code></pre></div><p>创建完成后我们可以查看下项目的目录结构：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ cd HelloWorld/
</span></span><span class=line><span class=cl>$ tree
</span></span><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>|-- HelloWorld
</span></span><span class=line><span class=cl>|   |-- __init__.py
</span></span><span class=line><span class=cl>|   |-- asgi.py
</span></span><span class=line><span class=cl>|   |-- settings.py
</span></span><span class=line><span class=cl>|   |-- urls.py
</span></span><span class=line><span class=cl>|   `-- wsgi.py
</span></span><span class=line><span class=cl>`-- manage.py
</span></span></code></pre></div><p>目录说明：</p><ul><li><strong>HelloWorld:</strong> 项目的容器。</li><li><strong>manage.py:</strong> 一个实用的命令行工具，可让你以各种方式与该 Django 项目进行交互。</li><li><strong>HelloWorld/<strong>init</strong>.py:</strong> 一个空文件，告诉 Python 该目录是一个 Python 包。</li><li><strong>HelloWorld/asgi.py:</strong> 一个 ASGI 兼容的 Web 服务器的入口，以便运行你的项目。</li><li><strong>HelloWorld/settings.py:</strong> 该 Django 项目的设置/配置。</li><li><strong>HelloWorld/urls.py:</strong> 该 Django 项目的 URL 声明; 一份由 Django 驱动的网站"目录"。</li><li><strong>HelloWorld/wsgi.py:</strong> 一个 WSGI 兼容的 Web 服务器的入口，以便运行你的项目。</li></ul><p>接下来我们进入 HelloWorld 目录输入以下命令，启动服务器：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>python3 manage.py runserver 0.0.0.0:8000
</span></span></code></pre></div><p>0.0.0.0 让其它电脑可连接到开发服务器，8000 为端口号。如果不说明，那么端口号默认为 8000。</p><p>在浏览器输入你服务器的 ip（这里我们输入本机 IP 地址： <strong>127.0.0.1:8000</strong>） 及端口号，如果正常启动，输出结果如下：</p><p><img alt=img loading=lazy src=https://qiniu.waite.wang/202405302024176.jpeg></p><h3 id=视图和-url-配置>视图和 URL 配置<a hidden class=anchor aria-hidden=true href=#视图和-url-配置>#</a></h3><p>在先前创建的 HelloWorld 目录下的 HelloWorld 目录新建一个 views.py 文件，并输入代码：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>django.http</span> <span class=kn>import</span> <span class=n>HttpResponse</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>hello</span><span class=p>(</span><span class=n>request</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>HttpResponse</span><span class=p>(</span><span class=s2>&#34;Hello world ! &#34;</span><span class=p>)</span>
</span></span></code></pre></div><p>接着，绑定 URL 与视图函数。打开 urls.py 文件，删除原来代码，将以下代码复制粘贴到 urls.py 文件中：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>django.urls</span> <span class=kn>import</span> <span class=n>path</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>.</span> <span class=kn>import</span> <span class=n>views</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=n>urlpatterns</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=n>path</span><span class=p>(</span><span class=s2>&#34;&#34;</span><span class=p>,</span> <span class=n>views</span><span class=o>.</span><span class=n>hello</span><span class=p>,</span> <span class=n>name</span><span class=o>=</span><span class=s2>&#34;hello&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></div><p>整个目录结构如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ tree
</span></span><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>|-- HelloWorld
</span></span><span class=line><span class=cl>|   |-- __init__.py
</span></span><span class=line><span class=cl>|   |-- __init__.pyc
</span></span><span class=line><span class=cl>|   |-- settings.py
</span></span><span class=line><span class=cl>|   |-- settings.pyc
</span></span><span class=line><span class=cl>|   |-- urls.py              ## url 配置
</span></span><span class=line><span class=cl>|   |-- urls.pyc
</span></span><span class=line><span class=cl>|   |-- views.py              ## 添加的视图文件
</span></span><span class=line><span class=cl>|   |-- views.pyc             ## 编译后的视图文件
</span></span><span class=line><span class=cl>|   |-- wsgi.py
</span></span><span class=line><span class=cl>|   `-- wsgi.pyc
</span></span><span class=line><span class=cl>`-- manage.py
</span></span></code></pre></div><p>完成后，启动 Django 开发服务器，并在浏览器访问打开浏览器并访问：</p><p><img alt=img loading=lazy src=https://qiniu.waite.wang/202405302027460.jpeg></p><p>我们也可以修改以下规则：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1>## HelloWorld/HelloWorld/urls.py 文件代码：</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>django.urls</span> <span class=kn>import</span> <span class=n>path</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>.</span> <span class=kn>import</span> <span class=n>views</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=n>urlpatterns</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=n>path</span><span class=p>(</span><span class=s1>&#39;hello/&#39;</span><span class=p>,</span> <span class=n>views</span><span class=o>.</span><span class=n>hello</span><span class=p>),</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></div><p>通过浏览器打开 **
<a href=http://127.0.0.1:8000/hello**%ef%bc%8c%e8%be%93%e5%87%ba%e7%bb%93%e6%9e%9c%e5%a6%82%e4%b8%8b%ef%bc%9a target=_blank>http://127.0.0.1:8000/hello**，输出结果如下：</a></p><p><img alt=img loading=lazy src=https://qiniu.waite.wang/202405302028324.jpeg></p><p>**注意：**项目中如果代码有改动，服务器会自动监测代码的改动并自动重新载入，所以如果你已经启动了服务器则不需手动重启。</p><h3 id=创建app>创建app<a hidden class=anchor aria-hidden=true href=#创建app>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>- 项目
</span></span><span class=line><span class=cl> - app，用户管理【表结构、函数、HTML模板、CSS】
</span></span><span class=line><span class=cl> - app，订单管理【表结构、函数、HTML模板、CSS】
</span></span><span class=line><span class=cl> - app，后台管理【表结构、函数、HTML模板、CSS】
</span></span><span class=line><span class=cl> - app，网站   【表结构、函数、HTML模板、CSS】
</span></span><span class=line><span class=cl> - app，API    【表结构、函数、HTML模板、CSS】
</span></span><span class=line><span class=cl> ..
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>注意：我们开发比较简洁，用不到多app，一般情况下，项目下创建1个app即可。
</span></span></code></pre></div><p><img alt=image-20240601153948318 loading=lazy src=https://qiniu.waite.wang/202406011539511.png></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>├── app01
</span></span><span class=line><span class=cl>│   ├── __init__.py
</span></span><span class=line><span class=cl>│   ├── admin.py         【固定，不用动】django默认提供了admin后台管理。
</span></span><span class=line><span class=cl>│   ├── apps.py          【固定，不用动】app启动类
</span></span><span class=line><span class=cl>│   ├── migrations       【固定，不用动】数据库变更记录
</span></span><span class=line><span class=cl>│   │   └── __init__.py
</span></span><span class=line><span class=cl>│   ├── models.py        【**重要**】，对数据库操作。
</span></span><span class=line><span class=cl>│   ├── tests.py         【固定，不用动】单元测试
</span></span><span class=line><span class=cl>│   └── views.py         【**重要**】，函数。
</span></span><span class=line><span class=cl>├── manage.py
</span></span><span class=line><span class=cl>└── mysite2
</span></span><span class=line><span class=cl>    ├── __init__.py
</span></span><span class=line><span class=cl>    ├── asgi.py
</span></span><span class=line><span class=cl>    ├── settings.py
</span></span><span class=line><span class=cl>    ├── urls.py          【URL-&gt;函数】
</span></span><span class=line><span class=cl>    └── wsgi.py
</span></span></code></pre></div><h2 id=django-模板>Django 模板<a hidden class=anchor aria-hidden=true href=#django-模板>#</a></h2><p>我们接着上一章节的项目将在 HelloWorld 目录底下创建 templates 目录并建立<code>hello.html</code>文件，整个目录结构如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>HelloWorld/
</span></span><span class=line><span class=cl>|-- HelloWorld
</span></span><span class=line><span class=cl>|   |-- __init__.py
</span></span><span class=line><span class=cl>|   |-- __init__.pyc
</span></span><span class=line><span class=cl>|   |-- settings.py
</span></span><span class=line><span class=cl>|   |-- settings.pyc
</span></span><span class=line><span class=cl>|   |-- urls.py
</span></span><span class=line><span class=cl>|   |-- urls.pyc
</span></span><span class=line><span class=cl>|   |-- views.py
</span></span><span class=line><span class=cl>|   |-- views.pyc
</span></span><span class=line><span class=cl>|   |-- wsgi.py
</span></span><span class=line><span class=cl>|   `-- wsgi.pyc
</span></span><span class=line><span class=cl>|-- manage.py
</span></span><span class=line><span class=cl>`-- templates
</span></span><span class=line><span class=cl>    `-- hello.html
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=c>&lt;!-- hello.html --&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;</span> {{ hello }} <span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>我们现在修改 views.py，增加一个新的对象，用于向模板提交数据：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1>## views.py </span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>hello_world</span><span class=p>(</span><span class=n>request</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>context</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;hello&#39;</span><span class=p>:</span> <span class=s1>&#39;Hello World11!&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>render</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=s1>&#39;hello.html&#39;</span><span class=p>,</span> <span class=n>context</span><span class=p>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1>## urls</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>django.urls</span> <span class=kn>import</span> <span class=n>path</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>.</span> <span class=kn>import</span> <span class=n>views</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>urlpatterns</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=n>path</span><span class=p>(</span><span class=s2>&#34;hello/&#34;</span><span class=p>,</span> <span class=n>views</span><span class=o>.</span><span class=n>hello_world</span><span class=p>,</span> <span class=n>name</span><span class=o>=</span><span class=s2>&#34;hello_world&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></div><p><img alt=img loading=lazy src=https://qiniu.waite.wang/6BC47EC1-ABC8-4EA7-A536-756648FBBC20.jpg></p><h3 id=django-模板标签>Django 模板标签<a hidden class=anchor aria-hidden=true href=#django-模板标签>#</a></h3><h4 id=变量>变量<a hidden class=anchor aria-hidden=true href=#变量>#</a></h4><p>模板语法：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>view：｛&#34;HTML变量名&#34; : &#34;views变量名&#34;｝
</span></span><span class=line><span class=cl>HTML：｛｛变量名｝｝
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1>## views.py</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>django.shortcuts</span> <span class=kn>import</span> <span class=n>render</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>runoob</span><span class=p>(</span><span class=n>request</span><span class=p>):</span> 
</span></span><span class=line><span class=cl>  <span class=n>views_name</span> <span class=o>=</span> <span class=s2>&#34;菜鸟教程&#34;</span> 
</span></span><span class=line><span class=cl>  <span class=k>return</span>  <span class=n>render</span><span class=p>(</span><span class=n>request</span><span class=p>,</span><span class=s2>&#34;runoob.html&#34;</span><span class=p>,</span> <span class=p>{</span><span class=s2>&#34;name&#34;</span><span class=p>:</span><span class=n>views_name</span><span class=p>})</span>
</span></span></code></pre></div><p>templates 中的 runoob.html ：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;p&gt;{{ name }}&lt;/p&gt;
</span></span></code></pre></div><p><img alt=img loading=lazy src=https://qiniu.waite.wang/202406011609908.jpeg></p><h4 id=列表>列表<a hidden class=anchor aria-hidden=true href=#列表>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>django.shortcuts</span> <span class=kn>import</span> <span class=n>render</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>runoob</span><span class=p>(</span><span class=n>request</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>views_list</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;菜鸟教程1&#34;</span><span class=p>,</span><span class=s2>&#34;菜鸟教程2&#34;</span><span class=p>,</span><span class=s2>&#34;菜鸟教程3&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>render</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=s2>&#34;runoob.html&#34;</span><span class=p>,</span> <span class=p>{</span><span class=s2>&#34;views_list&#34;</span><span class=p>:</span> <span class=n>views_list</span><span class=p>})</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;</span>{{ views_list }}<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>   ## 取出整个列表
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;</span>{{ views_list.0 }}<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span> ## 取出列表的第一个元素
</span></span></code></pre></div><p><img alt=image-20240601161226606 loading=lazy src=https://qiniu.waite.wang/202406011612712.png></p><h4 id=过滤器>过滤器<a hidden class=anchor aria-hidden=true href=#过滤器>#</a></h4><p>模板语法：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>{{ 变量名 | 过滤器：可选参数 }}
</span></span></code></pre></div><p>模板过滤器可以在变量被显示前修改它，过滤器使用管道字符，如下所示：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>{{ name|lower }}
</span></span></code></pre></div><p>{{ name }} 变量被过滤器 lower 处理后，文档大写转换文本为小写。</p><p>过滤管道可以被<em>套接</em> ，既是说，一个过滤器管道的输出又可以作为下一个管道的输入：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>{{ my_list|first|upper }}
</span></span></code></pre></div><p>以上实例将第一个元素并将其转化为大写。</p><p>有些过滤器有参数。 过滤器的参数跟随冒号之后并且总是以双引号包含。 例如：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>{{ bio|truncatewords:&#34;30&#34; }}
</span></span></code></pre></div><p>这个将显示变量 bio 的前30个词。</p><p>其他过滤器：</p><ul><li><p>addslashes : 添加反斜杠到任何反斜杠、单引号或者双引号前面。</p></li><li><p>date : 按指定的格式字符串参数格式化 date 或者 datetime 对象，实例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>{{ pub_date|date:&#34;F j, Y&#34; }}
</span></span></code></pre></div></li><li><p>length : 返回变量的长度。</p></li></ul><p><strong>default</strong></p><p>default 为变量提供一个默认值。</p><p>如果 views 传的变量的布尔值是 false，则使用指定的默认值。</p><p>以下值为 false：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>0  0.0  False  0j  &#34;&#34;  []  ()  set()  {}  None
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>django.shortcuts</span> <span class=kn>import</span> <span class=n>render</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>runoob</span><span class=p>(</span><span class=n>request</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span> <span class=o>=</span><span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>render</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=s2>&#34;runoob.html&#34;</span><span class=p>,</span> <span class=p>{</span><span class=s2>&#34;name&#34;</span><span class=p>:</span> <span class=n>name</span><span class=p>})</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>{{ name|default:&#34;菜鸟教程666&#34; }}
</span></span></code></pre></div><p><img alt=image-20240601161412458 loading=lazy src=https://qiniu.waite.wang/202406011614220.png></p><p><strong>length</strong></p><p>返回对象的长度，适用于字符串和列表。</p><p>字典返回的是键值对的数量，集合返回的是去重后的长度。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>{{ name|length}}
</span></span></code></pre></div><p><strong>filesizeformat</strong></p><p>以更易读的方式显示文件的大小（即'13 KB&rsquo;, &lsquo;4.1 MB&rsquo;, &lsquo;102 bytes&rsquo;等）。</p><p>字典返回的是键值对的数量，集合返回的是去重后的长度。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>django.shortcuts</span> <span class=kn>import</span> <span class=n>render</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>runoob</span><span class=p>(</span><span class=n>request</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>num</span><span class=o>=</span><span class=mi>1024</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>render</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=s2>&#34;runoob.html&#34;</span><span class=p>,</span> <span class=p>{</span><span class=s2>&#34;num&#34;</span><span class=p>:</span> <span class=n>num</span><span class=p>})</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>{{ num|filesizeformat}}
</span></span></code></pre></div><p><img alt=img loading=lazy src=https://qiniu.waite.wang/202406011615570.png></p><p><strong>date</strong></p><p>根据给定格式对一个日期变量进行格式化。</p><p>格式 <strong>Y-m-d H:i:s</strong>返回 <strong>年-月-日 小时:分钟:秒</strong> 的格式时间。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>django.shortcuts</span> <span class=kn>import</span> <span class=n>render</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>runoob</span><span class=p>(</span><span class=n>request</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=kn>import</span> <span class=nn>datetime</span>
</span></span><span class=line><span class=cl>    <span class=n>now</span>  <span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>render</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=s2>&#34;runoob.html&#34;</span><span class=p>,</span> <span class=p>{</span><span class=s2>&#34;time&#34;</span><span class=p>:</span> <span class=n>now</span><span class=p>})</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>{{ time|date:&#34;Y-m-d&#34; }}
</span></span></code></pre></div><p><img alt=img loading=lazy src=https://qiniu.waite.wang/202406011617906.png></p><p><strong>truncatechars</strong></p><p>如果字符串包含的字符总个数多于指定的字符数量，那么会被截断掉后面的部分。</p><p>截断的字符串将以 <strong>&mldr;</strong> 结尾。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>django.shortcuts</span> <span class=kn>import</span> <span class=n>render</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>runoob</span><span class=p>(</span><span class=n>request</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>views_str</span> <span class=o>=</span> <span class=s2>&#34;菜鸟教程&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>render</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=s2>&#34;runoob.html&#34;</span><span class=p>,</span> <span class=p>{</span><span class=s2>&#34;views_str&#34;</span><span class=p>:</span> <span class=n>views_str</span><span class=p>})</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>{{ views_str|truncatechars:2}}
</span></span></code></pre></div><p><img alt=img loading=lazy src=https://qiniu.waite.wang/202406011617607.png></p><p><strong>safe</strong></p><p>将字符串标记为安全，不需要转义。</p><p>要保证 views.py 传过来的数据绝对安全，才能用 safe。</p><p>和后端 views.py 的 mark_safe 效果相同。</p><p>Django 会自动对 views.py 传到HTML文件中的标签语法进行转义，令其语义失效。加 safe 过滤器是告诉 Django 该数据是安全的，不必对其进行转义，可以让该数据语义生效。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>django.shortcuts</span> <span class=kn>import</span> <span class=n>render</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>runoob</span><span class=p>(</span><span class=n>request</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>views_str</span> <span class=o>=</span> <span class=s2>&#34;&lt;a href=&#39;https://www.runoob.com/&#39;&gt;点击跳转&lt;/a&gt;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>render</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=s2>&#34;runoob.html&#34;</span><span class=p>,</span> <span class=p>{</span><span class=s2>&#34;views_str&#34;</span><span class=p>:</span> <span class=n>views_str</span><span class=p>})</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>{{ views_str|safe }}
</span></span></code></pre></div><blockquote><p>对比</p></blockquote><p><img alt=image-20240601161931407 loading=lazy src=https://qiniu.waite.wang/202406011619757.png></p><p><img alt=image-20240601161951788 loading=lazy src=https://qiniu.waite.wang/202406011619704.png></p><h4 id=ifelse-标签>if/else 标签<a hidden class=anchor aria-hidden=true href=#ifelse-标签>#</a></h4><p>基本语法格式如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>{% if condition %}
</span></span><span class=line><span class=cl>     ... display
</span></span><span class=line><span class=cl>{% endif %}
</span></span></code></pre></div><p>或者：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>{% if condition1 %}
</span></span><span class=line><span class=cl>   ... display 1
</span></span><span class=line><span class=cl>{% elif condition2 %}
</span></span><span class=line><span class=cl>   ... display 2
</span></span><span class=line><span class=cl>{% else %}
</span></span><span class=line><span class=cl>   ... display 3
</span></span><span class=line><span class=cl>{% endif %}
</span></span></code></pre></div><p>根据条件判断是否输出。if/else 支持嵌套。</p><p>{% if %} 标签接受 and ， or 或者 not 关键字来对多个变量做判断 ，或者对变量取反（ not )，例如：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>{% if athlete_list and coach_list %}
</span></span><span class=line><span class=cl>     athletes 和 coaches 变量都是可用的。
</span></span><span class=line><span class=cl>{% endif %}
</span></span></code></pre></div><h4 id=for-标签>for 标签<a hidden class=anchor aria-hidden=true href=#for-标签>#</a></h4><p>{% for %} 允许我们在一个序列上迭代。</p><p>与 Python 的 for 语句的情形类似，循环语法是 for X in Y ，Y 是要迭代的序列而 X 是在每一个特定的循环中使用的变量名称。</p><p>每一次循环中，模板系统会渲染在 <strong>{% for %}</strong> 和 <strong>{% endfor %}</strong> 之间的所有内容。</p><p>例如，给定一个运动员列表 athlete_list 变量，我们可以使用下面的代码来显示这个列表：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;ul&gt;
</span></span><span class=line><span class=cl>{% for athlete in athlete_list %}
</span></span><span class=line><span class=cl>    &lt;li&gt;{{ athlete.name }}&lt;/li&gt;
</span></span><span class=line><span class=cl>{% endfor %}
</span></span><span class=line><span class=cl>&lt;/ul&gt;
</span></span></code></pre></div><p>给标签增加一个 reversed 使得该列表被反向迭代：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>{% for athlete in athlete_list reversed %}
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>{% endfor %}
</span></span></code></pre></div><p><strong>遍历字典</strong>: 可以直接用字典 <strong>.items</strong> 方法，用变量的解包分别获取键和值。</p><p>在 {% for %} 标签里可以通过 {{forloop}} 变量获取循环序号。</p><ul><li>forloop.counter: 顺序获取循环序号，从 1 开始计算</li><li>forloop.counter0: 顺序获取循环序号，从 0 开始计算</li><li>forloop.revcounter: 倒序获取循环序号，结尾序号为 1</li><li>forloop.revcounter0: 倒序获取循环序号，结尾序号为 0</li><li>forloop.first（一般配合if标签使用）: 第一条数据返回 True，其他数据返回 False</li><li>forloop.last（一般配合if标签使用）: 最后一条数据返回 True，其他数据返回 False</li></ul><h3 id=模块化>模块化<a hidden class=anchor aria-hidden=true href=#模块化>#</a></h3><p><img alt=image-20240605150947706 loading=lazy src=https://qiniu.waite.wang/202406051509154.png></p><p>调整 <code>djangoProject/urls.py</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>django.urls</span> <span class=kn>import</span> <span class=n>path</span><span class=p>,</span> <span class=n>include</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>app</span> <span class=kn>import</span> <span class=n>views</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>## from . import views</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>urlpatterns</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=n>path</span><span class=p>(</span><span class=s1>&#39;book/&#39;</span><span class=p>,</span> <span class=n>include</span><span class=p>(</span><span class=s2>&#34;app.urls&#34;</span><span class=p>)),</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></div><p><code>app/urls.py</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>django.urls</span> <span class=kn>import</span> <span class=n>path</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>app</span> <span class=kn>import</span> <span class=n>views</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>urlpatterns</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=n>path</span><span class=p>(</span><span class=s2>&#34;home&#34;</span><span class=p>,</span> <span class=n>views</span><span class=o>.</span><span class=n>home</span><span class=p>,</span> <span class=n>name</span><span class=o>=</span><span class=s2>&#34;home&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>  <span class=n>path</span><span class=p>(</span><span class=s2>&#34;add&#34;</span><span class=p>,</span> <span class=n>views</span><span class=o>.</span><span class=n>add_book</span><span class=p>,</span> <span class=n>name</span><span class=o>=</span><span class=s2>&#34;add_book&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>  <span class=n>path</span><span class=p>(</span><span class=s2>&#34;query&#34;</span><span class=p>,</span> <span class=n>views</span><span class=o>.</span><span class=n>query_book</span><span class=p>,</span> <span class=n>name</span><span class=o>=</span><span class=s2>&#34;query_book&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>  <span class=n>path</span><span class=p>(</span><span class=s2>&#34;delete&#34;</span><span class=p>,</span> <span class=n>views</span><span class=o>.</span><span class=n>delete_book</span><span class=p>,</span> <span class=n>name</span><span class=o>=</span><span class=s2>&#34;delete_book&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>  <span class=n>path</span><span class=p>(</span><span class=s2>&#34;update&#34;</span><span class=p>,</span> <span class=n>views</span><span class=o>.</span><span class=n>update_book</span><span class=p>,</span> <span class=n>name</span><span class=o>=</span><span class=s2>&#34;update_book&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></div><p><img alt=image-20240605151102668 loading=lazy src=https://qiniu.waite.wang/202406051511917.png></p><h2 id=数据库操作>数据库操作<a hidden class=anchor aria-hidden=true href=#数据库操作>#</a></h2><h3 id=数据库配置>数据库配置<a hidden class=anchor aria-hidden=true href=#数据库配置>#</a></h3><p>安装环境</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>pip install mysqlclient
</span></span></code></pre></div><p>更改 settings.py 中的配置</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>DATABASES</span> <span class=o>=</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s1>&#39;default&#39;</span><span class=p>:</span> 
</span></span><span class=line><span class=cl>    <span class=p>{</span> 
</span></span><span class=line><span class=cl>        <span class=s1>&#39;ENGINE&#39;</span><span class=p>:</span> <span class=s1>&#39;django.db.backends.mysql&#39;</span><span class=p>,</span>    <span class=c1>## 数据库引擎</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;NAME&#39;</span><span class=p>:</span> <span class=s1>&#39;runoob&#39;</span><span class=p>,</span> <span class=c1>## 数据库名称</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;HOST&#39;</span><span class=p>:</span> <span class=s1>&#39;127.0.0.1&#39;</span><span class=p>,</span> <span class=c1>## 数据库地址，本机 ip 地址 127.0.0.1 </span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;PORT&#39;</span><span class=p>:</span> <span class=mi>3306</span><span class=p>,</span> <span class=c1>## 端口 </span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;USER&#39;</span><span class=p>:</span> <span class=s1>&#39;root&#39;</span><span class=p>,</span>  <span class=c1>## 数据库用户名</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;PASSWORD&#39;</span><span class=p>:</span> <span class=s1>&#39;123456&#39;</span><span class=p>,</span> <span class=c1>## 数据库密码</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>  
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>数据库配置是选择项目所使用的数据库的类型，不同的数据库需要设置不同的数据库引擎，数据库引擎</p><p>用于实现项目与数据库的连接，Django提供4种数据库引擎:</p><ul><li>&lsquo;django.db.backends.postgresql&rsquo;</li><li>&lsquo;django.db.backends.mysql&rsquo;</li><li>&lsquo;django.db.backends.sqlite3&rsquo;</li><li>&lsquo;django.db.backends.oracle&rsquo;</li></ul><p>我们有两种方式进行数据库的操作, 如下</p><h3 id=普通-sql-增删查改>普通 SQL 增删查改<a hidden class=anchor aria-hidden=true href=#普通-sql-增删查改>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1>## app/views</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>django.shortcuts</span> <span class=kn>import</span> <span class=n>render</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>django.db</span> <span class=kn>import</span> <span class=n>connection</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>## Create your views here.</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>home</span><span class=p>(</span><span class=n>request</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1>## 获取数据库连接</span>
</span></span><span class=line><span class=cl>    <span class=n>cursor</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>## 创建 book 表如果不存在</span>
</span></span><span class=line><span class=cl>    <span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;CREATE TABLE IF NOT EXISTS book (id INT PRIMARY KEY AUTO_INCREMENT, name VARCHAR(255))&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>## 插入数据</span>
</span></span><span class=line><span class=cl>    <span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;INSERT INTO book (name) VALUES (&#39;Python&#39;)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>## 查询数据</span>
</span></span><span class=line><span class=cl>    <span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;SELECT * FROM book&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>## 获取所有数据</span>
</span></span><span class=line><span class=cl>    <span class=n>books</span> <span class=o>=</span> <span class=n>cursor</span><span class=o>.</span><span class=n>fetchall</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>## 更改数据</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>books</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;Python&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;UPDATE book SET name = &#39;Java&#39; WHERE id = 1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;UPDATE book SET name = &#39;Python&#39; WHERE id = 1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>## 输出数据</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>book</span> <span class=ow>in</span> <span class=n>books</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>book</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>## 关闭数据库连接</span>
</span></span><span class=line><span class=cl>    <span class=n>cursor</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>render</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=s2>&#34;home.html&#34;</span><span class=p>,</span> <span class=p>{</span><span class=s2>&#34;books&#34;</span><span class=p>:</span> <span class=n>books</span><span class=p>})</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1>## 主项目/urls</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>django.urls</span> <span class=kn>import</span> <span class=n>path</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>app</span> <span class=kn>import</span> <span class=n>views</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>urlpatterns</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=n>path</span><span class=p>(</span><span class=s2>&#34;home/&#34;</span><span class=p>,</span> <span class=n>views</span><span class=o>.</span><span class=n>home</span><span class=p>,</span> <span class=n>name</span><span class=o>=</span><span class=s2>&#34;home&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE html&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>html</span> <span class=na>lang</span><span class=o>=</span><span class=s>&#34;en&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>meta</span> <span class=na>charset</span><span class=o>=</span><span class=s>&#34;UTF-8&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>title</span><span class=p>&gt;</span>Title<span class=p>&lt;/</span><span class=nt>title</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>{% for book in books %}
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;</span>{{ book}}<span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>{% endfor %}
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>html</span><span class=p>&gt;</span>
</span></span></code></pre></div><blockquote><p>效果如下</p></blockquote><p><img alt=image-20240602205856202 loading=lazy src=https://qiniu.waite.wang/202406022058040.png></p><h3 id=django-orm>Django ORM<a hidden class=anchor aria-hidden=true href=#django-orm>#</a></h3><p>Django 模型使用自带的 ORM。</p><p>对象关系映射（Object Relational Mapping，简称 ORM ）用于实现面向对象编程语言里不同类型系统的数据之间的转换。</p><p>ORM 在业务逻辑层和数据库层之间充当了桥梁的作用。</p><p>ORM 是通过使用描述对象和数据库之间的映射的元数据，将程序中的对象自动持久化到数据库中。</p><p><img alt=img loading=lazy src=https://qiniu.waite.wang/202406021619602.png></p><p>使用 ORM 的好处：</p><ul><li>提高开发效率。</li><li>不同数据库可以平滑切换。</li></ul><p>使用 ORM 的缺点：</p><ul><li>ORM 代码转换为 SQL 语句时，需要花费一定的时间，执行效率会有所降低。</li><li>长期写 ORM 代码，会降低编写 SQL 语句的能力。</li></ul><p>ORM 解析过程:</p><ul><li>1、ORM 会将 Python 代码转成为 SQL 语句。</li><li>2、SQL 语句通过 pymysql 传送到数据库服务端。</li><li>3、在数据库中执行 SQL 语句并将结果返回。</li></ul><p>ORM 对应关系表：</p><p><img alt=img loading=lazy src=https://qiniu.waite.wang/202406021619663.png></p><h4 id=定义模型>定义模型<a hidden class=anchor aria-hidden=true href=#定义模型>#</a></h4><p>Django 规定，如果要使用模型，必须要创建一个 app。我们使用以下命令创建一个 app 的 app:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>django-admin startapp app
</span></span></code></pre></div><p>创建一个新的 模块, 更改其中的 app.models</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>django.db</span> <span class=kn>import</span> <span class=n>models</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>## Create your models here.</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Book</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
</span></span><span class=line><span class=cl>  <span class=n>name</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>CharField</span><span class=p>(</span><span class=n>max_length</span><span class=o>=</span><span class=mi>255</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>author</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>CharField</span><span class=p>(</span><span class=n>max_length</span><span class=o>=</span><span class=mi>255</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>pub_time</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>DateField</span><span class=p>(</span><span class=n>auto_now_add</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>price</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>FloatField</span><span class=p>(</span><span class=n>default</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
</span></span></code></pre></div><p>以上的类名代表了数据库表名，且继承了models.Model，类里面的字段代表数据表中的字段(name)，数据类型则由CharField（相当于varchar）、DateField（相当于datetime）， max_length 参数限定长度。</p><p>接下来在 settings.py 中找到INSTALLED_APPS这一项，如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>INSTALLED_APPS</span> <span class=o>=</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;django.contrib.admin&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;django.contrib.auth&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;django.contrib.contenttypes&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;django.contrib.sessions&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;django.contrib.messages&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;django.contrib.staticfiles&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;app&#39;</span><span class=p>,</span>               <span class=c1>## 添加此项</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></div><p>在命令行中运行：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cmd data-lang=cmd><span class=line><span class=cl>python3 manage.py makemigrations  ## 让 Django 知道我们在我们的模型有一些变更
</span></span><span class=line><span class=cl>python3 manage.py migrate   ## 创建表结构
</span></span></code></pre></div><p><img alt=image-20240603144151895 loading=lazy src=https://qiniu.waite.wang/202406031441224.png></p><p>执行此命令, 也会把 django 自带的数据库导入进数据库中</p><p><img alt=image-20240603144845731 loading=lazy src=https://qiniu.waite.wang/202406031448969.png></p><p>编辑 <code>mysite/settings.py</code> 文件前，先设置
<a href=https://docs.djangoproject.com/zh-hans/5.0/ref/settings/#std-setting-TIME_ZONE target=_blank><code>TIME_ZONE</code></a> 为你自己时区。</p><p>此外，关注一下文件头部的
<a href=https://docs.djangoproject.com/zh-hans/5.0/ref/settings/#std-setting-INSTALLED_APPS target=_blank><code>INSTALLED_APPS</code></a> 设置项。这里包括了会在你项目中启用的所有 Django 应用。应用能在多个项目中使用，你也可以打包并且发布应用，让别人使用它们。</p><p>通常，
<a href=https://docs.djangoproject.com/zh-hans/5.0/ref/settings/#std-setting-INSTALLED_APPS target=_blank><code>INSTALLED_APPS</code></a> 默认包括了以下 Django 的自带应用：</p><ul><li><a href=https://docs.djangoproject.com/zh-hans/5.0/ref/contrib/admin/#module-django.contrib.admin target=_blank><code>django.contrib.admin</code></a> &ndash; 管理员站点， 你很快就会使用它。</li><li><a href=https://docs.djangoproject.com/zh-hans/5.0/topics/auth/#module-django.contrib.auth target=_blank><code>django.contrib.auth</code></a> &ndash; 认证授权系统。</li><li><a href=https://docs.djangoproject.com/zh-hans/5.0/ref/contrib/contenttypes/#module-django.contrib.contenttypes target=_blank><code>django.contrib.contenttypes</code></a> &ndash; 内容类型框架。</li><li><a href=https://docs.djangoproject.com/zh-hans/5.0/topics/http/sessions/#module-django.contrib.sessions target=_blank><code>django.contrib.sessions</code></a> &ndash; 会话框架。</li><li><a href=https://docs.djangoproject.com/zh-hans/5.0/ref/contrib/messages/#module-django.contrib.messages target=_blank><code>django.contrib.messages</code></a> &ndash; 消息框架。</li><li><a href=https://docs.djangoproject.com/zh-hans/5.0/ref/contrib/staticfiles/#module-django.contrib.staticfiles target=_blank><code>django.contrib.staticfiles</code></a> &ndash; 管理静态文件的框架。</li></ul><p>这些应用被默认启用是为了给常规项目提供方便。</p><p>默认开启的某些应用需要至少一个数据表，所以，在使用他们之前需要在数据库中创建一些表。请执行以下命令：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>python manage.py migrate
</span></span></code></pre></div><p>这个
<a href=https://docs.djangoproject.com/zh-hans/5.0/ref/django-admin/#django-admin-migrate target=_blank><code>migrate</code></a> 命令查看
<a href=https://docs.djangoproject.com/zh-hans/5.0/ref/settings/#std-setting-INSTALLED_APPS target=_blank><code>INSTALLED_APPS</code></a> 配置，并根据 <code>mysite/settings.py</code> 文件中的数据库配置和随应用提供的数据库迁移文件（我们将在后面介绍这些），创建任何必要的数据库表。你会看到它应用的每一个迁移都有一个消息。如果你有兴趣，运行你的数据库的命令行客户端，输入 <code>\dt</code> （PostgreSQL）， <code>SHOW TABLES;</code> （MariaDB，MySQL）， <code>.tables</code> （SQLite）或 <code>SELECT TABLE_NAME FROM USER_TABLES;</code> （Oracle）来显示 Django 创建的表。</p><blockquote><p>就像之前说的，为了方便大多数项目，我们默认激活了一些应用，但并不是每个人都需要它们。如果你不需要某个或某些应用，你可以在运行
<a href=https://docs.djangoproject.com/zh-hans/5.0/ref/django-admin/#django-admin-migrate target=_blank><code>migrate</code></a> 前毫无顾虑地从
<a href=https://docs.djangoproject.com/zh-hans/5.0/ref/settings/#std-setting-INSTALLED_APPS target=_blank><code>INSTALLED_APPS</code></a> 里注释或者删除掉它们。
<a href=https://docs.djangoproject.com/zh-hans/5.0/ref/django-admin/#django-admin-migrate target=_blank><code>migrate</code></a> 命令只会为在
<a href=https://docs.djangoproject.com/zh-hans/5.0/ref/settings/#std-setting-INSTALLED_APPS target=_blank><code>INSTALLED_APPS</code></a> 里声明了的应用进行数据库迁移。</p></blockquote><h4 id=实现基本-crud-操作>实现基本 CRUD 操作<a hidden class=anchor aria-hidden=true href=#实现基本-crud-操作>#</a></h4><h5 id=数据库添加>数据库添加<a hidden class=anchor aria-hidden=true href=#数据库添加>#</a></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>add_book</span><span class=p>(</span><span class=n>request</span><span class=p>):</span>
</span></span><span class=line><span class=cl>  <span class=n>book</span> <span class=o>=</span> <span class=n>Book</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=s2>&#34;Python&#34;</span><span class=p>,</span> <span class=n>author</span><span class=o>=</span><span class=s2>&#34;菜鸟教程&#34;</span><span class=p>,</span> <span class=n>price</span><span class=o>=</span><span class=mi>1024</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>book</span><span class=o>.</span><span class=n>save</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>## books = Book.objects.create(name=&#34;如来神掌&#34;, price=200, author=&#34;功夫出版社&#34;, pub_time=&#34;2010-10-10&#34;)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>HttpResponse</span><span class=p>(</span><span class=s2>&#34;添加数据成功！&#34;</span><span class=p>)</span>
</span></span></code></pre></div><h4 id=数据库查询>数据库查询<a hidden class=anchor aria-hidden=true href=#数据库查询>#</a></h4><blockquote><p>以下可能不全 具体可以参看官方文档</p></blockquote><ul><li><p>使用 <strong>all()</strong> 方法来查询所有内容。返回的是 QuerySet 类型数据，类似于 list，里面放的是一个个模型类的对象，可用索引下标取出模型类的对象。</p></li><li><p><strong>filter()</strong> 方法用于查询符合条件的数据。返回的是 QuerySet 类型数据，类似于 list，里面放的是满足条件的模型类的对象，可用索引下标取出模型类的对象。pk=3 的意思是主键 primary key=3，相当于 id=3。因为 id 在 pycharm 里有特殊含义，是看内存地址的内置函数 id()，因此用 pk。</p></li><li><p><strong>exclude()</strong> 方法用于查询不符合条件的数据。返回的是 QuerySet 类型数据，类似于 list，里面放的是不满足条件的模型类的对象，可用索引下标取出模型类的对象。</p></li><li><p><strong>get()</strong> 方法用于查询符合条件的返回模型类的对象符合条件的对象只能为一个，如果符合筛选条件的对象超过了一个或者没有一个都会抛出错误。</p></li><li><p><strong>order_by()</strong> 方法用于对查询结果进行排序。返回的是 QuerySet类型数据，类似于list，里面放的是排序后的模型类的对象，可用索引下标取出模型类的对象。</p><p><strong>注意：</strong></p><ul><li>a、参数的字段名要加引号。</li><li>b、降序为在字段前面加个负号 <strong>-</strong>。</li></ul></li><li><p><strong>reverse()</strong> 方法用于对查询结果进行反转。返回的是 QuerySe t类型数据，类似于 list，里面放的是反转后的模型类的对象，可用索引下标取出模型类的对象。</p></li><li><p><strong>count()</strong> 方法用于查询数据的数量返回的数据是整数。</p></li><li><p><strong>first()</strong> 方法返回第一条数据返回的数据是模型类的对象也可以用索引下标 <strong>[0]</strong>。</p></li><li><p>last() 方法返回最后一条数据返回的数据是模型类的对象不能用索引下标 <strong>[-1]</strong>，ORM 没有逆序索引。</p></li><li><p><strong>exists()</strong> 方法用于判断查询的结果 QuerySet 列表里是否有数据。返回的数据类型是布尔，有为 true，没有为 false。**注意：**判断的数据类型只能为 QuerySet 类型数据，不能为整型和模型类的对象。</p></li><li><p><strong>values()</strong> 方法用于查询部分字段的数据。返回的是 QuerySet 类型数据，类似于 list，里面不是模型类的对象，而是一个可迭代的字典序列，字典里的键是字段，值是数据。</p><p><strong>注意：</strong></p><ul><li>参数的字段名要加引号</li><li>想要字段名和数据用 <strong>values</strong>实例</li></ul></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>query_book</span><span class=p>(</span><span class=n>request</span><span class=p>):</span>
</span></span><span class=line><span class=cl>  <span class=n>books</span> <span class=o>=</span> <span class=n>Book</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>all</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=c1>## books = Book.objects.filter(name=&#34;Python&#34;)</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=n>book</span> <span class=ow>in</span> <span class=n>books</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>book</span><span class=o>.</span><span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>book_return</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;id&#34;</span><span class=p>:</span> <span class=n>book</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;name&#34;</span><span class=p>:</span> <span class=n>book</span><span class=o>.</span><span class=n>name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;author&#34;</span><span class=p>:</span> <span class=n>book</span><span class=o>.</span><span class=n>author</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;price&#34;</span><span class=p>:</span> <span class=n>book</span><span class=o>.</span><span class=n>price</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>for</span> <span class=n>book</span> <span class=ow>in</span> <span class=n>books</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>HttpResponse</span><span class=p>(</span><span class=s2>&#34;查询数据成功！&#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>book_return</span><span class=p>))</span>
</span></span></code></pre></div><h5 id=删除>删除<a hidden class=anchor aria-hidden=true href=#删除>#</a></h5><p>**方式一：**使用模型类的 <strong>对象.delete()</strong>。</p><p>**返回值：**元组，第一个元素为受影响的行数。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>books</span><span class=o>=</span><span class=n>models</span><span class=o>.</span><span class=n>Book</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>pk</span><span class=o>=</span><span class=mi>8</span><span class=p>)</span><span class=o>.</span><span class=n>first</span><span class=p>()</span><span class=o>.</span><span class=n>delete</span><span class=p>()</span>
</span></span></code></pre></div><p><strong>方式二</strong>：使用 QuerySet <strong>类型数据.delete()</strong>(推荐)</p><p>**返回值：**元组，第一个元素为受影响的行数。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>books</span><span class=o>=</span><span class=n>models</span><span class=o>.</span><span class=n>Book</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>pk__in</span><span class=o>=</span><span class=p>[</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>])</span><span class=o>.</span><span class=n>delete</span><span class=p>()</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>delete_book</span><span class=p>(</span><span class=n>request</span><span class=p>):</span>
</span></span><span class=line><span class=cl>  <span class=c1>## 使用 QuerySet 类型数据.delete()(推荐)</span>
</span></span><span class=line><span class=cl>  <span class=n>books</span> <span class=o>=</span> <span class=n>Book</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>pk__in</span><span class=o>=</span><span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>])</span><span class=o>.</span><span class=n>delete</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=nb>print</span><span class=p>(</span><span class=n>books</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>## 使用模型类的 对象.delete()。</span>
</span></span><span class=line><span class=cl>  <span class=n>books</span> <span class=o>=</span> <span class=n>Book</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=s2>&#34;Python&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>first</span><span class=p>()</span><span class=o>.</span><span class=n>delete</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=nb>print</span><span class=p>(</span><span class=n>books</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>HttpResponse</span><span class=p>(</span><span class=s2>&#34;删除数据成功！&#34;</span><span class=p>)</span>
</span></span></code></pre></div><p><strong>注意：</strong></p><ul><li>a. Django 删除数据时，会模仿 SQL约束 ON DELETE CASCADE 的行为，也就是删除一个对象时也会删除与它相关联的外键对象。</li><li>b. delete() 方法是 QuerySet 数据类型的方法，但并不适用于 Manager 本身。也就是想要删除所有数据，不能不写 all。</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>books</span><span class=o>=</span><span class=n>models</span><span class=o>.</span><span class=n>Book</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>delete</span><span class=p>()</span>　 <span class=c1>## 报错</span>
</span></span><span class=line><span class=cl><span class=n>books</span><span class=o>=</span><span class=n>models</span><span class=o>.</span><span class=n>Book</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>all</span><span class=p>()</span><span class=o>.</span><span class=n>delete</span><span class=p>()</span>　　 <span class=c1>## 删除成功</span>
</span></span></code></pre></div><h5 id=修改>修改<a hidden class=anchor aria-hidden=true href=#修改>#</a></h5><p><strong>方式一：</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>模型类的对象.属性 = 更改的属性值
</span></span><span class=line><span class=cl>模型类的对象.save()
</span></span></code></pre></div><p>**返回值：**编辑的模型类的对象。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>update_book</span><span class=p>(</span><span class=n>request</span><span class=p>):</span>
</span></span><span class=line><span class=cl>  <span class=n>book</span> <span class=o>=</span> <span class=n>Book</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=s2>&#34;Python&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>first</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=n>book</span><span class=o>.</span><span class=n>name</span> <span class=o>=</span> <span class=s2>&#34;Java&#34;</span>
</span></span><span class=line><span class=cl>  <span class=n>book</span><span class=o>.</span><span class=n>save</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>HttpResponse</span><span class=p>(</span><span class=s2>&#34;更新数据成功！&#34;</span><span class=p>)</span>
</span></span></code></pre></div><p>**方式二：**QuerySet 类型数据.update(字段名=更改的数据)（推荐）</p><p>**返回值：**整数，受影响的行数</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>Book</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=s2>&#34;Java&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>price</span><span class=o>=</span><span class=mi>100</span><span class=p>)</span>
</span></span></code></pre></div><h4 id=模型常用field和参数>模型常用Field和参数<a hidden class=anchor aria-hidden=true href=#模型常用field和参数>#</a></h4><h5 id=常用字段>常用字段<a hidden class=anchor aria-hidden=true href=#常用字段>#</a></h5><p>在Django中，定义了一些Field来与数据库表中的字段类型来进行映射。以下将介绍那些常用的字段类</p><p>型。</p><ol><li><p>AutoField：映射到数据库中是int类型，可以有自动增长的特性。一般不需要使用这个类型，如果不指定主键，那么模型会自动的生成一个叫做id的自动增长的主键。如果你想指定一个其他名字的并且具有自动增长的主键，使用AutoField也是可以的。</p></li><li><p>BigAutoField：64 位的整形，类似于AutoField，只不过是产生的数据的范围是从1-9223372036854775807。</p></li><li><p>BooleanField：在模型层面接收的是True/False。在数据库层面是tinyint类型。如果没有指定默认值，默认值是None。</p></li><li><p>CharField：在数据库层面是varchar类型。在Python层面就是普通的字符串。这个类型在使用的时候必须要指定最大的长度，也即必须要传递max_length这个关键字参数进去。</p></li><li><p>DateField：日期类型。在Python中是datetime.date类型，可以记录年月日。在映射到数据库中也是date类型。使用这个Field可以传递以下几个参数：</p><ol><li><p>auto_now：在每次这个数据保存的时候，都使用当前的时间。比如作为一个记录修改日期的字段，可以将这个属性设置为True。</p></li><li><p>auto_now_add：在每次数据第一次被添加进去的时候，都使用当前的时间。比如作为一个记录第一次入库的字段，可以将这个属性设置为True。</p></li></ol></li><li><p>DateTimeField：日期时间类型，类似于DateField。不仅仅可以存储日期，还可以存储时间。映射到数据库中是datetime类型。这个Field也可以使用auto_now和auto_now_add两个属性。</p></li><li><p>TimeField：时间类型。在数据库中是time类型。在Python中是datetime.time类型。</p></li><li><p>EmailField：类似于CharField。在数据库底层也是一个varchar类型。最大长度是 254 个字符。</p></li><li><p>FileField：用来存储文件的。这个请参考后面的文件上传章节部分。</p></li><li><p>ImageField：用来存储图片文件的。这个请参考后面的图片上传章节部分。</p></li><li><p>FloatField：浮点类型。映射到数据库中是float类型。</p></li><li><p>IntegerField：整形。值的区间是-2147483648——2147483647。</p></li><li><p>BigIntegerField：大整形。值的区间是-9223372036854775808——9223372036854775807。</p></li><li><p>PositiveIntegerField：正整形。值的区间是0——2147483647。</p></li><li><p>SmallIntegerField：小整形。值的区间是-32768——32767。</p></li><li><p>PositiveSmallIntegerField：正小整形。值的区间是0——32767。</p></li><li><p>TextField：大量的文本类型。映射到数据库中是longtext类型。</p></li><li><p>UUIDField：只能存储uuid格式的字符串。uuid是一个 32 位的全球唯一的字符串，一般用来作为主键。</p></li><li><p>URLField：类似于CharField，只不过只能用来存储url格式的字符串。并且默认的max_length是 200 。</p></li></ol><h5 id=field的常用参数>Field的常用参数<a hidden class=anchor aria-hidden=true href=#field的常用参数>#</a></h5><ol><li><p>null：如果设置为True，Django将会在映射表的时候指定是否为空。默认是为False。在使用字符串相关的Field（CharField/TextField）的时候，官方推荐尽量不要使用这个参数，也就是保持默认值False。因为Django在处理字符串相关的Field的时候，即使这个Field的null=False，如果你没有给这个Field传递任何值，那么Django也会使用一个空的字符串"&ldquo;来作为默认值存储进去。因此如果再使用null=True，Django会产生两种空值的情形（NULL或者空字符串）。如果想要在表单验证的时候允许这个字符串为空，那么建议使用blank=True。如果你的Field是BooleanField，那么对应的可空的字段则为NullBooleanField。</p></li><li><p>blank：标识这个字段在表单验证的时候是否可以为空。默认是False。这个和null是有区别的，null是一个纯数据库级别的。而blank是表单验证级别的。</p></li><li><p>db_column：这个字段在数据库中的名字。如果没有设置这个参数，那么将会使用模型中属性的名字。</p></li><li><p>default：默认值。可以为一个值，或者是一个函数，但是不支持lambda表达式。并且不支持列表/字典/集合等可变的数据结构。</p></li><li><p>primary_key：是否为主键。默认是False。</p></li><li><p>unique：在表中这个字段的值是否唯一。一般是设置手机号码/邮箱等。</p></li></ol><blockquote><p>更多Field参数请参考官方文档：
<a href=https://docs.djangoproject.com/zh-hans/5.0/ref/models/fields/ target=_blank>https://docs.djangoproject.com/zh-hans/5.0/ref/models/fields/</a></p></blockquote><h5 id=模型中-meta-配置>模型中 Meta 配置<a hidden class=anchor aria-hidden=true href=#模型中-meta-配置>#</a></h5><ol><li>db_table：这个模型映射到数据库中的表名。如果没有指定这个参数，那么在映射的时候将会使用模型名来作为默认的表名。</li><li>ordering：设置在提取数据的排序方式。后面章节会讲到如何查找数据。比如我想在查找数据的时候根据添加的时间排序，那么示例代码如下：</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>Book</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>CharField</span><span class=p>(</span><span class=n>max_length</span><span class=o>=</span><span class=mi>20</span><span class=p>,</span><span class=n>null</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>desc</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>CharField</span><span class=p>(</span><span class=n>max_length</span><span class=o>=</span><span class=mi>100</span><span class=p>,</span><span class=n>name</span><span class=o>=</span><span class=s1>&#39;description&#39;</span><span class=p>,</span><span class=n>db_column</span><span class=o>=</span><span class=s2>&#34;description1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>pub_date</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>DateTimeField</span><span class=p>(</span><span class=n>auto_now_add</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>class</span> <span class=nc>Meta</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>db_table</span> <span class=o>=</span> <span class=s1>&#39;book_model&#39;</span>
</span></span><span class=line><span class=cl>        <span class=n>ordering</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;pub_date&#39;</span><span class=p>]</span>
</span></span></code></pre></div><p>更多的配置后面会慢慢介绍到。 官方文档：
<a href=https://docs.djangoproject.com/zh-hans/5.0/ref/models/ target=_blank>https://docs.djangoproject.com/zh-hans/5.0/ref/models/</a></p><h4 id=外键使用>外键使用<a hidden class=anchor aria-hidden=true href=#外键使用>#</a></h4><p>在MySQL中，表有两种引擎，一种是<code>InnoDB</code>，另外一种是<code>myisam</code>。如果使用的是<code>InnoDB</code>引擎，是支持外键约束的。外键的存在使得ORM框架在处理表关系的时候异常的强大。因此这里我们首先来介绍下外键在Django中的使用。</p><blockquote><ol><li><strong>InnoDB</strong>:<ul><li><strong>事务支持</strong>：InnoDB支持事务处理，具有提交(commit)、回滚(rollback)和崩溃恢复能力，适合需要事务处理的应用。</li><li><strong>行级锁定</strong>：InnoDB使用行级锁定和MVCC（多版本并发控制），在高并发环境下性能更好。</li><li><strong>外键约束</strong>：InnoDB支持外键约束，有助于保持数据的完整性。</li><li><strong>崩溃恢复</strong>：InnoDB具有崩溃恢复的能力，可以保证数据的安全性。</li><li><strong>存储限制</strong>：InnoDB表有16TB的存储限制。</li><li><strong>默认引擎</strong>：从MySQL 5.5.5版本开始，InnoDB成为了MySQL的默认存储引擎。</li></ul></li><li><strong>MyISAM</strong>:<ul><li><strong>表级锁定</strong>：MyISAM使用表级锁定，这意味着在高并发环境下，性能可能不如InnoDB。</li><li><strong>全文索引</strong>：MyISAM提供了全文索引功能，适合需要全文搜索的应用。</li><li><strong>没有事务支持</strong>：MyISAM不支持事务处理，适用于不需要事务的应用。</li><li><strong>存储限制</strong>：MyISAM表有256TB的存储限制。</li><li><strong>快速读取</strong>：MyISAM通常在读取密集型的应用中表现更好，因为它的索引结构设计得更简单。</li></ul></li></ol><p>选择哪种存储引擎取决于你的应用需求。如果需要事务支持、行级锁定和外键约束，InnoDB通常是更好的选择。如果应用主要是读取密集型，并且需要全文索引功能，那么MyISAM可能更合适。不过，由于InnoDB的广泛特性和性能优势，它在现代应用中被广泛使用。</p></blockquote><h5 id=定义>定义<a hidden class=anchor aria-hidden=true href=#定义>#</a></h5><p>类定义为 class ForeignKey(to,on_delete,**options) 。第一个参数是引用的是哪个模型，第二个参数是在使用外键引用的模型数据被删除了，这个字段该如何处理，比如有 CASCADE 、 SET_NULL 等。这里以一个实际案例来说明。比如有一个 User 和一个 Article 两个模型。一个 User 可以发表多篇文章，一个 Article 只能有一个 Author ，并且通过外键进行引用。那么相关的示例代码如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>django.db</span> <span class=kn>import</span> <span class=n>models</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>User</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
</span></span><span class=line><span class=cl>  <span class=n>username</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>CharField</span><span class=p>(</span><span class=n>max_length</span><span class=o>=</span><span class=mi>255</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>password</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>CharField</span><span class=p>(</span><span class=n>max_length</span><span class=o>=</span><span class=mi>255</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Article</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
</span></span><span class=line><span class=cl>  <span class=n>title</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>CharField</span><span class=p>(</span><span class=n>max_length</span><span class=o>=</span><span class=mi>255</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>content</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>TextField</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>## 外键</span>
</span></span><span class=line><span class=cl>  <span class=n>author</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>ForeignKey</span><span class=p>(</span><span class=s1>&#39;User&#39;</span><span class=p>,</span> <span class=n>on_delete</span><span class=o>=</span><span class=n>models</span><span class=o>.</span><span class=n>CASCADE</span><span class=p>)</span>
</span></span></code></pre></div><blockquote><p>如果不同的 app, 可以这样子使用外键 <code>author = models.ForeignKey('app.User', on_delete=models.CASCADE)</code></p></blockquote><p>以上使用 ForeignKey 来定义模型之间的关系。即在 article 的实例中可以通过 author 属性来操作对应的 User 模型。这样使用起来非常的方便。示例代码如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>django.shortcuts</span> <span class=kn>import</span> <span class=n>HttpResponse</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>.models</span> <span class=kn>import</span> <span class=n>User</span><span class=p>,</span> <span class=n>Article</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>article_test</span><span class=p>(</span><span class=n>request</span><span class=p>):</span>
</span></span><span class=line><span class=cl>  <span class=c1>## user = User(username=&#34;admin&#34;, password=&#34;123456&#34;)</span>
</span></span><span class=line><span class=cl>  <span class=c1>## user.save()</span>
</span></span><span class=line><span class=cl>  <span class=c1>#</span>
</span></span><span class=line><span class=cl>  <span class=c1>## article = Article(title=&#34;Django&#34;, content=&#34;Django 是一个开放源代码的 Web 应用框架，由 Python 编写。&#34;, author=user)</span>
</span></span><span class=line><span class=cl>  <span class=c1>## article.save()</span>
</span></span><span class=line><span class=cl>  <span class=n>article</span> <span class=o>=</span> <span class=n>Article</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>first</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>HttpResponse</span><span class=p>(</span><span class=n>article</span><span class=o>.</span><span class=n>author</span><span class=o>.</span><span class=n>username</span><span class=p>)</span>
</span></span></code></pre></div><p><img alt=image-20240605171858982 loading=lazy src=https://qiniu.waite.wang/202406051719076.png></p><p>如果模型的外键引用的是本身自己这个模型，那么 to 参数可以为 &lsquo;self&rsquo; ，或者是这个模型的名字。在论坛开发中，一般评论都可以进行二级评论，即可以针对另外一个评论进行评论，那么在定义模型的时候就需要使用外键来引用自身。示例代码如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>Comment</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
</span></span><span class=line><span class=cl>  <span class=n>content</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>TextField</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=n>article</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>ForeignKey</span><span class=p>(</span><span class=s1>&#39;self&#39;</span><span class=p>,</span> <span class=n>on_delete</span><span class=o>=</span><span class=n>models</span><span class=o>.</span><span class=n>CASCADE</span><span class=p>,</span> <span class=n>null</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=c1>## or</span>
</span></span><span class=line><span class=cl>  <span class=n>article</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>ForeignKey</span><span class=p>(</span><span class=s1>&#39;Comment&#39;</span><span class=p>,</span> <span class=n>on_delete</span><span class=o>=</span><span class=n>models</span><span class=o>.</span><span class=n>CASCADE</span><span class=p>,</span> <span class=n>null</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span></code></pre></div><h5 id=外键删除操作>外键删除操作<a hidden class=anchor aria-hidden=true href=#外键删除操作>#</a></h5><p>在数据库中使用外键（Foreign Key）时，我们需要考虑当外键所引用的记录被删除时，应如何处理与该记录相关联的其他记录。Django ORM 提供了几种 <code>on_delete</code> 选项来处理这种情况，每种选项都定义了不同的行为。以下是这些选项的解释：</p><ol><li><strong>CASCADE</strong>：当外键所引用的主键记录被删除时，所有引用该记录的外键记录也将被自动删除。这种操作称为级联删除，它确保了数据库的引用完整性。</li><li><strong>PROTECT</strong>：当尝试删除一个被外键引用的主键记录时，如果存在引用，Django 会抛出一个 <code>ProtectedError</code> 异常，阻止删除操作。这是一种保护机制，确保数据的完整性不被破坏。</li><li><strong>SET_NULL</strong>：如果外键所引用的主键记录被删除，那么所有引用该记录的外键字段将被设置为 <code>NULL</code>。使用这个选项之前，需要确保外键字段在数据库中允许为空（<code>null=True</code>）。</li><li><strong>SET_DEFAULT</strong>：当外键所引用的主键记录被删除时，所有引用该记录的外键字段将被设置为字段的默认值。这要求外键字段在定义时有一个默认值。</li><li><strong>SET()</strong>：允许你指定一个可调用的对象（如函数或方法），当外键所引用的主键记录被删除时，Django 会调用这个对象，并使用返回的值来更新外键字段。这提供了高度的灵活性，可以根据业务逻辑来决定如何更新外键字段。</li><li><strong>DO_NOTHING</strong>：这个选项不会在 Django 层面上做任何操作，所有的约束都依赖于数据库级别的约束。如果数据库设置为不允许删除被引用的记录（如 <code>RESTRICT</code>），那么删除操作将会失败。</li></ol><p>需要注意的是，尽管 Django 提供了多种 <code>on_delete</code> 选项，但数据库层面的行为不会改变。例如，如果数据库设置为 <code>RESTRICT</code>，则即使 Django 设置为 <code>CASCADE</code>，数据库也不会执行级联删除，而是会阻止删除操作。因此，在使用 <code>on_delete</code> 选项时，还需要考虑数据库层面的约束。</p><h4 id=表的关系>表的关系<a hidden class=anchor aria-hidden=true href=#表的关系>#</a></h4><p>表与表之间的关系可分为以下三种：</p><ul><li><strong>一对一</strong>: 一个人对应一个身份证号码，数据字段设置 unique。</li><li><strong>一对多</strong>: 一个家庭有多个人，一般通过外键来实现。</li><li><strong>多对多</strong>: 一个学生有多门课程，一个课程有很多学生，一般通过第三个表来实现关联。</li></ul><h5 id=一对多>一对多<a hidden class=anchor aria-hidden=true href=#一对多>#</a></h5><ol><li><p>应用场景：比如文章和作者之间的关系。一个文章只能由一个作者编写，但是一个作者可以写多篇文章。文章和作者之间的关系就是典型的多对一的关系。</p></li><li><p>实现方式：一对多或者多对一，都是通过ForeignKey来实现的。还是以文章和作者的案例进行讲解。那么以后在给Article对象指定author，就可以使用以下代码来完成：</p></li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>django.db</span> <span class=kn>import</span> <span class=n>models</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>User</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
</span></span><span class=line><span class=cl>  <span class=n>username</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>CharField</span><span class=p>(</span><span class=n>max_length</span><span class=o>=</span><span class=mi>255</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>password</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>CharField</span><span class=p>(</span><span class=n>max_length</span><span class=o>=</span><span class=mi>255</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Article</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
</span></span><span class=line><span class=cl>  <span class=n>title</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>CharField</span><span class=p>(</span><span class=n>max_length</span><span class=o>=</span><span class=mi>255</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>content</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>TextField</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>## 外键</span>
</span></span><span class=line><span class=cl>  <span class=n>author</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>ForeignKey</span><span class=p>(</span><span class=s1>&#39;User&#39;</span><span class=p>,</span> <span class=n>on_delete</span><span class=o>=</span><span class=n>models</span><span class=o>.</span><span class=n>CASCADE</span><span class=p>)</span>
</span></span></code></pre></div><p>并且以后如果想要获取某个用户下所有的文章，可以通过<code>article_set</code>来实现。示例代码如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>article_test</span><span class=p>(</span><span class=n>request</span><span class=p>):</span>
</span></span><span class=line><span class=cl>  <span class=n>user</span> <span class=o>=</span> <span class=n>User</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>first</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=c1>## ## user.save()</span>
</span></span><span class=line><span class=cl>  <span class=c1>## #</span>
</span></span><span class=line><span class=cl>  <span class=c1>## article = Article(title=&#34;Django12&#34;, content=&#34;Django 是一个开放源代码的 Web 应用框架，由 Python 编写。&#34;, author=user)</span>
</span></span><span class=line><span class=cl>  <span class=c1>## article.save()</span>
</span></span><span class=line><span class=cl>  <span class=n>article</span> <span class=o>=</span> <span class=n>user</span><span class=o>.</span><span class=n>article_set</span><span class=o>.</span><span class=n>all</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=n>a</span> <span class=ow>in</span> <span class=n>article</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>a</span><span class=o>.</span><span class=n>title</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>a</span><span class=o>.</span><span class=n>content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>a</span><span class=o>.</span><span class=n>author</span><span class=o>.</span><span class=n>username</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>HttpResponse</span><span class=p>(</span><span class=s2>&#34;添加数据成功！&#34;</span><span class=p>)</span>
</span></span></code></pre></div><h5 id=一对一>一对一<a hidden class=anchor aria-hidden=true href=#一对一>#</a></h5><ol><li><p>应用场景：比如一个用户表和一个用户信息表。在实际网站中，可能需要保存用户的许多信息，但是有些信息是不经常用的。如果把所有信息都存放到一张表中可能会影响查询效率，因此可以把用户的一些不常用的信息存放到另外一张表中我们叫做<code>UserExtension</code>。但是用户表<code>User</code>和用户信息表<code>UserExtension</code>就是典型的一对一了。</p></li><li><p>实现方式：Django为一对一提供了一个专门的Field叫做<code>OneToOneField</code>来实现一对一操作。示例代码如下：</p></li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>django.db</span> <span class=kn>import</span> <span class=n>models</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>User</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
</span></span><span class=line><span class=cl>  <span class=n>username</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>CharField</span><span class=p>(</span><span class=n>max_length</span><span class=o>=</span><span class=mi>255</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>password</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>CharField</span><span class=p>(</span><span class=n>max_length</span><span class=o>=</span><span class=mi>255</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>UserExtension</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
</span></span><span class=line><span class=cl>  <span class=n>birthday</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>DateField</span><span class=p>(</span><span class=n>null</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>school</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>CharField</span><span class=p>(</span><span class=n>max_length</span><span class=o>=</span><span class=mi>255</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=c1>## user = models.OneToOneField(&#39;User&#39;, on_delete=models.CASCADE, related_name=&#39;extension&#39;)</span>
</span></span><span class=line><span class=cl>  <span class=n>user</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>OneToOneField</span><span class=p>(</span><span class=s1>&#39;User&#39;</span><span class=p>,</span> <span class=n>on_delete</span><span class=o>=</span><span class=n>models</span><span class=o>.</span><span class=n>CASCADE</span><span class=p>)</span>
</span></span></code></pre></div><p><img alt=image-20240605174601778 loading=lazy src=https://qiniu.waite.wang/202406051746248.png></p><blockquote><p>只允许一对一, 超过既会报错,</p><p>在<code>UserExtension</code>模型上增加了一个一对一的关系映射。其实底层是在<code>UserExtension</code>这个表上增加了一个user_id，来和user表进行关联，并且这个外键数据在表中必须是唯一的，来保证一对一。</p></blockquote><h5 id=多对多>多对多<a hidden class=anchor aria-hidden=true href=#多对多>#</a></h5><ol><li><p>应用场景：比如文章和标签的关系。一篇文章可以有多个标签，一个标签可以被多个文章所引用。因此标签和文章的关系是典型的多对多的关系。</p></li><li><p>实现方式：Django为这种多对多的实现提供了专门的Field。叫做ManyToManyField。还是拿文章和标签为例进行讲解。示例代码如下：</p></li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>Article</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
</span></span><span class=line><span class=cl>  <span class=n>title</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>CharField</span><span class=p>(</span><span class=n>max_length</span><span class=o>=</span><span class=mi>255</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>content</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>TextField</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>## 外键</span>
</span></span><span class=line><span class=cl>  <span class=n>author</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>ForeignKey</span><span class=p>(</span><span class=s1>&#39;User&#39;</span><span class=p>,</span> <span class=n>on_delete</span><span class=o>=</span><span class=n>models</span><span class=o>.</span><span class=n>CASCADE</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=c1>## 多对多</span>
</span></span><span class=line><span class=cl>  <span class=n>tags</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>ManyToManyField</span><span class=p>(</span><span class=s1>&#39;Tag&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Tag</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
</span></span><span class=line><span class=cl>  <span class=n>name</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>CharField</span><span class=p>(</span><span class=n>max_length</span><span class=o>=</span><span class=mi>255</span><span class=p>)</span>
</span></span></code></pre></div><p>在数据库层面，实际上Django是为这种多对多的关系建立了一个中间表。这个中间表分别定义了两个外键，引用到article和tag两张表的主键。</p><p><img alt=image-20240605175459605 loading=lazy src=https://qiniu.waite.wang/202406051755978.png></p><h4 id=related_name和related_query_name>related_name和related_query_name<a hidden class=anchor aria-hidden=true href=#related_name和related_query_name>#</a></h4><p>在 Django 中，<code>related_name</code> 和 <code>related_query_name</code> 是两个与模型的外键关系相关的参数，它们允许你自定义反向关系和查询的名称。</p><ol><li><code>related_name</code></li></ol><p><code>related_name</code> 是 <code>ForeignKey</code> 或 <code>ManyToManyField</code> 字段的一个选项，它允许你为反向关系指定一个自定义名称。默认情况下，Django 会使用 <code>&lt;模型名>_set</code> 作为反向关系的名称（例如，<code>Article</code> 模型的反向关系默认为 <code>article_set</code>）。但是，如果你想要一个更有意义的名称或避免名称冲突，你可以使用 <code>related_name</code> 来指定。</p><p>例如，如果你有一个 <code>User</code> 模型和一个 <code>Article</code> 模型，并且每个用户可以有多个文章，你可以这样定义模型：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>Article</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>title</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>CharField</span><span class=p>(</span><span class=n>max_length</span><span class=o>=</span><span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>content</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>TextField</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=c1>## 使用related_name指定反向关系名称为&#39;articles&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>author</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>ForeignKey</span><span class=p>(</span><span class=s2>&#34;User&#34;</span><span class=p>,</span> <span class=n>on_delete</span><span class=o>=</span><span class=n>models</span><span class=o>.</span><span class=n>SET_NULL</span><span class=p>,</span> <span class=n>null</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>related_name</span><span class=o>=</span><span class=s1>&#39;articles&#39;</span><span class=p>)</span>
</span></span></code></pre></div><p>这样，你就可以通过 <code>user.articles.all()</code> 来获取一个用户的所有文章。</p><p>如果你不想使用任何自定义的反向关系名称，可以设置 <code>related_name='+'</code>，这将禁用自动生成的 <code>&lt;模型名>_set</code> 名称。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>Article</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>title</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>CharField</span><span class=p>(</span><span class=n>max_length</span><span class=o>=</span><span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>content</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>TextField</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=c1>## 传递related_name参数，以后在方向引用的时候使用articles进行访问</span>
</span></span><span class=line><span class=cl>    <span class=n>author</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>ForeignKey</span><span class=p>(</span><span class=s2>&#34;User&#34;</span><span class=p>,</span><span class=n>on_delete</span><span class=o>=</span><span class=n>models</span><span class=o>.</span><span class=n>SET_NULL</span><span class=p>,</span><span class=n>null</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span><span class=n>related_name</span><span class=o>=</span><span class=s1>&#39;+&#39;</span><span class=p>)</span>
</span></span></code></pre></div><ol start=2><li><code>related_query_name</code></li></ol><p><code>related_query_name</code> 是 <code>related_name</code> 的一个补充选项，它允许你自定义在查询集中使用 <code>filter</code> 方法时反向关系的名称。默认情况下，Django 会使用 <code>related_name</code> 的值加上下划线和字段名来生成查询名称（例如，<code>articles_title</code>）。</p><p>如果你设置了 <code>related_name='articles'</code>，那么在进行反向查询时，你可以这样写：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>users</span> <span class=o>=</span> <span class=n>User</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>articles__title</span><span class=o>=</span><span class=s1>&#39;abc&#39;</span><span class=p>)</span>
</span></span></code></pre></div><p>如果你想要一个不同的查询名称，可以使用 <code>related_query_name</code> 来指定：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>Article</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>title</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>CharField</span><span class=p>(</span><span class=n>max_length</span><span class=o>=</span><span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>content</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>TextField</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=c1>## 使用related_name指定反向关系名称为&#39;articles&#39;</span>
</span></span><span class=line><span class=cl>    <span class=c1>## 使用related_query_name指定查询时的名称为&#39;article&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>author</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>ForeignKey</span><span class=p>(</span><span class=s2>&#34;User&#34;</span><span class=p>,</span> <span class=n>on_delete</span><span class=o>=</span><span class=n>models</span><span class=o>.</span><span class=n>SET_NULL</span><span class=p>,</span> <span class=n>null</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>related_name</span><span class=o>=</span><span class=s1>&#39;articles&#39;</span><span class=p>,</span> <span class=n>related_query_name</span><span class=o>=</span><span class=s1>&#39;article&#39;</span><span class=p>)</span>
</span></span></code></pre></div><p>这样，你就可以使用 <code>article__title</code> 来进行查询：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>users</span> <span class=o>=</span> <span class=n>User</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>article__title</span><span class=o>=</span><span class=s1>&#39;abc&#39;</span><span class=p>)</span>
</span></span></code></pre></div><p>请注意，<code>related_query_name</code> 只在反向查询中使用，而 <code>related_name</code> 用于定义反向关系名称。</p><p>最后，你提供的代码片段中有一些格式错误和不完整的部分，我已经根据上下文进行了修正。如果你有更具体的问题或需要进一步的帮助，请随时提问。</p><h4 id=查询操作>查询操作<a hidden class=anchor aria-hidden=true href=#查询操作>#</a></h4><p>查找是数据库操作中一个非常重要的技术。查询一般就是使用 filter 、 exclude 以及 get 三个方法来实现。我们可以在调用这些方法的时候传递不同的参数来实现查询需求。在 ORM 层面，这些查询条件都是使用 field + __ + condition 的方式来使用的。以下将那些常用的查询条件来一一解释。</p><p>在 Django 中，查询集（QuerySet）提供了多种方法来过滤和查询数据库中的数据。以下是对您提供的查询条件的优化格式和解释：</p><h5 id=1-exact>1. <code>exact</code><a hidden class=anchor aria-hidden=true href=#1-exact>#</a></h5><h5 id=执行精确匹配相当于-sql-中的--操作符如果查询值为-none则在-sql-中对应-is-null>执行精确匹配，相当于 SQL 中的 <code>=</code> 操作符。如果查询值为 <code>None</code>，则在 SQL 中对应 <code>IS NULL</code><a hidden class=anchor aria-hidden=true href=#执行精确匹配相当于-sql-中的--操作符如果查询值为-none则在-sql-中对应-is-null>#</a></h5><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>article = Article.objects.get(id__exact=14)
</span></span><span class=line><span class=cl>article = Article.objects.get(id__exact=None)
</span></span></code></pre></div><p><strong>SQL 翻译</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>SELECT ... FROM article WHERE id = 14;
</span></span><span class=line><span class=cl>SELECT ... FROM article WHERE id IS NULL;
</span></span></code></pre></div><h5 id=2-iexact>2. <code>iexact</code><a hidden class=anchor aria-hidden=true href=#2-iexact>#</a></h5><p>执行不区分大小写的模糊匹配，相当于 SQL 中的 <code>LIKE</code> 操作符。</p><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>article = Article.objects.filter(title__iexact=&#39;hello world&#39;)
</span></span></code></pre></div><p><strong>SQL 翻译</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>SELECT ... FROM article WHERE title LIKE &#39;hello world&#39;;
</span></span></code></pre></div><h5 id=3-contains>3. <code>contains</code><a hidden class=anchor aria-hidden=true href=#3-contains>#</a></h5><p>执行大小写敏感的模糊匹配，字段值包含给定的字符串。</p><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>articles = Article.objects.filter(title__contains=&#39;hello&#39;)
</span></span></code></pre></div><p><strong>SQL 翻译</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>SELECT ... WHERE title LIKE BINARY &#39;%hello%&#39;;
</span></span></code></pre></div><h5 id=4-icontains>4. <code>icontains</code><a hidden class=anchor aria-hidden=true href=#4-icontains>#</a></h5><p>与 <code>contains</code> 类似，但不区分大小写。</p><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>articles = Article.objects.filter(title__icontains=&#39;hello&#39;)
</span></span></code></pre></div><p><strong>SQL 翻译</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>SELECT ... WHERE title LIKE &#39;%hello%&#39;;
</span></span></code></pre></div><h5 id=5-in>5. <code>in</code><a hidden class=anchor aria-hidden=true href=#5-in>#</a></h5><p>检查字段值是否包含在给定的容器中，容器可以是列表、元组或任何可迭代对象。</p><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>articles = Article.objects.filter(id__in=[1, 2, 3])
</span></span></code></pre></div><p><strong>SQL 翻译</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>SELECT ... WHERE id IN (1, 2, 3);
</span></span></code></pre></div><h5 id=6-gt>6. <code>gt</code><a hidden class=anchor aria-hidden=true href=#6-gt>#</a></h5><p>检查字段值是否大于给定值。</p><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>articles = Article.objects.filter(id__gt=4)
</span></span></code></pre></div><p><strong>SQL 翻译</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>SELECT ... WHERE id &gt; 4;
</span></span></code></pre></div><h5 id=7-gte>7. <code>gte</code><a hidden class=anchor aria-hidden=true href=#7-gte>#</a></h5><p>检查字段值是否大于或等于给定值。</p><h5 id=8-lt>8. <code>lt</code><a hidden class=anchor aria-hidden=true href=#8-lt>#</a></h5><p>检查字段值是否小于给定值。</p><h5 id=9-lte>9. <code>lte</code><a hidden class=anchor aria-hidden=true href=#9-lte>#</a></h5><p>检查字段值是否小于或等于给定值。</p><h5 id=10-startswith>10. <code>startswith</code><a hidden class=anchor aria-hidden=true href=#10-startswith>#</a></h5><p>检查字段值是否以特定字符串开始，大小写敏感。</p><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>articles = Article.objects.filter(title__startswith=&#39;hello&#39;)
</span></span></code></pre></div><p><strong>SQL 翻译</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>SELECT ... WHERE title LIKE &#39;hello%&#39;;
</span></span></code></pre></div><h5 id=11-istartswith>11. <code>istartswith</code><a hidden class=anchor aria-hidden=true href=#11-istartswith>#</a></h5><p>与 <code>startswith</code> 类似，但不区分大小写。</p><h5 id=12-endswith>12. <code>endswith</code><a hidden class=anchor aria-hidden=true href=#12-endswith>#</a></h5><p>检查字段值是否以特定字符串结束，大小写敏感。</p><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>articles = Article.objects.filter(title__endswith=&#39;world&#39;)
</span></span></code></pre></div><p><strong>SQL 翻译</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>SELECT ... WHERE title LIKE &#39;%world&#39;;
</span></span></code></pre></div><h5 id=13-iendswith>13. <code>iendswith</code><a hidden class=anchor aria-hidden=true href=#13-iendswith>#</a></h5><p>与 <code>endswith</code> 类似，但不区分大小写。</p><h5 id=14-range>14. <code>range</code><a hidden class=anchor aria-hidden=true href=#14-range>#</a></h5><p>检查字段值是否在给定的范围内。</p><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>start_date = datetime(2018, 1, 1)
</span></span><span class=line><span class=cl>end_date = datetime(2018, 12, 31)
</span></span><span class=line><span class=cl>articles = Article.objects.filter(pub_date__range=(start_date, end_date))
</span></span></code></pre></div><p><strong>SQL 翻译</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>SELECT ... FROM article WHERE pub_date BETWEEN &#39;2018-01-01&#39; AND &#39;2018-12-31&#39;;
</span></span></code></pre></div><h5 id=15-date>15. <code>date</code><a hidden class=anchor aria-hidden=true href=#15-date>#</a></h5><p>针对 <code>DateField</code> 或 <code>DateTimeField</code> 类型的字段，可以指定日期的范围。</p><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>articles = Article.objects.filter(pub_date__date=date(2018, 3, 29))
</span></span></code></pre></div><p><strong>SQL 翻译</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>SELECT ... WHERE DATE(pub_date) = &#39;2018-03-29&#39;;
</span></span></code></pre></div><h5 id=16-yearmonthdayweek_daytime>16. <code>year</code>、<code>month</code>、<code>day</code>、<code>week_day</code>、<code>time</code><a hidden class=anchor aria-hidden=true href=#16-yearmonthdayweek_daytime>#</a></h5><p>这些查询条件允许你根据日期和时间的特定部分进行过滤。</p><p><strong>示例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>articles = Article.objects.filter(pub_date__year=2018)
</span></span><span class=line><span class=cl>articles = Article.objects.filter(pub_date__time=datetime.time(12, 12, 12))
</span></span></code></pre></div><p><strong>SQL 翻译</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>SELECT ... WHERE YEAR(pub_date) = 2018;
</span></span><span class=line><span class=cl>SELECT ... WHERE TIME(pub_date) = &#39;12:12:12&#39;;
</span></span></code></pre></div><p>这些查询条件使得在 Django 中进行数据库查询变得非常灵活和强大。你可以根据需要选择合适的查询条件来获取所需的数据。更多详细信息和高级用法，请参考
<a href=https://docs.djangoproject.com/en/5.0/ref/models/querysets/#field-lookups target=_blank>Django 官方文档</a>。</p><h4 id=聚合函数>聚合函数<a hidden class=anchor aria-hidden=true href=#聚合函数>#</a></h4><blockquote><p>前期准备</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>django.db</span> <span class=kn>import</span> <span class=n>models</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Author</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;&#34;&#34;作者模型&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>  <span class=n>name</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>CharField</span><span class=p>(</span><span class=n>max_length</span><span class=o>=</span><span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>age</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>IntegerField</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=n>email</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>EmailField</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>class</span> <span class=nc>Meta</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>db_table</span> <span class=o>=</span> <span class=s1>&#39;front_author&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Publisher</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;&#34;&#34;出版社模型&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>  <span class=n>name</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>CharField</span><span class=p>(</span><span class=n>max_length</span><span class=o>=</span><span class=mi>300</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>class</span> <span class=nc>Meta</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>db_table</span> <span class=o>=</span> <span class=s1>&#39;front_publisher&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Book</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;&#34;&#34;图书模型&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>  <span class=n>name</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>CharField</span><span class=p>(</span><span class=n>max_length</span><span class=o>=</span><span class=mi>300</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>pages</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>IntegerField</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=n>price</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>FloatField</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=n>rating</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>FloatField</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=n>author</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>ForeignKey</span><span class=p>(</span><span class=n>Author</span><span class=p>,</span> <span class=n>on_delete</span><span class=o>=</span><span class=n>models</span><span class=o>.</span><span class=n>CASCADE</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>publisher</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>ForeignKey</span><span class=p>(</span><span class=n>Publisher</span><span class=p>,</span> <span class=n>on_delete</span><span class=o>=</span><span class=n>models</span><span class=o>.</span><span class=n>CASCADE</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>class</span> <span class=nc>Meta</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>db_table</span> <span class=o>=</span> <span class=s1>&#39;front_book&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>BookOrder</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;&#34;&#34;图书订单模型&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>  <span class=n>book</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>ForeignKey</span><span class=p>(</span><span class=s2>&#34;Book&#34;</span><span class=p>,</span> <span class=n>on_delete</span><span class=o>=</span><span class=n>models</span><span class=o>.</span><span class=n>CASCADE</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>price</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>FloatField</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>class</span> <span class=nc>Meta</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>db_table</span> <span class=o>=</span> <span class=s1>&#39;front_book_order&#39;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm>Navicat MySQL Data Transfer
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>Source Server         : zhiliao
</span></span></span><span class=line><span class=cl><span class=cm>Source Server Version : 50718
</span></span></span><span class=line><span class=cl><span class=cm>Source Host           : localhost:3306
</span></span></span><span class=line><span class=cl><span class=cm>Source Database       : orm_aggregate_demo2
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>Target Server Type    : MYSQL
</span></span></span><span class=line><span class=cl><span class=cm>Target Server Version : 50718
</span></span></span><span class=line><span class=cl><span class=cm>File Encoding         : 65001
</span></span></span><span class=line><span class=cl><span class=cm>*/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SET</span><span class=w> </span><span class=n>FOREIGN_KEY_CHECKS</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- ----------------------------
</span></span></span><span class=line><span class=cl><span class=c1>-- Records of author
</span></span></span><span class=line><span class=cl><span class=c1>-- ----------------------------
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>front_author</span><span class=o>`</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;曹雪芹&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;35&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;cxq@qq.com&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>front_author</span><span class=o>`</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;吴承恩&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;28&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;wce@qq.com&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>front_author</span><span class=o>`</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;罗贯中&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;36&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;lgz@qq.com&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>front_author</span><span class=o>`</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>4</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;施耐庵&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;46&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;sna@qq.com&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- ----------------------------
</span></span></span><span class=line><span class=cl><span class=c1>-- Records of book
</span></span></span><span class=line><span class=cl><span class=c1>-- ----------------------------
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>front_book</span><span class=o>`</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;1&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;三国演义&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;987&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;98&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;4.8&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;3&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;1&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>front_book</span><span class=o>`</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;2&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;水浒传&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;967&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;97&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;4.83&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;4&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;1&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>front_book</span><span class=o>`</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;3&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;西游记&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;1004&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;95&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;4.85&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;2&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;2&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>front_book</span><span class=o>`</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;4&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;红楼梦&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;1007&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;99&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;4.9&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;1&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;2&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- ----------------------------
</span></span></span><span class=line><span class=cl><span class=c1>-- Records of book_order
</span></span></span><span class=line><span class=cl><span class=c1>-- ----------------------------
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>front_book_order</span><span class=o>`</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;1&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;95&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;1&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>front_book_order</span><span class=o>`</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;2&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;85&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;1&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>front_book_order</span><span class=o>`</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;3&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;88&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;1&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>front_book_order</span><span class=o>`</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;4&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;94&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;2&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>front_book_order</span><span class=o>`</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;5&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;93&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;2&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- ----------------------------
</span></span></span><span class=line><span class=cl><span class=c1>-- Records of publisher
</span></span></span><span class=line><span class=cl><span class=c1>-- ----------------------------
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>front_publisher</span><span class=o>`</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;1&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;中国邮电出版社&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>front_publisher</span><span class=o>`</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;2&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;清华大学出版社&#39;</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><h5 id=聚合查询>聚合查询<a hidden class=anchor aria-hidden=true href=#聚合查询>#</a></h5><p>聚合查询函数是对一组值执行计算，并返回单个值。Django 使用聚合查询前要先从 django.db.models 引入 Avg、Max、Min、Count、Sum（首字母大写）。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>.models</span> <span class=kn>import</span> <span class=n>Book</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>django.db.models</span> <span class=kn>import</span> <span class=n>Avg</span><span class=p>,</span> <span class=n>Max</span><span class=p>,</span> <span class=n>Min</span><span class=p>,</span> <span class=n>Count</span><span class=p>,</span> <span class=n>Sum</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test</span><span class=p>(</span><span class=n>request</span><span class=p>):</span>
</span></span><span class=line><span class=cl>  <span class=c1>## 查询所有图书的平均价格</span>
</span></span><span class=line><span class=cl>  <span class=n>avg_price</span> <span class=o>=</span> <span class=n>Book</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>aggregate</span><span class=p>(</span><span class=n>Avg</span><span class=p>(</span><span class=s1>&#39;price&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=nb>print</span><span class=p>(</span><span class=n>avg_price</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>## 查询所有图书的最高价格</span>
</span></span><span class=line><span class=cl>  <span class=n>max_price</span> <span class=o>=</span> <span class=n>Book</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>aggregate</span><span class=p>(</span><span class=n>Max</span><span class=p>(</span><span class=s1>&#39;price&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=nb>print</span><span class=p>(</span><span class=n>max_price</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>## 查询所有图书的最低价格</span>
</span></span><span class=line><span class=cl>  <span class=n>min_price</span> <span class=o>=</span> <span class=n>Book</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>aggregate</span><span class=p>(</span><span class=n>Min</span><span class=p>(</span><span class=s1>&#39;price&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=nb>print</span><span class=p>(</span><span class=n>min_price</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>## 查询所有图书的价格之和</span>
</span></span><span class=line><span class=cl>  <span class=n>sum_price</span> <span class=o>=</span> <span class=n>Book</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>aggregate</span><span class=p>(</span><span class=n>Sum</span><span class=p>(</span><span class=s1>&#39;price&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=nb>print</span><span class=p>(</span><span class=n>sum_price</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>## 查询所有图书的数量</span>
</span></span><span class=line><span class=cl>  <span class=n>count</span> <span class=o>=</span> <span class=n>Book</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>aggregate</span><span class=p>(</span><span class=n>Count</span><span class=p>(</span><span class=s1>&#39;id&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=nb>print</span><span class=p>(</span><span class=n>count</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>HttpResponse</span><span class=p>(</span><span class=s2>&#34;查询数据成功！&#34;</span><span class=p>)</span>
</span></span></code></pre></div><p><img alt=image-20240605212533357 loading=lazy src=https://qiniu.waite.wang/202406052125655.png></p><h5 id=aggregate-示例>aggregate() 示例<a hidden class=anchor aria-hidden=true href=#aggregate-示例>#</a></h5><p>假设我们想要计算所有书籍的平均价格。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>from django.db.models import Avg
</span></span><span class=line><span class=cl>from .models import Book
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>## 使用 aggregate() 方法来计算书籍的平均价格
</span></span><span class=line><span class=cl>average_price = Book.objects.aggregate(average=Avg(&#39;price&#39;))
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>## average_price 是一个字典，包含键 &#39;average&#39;，其值为平均价格
</span></span><span class=line><span class=cl>print(average_price)  ## 输出: {&#39;average&#39;: 25.5} 假设平均价格为25.5
</span></span></code></pre></div><h5 id=annotate-示例>annotate() 示例<a hidden class=anchor aria-hidden=true href=#annotate-示例>#</a></h5><p>假设我们想要为每个出版社添加一个字段，表示该出版社出版的所有书籍的平均价格。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>from django.db.models import Avg
</span></span><span class=line><span class=cl>from .models import Publisher, Book
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>## 使用 annotate() 方法为每个出版社添加一个平均价格字段
</span></span><span class=line><span class=cl>publishers_with_average_price = Publisher.objects.annotate(average_price=Avg(&#39;book__price&#39;))
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>## 现在 publishers_with_average_price 是一个查询集，我们可以通过迭代来查看每个出版社及其平均价格
</span></span><span class=line><span class=cl>for publisher in publishers_with_average_price:
</span></span><span class=line><span class=cl>    print(f&#34;{publisher.name}: Average Book Price = {publisher.average_price}&#34;)
</span></span></code></pre></div><p>在这个例子中，<code>annotate()</code> 方法为 <code>Publisher</code> 查询集中的每个出版社对象添加了一个 <code>average_price</code> 属性，表示该出版社出版的所有书籍的平均价格。</p><ul><li><code>aggregate()</code> 返回一个字典，其中包含了聚合函数的结果，适用于计算总和、平均值、最大值、最小值等聚合数据。</li><li><code>annotate()</code> 返回一个查询集，其中的每个对象都添加了聚合字段，适用于为查询集中的每个对象添加聚合数据相关的字段。</li></ul><p>这两个方法都使用 Django 的聚合函数，如 <code>Sum</code>、<code>Avg</code>、<code>Max</code>、<code>Min</code> 等，但是它们的使用场景和返回结果不同。<code>aggregate()</code> 用于获取单个或多个聚合值，而 <code>annotate()</code> 用于扩展查询集中每个对象的属性。</p><h4 id=f-表达式-以及-q表达式>F 表达式 以及 Q表达式<a hidden class=anchor aria-hidden=true href=#f-表达式-以及-q表达式>#</a></h4><h5 id=f-表达式>F 表达式<a hidden class=anchor aria-hidden=true href=#f-表达式>#</a></h5><p>F 表达式（Field expressions）允许你引用模型字段，并在数据库层面上执行操作，而不是在 Python 层面上。这意味着你可以在查询中使用字段的当前值，而无需在 Python 中加载整个对象。</p><p><strong>使用场景</strong>:</p><ul><li>当你想基于现有字段的值进行计算或条件判断时。</li><li>当你想避免在 Python 层面上加载对象，从而提高查询效率时。</li></ul><p><strong>示例</strong>: 假设我们有一个 <code>Book</code> 模型，我们想要更新所有书籍的价格，使其变为当前价格的两倍。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>from .models import Book
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Book.objects.update(price=F(&#39;price&#39;) * 2)
</span></span></code></pre></div><p>在这个例子中，我们没有首先加载所有的 <code>Book</code> 对象到 Python 中，而是直接在数据库层面上将 <code>price</code> 字段的值乘以 2。</p><h5 id=q-表达式>Q 表达式<a hidden class=anchor aria-hidden=true href=#q-表达式>#</a></h5><p>Q 表达式（Query expressions）提供了一种查询接口，允许你构建复杂的查询，可以包含多个条件，并且这些条件可以使用 <code>&</code>（和）、<code>|</code>（或）和 <code>~</code>（非）运算符来组合。</p><p><strong>使用场景</strong>:</p><ul><li>当你想构建包含多个条件的复杂查询时。</li><li>当你想使用逻辑运算符组合查询条件时。</li></ul><p><strong>示例</strong>: 假设我们想要查询所有由特定作者编写，并且价格大于 10 的书籍。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>from .models import Book
</span></span><span class=line><span class=cl>from django.db.models import Q
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>query = Q(author__name=&#39;John Doe&#39;) &amp; Q(price__gt=10)
</span></span><span class=line><span class=cl>books = Book.objects.filter(query)
</span></span></code></pre></div><p>在这个例子中，我们创建了一个 Q 对象，它表示作者是 &ldquo;John Doe&rdquo; 并且价格大于 10 的书籍。然后我们使用 <code>filter()</code> 方法来获取匹配这些条件的书籍。</p><ul><li><strong>F 表达式</strong> 用于引用模型字段并在数据库层面上执行操作，如字段值的计算。</li><li><strong>Q 表达式</strong> 用于构建复杂的查询，可以包含多个逻辑条件，并使用逻辑运算符进行组合。</li></ul><p>F 表达式和 Q 表达式都是 Django ORM 中不可或缺的工具，它们可以帮助你编写更高效、更灵活的数据库查询。</p><h2 id=cookie-和-session-操作>Cookie 和 Session 操作<a hidden class=anchor aria-hidden=true href=#cookie-和-session-操作>#</a></h2><h3 id=cookie和session简介>Cookie和Session简介<a hidden class=anchor aria-hidden=true href=#cookie和session简介>#</a></h3><h4 id=1-cookie>1. Cookie<a hidden class=anchor aria-hidden=true href=#1-cookie>#</a></h4><p>Cookies用于解决HTTP协议无状态的问题。当用户登录成功后，服务器会返回一些数据（cookie）给浏览器，浏览器将其保存。随后的请求中，浏览器自动携带cookie，服务器通过这些数据识别用户。</p><ul><li><strong>限制</strong>: Cookie的数据量有限，通常不超过4KB，因此只能存储少量数据。</li></ul><h4 id=2-session>2. Session<a hidden class=anchor aria-hidden=true href=#2-session>#</a></h4><p>Session用于存储用户信息，与Cookie类似但更安全，因为数据存储在服务器端。不同服务器和框架有不同的实现方式。</p><h4 id=3-使用场景>3. 使用场景<a hidden class=anchor aria-hidden=true href=#3-使用场景>#</a></h4><ul><li><strong>Server Side Session</strong>: 通过cookie存储session ID，数据存储在服务器的session中。</li><li><strong>Client Side Session</strong>: Session数据加密后存储在cookie中。</li></ul><h3 id=django中操作cookie>Django中操作Cookie<a hidden class=anchor aria-hidden=true href=#django中操作cookie>#</a></h3><h4 id=设置cookie>设置Cookie<a hidden class=anchor aria-hidden=true href=#设置cookie>#</a></h4><p>使用<code>response.set_cookie</code>方法，参数包括：</p><ul><li><code>key</code>: Cookie的键名。</li><li><code>value</code>: Cookie的值。</li><li><code>max_age</code>: 生命周期（秒）。</li><li><code>expires</code>: 过期日期。</li><li><code>path</code>: 有效的路径。</li><li><code>domain</code>: 有效的域名。</li><li><code>secure</code>: 是否仅在HTTPS下有效。</li><li><code>httponly</code>: 是否禁止客户端脚本访问。</li></ul><h4 id=删除cookie>删除Cookie<a hidden class=anchor aria-hidden=true href=#删除cookie>#</a></h4><p>使用<code>delete_cookie</code>，将cookie的值设置为空字符串，并设置过期时间为0。</p><h4 id=获取cookie>获取Cookie<a hidden class=anchor aria-hidden=true href=#获取cookie>#</a></h4><p>通过<code>request.COOKIES</code>获取，这是一个字典类型对象。</p><h3 id=django中操作session>Django中操作Session<a hidden class=anchor aria-hidden=true href=#django中操作session>#</a></h3><p>Django的session默认存储在数据库中，通过session ID与cookie交互。操作session使用<code>request.session</code>，包括：</p><ul><li><code>get</code>: 获取值。</li><li><code>pop</code>: 删除值。</li><li><code>keys</code>: 获取所有键。</li><li><code>items</code>: 获取所有项。</li><li><code>clear</code>: 清除session数据。</li><li><code>flush</code>: 删除session及cookie中的session ID。</li><li><code>set_expiry</code>: 设置过期时间。</li><li><code>clear_expired</code>: 清理过期session。</li></ul><p>示例代码：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 获取所有cookie</span>
</span></span><span class=line><span class=cl><span class=n>cookies</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>COOKIES</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>cookie_key</span><span class=p>,</span> <span class=n>cookie_value</span> <span class=ow>in</span> <span class=n>cookies</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>cookie_key</span><span class=p>,</span> <span class=n>cookie_value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 使用session</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>index</span><span class=p>(</span><span class=n>request</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>username</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>session</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;username&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>HttpResponse</span><span class=p>(</span><span class=s1>&#39;index&#39;</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=修改session的存储机制>修改Session的存储机制<a hidden class=anchor aria-hidden=true href=#修改session的存储机制>#</a></h3><p>Django默认将Session数据存储在数据库中。但您可以通过设置<code>SESSION_ENGINE</code>来更改Session的存储位置。以下是几种可选的存储方案：</p><ol><li><strong>数据库存储</strong> (<code>django.contrib.sessions.backends.db</code>): 默认方案，Session数据存储在数据库中。</li><li><strong>文件存储</strong> (<code>django.contrib.sessions.backends.file</code>): Session数据存储在服务器的文件系统中。</li><li><strong>缓存存储</strong> (<code>django.contrib.sessions.backends.cache</code>):<ul><li>将Session数据存储在缓存中，如Memcached。</li><li>需要在<code>settings.py</code>中配置<code>CACHES</code>。</li></ul></li><li><strong>缓存数据库混合存储</strong> (<code>django.contrib.sessions.backends.cached_db</code>):<ul><li>首先将Session数据存储在缓存中，然后同步到数据库。</li><li>即使缓存系统出现问题，Session数据也不会丢失。</li></ul></li><li><strong>加密Cookie存储</strong> (<code>django.contrib.sessions.backends.signed_cookies</code>):<ul><li>将Session信息加密后存储在浏览器的Cookie中。</li><li>需要考虑安全性，建议设置<code>SESSION_COOKIE_HTTPONLY=True</code>以防止通过JavaScript操作Session数据。</li><li>保护<code>settings.py</code>中的<code>SECRET_KEY</code>，防止解密Session数据。</li><li>Cookie中存储的数据量不能超过4KB。</li></ul></li></ol><p>请注意，选择存储方案时，需要根据您的应用需求和安全要求来决定最合适的方法。</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://waite.wang/tags/django/>Django</a></li></ul><nav class=paginav><a class=prev href=https://waite.wang/posts/win/modify-virtual-memory-to-other-disk/><span class=title>« 上一页</span><br><span>Win11 改虚拟内存到C盘之外的盘</span>
</a><a class=next href=https://waite.wang/posts/win/gcc-install-and-use-in-vscode/><span class=title>下一页 »</span><br><span>gcc 安装 + vscode 搭建</span></a></nav></footer><script src=https://utteranc.es/client.js repo=Waite0603/HugoBlog issue-term=pathname theme=github-light crossorigin=anonymous async></script></article></main><footer class=footer><span><a href=https://beian.miit.gov.cn/ target=_blank rel="noopener noreferrer">粤ICP备2022028437号-1</a></span><br><span>Copyright &copy; 2018 - 2025 By <a href=https://waite.wang/>Waite</a>, All Rights
Reserved.</span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script src=/js/jquery-3.5.1.min.js></script><link rel=stylesheet href=/css/jquery.fancybox.min.css><script src=/js/jquery.fancybox.min.js></script></body></html>