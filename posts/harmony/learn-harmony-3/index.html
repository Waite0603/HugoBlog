<!doctype html><html lang=zh-cn dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>鸿蒙学习笔记3 | 隶笔难书</title>
<meta name=keywords content="Harmony"><meta name=description content="Stage 模型

https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/start-with-ets-stage-0000001477980905-V2


  
    
  



一个应用只能有一个 @EntryAbility，但可以有多个 @PageAbility。

（Stage模型）目录结构


  
    
  



AppScope > app.json5：应用的全局配置信息。
entry：HarmonyOS工程模块，编译构建生成一个HAP包。

src > main > ets：用于存放ArkTS源码。
src > main > ets > entryability：应用/服务的入口。
src > main > ets > pages：应用/服务包含的页面
src > main > resources：用于存放应用/服务所用到的资源文件，如图形、多媒体、字符串、布局文件等。关于资源文件，详见资源分类与访问。
src > main > module.json5：Stage模型模块配置文件。主要包含HAP包的配置信息、应用/服务在具体设备上的配置信息以及应用/服务的全局配置信息。具体的配置文件说明，详见
module.json5配置文件。
build-profile.json5：当前的模块信息、编译信息配置项，包括buildOption、targets配置等。其中targets中可配置当前运行环境，默认为HarmonyOS。
hvigorfile.ts：模块级编译构建任务脚本，开发者可以自定义相关任务和代码实现。


oh_modules：用于存放三方库依赖信息。关于原npm工程适配ohpm操作，请参考历史工程迁移。
build-profile.json5：应用级配置信息，包括签名、产品配置等。
hvigorfile.ts：应用级编译构建任务脚本。

应用配置文件

https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/14d_u7f6e_u6587_u4ef6_uff08stage_u6a21_u578b_uff09-0000001427902192-V2"><meta name=author content><link rel=canonical href=https://waite.wang/posts/harmony/learn-harmony-3/><link crossorigin=anonymous href=/assets/css/stylesheet.c23d77c650f3aa02a79bbe7e1c00a00447db4f6603c968933ce8bb126f330334.css integrity="sha256-wj13xlDzqgKnm75+HACgBEfbT2YDyWiTPOi7Em8zAzQ=" rel="preload stylesheet" as=style><link rel=icon href=https://waite.wang/images/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://waite.wang/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://waite.wang/favicon-32x32.png><link rel=apple-touch-icon href=https://waite.wang/apple-touch-icon.png><link rel=mask-icon href=https://waite.wang/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh-cn href=https://waite.wang/posts/harmony/learn-harmony-3/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://waite.wang/posts/harmony/learn-harmony-3/"><meta property="og:site_name" content="隶笔难书"><meta property="og:title" content="鸿蒙学习笔记3"><meta property="og:description" content="Stage 模型 https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/start-with-ets-stage-0000001477980905-V2
一个应用只能有一个 @EntryAbility，但可以有多个 @PageAbility。
（Stage模型）目录结构 AppScope > app.json5：应用的全局配置信息。 entry：HarmonyOS工程模块，编译构建生成一个HAP包。 src > main > ets：用于存放ArkTS源码。 src > main > ets > entryability：应用/服务的入口。 src > main > ets > pages：应用/服务包含的页面 src > main > resources：用于存放应用/服务所用到的资源文件，如图形、多媒体、字符串、布局文件等。关于资源文件，详见资源分类与访问。 src > main > module.json5：Stage模型模块配置文件。主要包含HAP包的配置信息、应用/服务在具体设备上的配置信息以及应用/服务的全局配置信息。具体的配置文件说明，详见 module.json5配置文件。 build-profile.json5：当前的模块信息、编译信息配置项，包括buildOption、targets配置等。其中targets中可配置当前运行环境，默认为HarmonyOS。 hvigorfile.ts：模块级编译构建任务脚本，开发者可以自定义相关任务和代码实现。 oh_modules：用于存放三方库依赖信息。关于原npm工程适配ohpm操作，请参考历史工程迁移。 build-profile.json5：应用级配置信息，包括签名、产品配置等。 hvigorfile.ts：应用级编译构建任务脚本。 应用配置文件 https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/14d_u7f6e_u6587_u4ef6_uff08stage_u6a21_u578b_uff09-0000001427902192-V2"><meta property="og:locale" content="zh-cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-04-06T16:04:23+08:00"><meta property="article:modified_time" content="2024-04-06T16:04:23+08:00"><meta property="article:tag" content="Harmony"><meta name=twitter:card content="summary"><meta name=twitter:title content="鸿蒙学习笔记3"><meta name=twitter:description content="Stage 模型

https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/start-with-ets-stage-0000001477980905-V2


  
    
  



一个应用只能有一个 @EntryAbility，但可以有多个 @PageAbility。

（Stage模型）目录结构


  
    
  



AppScope > app.json5：应用的全局配置信息。
entry：HarmonyOS工程模块，编译构建生成一个HAP包。

src > main > ets：用于存放ArkTS源码。
src > main > ets > entryability：应用/服务的入口。
src > main > ets > pages：应用/服务包含的页面
src > main > resources：用于存放应用/服务所用到的资源文件，如图形、多媒体、字符串、布局文件等。关于资源文件，详见资源分类与访问。
src > main > module.json5：Stage模型模块配置文件。主要包含HAP包的配置信息、应用/服务在具体设备上的配置信息以及应用/服务的全局配置信息。具体的配置文件说明，详见
module.json5配置文件。
build-profile.json5：当前的模块信息、编译信息配置项，包括buildOption、targets配置等。其中targets中可配置当前运行环境，默认为HarmonyOS。
hvigorfile.ts：模块级编译构建任务脚本，开发者可以自定义相关任务和代码实现。


oh_modules：用于存放三方库依赖信息。关于原npm工程适配ohpm操作，请参考历史工程迁移。
build-profile.json5：应用级配置信息，包括签名、产品配置等。
hvigorfile.ts：应用级编译构建任务脚本。

应用配置文件

https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/14d_u7f6e_u6587_u4ef6_uff08stage_u6a21_u578b_uff09-0000001427902192-V2"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://waite.wang/posts/"},{"@type":"ListItem","position":2,"name":"鸿蒙学习笔记3","item":"https://waite.wang/posts/harmony/learn-harmony-3/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"鸿蒙学习笔记3","name":"鸿蒙学习笔记3","description":"Stage 模型 https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/start-with-ets-stage-0000001477980905-V2\n一个应用只能有一个 @EntryAbility，但可以有多个 @PageAbility。\n（Stage模型）目录结构 AppScope \u0026gt; app.json5：应用的全局配置信息。 entry：HarmonyOS工程模块，编译构建生成一个HAP包。 src \u0026gt; main \u0026gt; ets：用于存放ArkTS源码。 src \u0026gt; main \u0026gt; ets \u0026gt; entryability：应用/服务的入口。 src \u0026gt; main \u0026gt; ets \u0026gt; pages：应用/服务包含的页面 src \u0026gt; main \u0026gt; resources：用于存放应用/服务所用到的资源文件，如图形、多媒体、字符串、布局文件等。关于资源文件，详见资源分类与访问。 src \u0026gt; main \u0026gt; module.json5：Stage模型模块配置文件。主要包含HAP包的配置信息、应用/服务在具体设备上的配置信息以及应用/服务的全局配置信息。具体的配置文件说明，详见 module.json5配置文件。 build-profile.json5：当前的模块信息、编译信息配置项，包括buildOption、targets配置等。其中targets中可配置当前运行环境，默认为HarmonyOS。 hvigorfile.ts：模块级编译构建任务脚本，开发者可以自定义相关任务和代码实现。 oh_modules：用于存放三方库依赖信息。关于原npm工程适配ohpm操作，请参考历史工程迁移。 build-profile.json5：应用级配置信息，包括签名、产品配置等。 hvigorfile.ts：应用级编译构建任务脚本。 应用配置文件 https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/14d_u7f6e_u6587_u4ef6_uff08stage_u6a21_u578b_uff09-0000001427902192-V2\n","keywords":["Harmony"],"articleBody":"Stage 模型 https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/start-with-ets-stage-0000001477980905-V2\n一个应用只能有一个 @EntryAbility，但可以有多个 @PageAbility。\n（Stage模型）目录结构 AppScope \u003e app.json5：应用的全局配置信息。 entry：HarmonyOS工程模块，编译构建生成一个HAP包。 src \u003e main \u003e ets：用于存放ArkTS源码。 src \u003e main \u003e ets \u003e entryability：应用/服务的入口。 src \u003e main \u003e ets \u003e pages：应用/服务包含的页面 src \u003e main \u003e resources：用于存放应用/服务所用到的资源文件，如图形、多媒体、字符串、布局文件等。关于资源文件，详见资源分类与访问。 src \u003e main \u003e module.json5：Stage模型模块配置文件。主要包含HAP包的配置信息、应用/服务在具体设备上的配置信息以及应用/服务的全局配置信息。具体的配置文件说明，详见 module.json5配置文件。 build-profile.json5：当前的模块信息、编译信息配置项，包括buildOption、targets配置等。其中targets中可配置当前运行环境，默认为HarmonyOS。 hvigorfile.ts：模块级编译构建任务脚本，开发者可以自定义相关任务和代码实现。 oh_modules：用于存放三方库依赖信息。关于原npm工程适配ohpm操作，请参考历史工程迁移。 build-profile.json5：应用级配置信息，包括签名、产品配置等。 hvigorfile.ts：应用级编译构建任务脚本。 应用配置文件 https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/14d_u7f6e_u6587_u4ef6_uff08stage_u6a21_u578b_uff09-0000001427902192-V2\napp.json5文件是应用的全局配置文件，用于配置应用的基本信息、版本信息、图标、名称、描述等。\n属性名称 含义 数据类型 是否可缺省 bundleName 标识应用的Bundle名称，用于标识应用的唯一性。该标签不可缺省。标签的值命名规则 ：- 字符串以字母、数字、下划线和符号“.”组成。- 以字母开头。- 最小长度7个字节，最大长度127个字节。推荐采用反域名形式命名（如com.example.demo，建议第一级为域名后缀com，第二级为厂商/个人名，第三级为应用名，也可以多级）。 字符串 该标签不可缺省。 bundleType 标识应用的Bundle类型，用于区分应用或者原子化服务。该标签可选值为app和atomicService ：- app：当前Bundle为普通应用。- atomicService：当前Bundle为元服务。 字符串 该标签可以缺省，缺省为app。 debug 标识应用是否可调试，该标签由IDE编译构建时生成。- true：可调试。- false：不可调试。 布尔值 该标签可以缺省，缺省为false。 icon 标识 应用的图标，标签值为图标资源文件的索引。 字符串 该标签不可缺省。 label 标识 应用的名称，标签值为字符串资源的索引。 字符串 该标签不可缺省。 description 标识应用的描述信息，标签值是字符串类型（最大255个字节）或对描述内容的字符串资源索引。 字符串 该标签可缺省，缺省值为空。 vendor 标识对应用开发厂商的描述。该标签的值是字符串类型（最大255个字节）。 字符串 该标签可以缺省，缺省为空。 versionCode 标识应用的版本号，该标签值为32位非负整数。此数字仅用于确定某个版本是否比另一个版本更新，数值越大表示版本越高。开发者可以将该值设置为任何正整数，但是必须确保应用的新版本都使用比旧版本更大的值。该标签不可缺省，versionCode值应小于2^31次方。 数值 该标签不可缺省。 versionName 标识应用版本号的文字描述，用于向用户展示。该标签仅由数字和点构成，推荐采用“A.B.C.D”四段式的形式。四段式推荐的含义如下所示。第一段：主版本号/Major，范围0-99，重大修改的版本，如实现新的大功能或重大变化。第二段：次版本号/Minor，范围0-99，表示实现较突出的特点，如新功能添加或大问题修复。第三段：特性版本号/Feature，范围0-99，标识规划的新版本特性。第四段：修订版本号/Patch，范围0-999，表示维护版本，修复bug。标签最大字节长度为127。 字符串 该标签不可缺省。 minCompatibleVersionCode 标识应用能够兼容的最低历史版本号，用于跨设备兼容性判断。说明当前版本暂不支持跨设备能力。 数值 该标签可缺省，缺省值等于versionCode标签值。 minAPIVersion 标识应用运行需要的SDK的API最小版本。 数值 由build-profile.json5中的compatibleSdkVersion生成。 targetAPIVersion 标识应用运行需要的API目标版本。 数值 由build-profile.json5中的compileSdkVersion生成。 apiReleaseType 标识应用运行需要的API目标版本的类型，采用字符串类型表示。取值为“CanaryN”、“BetaN”或者“Release”，其中，N代表大于零的整数。- Canary：受限发布的版本。- Beta：公开发布的Beta版本。- Release：公开发布的正式版本。该字段由DevEco Studio读取当前使用的SDK的Stage来生成。 字符串 该标签可缺省，由IDE生成并覆盖。 multiProjects 标识当前工程是否支持多个工程的联合开发。- true：当前工程支持多个工程的联合开发。- false：当前工程不支持多个工程的联合开发。多工程开发可以参考文档： 多工程构建。 布尔值 可缺省，缺省值为false。 tablet 标识对tablet设备做的特殊配置，可以配置的属性字段有上文提到的：minAPIVersion、distributedNotificationEnabled。如果使用该属性对tablet设备做了特殊配置，则应用在tablet设备中会采用此处配置的属性值，并忽略在app.json5公共区域配置的属性值。 对象 该标签可缺省，缺省时tablet设备使用app.json5公共区域配置的属性值。 tv 标识对tv设备做的特殊配置，可以配置的属性字段有上文提到的：minAPIVersion、distributedNotificationEnabled。如果使用该属性对tv设备做了特殊配置，则应用在tv设备中会采用此处配置的属性值，并忽略在app.json5公共区域配置的属性值。 对象 该标签可缺省，缺省时tv设备使用app.json5公共区域配置的属性值。 wearable 标识对wearable设备做的特殊配置，可以配置的属性字段有上文提到的：minAPIVersion、distributedNotificationEnabled。如果使用该属性对wearable设备做了特殊配置，则应用在wearable设备中会采用此处配置的属性值，并忽略在app.json5公共区域配置的属性值。 对象 该标签可缺省，缺省时wearable设备使用app.json5公共区域配置的属性值。 car 标识对car设备做的特殊配置，可以配置的属性字段有上文提到的：minAPIVersion、distributedNotificationEnabled。如果使用该属性对car设备做了特殊配置，则应用在car设备中会采用此处配置的属性值，并忽略在app.json5公共区域配置的属性值。 对象 该标签可缺省，缺省时car设备使用app.json5公共区域配置的属性值。 phone 标识对phone设备做的特殊配置，可以配置的属性字段有上文提到的：minAPIVersion、distributedNotificationEnabled。如果使用该属性对phone设备做了特殊配置，则应用在phone设备中会采用此处配置的属性值，并忽略在app.json5公共区域配置的属性值。 对象 该标签可缺省，缺省时phone设备使用app.json5公共区域配置的属性值。 module.json5文件是Stage模型模块配置文件，用于配置HAP包的配置信息、应用/服务在具体设备上的配置信息以及应用/服务的全局配置信息。 以下是一个示例:\n{ \"module\": { \"name\": \"entry\", \"type\": \"entry\", \"description\": \"$string:module_desc\", \"mainElement\": \"EntryAbility\", \"deviceTypes\": [ \"tv\", \"tablet\" ], \"deliveryWithInstall\": true, \"installationFree\": false, \"pages\": \"$profile:main_pages\", \"virtualMachine\": \"ark\", \"metadata\": [ { \"name\": \"string\", \"value\": \"string\", \"resource\": \"$profile:distributionFilter_config\" } ], \"abilities\": [ { \"name\": \"EntryAbility\", \"srcEntry\": \"./ets/entryability/EntryAbility.ts\", \"description\": \"$string:EntryAbility_desc\", \"icon\": \"$media:icon\", \"label\": \"$string:EntryAbility_label\", \"startWindowIcon\": \"$media:icon\", \"startWindowBackground\": \"$color:start_window_background\", \"exported\": true, \"skills\": [ { \"entities\": [ \"entity.system.home\" ], \"actions\": [ \"ohos.want.action.home\" ] } ] } ], \"requestPermissions\": [ { \"name\": \"ohos.abilitydemo.permission.PROVIDER\", \"reason\": \"$string:reason\", \"usedScene\": { \"abilities\": [ \"FormAbility\" ], \"when\": \"inuse\" } } ] } } 属性名称 含义 数据类型 是否可缺省 name 标识当前Module的名称，标签值采用字符串表示（最大长度31个字节），该名称在整个应用要唯一，仅支持英文字符。 字符串 该标签不可缺省。 type 标识当前Module的类型。类型有两种，分别：- entry：应用的主模块。- feature：应用的动态特性模块。-har：静态共享包模块。-shared：动态共享包模块。 字符串 该标签不可缺省。 srcEntry 标识当前Module所对应的代码路径，标签值为字符串（最长为127字节）。 字符串 该标签可缺省，缺省值为空。 description 标识当前Module的描述信息，标签值是字符串类型（最长255字节）或对描述内容的字符串资源索引。 字符串 该标签可缺省，缺省值为空。 process 标识当前Module的进程名，标签值为字符串类型（最长为31个字节）。如果在HAP标签下配置了process，该应用的所有UIAbility、DataShareExtensionAbility、ServiceExtensionAbility都运行在该进程中。说明：- 仅支持系统应用配置，三方应用配置不生效。 字符串 可缺省，缺省为app.json5文件下app标签下的bundleName。 mainElement 标识当前Module的入口UIAbility名称或者ExtensionAbility名称。标签最大字节长度为255。 字符串 该标签可缺省，缺省值为空。 deviceTypes 标识当前Module可以运行在哪类设备上，标签值采用字符串数组的表示。 字符串数组 该标签不可缺省。 deliveryWithInstall 标识当前Module是否在用户主动安装的时候安装，表示该Module对应的HAP是否跟随应用一起安装。- true：主动安装时安装。- false：主动安装时不安装。 布尔值 该标签不可缺省。 installationFree 标识当前Module是否支持免安装特性。- true：表示支持免安装特性，且符合免安装约束。- false：表示不支持免安装特性。说明：- 当应用的entry类型Module的该字段配置为true时，该应用的feature类型的该字段也需要配置为true。- 当应用的entry类型Module的该字段配置为false时，该应用的feature类型的该字段根据业务需求配置true或false。 布尔值 该标签不可缺省。 virtualMachine 标识当前Module运行的目标虚拟机类型，供云端分发使用，如应用市场和分发中心。该标签值为字符串。如果目标虚拟机类型为ArkTS引擎，则其值为“ark+版本号”。 字符串 该标签由IDE构建HAP的时候自动插入。 pages 标识当前Module的profile资源，用于列举每个页面信息。该标签最大长度为255个字节。 字符串 在有UIAbility的场景下，该标签不可缺省。 metadata 标识当前Module的自定义元信息，标签值为数组类型，只对当前Module、UIAbility、ExtensionAbility生效。 对象数组 该标签可缺省，缺省值为空。 abilities 标识当前Module中UIAbility的配置信息，标签值为数组类型，只对当前UIAbility生效。 对象 该标签可缺省，缺省值为空。 extensionAbilities 标识当前Module中ExtensionAbility的配置信息，标签值为数组类型，只对当前ExtensionAbility生效。 对象 该标签可缺省，缺省值为空。 requestPermissions 标识当前应用运行时需向系统申请的权限集合。 对象 该标签可缺省，缺省值为空。 testRunner 标识当前Module用于支持对测试框架的配置。 对象 该标签可缺省，缺省值为空。 详细可以查阅 https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/module-configuration-file-0000001427744540-V2\n生命周期 UIAbility组件生命周期 https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/uiability-lifecycle-0000001427902208-V2\nsrc/main/ets/entryability/EntryAbility.ts\nForeground和Background状态分别在UIAbility实例切换至前台和切换至后台时触发，对应于onForeground()回调和onBackground()回调。\nonForeground()回调，在UIAbility的UI界面可见之前，如UIAbility切换至前台时触发。可以在onForeground()回调中申请系统需要的资源，或者重新申请在onBackground()中释放的资源。\nonBackground()回调，在UIAbility的UI界面完全不可见之后，如UIAbility切换至后台时候触发。可以在onBackground()回调中释放UI界面不可见时无用的资源，或者在此回调中执行较为耗时的操作，例如状态保存等。\n例如应用在使用过程中需要使用用户定位时，假设应用已获得用户的定位权限授权。在UI界面显示之前，可以在onForeground()回调中开启定位功能，从而获取到当前的位置信息。\n当应用切换到后台状态，可以在onBackground()回调中停止定位功能，以节省系统的资源消耗。\n页面和组件的生命周期 https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/arkts-page-custom-components-lifecycle-0000001524296665-V2\n在开始之前，我们先明确自定义组件和页面的关系：\n自定义组件：@Component装饰的UI单元，可以组合多个系统组件实现UI的复用，可以调用组件的生命周期。 页面：即应用的UI页面。可以由一个或者多个自定义组件组成， @Entry装饰的自定义组件为页面的入口组件，即页面的根节点，一个页面有且仅能有一个@Entry。只有被@Entry装饰的组件才可以调用页面的生命周期。 页面生命周期，即被@Entry装饰的组件生命周期，提供以下生命周期接口：\nonPageShow：页面每次显示时触发一次，包括路由过程、应用进入前台等场景。 onPageHide：页面每次隐藏时触发一次，包括路由过程、应用进入后台等场景。 onBackPress：当用户点击返回按钮时触发。 组件生命周期，即一般用@Component装饰的自定义组件的生命周期，提供以下生命周期接口：\naboutToAppear：组件即将出现时回调该接口，具体时机为在创建自定义组件的新实例后，在执行其build()函数之前执行。 aboutToDisappear：在自定义组件析构销毁之前执行。不允许在aboutToDisappear函数中改变状态变量，特别是@Link变量的修改可能会导致应用程序行为不稳定。 生命周期流程如下图所示，下图展示的是被@Entry装饰的组件（页面）生命周期。\n// Index.ets import router from '@ohos.router'; @Entry @Component struct MyComponent { @State showChild: boolean = true; // 只有被@Entry装饰的组件才可以调用页面的生命周期 onPageShow() { console.info('Index onPageShow'); } // 只有被@Entry装饰的组件才可以调用页面的生命周期 onPageHide() { console.info('Index onPageHide'); } // 只有被@Entry装饰的组件才可以调用页面的生命周期 onBackPress() { console.info('Index onBackPress'); } // 组件生命周期 aboutToAppear() { console.info('MyComponent aboutToAppear'); } // 组件生命周期 aboutToDisappear() { console.info('MyComponent aboutToDisappear'); } build() { Column() { // this.showChild为true，创建Child子组件，执行Child aboutToAppear if (this.showChild) { Child() } // this.showChild为false，删除Child子组件，执行Child aboutToDisappear Button('delete Child').onClick(() =\u003e { this.showChild = false; }) // push到Page2页面，执行onPageHide Button('push to next page') .onClick(() =\u003e { router.pushUrl({ url: 'pages/Second' }); }) } } } @Component struct Child { @State title: string = 'Hello World'; // 组件生命周期 aboutToDisappear() { console.info('[lifeCycle] Child aboutToDisappear') } // 组件生命周期 aboutToAppear() { console.info('[lifeCycle] Child aboutToAppear') } build() { Text(this.title).fontSize(50).onClick(() =\u003e { this.title = 'Hello ArkUI'; }) } } UIAbility组件启动模式 具体重新观看: https://www.bilibili.com/video/BV1Sa4y1Z7B1/?p=27\nhttps://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/uiability-launch-type-0000001428061476-V2\nUIAbility的启动模式是指UIAbility实例在启动时的不同呈现状态。针对不同的业务场景，系统提供了三种启动模式：\nsingleton（单实例模式） multiton（多实例模式） specified（指定实例模式） singleton启动模式 singleton启动模式为单实例模式，也是默认情况下的启动模式。\n每次调用startAbility()方法时，如果应用进程中该类型的UIAbility实例已经存在，则复用系统中的UIAbility实例。系统中只存在唯一一个该UIAbility实例，即在最近任务列表中只存在一个该类型的UIAbility实例。\n图1 单实例模式演示效果\n说明\n应用的UIAbility实例已创建，该UIAbility配置为单实例模式，再次调用startAbility()方法启动该UIAbility实例，此时只会进入该UIAbility的onNewWant()回调，不会进入其onCreate()和onWindowStageCreate()生命周期回调。\n如果需要使用singleton启动模式，在 module.json5配置文件中的\"launchType\"字段配置为\"singleton\"即可。\n{ \"module\": { // ... \"abilities\": [ { \"launchType\": \"singleton\", // ... } ] } } multiton启动模式 multiton启动模式为多实例模式，每次调用startAbility()方法时，都会在应用进程中创建一个新的该类型UIAbility实例。即在最近任务列表中可以看到有多个该类型的UIAbility实例。这种情况下可以将UIAbility配置为multiton（多实例模式）。\n图2 多实例模式演示效果\nmultiton启动模式的开发使用，在 module.json5配置文件中的\"launchType\"字段配置为\"multiton\"即可。\n{ \"module\": { // ... \"abilities\": [ { \"launchType\": \"multiton\", // ... } ] } } specified启动模式 specified启动模式为指定实例模式，针对一些特殊场景使用（例如文档应用中每次新建文档希望都能新建一个文档实例，重复打开一个已保存的文档希望打开的都是同一个文档实例）。\n在UIAbility实例创建之前，允许开发者为该实例创建一个唯一的字符串Key，创建的UIAbility实例绑定Key之后，后续每次调用startAbility()方法时，都会询问应用使用哪个Key对应的UIAbility实例来响应startAbility()请求。运行时由UIAbility内部业务决定是否创建多实例，如果匹配有该UIAbility实例的Key，则直接拉起与之绑定的UIAbility实例，否则创建一个新的UIAbility实例。\n图3 指定实例模式演示效果\n应用的UIAbility实例已创建，该UIAbility配置为指定实例模式，再次调用startAbility()方法启动该UIAbility实例，且 AbilityStage的 onAcceptWant()回调匹配到一个已创建的UIAbility实例。此时，再次启动该UIAbility时，只会进入该UIAbility的 onNewWant()回调，不会进入其onCreate()和onWindowStageCreate()生命周期回调。\n例如有两个UIAbility：EntryAbility和FuncAbility，FuncAbility配置为specified启动模式，需要从EntryAbility的页面中启动FuncAbility。\n在FuncAbility中，将 module.json5配置文件的\"launchType\"字段配置为\"specified\"。\n{ \"module\": { // ... \"abilities\": [ { \"launchType\": \"specified\", // ... } ] } } 在EntryAbility中，调用startAbility()方法时，在want参数中，增加一个自定义参数来区别UIAbility实例，例如增加一个\"instanceKey\"自定义参数。\n// 在启动指定实例模式的UIAbility时，给每一个UIAbility实例配置一个独立的Key标识 // 例如在文档使用场景中，可以用文档路径作为Key标识 function getInstance() { // ... } let want = { deviceId: '', // deviceId为空表示本设备 bundleName: 'com.example.myapplication', abilityName: 'FuncAbility', moduleName: 'module1', // moduleName非必选 parameters: { // 自定义信息 instanceKey: getInstance(), }, } // context为调用方UIAbility的AbilityContext this.context.startAbility(want).then(() =\u003e { // ... }).catch((err) =\u003e { // ... }) 由于FuncAbility的启动模式配置为了指定实例启动模式，在FuncAbility启动之前，会先进入其对应的AbilityStage的 onAcceptWant()生命周期回调中，解析传入的want参数，获取\"instanceKey\"自定义参数。根据业务需要通过AbilityStage的 onAcceptWant()生命周期回调返回一个字符串Key标识。如果返回的Key对应一个已启动的UIAbility，则会将之前的UIAbility拉回前台并获焦，而不创建新的实例，否则创建新的实例并启动。\nimport AbilityStage from '@ohos.app.ability.AbilityStage'; export default class MyAbilityStage extends AbilityStage { onAcceptWant(want): string { // 在被调用方的AbilityStage中，针对启动模式为specified的UIAbility返回一个UIAbility实例对应的一个Key值 // 当前示例指的是module1 Module的FuncAbility if (want.abilityName === 'FuncAbility') { // 返回的字符串Key标识为自定义拼接的字符串内容 return `ControlModule_EntryAbilityInstance_${want.parameters.instanceKey}`; } return ''; } } 例如在文档应用中，可以对不同的文档实例内容绑定不同的Key值。当每次新建文档的时候，可以传入不同的新Key值（如可以将文件的路径作为一个Key标识），此时AbilityStage中启动UIAbility时都会创建一个新的UIAbility实例；当新建的文档保存之后，回到桌面，或者新打开一个已保存的文档，回到桌面，此时再次打开该已保存的文档，此时AbilityStage中再次启动该UIAbility时，打开的仍然是之前原来已保存的文档界面。\n以如下步骤所示进行举例说明。\n打开文件A，对应启动一个新的UIAbility实例，例如启动“UIAbility实例1”。 在最近任务列表中关闭文件A的进程，此时UIAbility实例1被销毁，回到桌面，再次打开文件A，此时对应启动一个新的UIAbility实例，例如启动“UIAbility实例2”。 回到桌面，打开文件B，此时对应启动一个新的UIAbility实例，例如启动“UIAbility实例3”。 回到桌面，再次打开文件A，此时对应启动的还是之前的“UIAbility实例2”。 网络连接 https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/net-mgmt-overview-0000001478341009-V2\nHTTP数据请求 https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/http-request-0000001478061585-V2\n应用通过HTTP发起一个数据请求，支持常见的GET、POST、OPTIONS、HEAD、PUT、DELETE、TRACE、CONNECT方法。\nHTTP数据请求功能主要由http模块提供。\n使用该功能需要申请ohos.permission.INTERNET权限。\n权限申请请参考 访问控制（权限）开发指导。\n涉及的接口如下表，具体的接口说明请参考 API文档。\n接口名 功能描述 createHttp() 创建一个http请求。 request() 根据URL地址，发起HTTP网络请求。 destroy() 中断请求任务。 on(type: ‘headersReceive’) 订阅HTTP Response Header 事件。 off(type: ‘headersReceive’) 取消订阅HTTP Response Header 事件。 once(‘headersReceive’)8+ 订阅HTTP Response Header 事件，但是只触发一次。 request接口开发步骤 从@ohos.net.http.d.ts中导入http命名空间。 调用createHttp()方法，创建一个HttpRequest对象。 调用该对象的on()方法，订阅http响应头事件，此接口会比request请求先返回。可以根据业务需要订阅此消息。 调用该对象的request()方法，传入http请求的url地址和可选参数，发起网络请求。 按照实际业务需要，解析返回结果。 调用该对象的off()方法，取消订阅http响应头事件。 当该请求使用完毕时，调用destroy()方法主动销毁。 // 引入包名 import http from '@ohos.net.http'; // 每一个httpRequest对应一个HTTP请求任务，不可复用 let httpRequest = http.createHttp(); // 用于订阅HTTP响应头，此接口会比request请求先返回。可以根据业务需要订阅此消息 // 从API 8开始，使用on('headersReceive', Callback)替代on('headerReceive', AsyncCallback)。 8+ httpRequest.on('headersReceive', (header) =\u003e { console.info('header: ' + JSON.stringify(header)); }); httpRequest.request( // 填写HTTP请求的URL地址，可以带参数也可以不带参数。URL地址需要开发者自定义。请求的参数可以在extraData中指定 \"EXAMPLE_URL\", { method: http.RequestMethod.POST, // 可选，默认为http.RequestMethod.GET // 开发者根据自身业务需要添加header字段 header: { 'Content-Type': 'application/json' }, // 当使用POST请求时此字段用于传递内容 extraData: { \"data\": \"data to send\", }, expectDataType: http.HttpDataType.STRING, // 可选，指定返回数据的类型 usingCache: true, // 可选，默认为true priority: 1, // 可选，默认为1 connectTimeout: 60000, // 可选，默认为60000ms readTimeout: 60000, // 可选，默认为60000ms usingProtocol: http.HttpProtocol.HTTP1_1, // 可选，协议类型默认值由系统自动指定 }, (err, data) =\u003e { if (!err) { // data.result为HTTP响应内容，可根据业务需要进行解析 console.info('Result:' + JSON.stringify(data.result)); console.info('code:' + JSON.stringify(data.responseCode)); // data.header为HTTP响应头，可根据业务需要进行解析 console.info('header:' + JSON.stringify(data.header)); console.info('cookies:' + JSON.stringify(data.cookies)); // 8+ } else { console.info('error:' + JSON.stringify(err)); // 取消订阅HTTP响应头事件 httpRequest.off('headersReceive'); // 当该请求使用完毕时，调用destroy方法主动销毁 httpRequest.destroy(); } } ); 案例 现在有这么一个接口: http://127.0.0.1:3000/shops?pageNo=1\u0026\u0026pageSize=4 返回值如下\n[ { \"id\": 1, \"name\": \"103茶餐厅\", \"images\": [ \"/images/s3fqawWswzk.jpg\", \"/images/aZGOT1OjpJmLxG6urQ.jpg\" ], \"area\": \"大关\", \"address\": \"金华路锦昌文华苑29号\", \"avgPrice\": 80, \"comments\": 3035, \"score\": 37, \"openHours\": \"10:00-22:00\" }, { \"id\": 2, \"name\": \"蔡馬洪涛烤肉·老北京铜锅涮羊肉\", \"images\": [ \"/images/faca41195272.jpg\", \"/images/a9f88d706914.jpg\", \"/images/jpJmLxG6urQ.jpg\" ], \"area\": \"拱宸桥/上塘\", \"address\": \"上塘路1035号（中国工商银行旁）\", \"avgPrice\": 85, \"comments\": 1460, \"score\": 46, \"openHours\": \"11:30-03:00\" }, { \"id\": 3, \"name\": \"新白鹿餐厅(运河上街店)\", \"images\": [ \"/images/7cgjmzif2w2aalka4gms.jpg\", \"/images/73w0k4d40mxjt54btzda.jpg\", \"/images/uyb31c7yfqy95dejvis1.jpg\" ], \"area\": \"运河上街\", \"address\": \"台州路2号运河上街购物中心F5\", \"avgPrice\": 61, \"comments\": 8045, \"score\": 47, \"openHours\": \"10:30-21:00\" }, { \"id\": 4, \"name\": \"Mamala(杭州远洋乐堤港店)\", \"images\": [ \"/images/xpm2bq95a3ro2lc4vp5u.jpg\", \"/images/7kd3rq9hvtougx3mhnlt.jpg\" ], \"area\": \"拱宸桥/上塘\", \"address\": \"丽水路66号远洋乐堤港商城2期1层B115号\", \"avgPrice\": 290, \"comments\": 9529, \"score\": 49, \"openHours\": \"11:00-22:00\" } ] //src/main/ets/viewmodel/ShopInfo.ts export default class ShopInfo { id: number name: string images: string[] area: string address: string avgPrice: number comments: number score: number openHours: string } // src/main/ets/model/ShopModel.ts import http from '@ohos.net.http' import ShopInfo from '../viewmodel/ShopInfo' class ShopModel { pageNo: number = 1 url: string = `http://127.0.0.1:3000/` getShopList(): Promise\u003cShopInfo[]\u003e { return new Promise( (resolve, reject) =\u003e { let httpRequest = http.createHttp() httpRequest.request( this.url + `shops?pageNo=${this.pageNo}\u0026pageSize=4`, { method: http.RequestMethod.GET } ) .then((res: http.HttpResponse) =\u003e { if (res.responseCode === 200) { // 请求成功 console.log(\"Success\") resolve(JSON.parse(res.result.toString())) } else { console.log(\"Error\", JSON.stringify(res)) reject(\"Error\") } }) .catch((err: Error) =\u003e { // 请求失败 console.log(\"Error\", JSON.stringify(err)) reject(\"Error\") }) } ) } } const shopModel = new ShopModel() export default shopModel as ShopModel // src/main/ets/views import ShopInfo from '../viewmodel/ShopInfo' @Component export default struct ShopItem { shop: ShopInfo build(){ Column({space: 5}){ Row(){ Text(this.shop.name) .fontSize(20) .fontWeight(FontWeight.Bold) .ellipsisTextOverFlow() } .width('100%') Row(){ Text(this.shop.address) .fontColor('#a3a3a3') .ellipsisTextOverFlow() }.width('100%') Row({space: 5}){ Rating({rating: this.shop.score/10 , indicator: true}).stars(5).stepSize(0.1) Text(`${this.shop.score / 10}`).fontColor('#ffb04d') Text(`${this.shop.comments}条`).fontColor('#222') Blank() Text(`￥${this.shop.avgPrice}/人`) }.width('100%') List({space: 10}){ ForEach(this.shop.images, (image) =\u003e { ListItem(){ Column(){ Image(image) .width(150).aspectRatio(1.1).borderRadius(5) } } }) } .listDirection(Axis.Horizontal) .width('100%') } .width('100%') .height(240) .padding(12) .backgroundColor(Color.White) .borderRadius(15) .shadow({radius: 6, color: '#1F000000', offsetX: 2, offsetY: 4}) } } // 文本超出时的统一样式处理 @Extend(Text) function ellipsisTextOverFlow(line: number = 1){ .textOverflow({overflow: TextOverflow.Ellipsis}) .maxLines(line) } // src/main/ets/pages/Index.ets import ShopInfo from '../viewmodel/ShopInfo' @Component export default struct ShopItem { shop: ShopInfo build(){ Column({space: 5}){ Row(){ Text(this.shop.name) .fontSize(20) .fontWeight(FontWeight.Bold) .ellipsisTextOverFlow() } .width('100%') Row(){ Text(this.shop.address) .fontColor('#a3a3a3') .ellipsisTextOverFlow() }.width('100%') Row({space: 5}){ Rating({rating: this.shop.score/10 , indicator: true}).stars(5).stepSize(0.1) Text(`${this.shop.score / 10}`).fontColor('#ffb04d') Text(`${this.shop.comments}条`).fontColor('#222') Blank() Text(`￥${this.shop.avgPrice}/人`) }.width('100%') List({space: 10}){ ForEach(this.shop.images, (image) =\u003e { ListItem(){ Column(){ Image(image) .width(150).aspectRatio(1.1).borderRadius(5) } } }) } .listDirection(Axis.Horizontal) .width('100%') } .width('100%') .height(240) .padding(12) .backgroundColor(Color.White) .borderRadius(15) .shadow({radius: 6, color: '#1F000000', offsetX: 2, offsetY: 4}) } } // 文本超出时的统一样式处理 @Extend(Text) function ellipsisTextOverFlow(line: number = 1){ .textOverflow({overflow: TextOverflow.Ellipsis}) .maxLines(line) } 第三方库 axios https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/ide-command-line-ohpm-0000001490235312-V2\nOHPM CLI 作为鸿蒙生态三方库的包管理工具，支持OpenHarmony共享包的发布、安装和依赖管理。\n下载ohpm工具包， 点击链接获取。\n解压文件，进入“ohpm/bin”目录，打开命令行工具，执行如下指令init.bat初始化ohpm\n将ohpm配置到环境变量中。\nWindows环境变量设置方法：\n在此电脑 \u003e 属性 \u003e 高级系统设置 \u003e 高级 \u003e 环境变量中，将ohpm命令行工具的bin目录配置到系统或者用户的PATH变量中。\n安装完成之后，执行ohpm -v 输出版本号即为安装成功\n配置完环境变量后可能需要重启电脑才能生效\nOpenHarmony三方库中心仓: https://ohpm.openharmony.cn/#/cn/home\n以下为 使用案例\n// import http from '@ohos.net.http' import axios from '@ohos/axios' import ShopInfo from '../viewmodel/ShopInfo' class ShopModel { pageNo: number = 1 url: string = `http://127.0.0.1:3000/` getShopList(): Promise\u003cShopInfo[]\u003e { return new Promise( (resolve, reject) =\u003e { axios.get( this.url + `shops?pageNo=${this.pageNo}\u0026pageSize=4`, ) .then((res) =\u003e { if (res.status === 200) { // 请求成功 console.log(\"Success\") resolve(res.data) } else { console.log(\"Error\", JSON.stringify(res)) reject(\"Error\") } }) .catch((err: Error) =\u003e { // 请求失败 console.log(\"Error\", JSON.stringify(err)) reject(\"Error\") }) } ) } } const shopModel = new ShopModel() export default shopModel as ShopModel 数据持久化 https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/app-data-persistence-overview-0000001505513497-V2\n应用数据持久化，是指应用将内存中的数据通过文件或数据库的形式保存到设备上。内存中的数据形态通常是任意的数据结构或数据对象，存储介质上的数据形态可能是文本、数据库、二进制文件等。\nHarmonyOS标准系统支持典型的存储数据形态，包括用户首选项、键值型数据库、关系型数据库。\n开发者可以根据如下功能介绍，选择合适的数据形态以满足自己应用数据的持久化需要。\n用户首选项（Preferences）：通常用于保存应用的配置信息。数据通过文本的形式保存在设备中，应用使用过程中会将文本中的数据全量加载到内存中，所以访问速度快、效率高，但不适合需要存储大量数据的场景。 键值型数据库（KV-Store）：一种非关系型数据库，其数据以“键值”对的形式进行组织、索引和存储，其中“键”作为唯一标识符。适合很少数据关系和业务关系的业务数据存储，同时因其在分布式场景中降低了解决数据库版本兼容问题的复杂度，和数据同步过程中冲突解决的复杂度而被广泛使用。相比于关系型数据库，更容易做到跨设备跨版本兼容。 关系型数据库（RelationalStore）：一种关系型数据库，以行和列的形式存储数据，广泛用于应用中的关系型数据的处理，包括一系列的增、删、改、查等接口，开发者也可以运行自己定义的SQL语句来满足复杂业务场景的需要。 在 harmony 中, 比较常用的是 用户首选项以及关系型数据库\n用户首选项 https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/data-persistence-by-preferences-0000001505432513-V2\n用户首选项为应用提供Key-Value键值型的数据处理能力，支持应用持久化轻量级数据，并对其修改和查询。当用户希望有一个全局唯一存储的地方，可以采用用户首选项来进行存储。Preferences会将该数据缓存在内存中，当用户读取的时候，能够快速从内存中获取数据，当需要持久化时可以使用flush接口将内存中的数据写入持久化文件中。Preferences会随着存放的数据量越多而导致应用占用的内存越大，因此，Preferences不适合存放过多的数据，适用的场景一般为应用保存用户的个性化设置（字体大小，是否开启夜间模式）等。\nKey 为 string 类型, 要求非空且长度不超过80字节\nValue 可以是 string, number, boolean及以上类型数组, 大小不超过 8192 字节\n数据量建议不超过一万条\n下面对preferences 进行封装，基本思路：\n注意: 只要在真机预览才能看到效果\n在获取preferences实例后会将其保存单例中，这个单例是GlobalContext，方便后期可以通过单例直接获取实例；由于get()返回值类型是不确定性，定义一个联合类型的别名ValueType 来接收\n// src/main/ets/common/PreferencesUtil.ts import dataPreferences from '@ohos.data.preferences' import GlobalContext from '../../common/GlobalContext' import { LogUtils } from '../LogUtils' const LOG = 'PreferencesUtils-PUT' // 默认文件名(数据库表名)，可以在构造函数进行修改 const PREFERENCES_NAME = 'scjgPreferences' const KEY_PREFERENCES = 'preferences' type ValueType = number | string | boolean | Array\u003cnumber\u003e | Array\u003cstring\u003e | Array\u003cboolean\u003e class PreferencesUtils { // preferences的文件名-数据库表名 private preferencesName: string = PREFERENCES_NAME // 用于获取preferences实例的key值，保存到单例中 private keyPreferences: string = KEY_PREFERENCES constructor(name: string = PREFERENCES_NAME, key: string = KEY_PREFERENCES) { this.preferencesName = name this.keyPreferences = key } /** * 创建首选项实例 * @param context: 应用上下文 * @param preferencesName: 数据库表名 * @returns */ createPreferences(context): Promise\u003cdataPreferences.Preferences\u003e { let preferences = dataPreferences.getPreferences(context, this.preferencesName) GlobalContext.getContext().setObject(this.keyPreferences, preferences) return } /** * 获取首选项实例 * @returns */ getPreferences(): Promise\u003cdataPreferences.Preferences\u003e { return GlobalContext.getContext().getObject(this.keyPreferences) as Promise\u003cdataPreferences.Preferences\u003e } /** * 获取数据 * @param key: 读取key值 * @param def: 函数出参 * @returns */ async get(key: string, def?: ValueType): Promise\u003cValueType\u003e { return (await this.getPreferences()).get(key, def) } // 获取全部数据 async getAll(): Promise\u003cObject\u003e { let preferences = await this.getPreferences() return preferences.getAll() } /** * 插入数据 * @param key: 存入key值 * @param value: 存储数据 * @returns */ async put(key: string, value: ValueType): Promise\u003cvoid\u003e { let promise = await this.getPreferences().then(async preferences =\u003e { // 插入数据 await preferences.put(key, value) // 写入文件 await preferences.flush() }).catch(error =\u003e { LogUtils.error(LOG, `code:${error.code}, message:${error.message}`) }) return promise } /** * 删除数据 * @param key: 删除key的value值 * @returns */ async delete(key: string): Promise\u003cvoid\u003e { return (await this.getPreferences()).delete(key).finally(async () =\u003e { (await this.getPreferences()).flush() }) } // 清空数据 async clear(): Promise\u003cvoid\u003e { return (await this.getPreferences()).clear().finally(async () =\u003e { (await this.getPreferences()).flush() }) } } export default new PreferencesUtils() // src/main/ets/common/GlobalContext.ts export default class GlobalContext { private constructor() {} private static instance: GlobalContext private _objects = new Map\u003cstring, Object\u003e() public static getContext(): GlobalContext { if (!GlobalContext.instance) { GlobalContext.instance = new GlobalContext() } return GlobalContext.instance } getObject(value: string): Object | undefined { return this._objects.get(value) } setObject(key: string, objectClass: Object): void { this._objects.set(key, objectClass) } } 在EntryAbility中onCreate()方法初始化：\nexport default class EntryAbility extends UIAbility { onCreate(want: Want, launchParam: AbilityConstant.LaunchParam): void { PreferencesUtils.createPreferences(this.context) hilog.info(0x0000, 'testTag', '%{public}s', 'Ability onCreate') } } import PreferencesUtils from '../common/PreferencesUtil' @Entry @Component struct member { @State text: string = '' aboutToAppear() { this.getAll() } async getAll() { this.text = JSON.stringify(await PreferencesUtils.getAll() as Object) console.log('getAll', this.text) } build() { Column() { Text(this.text) .width('100%') .height(60) Row() { Button('get') .onClick(async () =\u003e { this.text = await PreferencesUtils.get('userName') as string }) Button('getAll') .onClick(async () =\u003e { this.getAll() }) Button('put') .onClick(async () =\u003e { await PreferencesUtils.put('userName', '李四') await PreferencesUtils.put('age', 25) await PreferencesUtils.put('sex', '女') this.getAll() }) Button('delete') .onClick(async () =\u003e { await PreferencesUtils.delete('sex') this.getAll() }) Button('clear') .onClick(async () =\u003e { await PreferencesUtils.clear() this.getAll() }) } .width('100%') .justifyContent(FlexAlign.Center) }.margin({ top: 50 }) } } 关系型数据库 https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/data-persistence-by-rdb-store-0000001505752421-V2\n关系型数据库基于SQLite组件，适用于存储包含复杂关系数据的场景，比如一个班级的学生信息，需要包括姓名、学号、各科成绩等，又或者公司的雇员信息，需要包括姓名、工号、职位等，由于数据之间有较强的对应关系，复杂程度比键值型数据更高，此时需要使用关系型数据库来持久化保存数据。\n谓词：数据库中用来代表数据实体的性质、特征或者数据实体之间关系的词项，主要用来定义数据库的操作条件。 结果集：指用户查询之后的结果集合，可以对数据进行访问。结果集提供了灵活的数据访问方式，可以更方便地拿到用户想要的数据。 关系型数据库对应用提供通用的操作接口，底层使用SQLite作为持久化存储引擎，支持SQLite具有的数据库特性，包括但不限于事务、索引、视图、触发器、外键、参数化查询和预编译SQL语句。\n使用关系型数据库实现数据持久化，需要获取一个RdbStore。示例代码如下所示： import relationalStore from '@ohos.data.relationalStore'; // 导入模块 import UIAbility from '@ohos.app.ability.UIAbility'; class EntryAbility extends UIAbility { onWindowStageCreate(windowStage) { const STORE_CONFIG = { name: 'RdbTest.db', // 数据库文件名 securityLevel: relationalStore.SecurityLevel.S1 // 数据库安全级别 }; const SQL_CREATE_TABLE = 'CREATE TABLE IF NOT EXISTS EMPLOYEE (ID INTEGER PRIMARY KEY AUTOINCREMENT, NAME TEXT NOT NULL, AGE INTEGER, SALARY REAL, CODES BLOB)'; // 建表Sql语句 relationalStore.getRdbStore(this.context, STORE_CONFIG, (err, store) =\u003e { if (err) { console.error(`Failed to get RdbStore. Code:${err.code}, message:${err.message}`); return; } console.info(`Succeeded in getting RdbStore.`); store.executeSql(SQL_CREATE_TABLE); // 创建数据表 // 这里执行数据库的增、删、改、查等操作 }); } } 获取到RdbStore后，调用insert()接口插入数据。示例代码如下所示： const valueBucket = { 'NAME': 'Lisa', 'AGE': 18, 'SALARY': 100.5, 'CODES': new Uint8Array([1, 2, 3, 4, 5]) }; store.insert('EMPLOYEE', valueBucket, (err, rowId) =\u003e { if (err) { console.error(`Failed to insert data. Code:${err.code}, message:${err.message}`); return; } console.info(`Succeeded in inserting data. rowId:${rowId}`); }) 关系型数据库没有显式的flush操作实现持久化，数据插入即保存在持久化文件。\n根据谓词指定的实例对象，对数据进行修改或删除。\n调用update()方法修改数据，调用delete()方法删除数据。示例代码如下所示：\n// 修改数据 const valueBucket = { 'NAME': 'Rose', 'AGE': 22, 'SALARY': 200.5, 'CODES': new Uint8Array([1, 2, 3, 4, 5]) }; let predicates = new relationalStore.RdbPredicates('EMPLOYEE'); // 创建表'EMPLOYEE'的predicates predicates.equalTo('NAME', 'Lisa'); // 匹配表'EMPLOYEE'中'NAME'为'Lisa'的字段 store.update(valueBucket, predicates, (err, rows) =\u003e { if (err) { console.error(`Failed to update data. Code:${err.code}, message:${err.message}`); return; } console.info(`Succeeded in updating data. row count: ${rows}`); }) // 删除数据 let predicates = new relationalStore.RdbPredicates('EMPLOYEE'); predicates.equalTo('NAME', 'Lisa'); store.delete(predicates, (err, rows) =\u003e { if (err) { console.error(`Failed to delete data. Code:${err.code}, message:${err.message}`); return; } console.info(`Delete rows: ${rows}`); }) 根据谓词指定的查询条件查找数据。\n调用query()方法查找数据，返回一个ResultSet结果集。示例代码如下所示：\nlet predicates = new relationalStore.RdbPredicates('EMPLOYEE'); predicates.equalTo('NAME', 'Rose'); store.query(predicates, ['ID', 'NAME', 'AGE', 'SALARY', 'CODES'], (err, resultSet) =\u003e { if (err) { console.error(`Failed to query data. Code:${err.code}, message:${err.message}`); return; } console.info(`ResultSet column names: ${resultSet.columnNames}`); console.info(`ResultSet column count: ${resultSet.columnCount}`); }) 当应用完成查询数据操作，不再使用结果集（ResultSet）时，请及时调用close方法关闭结果集，释放系统为其分配的内存。\n删除数据库。\n调用deleteRdbStore()方法，删除数据库及数据库相关文件。示例代码如下\nimport UIAbility from '@ohos.app.ability.UIAbility'; class EntryAbility extends UIAbility { onWindowStageCreate(windowStage) { relationalStore.deleteRdbStore(this.context, 'RdbTest.db', (err) =\u003e { if (err) { console.error(`Failed to delete RdbStore. Code:${err.code}, message:${err.message}`); return; } console.info('Succeeded in deleting RdbStore.'); }); } } 以下是一个案例, 包含增, 查, 代码很粗糙\n// src/main/ets/utils/DbUtil.ts import common from '@ohos.app.ability.common'; import relationalStore from '@ohos.data.relationalStore'; import { ColumnInfo, ColumnType } from '../type/ColumnInfo'; import Logger from './Logger'; // 操作的数据库名称 const DB_FILENAME: string = 'OliannaWen.db' class DbUtil { // 使用变量来获取关系型数据库操作对象 rdbStore: relationalStore.RdbStore // 初始化数据库 initDB(context: common.UIAbilityContext): Promise\u003cvoid\u003e { let config: relationalStore.StoreConfig = { // 数据库名称 name: DB_FILENAME, // 数据库操作安全等级 securityLevel: relationalStore.SecurityLevel.S1 } return new Promise\u003cvoid\u003e((resolve, reject) =\u003e { // 获取关系型数据库操作对象 relationalStore.getRdbStore(context, config) .then(rdbStore =\u003e { this.rdbStore = rdbStore // 记录日志 Logger.debug('rdbStore 初始化完成！') resolve() }) .catch(reason =\u003e { Logger.debug('rdbStore 初始化异常', JSON.stringify(reason)) reject(reason) }) }) } // 创建表函数，传入创建表语句 createTable(createSQL: string): Promise\u003cvoid\u003e { return new Promise((resolve, reject) =\u003e { this.rdbStore.executeSql(createSQL) .then(() =\u003e { Logger.debug('创建表成功', createSQL) resolve() }) .catch(err =\u003e { Logger.error('创建表失败,' + err.message, JSON.stringify(err)) reject(err) }) }) } // 建立insert方法的映射关系（实体数据插入到数据库的字段映射） buildValueBucket(obj: any, columns: ColumnInfo[]): relationalStore.ValuesBucket { let value = {} columns.forEach(info =\u003e { let val = obj[info.name] if (typeof val !== 'undefined') { value[info.columnName] = val } }) return value } // 新增方法，参数为表名称和新增对象 insert(tableName: string, obj: any, columns: ColumnInfo[]): Promise\u003cnumber\u003e { return new Promise((resolve, reject) =\u003e { // 1.构建新增数据 let value = this.buildValueBucket(obj, columns) // 2.新增 this.rdbStore.insert(tableName, value, (err, id) =\u003e { if (err) { Logger.error('新增失败！', JSON.stringify(err)) reject(err) } else { Logger.debug('新增成功！新增id：', id.toString()) resolve(id) } }) }) } // 删除方法,传入删除条件 delete(predicates: relationalStore.RdbPredicates): Promise\u003cnumber\u003e { return new Promise((resolve, reject) =\u003e { this.rdbStore.delete(predicates, (err, rows) =\u003e { if (err) { Logger.error('删除失败！', JSON.stringify(err)) reject(err) } else { Logger.debug('删除成功！删除行数：', rows.toString()) resolve(rows) } }) }) } // 查询方法,传入查询条件,字段,返回结果 queryForList\u003cT\u003e(predicates: relationalStore.RdbPredicates, columns: ColumnInfo[]): Promise\u003cT[]\u003e { Logger.debug(\"dddfafa\") return new Promise((resolve, reject) =\u003e { this.rdbStore.query(predicates, columns.map(info =\u003e info.columnName), (err, result) =\u003e { if (err) { Logger.error('查询失败！', JSON.stringify(err)) reject(err) } else { Logger.debug('查询成功！查询行数：', result.rowCount.toString()) resolve(this.parseResultSet(result, columns)) } }) }) } // 解析结果集 parseResultSet\u003cT\u003e(result: relationalStore.ResultSet, columns: ColumnInfo[]): T[] { // 1.声明最终返回的结果 let arr = [] // 2.判断是否有结果 if (result.rowCount \u003c= 0) { return arr } // 3.处理结果 while (!result.isAtLastRow) { // 3.1.去下一行 result.goToNextRow() // 3.2.解析这行数据，转为对象 let obj = {} columns.forEach(info =\u003e { let val = null switch (info.type) { case ColumnType.LONG: val = result.getLong(result.getColumnIndex(info.columnName)) break case ColumnType.DOUBLE: val = result.getDouble(result.getColumnIndex(info.columnName)) break case ColumnType.STRING: val = result.getString(result.getColumnIndex(info.columnName)) break case ColumnType.BLOB: val = result.getBlob(result.getColumnIndex(info.columnName)) break } obj[info.name] = val }) // 3.3.将对象填入结果数组 arr.push(obj) Logger.debug('查询到数据：', JSON.stringify(obj)) } return arr } } let dbUtil: DbUtil = new DbUtil(); export default dbUtil as DbUtil // src/main/ets/entryability/EntryAbility.ets async onCreate(want, launchParam) { // 初始化任务表 await DbUtil.initDB(this.context) } import dbUtil from '../utils/DbUtil'; import Logger from '../utils/Logger'; import relationalStore from '@ohos.data.relationalStore'; enum ColumnType { LONG, DOUBLE, STRING, BLOB } interface ColumnInfo { // 实体字段 name: string // 映射到数据库对应的字段 columnName: string // 数据库字段类型 type: ColumnType } interface ValuesBucket { [key: string]: any; } const DB_NAME = 'testDB'; const TABLE_NAME = 'table1'; const SQL_CREATE_TABLE = ` CREATE TABLE IF NOT EXISTS ${TABLE_NAME} ( ID INTEGER PRIMARY KEY AUTOINCREMENT, NAME TEXT NOT NULL, AGE INTEGER, SALARY REAL, CODES BLOB ) ` const columns: ColumnInfo[] = [ { name: 'NAME', columnName: 'NAME', type: ColumnType.STRING }, { name: 'AGE', columnName: 'AGE', type: ColumnType.LONG }, { name: 'SALARY', columnName: 'SALARY', type: ColumnType.DOUBLE }, { name: 'CODES', columnName: 'CODES', type: ColumnType.BLOB }, ] const valBucket: ValuesBucket = { 'NAME': 'John Doe', 'AGE': 30, 'SALARY': 5000.50, 'CODES': new Uint8Array([1, 2, 3, 4, 5]), }; let predicates = new relationalStore.RdbPredicates(TABLE_NAME); const createTable = async () =\u003e { const res = await dbUtil.createTable(SQL_CREATE_TABLE) Logger.debug(JSON.stringify(res)) } const insertData = async () =\u003e { const res = await dbUtil.insert(TABLE_NAME, valBucket, columns); return res }; const queryData = async () =\u003e { const res = await dbUtil.queryForList(predicates, columns) Logger.debug(JSON.stringify(res)) } export { createTable, insertData, queryData } import { createTable, insertData, queryData } from '../viewmodel/useDb' @Entry @Component struct Index { build() { Column({ space: 10 }) { Button(\"Create\") .onClick(() =\u003e { createTable() }) Button(\"Insert\") .onClick(async () =\u003e { insertData() }) Button(\"Query\") .onClick(async () =\u003e { await queryData() }) } .width('100%') } } 通知 基础通知 https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V3/notification-guidelines-0000001281360946-V3\nhttps://developer.huawei.com/consumer/cn/doc/harmonyos-references-V3/js-apis-notification-0000001333321097-V3\n名称 值 说明 NOTIFICATION_CONTENT_BASIC_TEXT ContentType 普通类型通知。 NOTIFICATION_CONTENT_LONG_TEXT ContentType 长文本类型通知。 NOTIFICATION_CONTENT_PICTURE ContentType 图片类型通知。 NOTIFICATION_CONTENT_CONVERSATION ContentType 社交类型通知。 NOTIFICATION_CONTENT_MULTILINE ContentType 多行文本类型通知。 系统能力：以下各项对应的系统能力均为SystemCapability.Notification.Notification\n名称 可读 可写 类型 必填 描述 content 是 是 NotificationContent 是 通知内容。 id 是 是 number 否 通知ID。 slotType 是 是 SlotType 否 通道类型。 isOngoing 是 是 boolean 否 是否进行时通知。 isUnremovable 是 是 boolean 否 是否可移除。 deliveryTime 是 是 number 否 通知发送时间。 tapDismissed 是 是 boolean 否 通知是否自动清除。 autoDeletedTime 是 是 number 否 自动清除的时间。 wantAgent 是 是 WantAgent 否 点击跳转的WantAgent。 extraInfo 是 是 {[key: string]: any} 否 扩展参数。 color 是 是 number 否 通知背景颜色。 colorEnabled 是 是 boolean 否 通知背景颜色是否使能。 isAlertOnce 是 是 boolean 否 设置是否仅有一次此通知警报。 isStopwatch 是 是 boolean 否 是否显示已用时间。 isCountDown 是 是 boolean 否 是否显示倒计时时间。 isFloatingIcon 是 是 boolean 否 是否显示状态栏图标。 label 是 是 string 否 通知标签。 badgeIconStyle 是 是 number 否 通知角标类型。 showDeliveryTime 是 是 boolean 否 是否显示分发时间。 actionButtons 是 是 Array\u003c NotificationActionButton\u003e 否 通知按钮，最多两个按钮。 smallIcon 是 是 PixelMap 否 通知小图标。 largeIcon 是 是 PixelMap 否 通知大图标。 creatorBundleName 是 否 string 否 创建通知的包名。 creatorUid 是 否 number 否 创建通知的UID。 creatorPid 是 否 number 否 创建通知的PID。 creatorUserId8+ 是 否 number 否 创建通知的UserId。 hashCode 是 否 string 否 通知唯一标识。 groupName8+ 是 是 string 否 组通知名称。 template8+ 是 是 NotificationTemplate 否 通知模板。 distributedOption8+ 是 是 DistributedOptions 否 分布式通知的选项。 notificationFlags8+ 是 否 NotificationFlags 否 获取NotificationFlags。 import notify from '@ohos.notificationManager' import image from '@ohos.multimedia.image' @Entry @Component struct Index { // 全局任务 id idx: number = 100 // 图像 pixel: PixelMap async aboutToAppear() { // 获取资源管理器 let rm = getContext(this).resourceManager // 读取图片 let file = await rm.getMediaContent($r('app.media.watchGT4')) // 创建 PixelMap image.createImageSource(file.buffer).createPixelMap() .then(value =\u003e this.pixel = value) .catch(reason =\u003e console.error(reason)) } build() { Column({ space: 10 }) { Button(`发送normalText通知`) .onClick(() =\u003e this.publishNormalTextNotification()) Button(`发送longText通知`) .onClick(() =\u003e this.publishLongTextNotification()) Button(`发送multiLine通知`) .onClick(() =\u003e this.publishMultiLineNotification()) Button(`发送Picture通知`) .onClick(() =\u003e this.publishPictureNotification()) } .width('100%') } publishNormalTextNotification() { let request: notify.NotificationRequest = { id: this.idx++, content: { contentType: notify.ContentType.NOTIFICATION_CONTENT_BASIC_TEXT, normal: { title: '通知标题' + this.idx, text: '通知内容详情', additionalText: '通知附加内容' } }, showDeliveryTime: true, deliveryTime: new Date().getTime(), groupName: 'wechat', slotType: notify.SlotType.SOCIAL_COMMUNICATION } this.publish(request) } publishLongTextNotification() { let request: notify.NotificationRequest = { id: this.idx++, content: { contentType: notify.ContentType.NOTIFICATION_CONTENT_LONG_TEXT, longText: { title: '通知标题' + this.idx, text: '通知内容详情', additionalText: '通知附加内容', longText: '通知中的长文本，我很长，我很长，我很长，我很长，我很长，我很长，我很长', briefText: '通知概要和总结', expandedTitle: '通知展开时的标题' + this.idx } } } this.publish(request) } publishMultiLineNotification() { let request: notify.NotificationRequest = { id: this.idx++, content: { contentType: notify.ContentType.NOTIFICATION_CONTENT_MULTILINE, multiLine: { title: '通知标题' + this.idx, text: '通知内容详情', additionalText: '通知附加内容', briefText: '通知概要和总结', longTitle: '展开时的标题，我很宽，我很宽，我很宽', lines: [ '第一行', '第二行', '第三行', '第四行', ] } } } this.publish(request) } publishPictureNotification() { let request: notify.NotificationRequest = { id: this.idx++, content: { contentType: notify.ContentType.NOTIFICATION_CONTENT_PICTURE, picture: { title: '通知标题' + this.idx, text: '通知内容详情', additionalText: '通知附加内容', briefText: '通知概要和总结', expandedTitle: '展开后标题' + this.idx, picture: this.pixel } } } this.publish(request) } private publish(request: notify.NotificationRequest) { notify.publish(request) .then(() =\u003e console.log('notify test', '发送通知成功')) .then(reason =\u003e console.log('notify test', '发送通知失败', JSON.stringify(reason))) } } 进度条通知 import Notification from '@ohos.notificationManager' import wantAgent, { WantAgent } from '@ohos.app.ability.wantAgent' import promptAction from '@ohos.promptAction' import Prompt from '@system.prompt' enum DownloadState { NOT_BEGIN = '未开始', DOWNLOADING = '下载中', PAUSE = '已暂停', FINISHED = '已完成', } @Entry @Component struct Index { // 下载进度 @State progressValue: number = 0 progressMaxValue: number = 100 // 任务状态 @State state: DownloadState = DownloadState.NOT_BEGIN // 下载的文件名 filename: string = '圣诞星.mp4' // 模拟下载的任务的id taskId: number = -1 // 通知id notificationId: number = 999 isSupport: boolean = false wantAgentInstance: WantAgent async aboutToAppear() { // 1.判断当前系统是否支持进度条模板 this.isSupport = await Notification.isSupportTemplate('downloadTemplate') // 2.创建拉取当前应用的行为意图 // 2.1.创建wantInfo信息 let wantInfo: wantAgent.WantAgentInfo = { wants: [ { bundleName: 'com.example.myapplication', abilityName: 'EntryAbility', } ], requestCode: 0, operationType: wantAgent.OperationType.START_ABILITY, wantAgentFlags: [wantAgent.WantAgentFlags.CONSTANT_FLAG] } // 2.2.创建wantAgent实例 this.wantAgentInstance = await wantAgent.getWantAgent(wantInfo) } build() { Row({ space: 10 }) { Image($r('app.media.ic_files_video')).width(50) Column({ space: 5 }) { Row() { Text(this.filename) Text(`${this.progressValue}%`).fontColor('#c1c2c1') } .width('100%') .justifyContent(FlexAlign.SpaceBetween) Progress({ value: this.progressValue, total: this.progressMaxValue, }) Row({ space: 5 }) { Text(`${(this.progressValue * 0.43).toFixed(2)}MB`) .fontSize(14).fontColor('#c1c2c1') Blank() if (this.state === DownloadState.NOT_BEGIN) { Button('开始').downloadButton() .onClick(() =\u003e this.download()) } else if (this.state === DownloadState.DOWNLOADING) { Button('取消').downloadButton().backgroundColor('#d1d2d3') .onClick(() =\u003e this.cancel()) Button('暂停').downloadButton() .onClick(() =\u003e this.pause()) } else if (this.state === DownloadState.PAUSE) { Button('取消').downloadButton().backgroundColor('#d1d2d3') .onClick(() =\u003e this.cancel()) Button('继续').downloadButton() .onClick(() =\u003e this.download()) } else { Button('打开').downloadButton() .onClick(() =\u003e this.open()) } }.width('100%') } .layoutWeight(1) } .width('100%') .borderRadius(20) .padding(15) .backgroundColor(Color.White) } cancel() { // 取消定时任务 if (this.taskId \u003e 0) { clearInterval(this.taskId); this.taskId = -1 } console.log(this.notificationId.toString()) // 清理下载任务进度 this.progressValue = 0 // 标记任务状态：未开始 this.state = DownloadState.NOT_BEGIN // 取消通知 Notification.cancel(this.notificationId).then((response) =\u003e { console.log('ssssss', JSON.stringify(response)) }) } download() { // 清理旧任务 if (this.taskId \u003e 0) { clearInterval(this.taskId); } // 开启定时任务，模拟下载 this.taskId = setInterval(() =\u003e { // 判断任务进度是否达到100 if (this.progressValue \u003e= 100) { // 任务完成了，应该取消定时任务 clearInterval(this.taskId) this.taskId = -1 // 并且标记任务状态为已完成 this.state = DownloadState.FINISHED // 发送通知 this.publishProgressNotification() return } // 模拟任务进度变更 this.progressValue += 2 // 发送通知 this.publishProgressNotification() }, 500) // 标记任务状态：下载中 this.state = DownloadState.DOWNLOADING } pause() { // 取消定时任务 if (this.taskId \u003e 0) { clearInterval(this.taskId); this.taskId = -1 } // 标记任务状态：已暂停 this.state = DownloadState.PAUSE // 发送通知 this.publishProgressNotification() } open() { promptAction.showToast({ message: '功能未实现' }) } async publishProgressNotification() { let isSupportTpl: boolean; await Notification.isSupportTemplate('downloadTemplate').then((data) =\u003e { isSupportTpl = data; }).catch((err) =\u003e { Prompt.showToast({ message: `判断是否支持进度条模板时报错,error[${err}]`, duration: 2000 }) }) if (isSupportTpl) { // 构造模板 let template = { name: 'downloadTemplate', data: { progressValue: this.progressValue, // 当前进度值 progressMaxValue: this.progressMaxValue // 最大进度值 } }; let notificationRequest: Notification.NotificationRequest = { id: this.notificationId, content: { contentType: Notification.ContentType.NOTIFICATION_CONTENT_BASIC_TEXT, normal: { title: this.filename + ': ' + this.state, text: '', additionalText: this.progressValue + '%' } }, template: template }; // 发布通知 Notification.publish(notificationRequest).then(() =\u003e { Prompt.showToast({ message: `发布通知成功！`, duration: 2000 }) }).catch((err) =\u003e { Prompt.showToast({ message: `发布通知失败,error[${err}]`, duration: 2000 }) }) } else { Prompt.showToast({ message: '不支持downloadTemplate进度条通知模板', duration: 2000 }) } } publishDownloadNotification() { // 1.判断当前系统是否支持进度条模板 if (!this.isSupport) { // 当前系统不支持进度条模板 console.log(\"not support\") return } // 2.准备进度条模板的参数 let template = { name: 'downloadTemplate', data: { progressValue: this.progressValue, progressMaxValue: this.progressMaxValue } } let request: Notification.NotificationRequest = { id: this.notificationId, template: template, wantAgent: this.wantAgentInstance, content: { contentType: Notification.ContentType.NOTIFICATION_CONTENT_BASIC_TEXT, normal: { title: this.filename + ': ' + this.state, text: '', additionalText: this.progressValue + '%' } } } // 3.发送通知 Notification.publish(request) .then(() =\u003e console.log('test', '通知发送成功')) .catch(reason =\u003e console.log('test', '通知发送失败！', JSON.stringify(reason))) } } @Extend(Button) function downloadButton() { .width(75).height(28).fontSize(14) } 通知意图 具体参数看官方文档\nhttps://developer.huawei.com/consumer/cn/doc/harmonyos-references-V2/js-apis-app-ability-wantagent-0000001493424324-V2\n​ async aboutToAppear() { // 1.判断当前系统是否支持进度条模板 this.isSupport = await Notification.isSupportTemplate('downloadTemplate') // 2.创建拉取当前应用的行为意图 // 2.1.创建wantInfo信息 let wantInfo: wantAgent.WantAgentInfo = { wants: [ { bundleName: 'com.example.learn_2', abilityName: 'EntryAbility', } ], requestCode: 0, operationType: wantAgent.OperationType.START_ABILITY, wantAgentFlags: [wantAgent.WantAgentFlags.CONSTANT_FLAG] } // 2.2.创建wantAgent实例 this.wantAgentInstance = await wantAgent.getWantAgent(wantInfo) } async publishProgressNotification() { let isSupportTpl: boolean; await Notification.isSupportTemplate('downloadTemplate').then((data) =\u003e { isSupportTpl = data; }).catch((err) =\u003e { Prompt.showToast({ message: `判断是否支持进度条模板时报错,error[${err}]`, duration: 2000 }) }) if (isSupportTpl) { // 构造模板 let template = { name: 'downloadTemplate', data: { progressValue: this.progressValue, // 当前进度值 progressMaxValue: this.progressMaxValue // 最大进度值 } }; let notificationRequest: Notification.NotificationRequest = { id: this.notificationId, wantAgent: this.wantAgentInstance, content: { contentType: Notification.ContentType.NOTIFICATION_CONTENT_BASIC_TEXT, normal: { title: this.filename + ': ' + this.state, text: '', additionalText: this.progressValue + '%' } }, template: template }; // 发布通知 Notification.publish(notificationRequest).then(() =\u003e { Prompt.showToast({ message: `发布通知成功！`, duration: 2000 }) }).catch((err) =\u003e { Prompt.showToast({ message: `发布通知失败,error[${err}]`, duration: 2000 }) }) } else { Prompt.showToast({ message: '不支持downloadTemplate进度条通知模板', duration: 2000 }) } } ","wordCount":"17955","inLanguage":"zh-cn","datePublished":"2024-04-06T16:04:23+08:00","dateModified":"2024-04-06T16:04:23+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://waite.wang/posts/harmony/learn-harmony-3/"},"publisher":{"@type":"Organization","name":"隶笔难书","logo":{"@type":"ImageObject","url":"https://waite.wang/images/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://waite.wang/ accesskey=h title="隶笔难书 (Alt + H)">隶笔难书</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://waite.wang/ title=首页><span>首页</span></a></li><li><a href=https://waite.wang/search title=搜索><span>搜索</span></a></li><li><a href=https://waite.wang/categories title=分类><span>分类</span></a></li><li><a href=https://waite.wang/tags title=标签><span>标签</span></a></li><li><a href=https://waite.wang/archives title=归档><span>归档</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">鸿蒙学习笔记3</h1><div class=post-meta>Created: &nbsp;<span title='2024-04-06 16:04:23 +0800 +0800'>2024-04-06</span>&nbsp;·&nbsp;36 min&nbsp;·&nbsp;17955 words&nbsp;|&nbsp;<a href=https://github.com/Waite0603/HugoBlog/edit/main/content/posts/harmony/learn-harmony-3.md rel="noopener noreferrer" target=_blank>在 GitHub 编辑</a></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#stage-%e6%a8%a1%e5%9e%8b aria-label="Stage 模型">Stage 模型</a><ul><li><a href=#stage%e6%a8%a1%e5%9e%8b%e7%9b%ae%e5%bd%95%e7%bb%93%e6%9e%84 aria-label=（Stage模型）目录结构>（Stage模型）目录结构</a></li><li><a href=#%e5%ba%94%e7%94%a8%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6 aria-label=应用配置文件>应用配置文件</a></li><li><a href=#%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f aria-label=生命周期>生命周期</a><ul><li><a href=#uiability%e7%bb%84%e4%bb%b6%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f aria-label=UIAbility组件生命周期>UIAbility组件生命周期</a></li><li><a href=#%e9%a1%b5%e9%9d%a2%e5%92%8c%e7%bb%84%e4%bb%b6%e7%9a%84%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f aria-label=页面和组件的生命周期>页面和组件的生命周期</a></li></ul></li><li><a href=#uiability%e7%bb%84%e4%bb%b6%e5%90%af%e5%8a%a8%e6%a8%a1%e5%bc%8f aria-label=UIAbility组件启动模式>UIAbility组件启动模式</a></li><li><a href=#singleton%e5%90%af%e5%8a%a8%e6%a8%a1%e5%bc%8f aria-label=singleton启动模式>singleton启动模式</a><ul><ul><li><a href=#multiton%e5%90%af%e5%8a%a8%e6%a8%a1%e5%bc%8f aria-label=multiton启动模式>multiton启动模式</a></li><li><a href=#specified%e5%90%af%e5%8a%a8%e6%a8%a1%e5%bc%8f aria-label=specified启动模式>specified启动模式</a></li></ul></ul></li></ul></li><li><a href=#%e7%bd%91%e7%bb%9c%e8%bf%9e%e6%8e%a5 aria-label=网络连接>网络连接</a><ul><li><a href=#http%e6%95%b0%e6%8d%ae%e8%af%b7%e6%b1%82 aria-label=HTTP数据请求>HTTP数据请求</a><ul><li><a href=#request%e6%8e%a5%e5%8f%a3%e5%bc%80%e5%8f%91%e6%ad%a5%e9%aa%a4 aria-label=request接口开发步骤>request接口开发步骤</a></li><li><a href=#%e6%a1%88%e4%be%8b aria-label=案例>案例</a></li></ul></li><li><a href=#%e7%ac%ac%e4%b8%89%e6%96%b9%e5%ba%93-axios aria-label="第三方库 axios">第三方库 axios</a></li></ul></li><li><a href=#%e6%95%b0%e6%8d%ae%e6%8c%81%e4%b9%85%e5%8c%96 aria-label=数据持久化>数据持久化</a><ul><li><a href=#%e7%94%a8%e6%88%b7%e9%a6%96%e9%80%89%e9%a1%b9 aria-label=用户首选项>用户首选项</a></li><li><a href=#%e5%85%b3%e7%b3%bb%e5%9e%8b%e6%95%b0%e6%8d%ae%e5%ba%93 aria-label=关系型数据库>关系型数据库</a></li></ul></li><li><a href=#%e9%80%9a%e7%9f%a5 aria-label=通知>通知</a><ul><li><a href=#%e5%9f%ba%e7%a1%80%e9%80%9a%e7%9f%a5 aria-label=基础通知>基础通知</a></li><li><a href=#%e8%bf%9b%e5%ba%a6%e6%9d%a1%e9%80%9a%e7%9f%a5 aria-label=进度条通知>进度条通知</a></li><li><a href=#%e9%80%9a%e7%9f%a5%e6%84%8f%e5%9b%be aria-label=通知意图>通知意图</a></li></ul></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h2 id=stage-模型>Stage 模型<a hidden class=anchor aria-hidden=true href=#stage-模型>#</a></h2><p><a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/start-with-ets-stage-0000001477980905-V2 target=_blank>https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/start-with-ets-stage-0000001477980905-V2</a></p><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202404271535958.png><img src=https://qiniu.waite.wang/202404271535958.png alt></a></div></p><blockquote><p>一个应用只能有一个 @EntryAbility，但可以有多个 @PageAbility。</p></blockquote><h3 id=stage模型目录结构>（Stage模型）目录结构<a hidden class=anchor aria-hidden=true href=#stage模型目录结构>#</a></h3><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202404181340550.png><img src=https://qiniu.waite.wang/202404181340550.png alt></a></div></p><ul><li>AppScope > app.json5：应用的全局配置信息。</li><li>entry：HarmonyOS工程模块，编译构建生成一个HAP包。<ul><li>src > main > ets：用于存放ArkTS源码。
src > main > ets > entryability：应用/服务的入口。</li><li>src > main > ets > pages：应用/服务包含的页面</li><li>src > main > resources：用于存放应用/服务所用到的资源文件，如图形、多媒体、字符串、布局文件等。关于资源文件，详见资源分类与访问。</li><li>src > main > module.json5：Stage模型模块配置文件。主要包含HAP包的配置信息、应用/服务在具体设备上的配置信息以及应用/服务的全局配置信息。具体的配置文件说明，详见
<a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/module-configuration-file-0000001427744540-V2 target=_blank>module.json5配置文件</a>。</li><li>build-profile.json5：当前的模块信息、编译信息配置项，包括buildOption、targets配置等。其中targets中可配置当前运行环境，默认为HarmonyOS。</li><li>hvigorfile.ts：模块级编译构建任务脚本，开发者可以自定义相关任务和代码实现。</li></ul></li><li>oh_modules：用于存放三方库依赖信息。关于原npm工程适配ohpm操作，请参考历史工程迁移。</li><li>build-profile.json5：应用级配置信息，包括签名、产品配置等。</li><li>hvigorfile.ts：应用级编译构建任务脚本。</li></ul><h3 id=应用配置文件>应用配置文件<a hidden class=anchor aria-hidden=true href=#应用配置文件>#</a></h3><p><a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/14d_u7f6e_u6587_u4ef6_uff08stage_u6a21_u578b_uff09-0000001427902192-V2 target=_blank>https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/14d_u7f6e_u6587_u4ef6_uff08stage_u6a21_u578b_uff09-0000001427902192-V2</a></p><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202404271550809.png><img src=https://qiniu.waite.wang/202404271550809.png alt></a></div></p><blockquote><p>app.json5文件是应用的全局配置文件，用于配置应用的基本信息、版本信息、图标、名称、描述等。</p></blockquote><table><thead><tr><th>属性名称</th><th>含义</th><th>数据类型</th><th>是否可缺省</th></tr></thead><tbody><tr><td>bundleName</td><td>标识应用的Bundle名称，用于标识应用的唯一性。该标签不可缺省。标签的值命名规则 ：- 字符串以字母、数字、下划线和符号“.”组成。- 以字母开头。- 最小长度7个字节，最大长度127个字节。推荐采用反域名形式命名（如com.example.demo，建议第一级为域名后缀com，第二级为厂商/个人名，第三级为应用名，也可以多级）。</td><td>字符串</td><td>该标签不可缺省。</td></tr><tr><td>bundleType</td><td>标识应用的Bundle类型，用于区分应用或者原子化服务。该标签可选值为app和atomicService ：- app：当前Bundle为普通应用。- atomicService：当前Bundle为元服务。</td><td>字符串</td><td>该标签可以缺省，缺省为app。</td></tr><tr><td>debug</td><td>标识应用是否可调试，该标签由IDE编译构建时生成。- true：可调试。- false：不可调试。</td><td>布尔值</td><td>该标签可以缺省，缺省为false。</td></tr><tr><td>icon</td><td>标识
<a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/application-component-configuration-stage-0000001478340869-V2 target=_blank>应用的图标</a>，标签值为图标资源文件的索引。</td><td>字符串</td><td>该标签不可缺省。</td></tr><tr><td>label</td><td>标识
<a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/application-component-configuration-stage-0000001478340869-V2 target=_blank>应用的名称</a>，标签值为字符串资源的索引。</td><td>字符串</td><td>该标签不可缺省。</td></tr><tr><td>description</td><td>标识应用的描述信息，标签值是字符串类型（最大255个字节）或对描述内容的字符串资源索引。</td><td>字符串</td><td>该标签可缺省，缺省值为空。</td></tr><tr><td>vendor</td><td>标识对应用开发厂商的描述。该标签的值是字符串类型（最大255个字节）。</td><td>字符串</td><td>该标签可以缺省，缺省为空。</td></tr><tr><td>versionCode</td><td>标识应用的版本号，该标签值为32位非负整数。此数字仅用于确定某个版本是否比另一个版本更新，数值越大表示版本越高。开发者可以将该值设置为任何正整数，但是必须确保应用的新版本都使用比旧版本更大的值。该标签不可缺省，versionCode值应小于2^31次方。</td><td>数值</td><td>该标签不可缺省。</td></tr><tr><td>versionName</td><td>标识应用版本号的文字描述，用于向用户展示。该标签仅由数字和点构成，推荐采用“A.B.C.D”四段式的形式。四段式推荐的含义如下所示。第一段：主版本号/Major，范围0-99，重大修改的版本，如实现新的大功能或重大变化。第二段：次版本号/Minor，范围0-99，表示实现较突出的特点，如新功能添加或大问题修复。第三段：特性版本号/Feature，范围0-99，标识规划的新版本特性。第四段：修订版本号/Patch，范围0-999，表示维护版本，修复bug。标签最大字节长度为127。</td><td>字符串</td><td>该标签不可缺省。</td></tr><tr><td>minCompatibleVersionCode</td><td>标识应用能够兼容的最低历史版本号，用于跨设备兼容性判断。说明当前版本暂不支持跨设备能力。</td><td>数值</td><td>该标签可缺省，缺省值等于versionCode标签值。</td></tr><tr><td>minAPIVersion</td><td>标识应用运行需要的SDK的API最小版本。</td><td>数值</td><td>由build-profile.json5中的compatibleSdkVersion生成。</td></tr><tr><td>targetAPIVersion</td><td>标识应用运行需要的API目标版本。</td><td>数值</td><td>由build-profile.json5中的compileSdkVersion生成。</td></tr><tr><td>apiReleaseType</td><td>标识应用运行需要的API目标版本的类型，采用字符串类型表示。取值为“CanaryN”、“BetaN”或者“Release”，其中，N代表大于零的整数。- Canary：受限发布的版本。- Beta：公开发布的Beta版本。- Release：公开发布的正式版本。该字段由DevEco Studio读取当前使用的SDK的Stage来生成。</td><td>字符串</td><td>该标签可缺省，由IDE生成并覆盖。</td></tr><tr><td>multiProjects</td><td>标识当前工程是否支持多个工程的联合开发。- true：当前工程支持多个工程的联合开发。- false：当前工程不支持多个工程的联合开发。多工程开发可以参考文档：
<a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/build_overview-0000001055075201-V2#section73401914284 target=_blank>多工程构建</a>。</td><td>布尔值</td><td>可缺省，缺省值为false。</td></tr><tr><td>tablet</td><td>标识对tablet设备做的特殊配置，可以配置的属性字段有上文提到的：minAPIVersion、distributedNotificationEnabled。如果使用该属性对tablet设备做了特殊配置，则应用在tablet设备中会采用此处配置的属性值，并忽略在app.json5公共区域配置的属性值。</td><td>对象</td><td>该标签可缺省，缺省时tablet设备使用app.json5公共区域配置的属性值。</td></tr><tr><td>tv</td><td>标识对tv设备做的特殊配置，可以配置的属性字段有上文提到的：minAPIVersion、distributedNotificationEnabled。如果使用该属性对tv设备做了特殊配置，则应用在tv设备中会采用此处配置的属性值，并忽略在app.json5公共区域配置的属性值。</td><td>对象</td><td>该标签可缺省，缺省时tv设备使用app.json5公共区域配置的属性值。</td></tr><tr><td>wearable</td><td>标识对wearable设备做的特殊配置，可以配置的属性字段有上文提到的：minAPIVersion、distributedNotificationEnabled。如果使用该属性对wearable设备做了特殊配置，则应用在wearable设备中会采用此处配置的属性值，并忽略在app.json5公共区域配置的属性值。</td><td>对象</td><td>该标签可缺省，缺省时wearable设备使用app.json5公共区域配置的属性值。</td></tr><tr><td>car</td><td>标识对car设备做的特殊配置，可以配置的属性字段有上文提到的：minAPIVersion、distributedNotificationEnabled。如果使用该属性对car设备做了特殊配置，则应用在car设备中会采用此处配置的属性值，并忽略在app.json5公共区域配置的属性值。</td><td>对象</td><td>该标签可缺省，缺省时car设备使用app.json5公共区域配置的属性值。</td></tr><tr><td>phone</td><td>标识对phone设备做的特殊配置，可以配置的属性字段有上文提到的：minAPIVersion、distributedNotificationEnabled。如果使用该属性对phone设备做了特殊配置，则应用在phone设备中会采用此处配置的属性值，并忽略在app.json5公共区域配置的属性值。</td><td>对象</td><td>该标签可缺省，缺省时phone设备使用app.json5公共区域配置的属性值。</td></tr></tbody></table><blockquote><p>module.json5文件是Stage模型模块配置文件，用于配置HAP包的配置信息、应用/服务在具体设备上的配置信息以及应用/服务的全局配置信息。 以下是一个示例:</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;module&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;entry&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;entry&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;$string:module_desc&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;mainElement&#34;</span><span class=p>:</span> <span class=s2>&#34;EntryAbility&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;deviceTypes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;tv&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;tablet&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;deliveryWithInstall&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;installationFree&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;pages&#34;</span><span class=p>:</span> <span class=s2>&#34;$profile:main_pages&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;virtualMachine&#34;</span><span class=p>:</span> <span class=s2>&#34;ark&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;metadata&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;string&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=s2>&#34;string&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;resource&#34;</span><span class=p>:</span> <span class=s2>&#34;$profile:distributionFilter_config&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;abilities&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;EntryAbility&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;srcEntry&#34;</span><span class=p>:</span> <span class=s2>&#34;./ets/entryability/EntryAbility.ts&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;$string:EntryAbility_desc&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;icon&#34;</span><span class=p>:</span> <span class=s2>&#34;$media:icon&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;label&#34;</span><span class=p>:</span> <span class=s2>&#34;$string:EntryAbility_label&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;startWindowIcon&#34;</span><span class=p>:</span> <span class=s2>&#34;$media:icon&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;startWindowBackground&#34;</span><span class=p>:</span> <span class=s2>&#34;$color:start_window_background&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;exported&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;skills&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;entities&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>              <span class=s2>&#34;entity.system.home&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;actions&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>              <span class=s2>&#34;ohos.want.action.home&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;requestPermissions&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;ohos.abilitydemo.permission.PROVIDER&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;reason&#34;</span><span class=p>:</span> <span class=s2>&#34;$string:reason&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;usedScene&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;abilities&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;FormAbility&#34;</span>
</span></span><span class=line><span class=cl>          <span class=p>],</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;when&#34;</span><span class=p>:</span> <span class=s2>&#34;inuse&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><table><thead><tr><th>属性名称</th><th>含义</th><th>数据类型</th><th>是否可缺省</th></tr></thead><tbody><tr><td>name</td><td>标识当前Module的名称，标签值采用字符串表示（最大长度31个字节），该名称在整个应用要唯一，仅支持英文字符。</td><td>字符串</td><td>该标签不可缺省。</td></tr><tr><td>type</td><td>标识当前Module的类型。类型有两种，分别：- entry：应用的主模块。- feature：应用的动态特性模块。-har：静态共享包模块。-shared：动态共享包模块。</td><td>字符串</td><td>该标签不可缺省。</td></tr><tr><td>srcEntry</td><td>标识当前Module所对应的代码路径，标签值为字符串（最长为127字节）。</td><td>字符串</td><td>该标签可缺省，缺省值为空。</td></tr><tr><td>description</td><td>标识当前Module的描述信息，标签值是字符串类型（最长255字节）或对描述内容的字符串资源索引。</td><td>字符串</td><td>该标签可缺省，缺省值为空。</td></tr><tr><td>process</td><td>标识当前Module的进程名，标签值为字符串类型（最长为31个字节）。如果在HAP标签下配置了process，该应用的所有UIAbility、DataShareExtensionAbility、ServiceExtensionAbility都运行在该进程中。<strong>说明：</strong>- 仅支持系统应用配置，三方应用配置不生效。</td><td>字符串</td><td>可缺省，缺省为app.json5文件下app标签下的bundleName。</td></tr><tr><td>mainElement</td><td>标识当前Module的入口UIAbility名称或者ExtensionAbility名称。标签最大字节长度为255。</td><td>字符串</td><td>该标签可缺省，缺省值为空。</td></tr><tr><td><a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/module-configuration-file-0000001427744540-V2#ZH-CN_TOPIC_0000001573929365__devicetypes%e6%a0%87%e7%ad%be target=_blank>deviceTypes</a></td><td>标识当前Module可以运行在哪类设备上，标签值采用字符串数组的表示。</td><td>字符串数组</td><td>该标签不可缺省。</td></tr><tr><td>deliveryWithInstall</td><td>标识当前Module是否在用户主动安装的时候安装，表示该Module对应的HAP是否跟随应用一起安装。- true：主动安装时安装。- false：主动安装时不安装。</td><td>布尔值</td><td>该标签不可缺省。</td></tr><tr><td>installationFree</td><td>标识当前Module是否支持免安装特性。- true：表示支持免安装特性，且符合免安装约束。- false：表示不支持免安装特性。<strong>说明：</strong>- 当应用的entry类型Module的该字段配置为true时，该应用的feature类型的该字段也需要配置为true。- 当应用的entry类型Module的该字段配置为false时，该应用的feature类型的该字段根据业务需求配置true或false。</td><td>布尔值</td><td>该标签不可缺省。</td></tr><tr><td>virtualMachine</td><td>标识当前Module运行的目标虚拟机类型，供云端分发使用，如应用市场和分发中心。该标签值为字符串。如果目标虚拟机类型为ArkTS引擎，则其值为“ark+版本号”。</td><td>字符串</td><td>该标签由IDE构建HAP的时候自动插入。</td></tr><tr><td><a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/module-configuration-file-0000001427744540-V2#ZH-CN_TOPIC_0000001573929365__pages%e6%a0%87%e7%ad%be target=_blank>pages</a></td><td>标识当前Module的profile资源，用于列举每个页面信息。该标签最大长度为255个字节。</td><td>字符串</td><td>在有UIAbility的场景下，该标签不可缺省。</td></tr><tr><td><a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/module-configuration-file-0000001427744540-V2#ZH-CN_TOPIC_0000001573929365__metadata%e6%a0%87%e7%ad%be target=_blank>metadata</a></td><td>标识当前Module的自定义元信息，标签值为数组类型，只对当前Module、UIAbility、ExtensionAbility生效。</td><td>对象数组</td><td>该标签可缺省，缺省值为空。</td></tr><tr><td><a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/module-configuration-file-0000001427744540-V2#ZH-CN_TOPIC_0000001573929365__abilities%e6%a0%87%e7%ad%be target=_blank>abilities</a></td><td>标识当前Module中UIAbility的配置信息，标签值为数组类型，只对当前UIAbility生效。</td><td>对象</td><td>该标签可缺省，缺省值为空。</td></tr><tr><td><a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/module-configuration-file-0000001427744540-V2#ZH-CN_TOPIC_0000001573929365__extensionabilities%e6%a0%87%e7%ad%be target=_blank>extensionAbilities</a></td><td>标识当前Module中ExtensionAbility的配置信息，标签值为数组类型，只对当前ExtensionAbility生效。</td><td>对象</td><td>该标签可缺省，缺省值为空。</td></tr><tr><td><a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/module-configuration-file-0000001427744540-V2#ZH-CN_TOPIC_0000001573929365__requestpermissions%e6%a0%87%e7%ad%be target=_blank>requestPermissions</a></td><td>标识当前应用运行时需向系统申请的权限集合。</td><td>对象</td><td>该标签可缺省，缺省值为空。</td></tr><tr><td><a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/module-configuration-file-0000001427744540-V2#ZH-CN_TOPIC_0000001573929365__testrunner%e6%a0%87%e7%ad%be target=_blank>testRunner</a></td><td>标识当前Module用于支持对测试框架的配置。</td><td>对象</td><td>该标签可缺省，缺省值为空。</td></tr></tbody></table><blockquote><p>详细可以查阅
<a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/module-configuration-file-0000001427744540-V2 target=_blank>https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/module-configuration-file-0000001427744540-V2</a></p></blockquote><h3 id=生命周期>生命周期<a hidden class=anchor aria-hidden=true href=#生命周期>#</a></h3><h4 id=uiability组件生命周期>UIAbility组件生命周期<a hidden class=anchor aria-hidden=true href=#uiability组件生命周期>#</a></h4><p><a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/uiability-lifecycle-0000001427902208-V2 target=_blank>https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/uiability-lifecycle-0000001427902208-V2</a></p><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202404272145594.png><img src=https://qiniu.waite.wang/202404272145594.png alt=img></a></div></p><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202404272203694.png><img src=https://qiniu.waite.wang/202404272203694.png alt=image-20240427220332385></a></div></p><blockquote><p>src/main/ets/entryability/EntryAbility.ts</p></blockquote><p>Foreground和Background状态分别在UIAbility实例切换至前台和切换至后台时触发，对应于onForeground()回调和onBackground()回调。</p><p>onForeground()回调，在UIAbility的UI界面可见之前，如UIAbility切换至前台时触发。可以在onForeground()回调中申请系统需要的资源，或者重新申请在onBackground()中释放的资源。</p><p>onBackground()回调，在UIAbility的UI界面完全不可见之后，如UIAbility切换至后台时候触发。可以在onBackground()回调中释放UI界面不可见时无用的资源，或者在此回调中执行较为耗时的操作，例如状态保存等。</p><p>例如应用在使用过程中需要使用用户定位时，假设应用已获得用户的定位权限授权。在UI界面显示之前，可以在onForeground()回调中开启定位功能，从而获取到当前的位置信息。</p><p>当应用切换到后台状态，可以在onBackground()回调中停止定位功能，以节省系统的资源消耗。</p><h4 id=页面和组件的生命周期>页面和组件的生命周期<a hidden class=anchor aria-hidden=true href=#页面和组件的生命周期>#</a></h4><p><a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/arkts-page-custom-components-lifecycle-0000001524296665-V2 target=_blank>https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/arkts-page-custom-components-lifecycle-0000001524296665-V2</a></p><p>在开始之前，我们先明确自定义组件和页面的关系：</p><ul><li>自定义组件：@Component装饰的UI单元，可以组合多个系统组件实现UI的复用，可以调用组件的生命周期。</li><li>页面：即应用的UI页面。可以由一个或者多个自定义组件组成，
<a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/arkts-create-custom-components-0000001473537046-V2#section1430055924816 target=_blank>@Entry</a>装饰的自定义组件为页面的入口组件，即页面的根节点，一个页面有且仅能有一个@Entry。只有被@Entry装饰的组件才可以调用页面的生命周期。</li></ul><p>页面生命周期，即被@Entry装饰的组件生命周期，提供以下生命周期接口：</p><ul><li><a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V2/arkts-custom-component-lifecycle-0000001482395076-V2#ZH-CN_TOPIC_0000001523488850__onpageshow target=_blank>onPageShow</a>：页面每次显示时触发一次，包括路由过程、应用进入前台等场景。</li><li><a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V2/arkts-custom-component-lifecycle-0000001482395076-V2#ZH-CN_TOPIC_0000001523488850__onpagehide target=_blank>onPageHide</a>：页面每次隐藏时触发一次，包括路由过程、应用进入后台等场景。</li><li><a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V2/arkts-custom-component-lifecycle-0000001482395076-V2#ZH-CN_TOPIC_0000001523488850__onbackpress target=_blank>onBackPress</a>：当用户点击返回按钮时触发。</li></ul><p>组件生命周期，即一般用@Component装饰的自定义组件的生命周期，提供以下生命周期接口：</p><ul><li><a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V2/arkts-custom-component-lifecycle-0000001482395076-V2#ZH-CN_TOPIC_0000001523488850__abouttoappear target=_blank>aboutToAppear</a>：组件即将出现时回调该接口，具体时机为在创建自定义组件的新实例后，在执行其build()函数之前执行。</li><li><a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V2/arkts-custom-component-lifecycle-0000001482395076-V2#ZH-CN_TOPIC_0000001523488850__abouttodisappear target=_blank>aboutToDisappear</a>：在自定义组件析构销毁之前执行。不允许在aboutToDisappear函数中改变状态变量，特别是@Link变量的修改可能会导致应用程序行为不稳定。</li></ul><p>生命周期流程如下图所示，下图展示的是被@Entry装饰的组件（页面）生命周期。</p><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202404272209682.png><img src=https://qiniu.waite.wang/202404272209682.png alt=img></a></div></p><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202404272220757.png><img src=https://qiniu.waite.wang/202404272220757.png alt=image-20240427222009106></a></div></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=c1>// Index.ets
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>router</span> <span class=kr>from</span> <span class=s1>&#39;@ohos.router&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>@Entry</span>
</span></span><span class=line><span class=cl><span class=kd>@Component</span>
</span></span><span class=line><span class=cl><span class=nx>struct</span> <span class=nx>MyComponent</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>@State</span> <span class=nx>showChild</span>: <span class=kt>boolean</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 只有被@Entry装饰的组件才可以调用页面的生命周期
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>onPageShow() {</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>info</span><span class=p>(</span><span class=s1>&#39;Index onPageShow&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 只有被@Entry装饰的组件才可以调用页面的生命周期
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>onPageHide() {</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>info</span><span class=p>(</span><span class=s1>&#39;Index onPageHide&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 只有被@Entry装饰的组件才可以调用页面的生命周期
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>onBackPress() {</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>info</span><span class=p>(</span><span class=s1>&#39;Index onBackPress&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 组件生命周期
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>aboutToAppear() {</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>info</span><span class=p>(</span><span class=s1>&#39;MyComponent aboutToAppear&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 组件生命周期
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>aboutToDisappear() {</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>info</span><span class=p>(</span><span class=s1>&#39;MyComponent aboutToDisappear&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>build() {</span>
</span></span><span class=line><span class=cl>    <span class=nx>Column() {</span>
</span></span><span class=line><span class=cl>      <span class=c1>// this.showChild为true，创建Child子组件，执行Child aboutToAppear
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>showChild</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>Child</span><span class=p>()</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=c1>// this.showChild为false，删除Child子组件，执行Child aboutToDisappear
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>Button</span><span class=p>(</span><span class=s1>&#39;delete Child&#39;</span><span class=p>).</span><span class=nx>onClick</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>showChild</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>})</span>
</span></span><span class=line><span class=cl>      <span class=c1>// push到Page2页面，执行onPageHide
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>Button</span><span class=p>(</span><span class=s1>&#39;push to next page&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>onClick</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>router</span><span class=p>.</span><span class=nx>pushUrl</span><span class=p>({</span> <span class=nx>url</span><span class=o>:</span> <span class=s1>&#39;pages/Second&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>@Component</span>
</span></span><span class=line><span class=cl><span class=nx>struct</span> <span class=nx>Child</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>@State</span> <span class=nx>title</span>: <span class=kt>string</span> <span class=o>=</span> <span class=s1>&#39;Hello World&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 组件生命周期
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>aboutToDisappear() {</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>info</span><span class=p>(</span><span class=s1>&#39;[lifeCycle] Child aboutToDisappear&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 组件生命周期
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>aboutToAppear() {</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>info</span><span class=p>(</span><span class=s1>&#39;[lifeCycle] Child aboutToAppear&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>build() {</span>
</span></span><span class=line><span class=cl>    <span class=nx>Text</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>title</span><span class=p>).</span><span class=nx>fontSize</span><span class=p>(</span><span class=mi>50</span><span class=p>).</span><span class=nx>onClick</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>title</span> <span class=o>=</span> <span class=s1>&#39;Hello ArkUI&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202404272230907.png><img src=https://qiniu.waite.wang/202404272230907.png alt=image-20240427223013370></a></div></p><h3 id=uiability组件启动模式>UIAbility组件启动模式<a hidden class=anchor aria-hidden=true href=#uiability组件启动模式>#</a></h3><blockquote><p>具体重新观看:
<a href="https://www.bilibili.com/video/BV1Sa4y1Z7B1/?p=27" target=_blank>https://www.bilibili.com/video/BV1Sa4y1Z7B1/?p=27</a></p></blockquote><p><a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/uiability-launch-type-0000001428061476-V2 target=_blank>https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/uiability-launch-type-0000001428061476-V2</a></p><p>UIAbility的启动模式是指UIAbility实例在启动时的不同呈现状态。针对不同的业务场景，系统提供了三种启动模式：</p><ul><li><a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/uiability-launch-type-0000001428061476-V2#ZH-CN_TOPIC_0000001523489150__singleton%e5%90%af%e5%8a%a8%e6%a8%a1%e5%bc%8f target=_blank>singleton（单实例模式）</a></li><li><a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/uiability-launch-type-0000001428061476-V2#ZH-CN_TOPIC_0000001523489150__standard%e5%90%af%e5%8a%a8%e6%a8%a1%e5%bc%8f target=_blank>multiton（多实例模式）</a></li><li><a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/uiability-launch-type-0000001428061476-V2#ZH-CN_TOPIC_0000001523489150__specified%e5%90%af%e5%8a%a8%e6%a8%a1%e5%bc%8f target=_blank>specified（指定实例模式）</a></li></ul><h3 id=singleton启动模式>singleton启动模式<a hidden class=anchor aria-hidden=true href=#singleton启动模式>#</a></h3><p>singleton启动模式为单实例模式，也是默认情况下的启动模式。</p><p>每次调用startAbility()方法时，如果应用进程中该类型的UIAbility实例已经存在，则复用系统中的UIAbility实例。系统中只存在唯一一个该UIAbility实例，即在最近任务列表中只存在一个该类型的UIAbility实例。</p><p><strong>图1</strong> 单实例模式演示效果</p><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202404272235630.png><img src=https://qiniu.waite.wang/202404272235630.png alt=img></a></div></p><p>说明</p><p>应用的UIAbility实例已创建，该UIAbility配置为单实例模式，再次调用startAbility()方法启动该UIAbility实例，此时只会进入该UIAbility的onNewWant()回调，不会进入其onCreate()和onWindowStageCreate()生命周期回调。</p><p>如果需要使用singleton启动模式，在
<a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/module-configuration-file-0000001427744540-V2 target=_blank>module.json5配置文件</a>中的"launchType"字段配置为"singleton"即可。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;module&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nt>&#34;abilities&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;launchType&#34;</span><span class=p>:</span> <span class=s2>&#34;singleton&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h5 id=multiton启动模式>multiton启动模式<a hidden class=anchor aria-hidden=true href=#multiton启动模式>#</a></h5><p>multiton启动模式为多实例模式，每次调用startAbility()方法时，都会在应用进程中创建一个新的该类型UIAbility实例。即在最近任务列表中可以看到有多个该类型的UIAbility实例。这种情况下可以将UIAbility配置为multiton（多实例模式）。</p><p><strong>图2</strong> 多实例模式演示效果</p><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202404272235979.png><img src=https://qiniu.waite.wang/202404272235979.png alt=img></a></div></p><p>multiton启动模式的开发使用，在
<a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/module-configuration-file-0000001427744540-V2 target=_blank>module.json5配置文件</a>中的"launchType"字段配置为"multiton"即可。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;module&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nt>&#34;abilities&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;launchType&#34;</span><span class=p>:</span> <span class=s2>&#34;multiton&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h5 id=specified启动模式>specified启动模式<a hidden class=anchor aria-hidden=true href=#specified启动模式>#</a></h5><p>specified启动模式为指定实例模式，针对一些特殊场景使用（例如文档应用中每次新建文档希望都能新建一个文档实例，重复打开一个已保存的文档希望打开的都是同一个文档实例）。</p><p>在UIAbility实例创建之前，允许开发者为该实例创建一个唯一的字符串Key，创建的UIAbility实例绑定Key之后，后续每次调用startAbility()方法时，都会询问应用使用哪个Key对应的UIAbility实例来响应startAbility()请求。运行时由UIAbility内部业务决定是否创建多实例，如果匹配有该UIAbility实例的Key，则直接拉起与之绑定的UIAbility实例，否则创建一个新的UIAbility实例。</p><p><strong>图3</strong> 指定实例模式演示效果</p><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202404272236549.png><img src=https://qiniu.waite.wang/202404272236549.png alt=点击放大></a></div></p><p>应用的UIAbility实例已创建，该UIAbility配置为指定实例模式，再次调用startAbility()方法启动该UIAbility实例，且
<a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/abilitystage-0000001427584604-V2 target=_blank>AbilityStage</a>的
<a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V2/js-apis-app-ability-abilitystage-0000001493424312-V2#ZH-CN_TOPIC_0000001574088265__abilitystageonacceptwant target=_blank>onAcceptWant()</a>回调匹配到一个已创建的UIAbility实例。此时，再次启动该UIAbility时，只会进入该UIAbility的
<a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V2/js-apis-app-ability-uiability-0000001493584184-V2#ZH-CN_TOPIC_0000001523808838__abilityonnewwant target=_blank>onNewWant()</a>回调，不会进入其onCreate()和onWindowStageCreate()生命周期回调。</p><p>例如有两个UIAbility：EntryAbility和FuncAbility，FuncAbility配置为specified启动模式，需要从EntryAbility的页面中启动FuncAbility。</p><ol><li><p>在FuncAbility中，将
<a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/module-configuration-file-0000001427744540-V2 target=_blank>module.json5配置文件</a>的"launchType"字段配置为"specified"。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;module&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nt>&#34;abilities&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;launchType&#34;</span><span class=p>:</span> <span class=s2>&#34;specified&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div></li><li><p>在EntryAbility中，调用startAbility()方法时，在want参数中，增加一个自定义参数来区别UIAbility实例，例如增加一个"instanceKey"自定义参数。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// 在启动指定实例模式的UIAbility时，给每一个UIAbility实例配置一个独立的Key标识
</span></span></span><span class=line><span class=cl><span class=c1>// 例如在文档使用场景中，可以用文档路径作为Key标识
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>function</span> <span class=nx>getInstance</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>want</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>deviceId</span><span class=o>:</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=c1>// deviceId为空表示本设备
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>bundleName</span><span class=o>:</span> <span class=s1>&#39;com.example.myapplication&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>abilityName</span><span class=o>:</span> <span class=s1>&#39;FuncAbility&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>moduleName</span><span class=o>:</span> <span class=s1>&#39;module1&#39;</span><span class=p>,</span> <span class=c1>// moduleName非必选
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>parameters</span><span class=o>:</span> <span class=p>{</span> <span class=c1>// 自定义信息
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>instanceKey</span><span class=o>:</span> <span class=nx>getInstance</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// context为调用方UIAbility的AbilityContext
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>this</span><span class=p>.</span><span class=nx>context</span><span class=p>.</span><span class=nx>startAbility</span><span class=p>(</span><span class=nx>want</span><span class=p>).</span><span class=nx>then</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}).</span><span class=k>catch</span><span class=p>((</span><span class=nx>err</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>})</span>
</span></span></code></pre></div></li><li><p>由于FuncAbility的启动模式配置为了指定实例启动模式，在FuncAbility启动之前，会先进入其对应的AbilityStage的
<a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V2/js-apis-app-ability-abilitystage-0000001493424312-V2#ZH-CN_TOPIC_0000001574088265__abilitystageonacceptwant target=_blank>onAcceptWant()</a>生命周期回调中，解析传入的want参数，获取"instanceKey"自定义参数。根据业务需要通过AbilityStage的
<a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V2/js-apis-app-ability-abilitystage-0000001493424312-V2#ZH-CN_TOPIC_0000001574088265__abilitystageonacceptwant target=_blank>onAcceptWant()</a>生命周期回调返回一个字符串Key标识。如果返回的Key对应一个已启动的UIAbility，则会将之前的UIAbility拉回前台并获焦，而不创建新的实例，否则创建新的实例并启动。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=nx>AbilityStage</span> <span class=nx>from</span> <span class=s1>&#39;@ohos.app.ability.AbilityStage&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=kr>class</span> <span class=nx>MyAbilityStage</span> <span class=kr>extends</span> <span class=nx>AbilityStage</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>onAcceptWant</span><span class=p>(</span><span class=nx>want</span><span class=p>)</span><span class=o>:</span> <span class=nx>string</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 在被调用方的AbilityStage中，针对启动模式为specified的UIAbility返回一个UIAbility实例对应的一个Key值
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>// 当前示例指的是module1 Module的FuncAbility
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>if</span> <span class=p>(</span><span class=nx>want</span><span class=p>.</span><span class=nx>abilityName</span> <span class=o>===</span> <span class=s1>&#39;FuncAbility&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 返回的字符串Key标识为自定义拼接的字符串内容
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>return</span> <span class=sb>`ControlModule_EntryAbilityInstance_</span><span class=si>${</span><span class=nx>want</span><span class=p>.</span><span class=nx>parameters</span><span class=p>.</span><span class=nx>instanceKey</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s1>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>例如在文档应用中，可以对不同的文档实例内容绑定不同的Key值。当每次新建文档的时候，可以传入不同的新Key值（如可以将文件的路径作为一个Key标识），此时AbilityStage中启动UIAbility时都会创建一个新的UIAbility实例；当新建的文档保存之后，回到桌面，或者新打开一个已保存的文档，回到桌面，此时再次打开该已保存的文档，此时AbilityStage中再次启动该UIAbility时，打开的仍然是之前原来已保存的文档界面。</p><p>以如下步骤所示进行举例说明。</p><ol><li>打开文件A，对应启动一个新的UIAbility实例，例如启动“UIAbility实例1”。</li><li>在最近任务列表中关闭文件A的进程，此时UIAbility实例1被销毁，回到桌面，再次打开文件A，此时对应启动一个新的UIAbility实例，例如启动“UIAbility实例2”。</li><li>回到桌面，打开文件B，此时对应启动一个新的UIAbility实例，例如启动“UIAbility实例3”。</li><li>回到桌面，再次打开文件A，此时对应启动的还是之前的“UIAbility实例2”。</li></ol></li></ol><h2 id=网络连接>网络连接<a hidden class=anchor aria-hidden=true href=#网络连接>#</a></h2><p><a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/net-mgmt-overview-0000001478341009-V2 target=_blank>https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/net-mgmt-overview-0000001478341009-V2</a></p><h3 id=http数据请求>HTTP数据请求<a hidden class=anchor aria-hidden=true href=#http数据请求>#</a></h3><p><a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/http-request-0000001478061585-V2 target=_blank>https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/http-request-0000001478061585-V2</a></p><p>应用通过HTTP发起一个数据请求，支持常见的GET、POST、OPTIONS、HEAD、PUT、DELETE、TRACE、CONNECT方法。</p><p>HTTP数据请求功能主要由http模块提供。</p><p>使用该功能需要申请ohos.permission.INTERNET权限。</p><p>权限申请请参考
<a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/accesstoken-guidelines-0000001493744016-V2 target=_blank>访问控制（权限）开发指导</a>。</p><p>涉及的接口如下表，具体的接口说明请参考
<a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V2/js-apis-http-0000001478061929-V2 target=_blank>API文档</a>。</p><table><thead><tr><th>接口名</th><th>功能描述</th></tr></thead><tbody><tr><td>createHttp()</td><td>创建一个http请求。</td></tr><tr><td>request()</td><td>根据URL地址，发起HTTP网络请求。</td></tr><tr><td>destroy()</td><td>中断请求任务。</td></tr><tr><td>on(type: &lsquo;headersReceive&rsquo;)</td><td>订阅HTTP Response Header 事件。</td></tr><tr><td>off(type: &lsquo;headersReceive&rsquo;)</td><td>取消订阅HTTP Response Header 事件。</td></tr><tr><td>once(&lsquo;headersReceive&rsquo;)8+</td><td>订阅HTTP Response Header 事件，但是只触发一次。</td></tr></tbody></table><h4 id=request接口开发步骤>request接口开发步骤<a hidden class=anchor aria-hidden=true href=#request接口开发步骤>#</a></h4><ol><li>从@ohos.net.http.d.ts中导入http命名空间。</li><li>调用createHttp()方法，创建一个HttpRequest对象。</li><li>调用该对象的on()方法，订阅http响应头事件，此接口会比request请求先返回。可以根据业务需要订阅此消息。</li><li>调用该对象的request()方法，传入http请求的url地址和可选参数，发起网络请求。</li><li>按照实际业务需要，解析返回结果。</li><li>调用该对象的off()方法，取消订阅http响应头事件。</li><li>当该请求使用完毕时，调用destroy()方法主动销毁。</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-tsx data-lang=tsx><span class=line><span class=cl><span class=c1>// 引入包名
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>http</span> <span class=kr>from</span> <span class=s1>&#39;@ohos.net.http&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 每一个httpRequest对应一个HTTP请求任务，不可复用
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>let</span> <span class=nx>httpRequest</span> <span class=o>=</span> <span class=nx>http</span><span class=p>.</span><span class=nx>createHttp</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=c1>// 用于订阅HTTP响应头，此接口会比request请求先返回。可以根据业务需要订阅此消息
</span></span></span><span class=line><span class=cl><span class=c1>// 从API 8开始，使用on(&#39;headersReceive&#39;, Callback)替代on(&#39;headerReceive&#39;, AsyncCallback)。 8+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>httpRequest</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;headersReceive&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>header</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>info</span><span class=p>(</span><span class=s1>&#39;header: &#39;</span> <span class=o>+</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>header</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=nx>httpRequest</span><span class=p>.</span><span class=nx>request</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 填写HTTP请求的URL地址，可以带参数也可以不带参数。URL地址需要开发者自定义。请求的参数可以在extraData中指定
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=s2>&#34;EXAMPLE_URL&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>method</span>: <span class=kt>http.RequestMethod.POST</span><span class=p>,</span> <span class=c1>// 可选，默认为http.RequestMethod.GET
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>// 开发者根据自身业务需要添加header字段
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>header</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;Content-Type&#39;</span><span class=o>:</span> <span class=s1>&#39;application/json&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 当使用POST请求时此字段用于传递内容
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>extraData</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;data&#34;</span><span class=o>:</span> <span class=s2>&#34;data to send&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=nx>expectDataType</span>: <span class=kt>http.HttpDataType.STRING</span><span class=p>,</span> <span class=c1>// 可选，指定返回数据的类型
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>usingCache</span>: <span class=kt>true</span><span class=p>,</span> <span class=c1>// 可选，默认为true
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>priority</span>: <span class=kt>1</span><span class=p>,</span> <span class=c1>// 可选，默认为1
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>connectTimeout</span>: <span class=kt>60000</span><span class=p>,</span> <span class=c1>// 可选，默认为60000ms
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>readTimeout</span>: <span class=kt>60000</span><span class=p>,</span> <span class=c1>// 可选，默认为60000ms
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>usingProtocol</span>: <span class=kt>http.HttpProtocol.HTTP1_1</span><span class=p>,</span> <span class=c1>// 可选，协议类型默认值由系统自动指定
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>},</span> <span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=nx>data</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// data.result为HTTP响应内容，可根据业务需要进行解析
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nx>console</span><span class=p>.</span><span class=nx>info</span><span class=p>(</span><span class=s1>&#39;Result:&#39;</span> <span class=o>+</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>result</span><span class=p>));</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>info</span><span class=p>(</span><span class=s1>&#39;code:&#39;</span> <span class=o>+</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>responseCode</span><span class=p>));</span>
</span></span><span class=line><span class=cl>            <span class=c1>// data.header为HTTP响应头，可根据业务需要进行解析
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nx>console</span><span class=p>.</span><span class=nx>info</span><span class=p>(</span><span class=s1>&#39;header:&#39;</span> <span class=o>+</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>header</span><span class=p>));</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>info</span><span class=p>(</span><span class=s1>&#39;cookies:&#39;</span> <span class=o>+</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>cookies</span><span class=p>));</span> <span class=c1>// 8+
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>info</span><span class=p>(</span><span class=s1>&#39;error:&#39;</span> <span class=o>+</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>err</span><span class=p>));</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 取消订阅HTTP响应头事件
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nx>httpRequest</span><span class=p>.</span><span class=nx>off</span><span class=p>(</span><span class=s1>&#39;headersReceive&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 当该请求使用完毕时，调用destroy方法主动销毁
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nx>httpRequest</span><span class=p>.</span><span class=nx>destroy</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span></code></pre></div><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202404281718615.png><img src=https://qiniu.waite.wang/202404281718615.png alt=image-20240428171812486></a></div></p><h4 id=案例>案例<a hidden class=anchor aria-hidden=true href=#案例>#</a></h4><blockquote><p>现在有这么一个接口:
<a href="http://127.0.0.1:3000/shops?pageNo=1&&amp;pageSize=4" target=_blank>http://127.0.0.1:3000/shops?pageNo=1&&pageSize=4</a> 返回值如下</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;103茶餐厅&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;images&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;/images/s3fqawWswzk.jpg&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;/images/aZGOT1OjpJmLxG6urQ.jpg&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;area&#34;</span><span class=p>:</span> <span class=s2>&#34;大关&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;address&#34;</span><span class=p>:</span> <span class=s2>&#34;金华路锦昌文华苑29号&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;avgPrice&#34;</span><span class=p>:</span> <span class=mi>80</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;comments&#34;</span><span class=p>:</span> <span class=mi>3035</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;score&#34;</span><span class=p>:</span> <span class=mi>37</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;openHours&#34;</span><span class=p>:</span> <span class=s2>&#34;10:00-22:00&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;蔡馬洪涛烤肉·老北京铜锅涮羊肉&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;images&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;/images/faca41195272.jpg&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;/images/a9f88d706914.jpg&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;/images/jpJmLxG6urQ.jpg&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;area&#34;</span><span class=p>:</span> <span class=s2>&#34;拱宸桥/上塘&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;address&#34;</span><span class=p>:</span> <span class=s2>&#34;上塘路1035号（中国工商银行旁）&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;avgPrice&#34;</span><span class=p>:</span> <span class=mi>85</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;comments&#34;</span><span class=p>:</span> <span class=mi>1460</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;score&#34;</span><span class=p>:</span> <span class=mi>46</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;openHours&#34;</span><span class=p>:</span> <span class=s2>&#34;11:30-03:00&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=mi>3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;新白鹿餐厅(运河上街店)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;images&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;/images/7cgjmzif2w2aalka4gms.jpg&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;/images/73w0k4d40mxjt54btzda.jpg&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;/images/uyb31c7yfqy95dejvis1.jpg&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;area&#34;</span><span class=p>:</span> <span class=s2>&#34;运河上街&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;address&#34;</span><span class=p>:</span> <span class=s2>&#34;台州路2号运河上街购物中心F5&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;avgPrice&#34;</span><span class=p>:</span> <span class=mi>61</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;comments&#34;</span><span class=p>:</span> <span class=mi>8045</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;score&#34;</span><span class=p>:</span> <span class=mi>47</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;openHours&#34;</span><span class=p>:</span> <span class=s2>&#34;10:30-21:00&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=mi>4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Mamala(杭州远洋乐堤港店)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;images&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;/images/xpm2bq95a3ro2lc4vp5u.jpg&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;/images/7kd3rq9hvtougx3mhnlt.jpg&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;area&#34;</span><span class=p>:</span> <span class=s2>&#34;拱宸桥/上塘&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;address&#34;</span><span class=p>:</span> <span class=s2>&#34;丽水路66号远洋乐堤港商城2期1层B115号&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;avgPrice&#34;</span><span class=p>:</span> <span class=mi>290</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;comments&#34;</span><span class=p>:</span> <span class=mi>9529</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;score&#34;</span><span class=p>:</span> <span class=mi>49</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;openHours&#34;</span><span class=p>:</span> <span class=s2>&#34;11:00-22:00&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></div><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202404282321584.png><img src=https://qiniu.waite.wang/202404282321584.png alt=image-20240428232115572></a></div></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=c1>//src/main/ets/viewmodel/ShopInfo.ts
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=kr>class</span> <span class=nx>ShopInfo</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>id</span>: <span class=kt>number</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span>: <span class=kt>string</span>
</span></span><span class=line><span class=cl>  <span class=nx>images</span>: <span class=kt>string</span><span class=p>[]</span>
</span></span><span class=line><span class=cl>  <span class=nx>area</span>: <span class=kt>string</span>
</span></span><span class=line><span class=cl>  <span class=nx>address</span>: <span class=kt>string</span>
</span></span><span class=line><span class=cl>  <span class=nx>avgPrice</span>: <span class=kt>number</span>
</span></span><span class=line><span class=cl>  <span class=nx>comments</span>: <span class=kt>number</span>
</span></span><span class=line><span class=cl>  <span class=nx>score</span>: <span class=kt>number</span>
</span></span><span class=line><span class=cl>  <span class=nx>openHours</span>: <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=c1>// src/main/ets/model/ShopModel.ts
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>http</span> <span class=kr>from</span> <span class=s1>&#39;@ohos.net.http&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>ShopInfo</span> <span class=kr>from</span> <span class=s1>&#39;../viewmodel/ShopInfo&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>ShopModel</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>pageNo</span>: <span class=kt>number</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>  <span class=nx>url</span>: <span class=kt>string</span> <span class=o>=</span> <span class=sb>`http://127.0.0.1:3000/`</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>getShopList</span><span class=p>()</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>ShopInfo</span><span class=err>[]</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>new</span> <span class=nx>Promise</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=nx>resolve</span><span class=p>,</span> <span class=nx>reject</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nx>httpRequest</span> <span class=o>=</span> <span class=nx>http</span><span class=p>.</span><span class=nx>createHttp</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nx>httpRequest</span><span class=p>.</span><span class=nx>request</span><span class=p>(</span>
</span></span><span class=line><span class=cl>          <span class=k>this</span><span class=p>.</span><span class=nx>url</span> <span class=o>+</span> <span class=sb>`shops?pageNo=</span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>pageNo</span><span class=si>}</span><span class=sb>&amp;pageSize=4`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>method</span>: <span class=kt>http.RequestMethod.GET</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=p>.</span><span class=nx>then</span><span class=p>((</span><span class=nx>res</span>: <span class=kt>http.HttpResponse</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=nx>res</span><span class=p>.</span><span class=nx>responseCode</span> <span class=o>===</span> <span class=mi>200</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=c1>// 请求成功
</span></span></span><span class=line><span class=cl><span class=c1></span>              <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;Success&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>              <span class=nx>resolve</span><span class=p>(</span><span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>res</span><span class=p>.</span><span class=nx>result</span><span class=p>.</span><span class=nx>toString</span><span class=p>()))</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;Error&#34;</span><span class=p>,</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>res</span><span class=p>))</span>
</span></span><span class=line><span class=cl>              <span class=nx>reject</span><span class=p>(</span><span class=s2>&#34;Error&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>})</span>
</span></span><span class=line><span class=cl>          <span class=p>.</span><span class=k>catch</span><span class=p>((</span><span class=nx>err</span>: <span class=kt>Error</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 请求失败
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;Error&#34;</span><span class=p>,</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>err</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=nx>reject</span><span class=p>(</span><span class=s2>&#34;Error&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=p>})</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>shopModel</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>ShopModel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>shopModel</span> <span class=kr>as</span> <span class=nx>ShopModel</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-tsx data-lang=tsx><span class=line><span class=cl><span class=c1>// src/main/ets/views
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>ShopInfo</span> <span class=kr>from</span> <span class=s1>&#39;../viewmodel/ShopInfo&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>@Component</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>struct</span> <span class=nx>ShopItem</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>shop</span>: <span class=kt>ShopInfo</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>build</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>    <span class=nx>Column</span><span class=p>({</span><span class=nx>space</span>: <span class=kt>5</span><span class=p>}){</span>
</span></span><span class=line><span class=cl>      <span class=nx>Row</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=nx>Text</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>shop</span><span class=p>.</span><span class=nx>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=p>.</span><span class=nx>fontSize</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=p>.</span><span class=nx>fontWeight</span><span class=p>(</span><span class=nx>FontWeight</span><span class=p>.</span><span class=nx>Bold</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=p>.</span><span class=nx>ellipsisTextOverFlow</span><span class=p>()</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>width</span><span class=p>(</span><span class=s1>&#39;100%&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=nx>Row</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=nx>Text</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>shop</span><span class=p>.</span><span class=nx>address</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=p>.</span><span class=nx>fontColor</span><span class=p>(</span><span class=s1>&#39;#a3a3a3&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=p>.</span><span class=nx>ellipsisTextOverFlow</span><span class=p>()</span>
</span></span><span class=line><span class=cl>      <span class=p>}.</span><span class=nx>width</span><span class=p>(</span><span class=s1>&#39;100%&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=nx>Row</span><span class=p>({</span><span class=nx>space</span>: <span class=kt>5</span><span class=p>}){</span>
</span></span><span class=line><span class=cl>        <span class=nx>Rating</span><span class=p>({</span><span class=nx>rating</span>: <span class=kt>this.shop.score</span><span class=o>/</span><span class=mi>10</span> <span class=p>,</span> <span class=nx>indicator</span>: <span class=kt>true</span><span class=p>}).</span><span class=nx>stars</span><span class=p>(</span><span class=mi>5</span><span class=p>).</span><span class=nx>stepSize</span><span class=p>(</span><span class=mf>0.1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>Text</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>shop</span><span class=p>.</span><span class=nx>score</span> <span class=o>/</span> <span class=mi>10</span><span class=si>}</span><span class=sb>`</span><span class=p>).</span><span class=nx>fontColor</span><span class=p>(</span><span class=s1>&#39;#ffb04d&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>Text</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>shop</span><span class=p>.</span><span class=nx>comments</span><span class=si>}</span><span class=sb>条`</span><span class=p>).</span><span class=nx>fontColor</span><span class=p>(</span><span class=s1>&#39;#222&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>Blank</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=nx>Text</span><span class=p>(</span><span class=sb>`￥</span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>shop</span><span class=p>.</span><span class=nx>avgPrice</span><span class=si>}</span><span class=sb>/人`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>}.</span><span class=nx>width</span><span class=p>(</span><span class=s1>&#39;100%&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=nx>List</span><span class=p>({</span><span class=nx>space</span>: <span class=kt>10</span><span class=p>}){</span>
</span></span><span class=line><span class=cl>        <span class=nx>ForEach</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>shop</span><span class=p>.</span><span class=nx>images</span><span class=p>,</span> <span class=p>(</span><span class=nx>image</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>ListItem</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>            <span class=nx>Column</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>              <span class=nx>Image</span><span class=p>(</span><span class=nx>image</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>.</span><span class=nx>width</span><span class=p>(</span><span class=mi>150</span><span class=p>).</span><span class=nx>aspectRatio</span><span class=p>(</span><span class=mf>1.1</span><span class=p>).</span><span class=nx>borderRadius</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>listDirection</span><span class=p>(</span><span class=nx>Axis</span><span class=p>.</span><span class=nx>Horizontal</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>width</span><span class=p>(</span><span class=s1>&#39;100%&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>width</span><span class=p>(</span><span class=s1>&#39;100%&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>height</span><span class=p>(</span><span class=mi>240</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>padding</span><span class=p>(</span><span class=mi>12</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>backgroundColor</span><span class=p>(</span><span class=nx>Color</span><span class=p>.</span><span class=nx>White</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>borderRadius</span><span class=p>(</span><span class=mi>15</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>shadow</span><span class=p>({</span><span class=nx>radius</span>: <span class=kt>6</span><span class=p>,</span> <span class=nx>color</span><span class=o>:</span> <span class=s1>&#39;#1F000000&#39;</span><span class=p>,</span> <span class=nx>offsetX</span>: <span class=kt>2</span><span class=p>,</span> <span class=nx>offsetY</span>: <span class=kt>4</span><span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 文本超出时的统一样式处理
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>@Extend</span><span class=p>(</span><span class=nx>Text</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>ellipsisTextOverFlow</span><span class=p>(</span><span class=nx>line</span>: <span class=kt>number</span> <span class=o>=</span> <span class=mi>1</span><span class=p>){</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>textOverflow</span><span class=p>({</span><span class=nx>overflow</span>: <span class=kt>TextOverflow.Ellipsis</span><span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>maxLines</span><span class=p>(</span><span class=nx>line</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-tsx data-lang=tsx><span class=line><span class=cl><span class=c1>// src/main/ets/pages/Index.ets
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>ShopInfo</span> <span class=kr>from</span> <span class=s1>&#39;../viewmodel/ShopInfo&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>@Component</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>struct</span> <span class=nx>ShopItem</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>shop</span>: <span class=kt>ShopInfo</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>build</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>    <span class=nx>Column</span><span class=p>({</span><span class=nx>space</span>: <span class=kt>5</span><span class=p>}){</span>
</span></span><span class=line><span class=cl>      <span class=nx>Row</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=nx>Text</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>shop</span><span class=p>.</span><span class=nx>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=p>.</span><span class=nx>fontSize</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=p>.</span><span class=nx>fontWeight</span><span class=p>(</span><span class=nx>FontWeight</span><span class=p>.</span><span class=nx>Bold</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=p>.</span><span class=nx>ellipsisTextOverFlow</span><span class=p>()</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>width</span><span class=p>(</span><span class=s1>&#39;100%&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=nx>Row</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=nx>Text</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>shop</span><span class=p>.</span><span class=nx>address</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=p>.</span><span class=nx>fontColor</span><span class=p>(</span><span class=s1>&#39;#a3a3a3&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=p>.</span><span class=nx>ellipsisTextOverFlow</span><span class=p>()</span>
</span></span><span class=line><span class=cl>      <span class=p>}.</span><span class=nx>width</span><span class=p>(</span><span class=s1>&#39;100%&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=nx>Row</span><span class=p>({</span><span class=nx>space</span>: <span class=kt>5</span><span class=p>}){</span>
</span></span><span class=line><span class=cl>        <span class=nx>Rating</span><span class=p>({</span><span class=nx>rating</span>: <span class=kt>this.shop.score</span><span class=o>/</span><span class=mi>10</span> <span class=p>,</span> <span class=nx>indicator</span>: <span class=kt>true</span><span class=p>}).</span><span class=nx>stars</span><span class=p>(</span><span class=mi>5</span><span class=p>).</span><span class=nx>stepSize</span><span class=p>(</span><span class=mf>0.1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>Text</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>shop</span><span class=p>.</span><span class=nx>score</span> <span class=o>/</span> <span class=mi>10</span><span class=si>}</span><span class=sb>`</span><span class=p>).</span><span class=nx>fontColor</span><span class=p>(</span><span class=s1>&#39;#ffb04d&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>Text</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>shop</span><span class=p>.</span><span class=nx>comments</span><span class=si>}</span><span class=sb>条`</span><span class=p>).</span><span class=nx>fontColor</span><span class=p>(</span><span class=s1>&#39;#222&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>Blank</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=nx>Text</span><span class=p>(</span><span class=sb>`￥</span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>shop</span><span class=p>.</span><span class=nx>avgPrice</span><span class=si>}</span><span class=sb>/人`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>}.</span><span class=nx>width</span><span class=p>(</span><span class=s1>&#39;100%&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=nx>List</span><span class=p>({</span><span class=nx>space</span>: <span class=kt>10</span><span class=p>}){</span>
</span></span><span class=line><span class=cl>        <span class=nx>ForEach</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>shop</span><span class=p>.</span><span class=nx>images</span><span class=p>,</span> <span class=p>(</span><span class=nx>image</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>ListItem</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>            <span class=nx>Column</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>              <span class=nx>Image</span><span class=p>(</span><span class=nx>image</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>.</span><span class=nx>width</span><span class=p>(</span><span class=mi>150</span><span class=p>).</span><span class=nx>aspectRatio</span><span class=p>(</span><span class=mf>1.1</span><span class=p>).</span><span class=nx>borderRadius</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>listDirection</span><span class=p>(</span><span class=nx>Axis</span><span class=p>.</span><span class=nx>Horizontal</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>width</span><span class=p>(</span><span class=s1>&#39;100%&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>width</span><span class=p>(</span><span class=s1>&#39;100%&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>height</span><span class=p>(</span><span class=mi>240</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>padding</span><span class=p>(</span><span class=mi>12</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>backgroundColor</span><span class=p>(</span><span class=nx>Color</span><span class=p>.</span><span class=nx>White</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>borderRadius</span><span class=p>(</span><span class=mi>15</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>shadow</span><span class=p>({</span><span class=nx>radius</span>: <span class=kt>6</span><span class=p>,</span> <span class=nx>color</span><span class=o>:</span> <span class=s1>&#39;#1F000000&#39;</span><span class=p>,</span> <span class=nx>offsetX</span>: <span class=kt>2</span><span class=p>,</span> <span class=nx>offsetY</span>: <span class=kt>4</span><span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 文本超出时的统一样式处理
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>@Extend</span><span class=p>(</span><span class=nx>Text</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>ellipsisTextOverFlow</span><span class=p>(</span><span class=nx>line</span>: <span class=kt>number</span> <span class=o>=</span> <span class=mi>1</span><span class=p>){</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>textOverflow</span><span class=p>({</span><span class=nx>overflow</span>: <span class=kt>TextOverflow.Ellipsis</span><span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>maxLines</span><span class=p>(</span><span class=nx>line</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=第三方库-axios>第三方库 axios<a hidden class=anchor aria-hidden=true href=#第三方库-axios>#</a></h3><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202404291514779.png><img src=https://qiniu.waite.wang/202404291514779.png alt=image-20240429151445521></a></div></p><p><a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/ide-command-line-ohpm-0000001490235312-V2 target=_blank>https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/ide-command-line-ohpm-0000001490235312-V2</a></p><p>OHPM CLI 作为鸿蒙生态三方库的包管理工具，支持OpenHarmony共享包的发布、安装和依赖管理。</p><ol><li><p>下载ohpm工具包，
<a href=https://developer.harmonyos.com/cn/develop/deveco-studio#download_cli target=_blank>点击链接获取</a>。</p></li><li><p>解压文件，进入“ohpm/bin”目录，打开命令行工具，执行如下指令<code>init.bat</code>初始化ohpm</p></li><li><p>将ohpm配置到环境变量中。</p><ul><li><p>Windows环境变量设置方法：</p><p>在<strong>此电脑 > 属性 > 高级系统设置 > 高级 > 环境变量</strong>中，将ohpm命令行工具的bin目录配置到系统或者用户的PATH变量中。</p></li></ul></li><li><p>安装完成之后，执行<code>ohpm -v</code> 输出版本号即为安装成功</p></li></ol><blockquote><p>配置完环境变量后可能需要重启电脑才能生效</p></blockquote><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202404291517899.png><img src=https://qiniu.waite.wang/202404291517899.png alt=image-20240429151700246></a></div></p><p><strong>OpenHarmony三方库中心仓</strong>:
<a href=https://ohpm.openharmony.cn/#/cn/home target=_blank>https://ohpm.openharmony.cn/#/cn/home</a></p><blockquote><p>以下为 使用案例</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-tsx data-lang=tsx><span class=line><span class=cl><span class=c1>// import http from &#39;@ohos.net.http&#39;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>axios</span> <span class=kr>from</span> <span class=s1>&#39;@ohos/axios&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>ShopInfo</span> <span class=kr>from</span> <span class=s1>&#39;../viewmodel/ShopInfo&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>ShopModel</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>pageNo</span>: <span class=kt>number</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>  <span class=nx>url</span>: <span class=kt>string</span> <span class=o>=</span> <span class=sb>`http://127.0.0.1:3000/`</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>getShopList</span><span class=p>()</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>ShopInfo</span><span class=err>[]</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>new</span> <span class=nx>Promise</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=nx>resolve</span><span class=p>,</span> <span class=nx>reject</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>axios</span><span class=p>.</span><span class=kr>get</span><span class=p>(</span>
</span></span><span class=line><span class=cl>          <span class=k>this</span><span class=p>.</span><span class=nx>url</span> <span class=o>+</span> <span class=sb>`shops?pageNo=</span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>pageNo</span><span class=si>}</span><span class=sb>&amp;pageSize=4`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=p>.</span><span class=nx>then</span><span class=p>((</span><span class=nx>res</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=nx>res</span><span class=p>.</span><span class=nx>status</span> <span class=o>===</span> <span class=mi>200</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=c1>// 请求成功
</span></span></span><span class=line><span class=cl><span class=c1></span>              <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;Success&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>              <span class=nx>resolve</span><span class=p>(</span><span class=nx>res</span><span class=p>.</span><span class=nx>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;Error&#34;</span><span class=p>,</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>res</span><span class=p>))</span>
</span></span><span class=line><span class=cl>              <span class=nx>reject</span><span class=p>(</span><span class=s2>&#34;Error&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>})</span>
</span></span><span class=line><span class=cl>          <span class=p>.</span><span class=k>catch</span><span class=p>((</span><span class=nx>err</span>: <span class=kt>Error</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 请求失败
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;Error&#34;</span><span class=p>,</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>err</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=nx>reject</span><span class=p>(</span><span class=s2>&#34;Error&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=p>})</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>shopModel</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>ShopModel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>shopModel</span> <span class=kr>as</span> <span class=nx>ShopModel</span>
</span></span></code></pre></div><h2 id=数据持久化>数据持久化<a hidden class=anchor aria-hidden=true href=#数据持久化>#</a></h2><p><a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/app-data-persistence-overview-0000001505513497-V2 target=_blank>https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/app-data-persistence-overview-0000001505513497-V2</a></p><p>应用数据持久化，是指应用将内存中的数据通过文件或数据库的形式保存到设备上。内存中的数据形态通常是任意的数据结构或数据对象，存储介质上的数据形态可能是文本、数据库、二进制文件等。</p><p>HarmonyOS标准系统支持典型的存储数据形态，包括用户首选项、键值型数据库、关系型数据库。</p><p>开发者可以根据如下功能介绍，选择合适的数据形态以满足自己应用数据的持久化需要。</p><ul><li><strong>用户首选项（Preferences）</strong>：通常用于保存应用的配置信息。数据通过文本的形式保存在设备中，应用使用过程中会将文本中的数据全量加载到内存中，所以访问速度快、效率高，但不适合需要存储大量数据的场景。</li><li><strong>键值型数据库（KV-Store）</strong>：一种非关系型数据库，其数据以“键值”对的形式进行组织、索引和存储，其中“键”作为唯一标识符。适合很少数据关系和业务关系的业务数据存储，同时因其在分布式场景中降低了解决数据库版本兼容问题的复杂度，和数据同步过程中冲突解决的复杂度而被广泛使用。相比于关系型数据库，更容易做到跨设备跨版本兼容。</li><li><strong>关系型数据库（RelationalStore）</strong>：一种关系型数据库，以行和列的形式存储数据，广泛用于应用中的关系型数据的处理，包括一系列的增、删、改、查等接口，开发者也可以运行自己定义的SQL语句来满足复杂业务场景的需要。</li></ul><blockquote><p>在 harmony 中, 比较常用的是 用户首选项以及关系型数据库</p></blockquote><h3 id=用户首选项>用户首选项<a hidden class=anchor aria-hidden=true href=#用户首选项>#</a></h3><p><a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/data-persistence-by-preferences-0000001505432513-V2 target=_blank>https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/data-persistence-by-preferences-0000001505432513-V2</a></p><p>用户首选项为应用提供Key-Value键值型的数据处理能力，支持应用持久化轻量级数据，并对其修改和查询。当用户希望有一个全局唯一存储的地方，可以采用用户首选项来进行存储。Preferences会将该数据缓存在内存中，当用户读取的时候，能够快速从内存中获取数据，当需要持久化时可以使用flush接口将内存中的数据写入持久化文件中。Preferences会随着存放的数据量越多而导致应用占用的内存越大，因此，Preferences不适合存放过多的数据，适用的场景一般为应用保存用户的个性化设置（字体大小，是否开启夜间模式）等。</p><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202404292336853.png><img src=https://qiniu.waite.wang/202404292336853.png alt=image-20240429233616769></a></div></p><blockquote><p>Key 为 string 类型, 要求非空且长度不超过80字节</p><p>Value 可以是 string, number, boolean及以上类型数组, 大小不超过 8192 字节</p><p>数据量建议不超过一万条</p></blockquote><p>下面对<code>preferences</code> 进行封装，基本思路：</p><blockquote><p>注意: 只要在真机预览才能看到效果</p></blockquote><p>在获取<code>preferences</code>实例后会将其保存单例中，这个单例是<code>GlobalContext</code>，方便后期可以通过单例直接获取实例；由于<code>get()</code>返回值类型是不确定性，定义一个联合类型的别名<code>ValueType</code> 来接收</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-TypeScript data-lang=TypeScript><span class=line><span class=cl><span class=c1>// src/main/ets/common/PreferencesUtil.ts
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>dataPreferences</span> <span class=kr>from</span> <span class=s1>&#39;@ohos.data.preferences&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>GlobalContext</span> <span class=kr>from</span> <span class=s1>&#39;../../common/GlobalContext&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>LogUtils</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;../LogUtils&#39;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>LOG</span> <span class=o>=</span> <span class=s1>&#39;PreferencesUtils-PUT&#39;</span>
</span></span><span class=line><span class=cl><span class=c1>// 默认文件名(数据库表名)，可以在构造函数进行修改
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>PREFERENCES_NAME</span> <span class=o>=</span> <span class=s1>&#39;scjgPreferences&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>KEY_PREFERENCES</span> <span class=o>=</span> <span class=s1>&#39;preferences&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>type</span> <span class=nx>ValueType</span> <span class=o>=</span> <span class=kt>number</span> <span class=o>|</span> <span class=kt>string</span> <span class=o>|</span> <span class=kr>boolean</span> <span class=o>|</span> <span class=nb>Array</span><span class=p>&lt;</span><span class=nt>number</span><span class=p>&gt;</span> <span class=o>|</span> <span class=nb>Array</span><span class=p>&lt;</span><span class=nt>string</span><span class=p>&gt;</span> <span class=o>|</span> <span class=nb>Array</span><span class=p>&lt;</span><span class=nt>boolean</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>PreferencesUtils</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// preferences的文件名-数据库表名
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>private</span> <span class=nx>preferencesName</span>: <span class=kt>string</span> <span class=o>=</span> <span class=nx>PREFERENCES_NAME</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 用于获取preferences实例的key值，保存到单例中
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>private</span> <span class=nx>keyPreferences</span>: <span class=kt>string</span> <span class=o>=</span> <span class=nx>KEY_PREFERENCES</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>  <span class=kr>constructor</span><span class=p>(</span><span class=nx>name</span>: <span class=kt>string</span> <span class=o>=</span> <span class=nx>PREFERENCES_NAME</span><span class=p>,</span> <span class=nx>key</span>: <span class=kt>string</span> <span class=o>=</span> <span class=nx>KEY_PREFERENCES</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>preferencesName</span> <span class=o>=</span> <span class=nx>name</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>keyPreferences</span> <span class=o>=</span> <span class=nx>key</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   * 创建首选项实例
</span></span></span><span class=line><span class=cl><span class=cm>   * @param context: 应用上下文
</span></span></span><span class=line><span class=cl><span class=cm>   * @param preferencesName: 数据库表名
</span></span></span><span class=line><span class=cl><span class=cm>   * @returns
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=nx>createPreferences</span><span class=p>(</span><span class=nx>context</span><span class=p>)</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>dataPreferences.Preferences</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>preferences</span> <span class=o>=</span> <span class=nx>dataPreferences</span><span class=p>.</span><span class=nx>getPreferences</span><span class=p>(</span><span class=nx>context</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>preferencesName</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>GlobalContext</span><span class=p>.</span><span class=nx>getContext</span><span class=p>().</span><span class=nx>setObject</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>keyPreferences</span><span class=p>,</span> <span class=nx>preferences</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   * 获取首选项实例
</span></span></span><span class=line><span class=cl><span class=cm>   * @returns
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=nx>getPreferences</span><span class=p>()</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>dataPreferences.Preferences</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>GlobalContext</span><span class=p>.</span><span class=nx>getContext</span><span class=p>().</span><span class=nx>getObject</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>keyPreferences</span><span class=p>)</span> <span class=kr>as</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>dataPreferences.Preferences</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   * 获取数据
</span></span></span><span class=line><span class=cl><span class=cm>   * @param key: 读取key值
</span></span></span><span class=line><span class=cl><span class=cm>   * @param def: 函数出参
</span></span></span><span class=line><span class=cl><span class=cm>   * @returns
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=kr>get</span><span class=p>(</span><span class=nx>key</span>: <span class=kt>string</span><span class=p>,</span> <span class=nx>def?</span>: <span class=kt>ValueType</span><span class=p>)</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>ValueType</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span><span class=k>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>getPreferences</span><span class=p>()).</span><span class=kr>get</span><span class=p>(</span><span class=nx>key</span><span class=p>,</span> <span class=nx>def</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>  <span class=c1>// 获取全部数据
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>async</span> <span class=nx>getAll</span><span class=p>()</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>Object</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>preferences</span> <span class=o>=</span> <span class=k>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>getPreferences</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>preferences</span><span class=p>.</span><span class=nx>getAll</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   * 插入数据
</span></span></span><span class=line><span class=cl><span class=cm>   * @param key: 存入key值
</span></span></span><span class=line><span class=cl><span class=cm>   * @param value: 存储数据
</span></span></span><span class=line><span class=cl><span class=cm>   * @returns
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>put</span><span class=p>(</span><span class=nx>key</span>: <span class=kt>string</span><span class=p>,</span> <span class=nx>value</span>: <span class=kt>ValueType</span><span class=p>)</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>void</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>promise</span> <span class=o>=</span> <span class=k>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>getPreferences</span><span class=p>().</span><span class=nx>then</span><span class=p>(</span><span class=kr>async</span> <span class=nx>preferences</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 插入数据
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>await</span> <span class=nx>preferences</span><span class=p>.</span><span class=nx>put</span><span class=p>(</span><span class=nx>key</span><span class=p>,</span> <span class=nx>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 写入文件
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>await</span> <span class=nx>preferences</span><span class=p>.</span><span class=nx>flush</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>}).</span><span class=k>catch</span><span class=p>(</span><span class=nx>error</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>LogUtils</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>LOG</span><span class=p>,</span> <span class=sb>`code:</span><span class=si>${</span><span class=nx>error</span><span class=p>.</span><span class=nx>code</span><span class=si>}</span><span class=sb>, message:</span><span class=si>${</span><span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>promise</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   * 删除数据
</span></span></span><span class=line><span class=cl><span class=cm>   * @param key: 删除key的value值
</span></span></span><span class=line><span class=cl><span class=cm>   * @returns
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=k>delete</span><span class=p>(</span><span class=nx>key</span>: <span class=kt>string</span><span class=p>)</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>void</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span><span class=k>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>getPreferences</span><span class=p>()).</span><span class=k>delete</span><span class=p>(</span><span class=nx>key</span><span class=p>).</span><span class=k>finally</span><span class=p>(</span><span class=kr>async</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=k>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>getPreferences</span><span class=p>()).</span><span class=nx>flush</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>  <span class=c1>// 清空数据
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>async</span> <span class=nx>clear</span><span class=p>()</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>void</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span><span class=k>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>getPreferences</span><span class=p>()).</span><span class=nx>clear</span><span class=p>().</span><span class=k>finally</span><span class=p>(</span><span class=kr>async</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=k>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>getPreferences</span><span class=p>()).</span><span class=nx>flush</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=k>new</span> <span class=nx>PreferencesUtils</span><span class=p>()</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-tsx data-lang=tsx><span class=line><span class=cl><span class=c1>// src/main/ets/common/GlobalContext.ts
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=kr>class</span> <span class=nx>GlobalContext</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>private</span> <span class=kr>constructor</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  <span class=kr>private</span> <span class=kr>static</span> <span class=nx>instance</span>: <span class=kt>GlobalContext</span>
</span></span><span class=line><span class=cl>  <span class=kr>private</span> <span class=nx>_objects</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Map</span><span class=p>&lt;</span><span class=nt>string</span><span class=p>,</span> <span class=na>Object</span><span class=p>&gt;()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>public</span> <span class=kr>static</span> <span class=nx>getContext</span><span class=p>()</span><span class=o>:</span> <span class=nx>GlobalContext</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>GlobalContext</span><span class=p>.</span><span class=nx>instance</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>GlobalContext</span><span class=p>.</span><span class=nx>instance</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>GlobalContext</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>GlobalContext</span><span class=p>.</span><span class=nx>instance</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>getObject</span><span class=p>(</span><span class=nx>value</span>: <span class=kt>string</span><span class=p>)</span><span class=o>:</span> <span class=nb>Object</span> <span class=o>|</span> <span class=kc>undefined</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>_objects</span><span class=p>.</span><span class=kr>get</span><span class=p>(</span><span class=nx>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>setObject</span><span class=p>(</span><span class=nx>key</span>: <span class=kt>string</span><span class=p>,</span> <span class=nx>objectClass</span>: <span class=kt>Object</span><span class=p>)</span><span class=o>:</span> <span class=k>void</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>_objects</span><span class=p>.</span><span class=kr>set</span><span class=p>(</span><span class=nx>key</span><span class=p>,</span> <span class=nx>objectClass</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><blockquote><p>在<code>EntryAbility中onCreate()</code>方法初始化：</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-tsx data-lang=tsx><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=kr>class</span> <span class=nx>EntryAbility</span> <span class=kr>extends</span> <span class=nx>UIAbility</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>onCreate</span><span class=p>(</span><span class=nx>want</span>: <span class=kt>Want</span><span class=p>,</span> <span class=nx>launchParam</span>: <span class=kt>AbilityConstant.LaunchParam</span><span class=p>)</span><span class=o>:</span> <span class=k>void</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>PreferencesUtils</span><span class=p>.</span><span class=nx>createPreferences</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>context</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>hilog</span><span class=p>.</span><span class=nx>info</span><span class=p>(</span><span class=mh>0x0000</span><span class=p>,</span> <span class=s1>&#39;testTag&#39;</span><span class=p>,</span> <span class=s1>&#39;%{public}s&#39;</span><span class=p>,</span> <span class=s1>&#39;Ability onCreate&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-tsx data-lang=tsx><span class=line><span class=cl><span class=kr>import</span> <span class=nx>PreferencesUtils</span> <span class=kr>from</span> <span class=s1>&#39;../common/PreferencesUtil&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>@Entry</span>
</span></span><span class=line><span class=cl><span class=kd>@Component</span>
</span></span><span class=line><span class=cl><span class=nx>struct</span> <span class=nx>member</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>@State</span> <span class=nx>text</span>: <span class=kt>string</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>aboutToAppear() {</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>getAll</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>getAll() {</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>text</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=k>await</span> <span class=nx>PreferencesUtils</span><span class=p>.</span><span class=nx>getAll</span><span class=p>()</span> <span class=kr>as</span> <span class=nb>Object</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;getAll&#39;</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>build() {</span>
</span></span><span class=line><span class=cl>    <span class=nx>Column() {</span>
</span></span><span class=line><span class=cl>      <span class=nx>Text</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>width</span><span class=p>(</span><span class=s1>&#39;100%&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>height</span><span class=p>(</span><span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=nx>Row() {</span>
</span></span><span class=line><span class=cl>        <span class=nx>Button</span><span class=p>(</span><span class=s1>&#39;get&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=p>.</span><span class=nx>onClick</span><span class=p>(</span><span class=kr>async</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=p>.</span><span class=nx>text</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>PreferencesUtils</span><span class=p>.</span><span class=kr>get</span><span class=p>(</span><span class=s1>&#39;userName&#39;</span><span class=p>)</span> <span class=kr>as</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>          <span class=p>})</span>
</span></span><span class=line><span class=cl>        <span class=nx>Button</span><span class=p>(</span><span class=s1>&#39;getAll&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=p>.</span><span class=nx>onClick</span><span class=p>(</span><span class=kr>async</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=p>.</span><span class=nx>getAll</span><span class=p>()</span>
</span></span><span class=line><span class=cl>          <span class=p>})</span>
</span></span><span class=line><span class=cl>        <span class=nx>Button</span><span class=p>(</span><span class=s1>&#39;put&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=p>.</span><span class=nx>onClick</span><span class=p>(</span><span class=kr>async</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=nx>PreferencesUtils</span><span class=p>.</span><span class=nx>put</span><span class=p>(</span><span class=s1>&#39;userName&#39;</span><span class=p>,</span> <span class=s1>&#39;李四&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span>  <span class=nx>PreferencesUtils</span><span class=p>.</span><span class=nx>put</span><span class=p>(</span><span class=s1>&#39;age&#39;</span><span class=p>,</span> <span class=mi>25</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=nx>PreferencesUtils</span><span class=p>.</span><span class=nx>put</span><span class=p>(</span><span class=s1>&#39;sex&#39;</span><span class=p>,</span> <span class=s1>&#39;女&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=p>.</span><span class=nx>getAll</span><span class=p>()</span>
</span></span><span class=line><span class=cl>          <span class=p>})</span>
</span></span><span class=line><span class=cl>        <span class=nx>Button</span><span class=p>(</span><span class=s1>&#39;delete&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=p>.</span><span class=nx>onClick</span><span class=p>(</span><span class=kr>async</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=nx>PreferencesUtils</span><span class=p>.</span><span class=k>delete</span><span class=p>(</span><span class=s1>&#39;sex&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=p>.</span><span class=nx>getAll</span><span class=p>()</span>
</span></span><span class=line><span class=cl>          <span class=p>})</span>
</span></span><span class=line><span class=cl>        <span class=nx>Button</span><span class=p>(</span><span class=s1>&#39;clear&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=p>.</span><span class=nx>onClick</span><span class=p>(</span><span class=kr>async</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=nx>PreferencesUtils</span><span class=p>.</span><span class=nx>clear</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=p>.</span><span class=nx>getAll</span><span class=p>()</span>
</span></span><span class=line><span class=cl>          <span class=p>})</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>width</span><span class=p>(</span><span class=s1>&#39;100%&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>justifyContent</span><span class=p>(</span><span class=nx>FlexAlign</span><span class=p>.</span><span class=nx>Center</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}.</span><span class=nx>margin</span><span class=p>({</span> <span class=nx>top</span>: <span class=kt>50</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202404301441674.png><img src=https://qiniu.waite.wang/202404301441674.png alt=image-20240430144106287></a></div></p><h3 id=关系型数据库>关系型数据库<a hidden class=anchor aria-hidden=true href=#关系型数据库>#</a></h3><p><a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/data-persistence-by-rdb-store-0000001505752421-V2 target=_blank>https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/data-persistence-by-rdb-store-0000001505752421-V2</a></p><p>关系型数据库基于SQLite组件，适用于存储包含复杂关系数据的场景，比如一个班级的学生信息，需要包括姓名、学号、各科成绩等，又或者公司的雇员信息，需要包括姓名、工号、职位等，由于数据之间有较强的对应关系，复杂程度比键值型数据更高，此时需要使用关系型数据库来持久化保存数据。</p><ul><li><strong>谓词</strong>：数据库中用来代表数据实体的性质、特征或者数据实体之间关系的词项，主要用来定义数据库的操作条件。</li><li><strong>结果集</strong>：指用户查询之后的结果集合，可以对数据进行访问。结果集提供了灵活的数据访问方式，可以更方便地拿到用户想要的数据。</li></ul><p>关系型数据库对应用提供通用的操作接口，底层使用SQLite作为持久化存储引擎，支持SQLite具有的数据库特性，包括但不限于事务、索引、视图、触发器、外键、参数化查询和预编译SQL语句。</p><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202404301738287.jpeg><img src=https://qiniu.waite.wang/202404301738287.jpeg alt=img></a></div></p><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202404301738399.png><img src=https://qiniu.waite.wang/202404301738399.png alt=image-20240430173835738></a></div></p><ol><li>使用关系型数据库实现数据持久化，需要获取一个RdbStore。示例代码如下所示：</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-tsx data-lang=tsx><span class=line><span class=cl><span class=kr>import</span> <span class=nx>relationalStore</span> <span class=kr>from</span> <span class=s1>&#39;@ohos.data.relationalStore&#39;</span><span class=p>;</span> <span class=c1>// 导入模块 
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>UIAbility</span> <span class=kr>from</span> <span class=s1>&#39;@ohos.app.ability.UIAbility&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>EntryAbility</span> <span class=kr>extends</span> <span class=nx>UIAbility</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>onWindowStageCreate</span><span class=p>(</span><span class=nx>windowStage</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>STORE_CONFIG</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;RdbTest.db&#39;</span><span class=p>,</span> <span class=c1>// 数据库文件名
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>securityLevel</span>: <span class=kt>relationalStore.SecurityLevel.S1</span> <span class=c1>// 数据库安全级别
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>SQL_CREATE_TABLE</span> <span class=o>=</span> <span class=s1>&#39;CREATE TABLE IF NOT EXISTS EMPLOYEE (ID INTEGER PRIMARY KEY AUTOINCREMENT, NAME TEXT NOT NULL, AGE INTEGER, SALARY REAL, CODES BLOB)&#39;</span><span class=p>;</span> <span class=c1>// 建表Sql语句
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=nx>relationalStore</span><span class=p>.</span><span class=nx>getRdbStore</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>context</span><span class=p>,</span> <span class=nx>STORE_CONFIG</span><span class=p>,</span> <span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=nx>store</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=sb>`Failed to get RdbStore. Code:</span><span class=si>${</span><span class=nx>err</span><span class=p>.</span><span class=nx>code</span><span class=si>}</span><span class=sb>, message:</span><span class=si>${</span><span class=nx>err</span><span class=p>.</span><span class=nx>message</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>info</span><span class=p>(</span><span class=sb>`Succeeded in getting RdbStore.`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nx>store</span><span class=p>.</span><span class=nx>executeSql</span><span class=p>(</span><span class=nx>SQL_CREATE_TABLE</span><span class=p>);</span> <span class=c1>// 创建数据表
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>      <span class=c1>// 这里执行数据库的增、删、改、查等操作
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><ol start=2><li>获取到RdbStore后，调用insert()接口插入数据。示例代码如下所示：</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-tsx data-lang=tsx><span class=line><span class=cl><span class=kr>const</span> <span class=nx>valueBucket</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;NAME&#39;</span><span class=o>:</span> <span class=s1>&#39;Lisa&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;AGE&#39;</span><span class=o>:</span> <span class=mi>18</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;SALARY&#39;</span><span class=o>:</span> <span class=mf>100.5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;CODES&#39;</span><span class=o>:</span> <span class=k>new</span> <span class=nx>Uint8Array</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=nx>store</span><span class=p>.</span><span class=nx>insert</span><span class=p>(</span><span class=s1>&#39;EMPLOYEE&#39;</span><span class=p>,</span> <span class=nx>valueBucket</span><span class=p>,</span> <span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=nx>rowId</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=sb>`Failed to insert data. Code:</span><span class=si>${</span><span class=nx>err</span><span class=p>.</span><span class=nx>code</span><span class=si>}</span><span class=sb>, message:</span><span class=si>${</span><span class=nx>err</span><span class=p>.</span><span class=nx>message</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>info</span><span class=p>(</span><span class=sb>`Succeeded in inserting data. rowId:</span><span class=si>${</span><span class=nx>rowId</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div><blockquote><p>关系型数据库没有显式的flush操作实现持久化，数据插入即保存在持久化文件。</p></blockquote><ol start=3><li><p>根据谓词指定的实例对象，对数据进行修改或删除。</p><p>调用update()方法修改数据，调用delete()方法删除数据。示例代码如下所示：</p></li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-tsx data-lang=tsx><span class=line><span class=cl><span class=c1>// 修改数据
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>valueBucket</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;NAME&#39;</span><span class=o>:</span> <span class=s1>&#39;Rose&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;AGE&#39;</span><span class=o>:</span> <span class=mi>22</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;SALARY&#39;</span><span class=o>:</span> <span class=mf>200.5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;CODES&#39;</span><span class=o>:</span> <span class=k>new</span> <span class=nx>Uint8Array</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>predicates</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>relationalStore</span><span class=p>.</span><span class=nx>RdbPredicates</span><span class=p>(</span><span class=s1>&#39;EMPLOYEE&#39;</span><span class=p>);</span> <span class=c1>// 创建表&#39;EMPLOYEE&#39;的predicates
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>predicates</span><span class=p>.</span><span class=nx>equalTo</span><span class=p>(</span><span class=s1>&#39;NAME&#39;</span><span class=p>,</span> <span class=s1>&#39;Lisa&#39;</span><span class=p>);</span> <span class=c1>// 匹配表&#39;EMPLOYEE&#39;中&#39;NAME&#39;为&#39;Lisa&#39;的字段
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>store</span><span class=p>.</span><span class=nx>update</span><span class=p>(</span><span class=nx>valueBucket</span><span class=p>,</span> <span class=nx>predicates</span><span class=p>,</span> <span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=nx>rows</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=sb>`Failed to update data. Code:</span><span class=si>${</span><span class=nx>err</span><span class=p>.</span><span class=nx>code</span><span class=si>}</span><span class=sb>, message:</span><span class=si>${</span><span class=nx>err</span><span class=p>.</span><span class=nx>message</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>info</span><span class=p>(</span><span class=sb>`Succeeded in updating data. row count: </span><span class=si>${</span><span class=nx>rows</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 删除数据
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>let</span> <span class=nx>predicates</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>relationalStore</span><span class=p>.</span><span class=nx>RdbPredicates</span><span class=p>(</span><span class=s1>&#39;EMPLOYEE&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>predicates</span><span class=p>.</span><span class=nx>equalTo</span><span class=p>(</span><span class=s1>&#39;NAME&#39;</span><span class=p>,</span> <span class=s1>&#39;Lisa&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>store</span><span class=p>.</span><span class=k>delete</span><span class=p>(</span><span class=nx>predicates</span><span class=p>,</span> <span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=nx>rows</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=sb>`Failed to delete data. Code:</span><span class=si>${</span><span class=nx>err</span><span class=p>.</span><span class=nx>code</span><span class=si>}</span><span class=sb>, message:</span><span class=si>${</span><span class=nx>err</span><span class=p>.</span><span class=nx>message</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>info</span><span class=p>(</span><span class=sb>`Delete rows: </span><span class=si>${</span><span class=nx>rows</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div><ol start=4><li><p>根据谓词指定的查询条件查找数据。</p><p>调用query()方法查找数据，返回一个ResultSet结果集。示例代码如下所示：</p></li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-tsx data-lang=tsx><span class=line><span class=cl><span class=kd>let</span> <span class=nx>predicates</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>relationalStore</span><span class=p>.</span><span class=nx>RdbPredicates</span><span class=p>(</span><span class=s1>&#39;EMPLOYEE&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>predicates</span><span class=p>.</span><span class=nx>equalTo</span><span class=p>(</span><span class=s1>&#39;NAME&#39;</span><span class=p>,</span> <span class=s1>&#39;Rose&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>store</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span><span class=nx>predicates</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;ID&#39;</span><span class=p>,</span> <span class=s1>&#39;NAME&#39;</span><span class=p>,</span> <span class=s1>&#39;AGE&#39;</span><span class=p>,</span> <span class=s1>&#39;SALARY&#39;</span><span class=p>,</span> <span class=s1>&#39;CODES&#39;</span><span class=p>],</span> <span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=nx>resultSet</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=sb>`Failed to query data. Code:</span><span class=si>${</span><span class=nx>err</span><span class=p>.</span><span class=nx>code</span><span class=si>}</span><span class=sb>, message:</span><span class=si>${</span><span class=nx>err</span><span class=p>.</span><span class=nx>message</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>info</span><span class=p>(</span><span class=sb>`ResultSet column names: </span><span class=si>${</span><span class=nx>resultSet</span><span class=p>.</span><span class=nx>columnNames</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>info</span><span class=p>(</span><span class=sb>`ResultSet column count: </span><span class=si>${</span><span class=nx>resultSet</span><span class=p>.</span><span class=nx>columnCount</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div><blockquote><p>当应用完成查询数据操作，不再使用结果集（ResultSet）时，请及时调用close方法关闭结果集，释放系统为其分配的内存。</p></blockquote><ol start=5><li><p>删除数据库。</p><p>调用deleteRdbStore()方法，删除数据库及数据库相关文件。示例代码如下</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-tsx data-lang=tsx><span class=line><span class=cl><span class=kr>import</span> <span class=nx>UIAbility</span> <span class=kr>from</span> <span class=s1>&#39;@ohos.app.ability.UIAbility&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>EntryAbility</span> <span class=kr>extends</span> <span class=nx>UIAbility</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>onWindowStageCreate</span><span class=p>(</span><span class=nx>windowStage</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>relationalStore</span><span class=p>.</span><span class=nx>deleteRdbStore</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>context</span><span class=p>,</span> <span class=s1>&#39;RdbTest.db&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=sb>`Failed to delete RdbStore. Code:</span><span class=si>${</span><span class=nx>err</span><span class=p>.</span><span class=nx>code</span><span class=si>}</span><span class=sb>, message:</span><span class=si>${</span><span class=nx>err</span><span class=p>.</span><span class=nx>message</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>info</span><span class=p>(</span><span class=s1>&#39;Succeeded in deleting RdbStore.&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div></li></ol><blockquote><p>以下是一个案例, 包含增, 查, 代码很粗糙</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-tsx data-lang=tsx><span class=line><span class=cl><span class=c1>// src/main/ets/utils/DbUtil.ts
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>common</span> <span class=kr>from</span> <span class=s1>&#39;@ohos.app.ability.common&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>relationalStore</span> <span class=kr>from</span> <span class=s1>&#39;@ohos.data.relationalStore&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>ColumnInfo</span><span class=p>,</span> <span class=nx>ColumnType</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;../type/ColumnInfo&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>Logger</span> <span class=kr>from</span> <span class=s1>&#39;./Logger&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//  操作的数据库名称
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>DB_FILENAME</span>: <span class=kt>string</span> <span class=o>=</span> <span class=s1>&#39;OliannaWen.db&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>DbUtil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 使用变量来获取关系型数据库操作对象
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>rdbStore</span>: <span class=kt>relationalStore.RdbStore</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 初始化数据库
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>initDB</span><span class=p>(</span><span class=nx>context</span>: <span class=kt>common.UIAbilityContext</span><span class=p>)</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>void</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>config</span>: <span class=kt>relationalStore.StoreConfig</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 数据库名称
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>name</span>: <span class=kt>DB_FILENAME</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 数据库操作安全等级
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>securityLevel</span>: <span class=kt>relationalStore.SecurityLevel.S1</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>new</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>void</span><span class=p>&gt;((</span><span class=nx>resolve</span><span class=p>,</span> <span class=nx>reject</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 获取关系型数据库操作对象
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>relationalStore</span><span class=p>.</span><span class=nx>getRdbStore</span><span class=p>(</span><span class=nx>context</span><span class=p>,</span> <span class=nx>config</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>rdbStore</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=k>this</span><span class=p>.</span><span class=nx>rdbStore</span> <span class=o>=</span> <span class=nx>rdbStore</span>
</span></span><span class=line><span class=cl>          <span class=c1>// 记录日志
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=nx>Logger</span><span class=p>.</span><span class=nx>debug</span><span class=p>(</span><span class=s1>&#39;rdbStore 初始化完成！&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=nx>resolve</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=nx>reason</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>Logger</span><span class=p>.</span><span class=nx>debug</span><span class=p>(</span><span class=s1>&#39;rdbStore 初始化异常&#39;</span><span class=p>,</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>reason</span><span class=p>))</span>
</span></span><span class=line><span class=cl>          <span class=nx>reject</span><span class=p>(</span><span class=nx>reason</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 创建表函数，传入创建表语句
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>createTable</span><span class=p>(</span><span class=nx>createSQL</span>: <span class=kt>string</span><span class=p>)</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>void</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>new</span> <span class=nx>Promise</span><span class=p>((</span><span class=nx>resolve</span><span class=p>,</span> <span class=nx>reject</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>rdbStore</span><span class=p>.</span><span class=nx>executeSql</span><span class=p>(</span><span class=nx>createSQL</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>then</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>Logger</span><span class=p>.</span><span class=nx>debug</span><span class=p>(</span><span class=s1>&#39;创建表成功&#39;</span><span class=p>,</span> <span class=nx>createSQL</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=nx>resolve</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=nx>err</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>Logger</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;创建表失败,&#39;</span> <span class=o>+</span> <span class=nx>err</span><span class=p>.</span><span class=nx>message</span><span class=p>,</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>err</span><span class=p>))</span>
</span></span><span class=line><span class=cl>          <span class=nx>reject</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 建立insert方法的映射关系（实体数据插入到数据库的字段映射）
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>buildValueBucket</span><span class=p>(</span><span class=nx>obj</span>: <span class=kt>any</span><span class=p>,</span> <span class=nx>columns</span>: <span class=kt>ColumnInfo</span><span class=p>[])</span><span class=o>:</span> <span class=nx>relationalStore</span><span class=p>.</span><span class=nx>ValuesBucket</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>value</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=nx>columns</span><span class=p>.</span><span class=nx>forEach</span><span class=p>(</span><span class=nx>info</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kd>let</span> <span class=nx>val</span> <span class=o>=</span> <span class=nx>obj</span><span class=p>[</span><span class=nx>info</span><span class=p>.</span><span class=nx>name</span><span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=k>typeof</span> <span class=nx>val</span> <span class=o>!==</span> <span class=s1>&#39;undefined&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>value</span><span class=p>[</span><span class=nx>info</span><span class=p>.</span><span class=nx>columnName</span><span class=p>]</span> <span class=o>=</span> <span class=nx>val</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>value</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 新增方法，参数为表名称和新增对象
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>insert</span><span class=p>(</span><span class=nx>tableName</span>: <span class=kt>string</span><span class=p>,</span> <span class=nx>obj</span>: <span class=kt>any</span><span class=p>,</span> <span class=nx>columns</span>: <span class=kt>ColumnInfo</span><span class=p>[])</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>number</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>new</span> <span class=nx>Promise</span><span class=p>((</span><span class=nx>resolve</span><span class=p>,</span> <span class=nx>reject</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 1.构建新增数据
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kd>let</span> <span class=nx>value</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>buildValueBucket</span><span class=p>(</span><span class=nx>obj</span><span class=p>,</span> <span class=nx>columns</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 2.新增
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>this</span><span class=p>.</span><span class=nx>rdbStore</span><span class=p>.</span><span class=nx>insert</span><span class=p>(</span><span class=nx>tableName</span><span class=p>,</span> <span class=nx>value</span><span class=p>,</span> <span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=nx>id</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>Logger</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;新增失败！&#39;</span><span class=p>,</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>err</span><span class=p>))</span>
</span></span><span class=line><span class=cl>          <span class=nx>reject</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>Logger</span><span class=p>.</span><span class=nx>debug</span><span class=p>(</span><span class=s1>&#39;新增成功！新增id：&#39;</span><span class=p>,</span> <span class=nx>id</span><span class=p>.</span><span class=nx>toString</span><span class=p>())</span>
</span></span><span class=line><span class=cl>          <span class=nx>resolve</span><span class=p>(</span><span class=nx>id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 删除方法,传入删除条件
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>delete</span><span class=p>(</span><span class=nx>predicates</span>: <span class=kt>relationalStore.RdbPredicates</span><span class=p>)</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>number</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>new</span> <span class=nx>Promise</span><span class=p>((</span><span class=nx>resolve</span><span class=p>,</span> <span class=nx>reject</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>rdbStore</span><span class=p>.</span><span class=k>delete</span><span class=p>(</span><span class=nx>predicates</span><span class=p>,</span> <span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=nx>rows</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>Logger</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;删除失败！&#39;</span><span class=p>,</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>err</span><span class=p>))</span>
</span></span><span class=line><span class=cl>          <span class=nx>reject</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>Logger</span><span class=p>.</span><span class=nx>debug</span><span class=p>(</span><span class=s1>&#39;删除成功！删除行数：&#39;</span><span class=p>,</span> <span class=nx>rows</span><span class=p>.</span><span class=nx>toString</span><span class=p>())</span>
</span></span><span class=line><span class=cl>          <span class=nx>resolve</span><span class=p>(</span><span class=nx>rows</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 查询方法,传入查询条件,字段,返回结果
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>queryForList</span><span class=p>&lt;</span><span class=nt>T</span><span class=p>&gt;(</span><span class=nx>predicates</span>: <span class=kt>relationalStore.RdbPredicates</span><span class=p>,</span> <span class=nx>columns</span>: <span class=kt>ColumnInfo</span><span class=p>[])</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>T</span><span class=err>[]</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>Logger</span><span class=p>.</span><span class=nx>debug</span><span class=p>(</span><span class=s2>&#34;dddfafa&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>new</span> <span class=nx>Promise</span><span class=p>((</span><span class=nx>resolve</span><span class=p>,</span> <span class=nx>reject</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>rdbStore</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span><span class=nx>predicates</span><span class=p>,</span> <span class=nx>columns</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>info</span> <span class=o>=&gt;</span> <span class=nx>info</span><span class=p>.</span><span class=nx>columnName</span><span class=p>),</span> <span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=nx>result</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>Logger</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;查询失败！&#39;</span><span class=p>,</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>err</span><span class=p>))</span>
</span></span><span class=line><span class=cl>          <span class=nx>reject</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>Logger</span><span class=p>.</span><span class=nx>debug</span><span class=p>(</span><span class=s1>&#39;查询成功！查询行数：&#39;</span><span class=p>,</span> <span class=nx>result</span><span class=p>.</span><span class=nx>rowCount</span><span class=p>.</span><span class=nx>toString</span><span class=p>())</span>
</span></span><span class=line><span class=cl>          <span class=nx>resolve</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>parseResultSet</span><span class=p>(</span><span class=nx>result</span><span class=p>,</span> <span class=nx>columns</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 解析结果集
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>parseResultSet</span><span class=p>&lt;</span><span class=nt>T</span><span class=p>&gt;(</span><span class=nx>result</span>: <span class=kt>relationalStore.ResultSet</span><span class=p>,</span> <span class=nx>columns</span>: <span class=kt>ColumnInfo</span><span class=p>[])</span><span class=o>:</span> <span class=nx>T</span><span class=p>[]</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 1.声明最终返回的结果
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>let</span> <span class=nx>arr</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 2.判断是否有结果
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=nx>result</span><span class=p>.</span><span class=nx>rowCount</span> <span class=o>&lt;=</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>arr</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 3.处理结果
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>while</span> <span class=p>(</span><span class=o>!</span><span class=nx>result</span><span class=p>.</span><span class=nx>isAtLastRow</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 3.1.去下一行
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>result</span><span class=p>.</span><span class=nx>goToNextRow</span><span class=p>()</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 3.2.解析这行数据，转为对象
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kd>let</span> <span class=nx>obj</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>      <span class=nx>columns</span><span class=p>.</span><span class=nx>forEach</span><span class=p>(</span><span class=nx>info</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nx>val</span> <span class=o>=</span> <span class=kc>null</span>
</span></span><span class=line><span class=cl>        <span class=k>switch</span> <span class=p>(</span><span class=nx>info</span><span class=p>.</span><span class=kr>type</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=k>case</span> <span class=nx>ColumnType.LONG</span>:
</span></span><span class=line><span class=cl>            <span class=kt>val</span> <span class=o>=</span> <span class=nx>result</span><span class=p>.</span><span class=nx>getLong</span><span class=p>(</span><span class=nx>result</span><span class=p>.</span><span class=nx>getColumnIndex</span><span class=p>(</span><span class=nx>info</span><span class=p>.</span><span class=nx>columnName</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>          <span class=k>case</span> <span class=nx>ColumnType.DOUBLE</span>:
</span></span><span class=line><span class=cl>            <span class=kt>val</span> <span class=o>=</span> <span class=nx>result</span><span class=p>.</span><span class=nx>getDouble</span><span class=p>(</span><span class=nx>result</span><span class=p>.</span><span class=nx>getColumnIndex</span><span class=p>(</span><span class=nx>info</span><span class=p>.</span><span class=nx>columnName</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>          <span class=k>case</span> <span class=nx>ColumnType.STRING</span>:
</span></span><span class=line><span class=cl>            <span class=kt>val</span> <span class=o>=</span> <span class=nx>result</span><span class=p>.</span><span class=nx>getString</span><span class=p>(</span><span class=nx>result</span><span class=p>.</span><span class=nx>getColumnIndex</span><span class=p>(</span><span class=nx>info</span><span class=p>.</span><span class=nx>columnName</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>          <span class=k>case</span> <span class=nx>ColumnType.BLOB</span>:
</span></span><span class=line><span class=cl>            <span class=kt>val</span> <span class=o>=</span> <span class=nx>result</span><span class=p>.</span><span class=nx>getBlob</span><span class=p>(</span><span class=nx>result</span><span class=p>.</span><span class=nx>getColumnIndex</span><span class=p>(</span><span class=nx>info</span><span class=p>.</span><span class=nx>columnName</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nx>obj</span><span class=p>[</span><span class=nx>info</span><span class=p>.</span><span class=nx>name</span><span class=p>]</span> <span class=o>=</span> <span class=nx>val</span>
</span></span><span class=line><span class=cl>      <span class=p>})</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 3.3.将对象填入结果数组
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>arr</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>obj</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=nx>Logger</span><span class=p>.</span><span class=nx>debug</span><span class=p>(</span><span class=s1>&#39;查询到数据：&#39;</span><span class=p>,</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>obj</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>arr</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>dbUtil</span>: <span class=kt>DbUtil</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>DbUtil</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>dbUtil</span> <span class=kr>as</span> <span class=nx>DbUtil</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-tsx data-lang=tsx><span class=line><span class=cl><span class=c1>// src/main/ets/entryability/EntryAbility.ets
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>async</span> <span class=nx>onCreate</span><span class=p>(</span><span class=nx>want</span><span class=p>,</span> <span class=nx>launchParam</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 初始化任务表
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>await</span> <span class=nx>DbUtil</span><span class=p>.</span><span class=nx>initDB</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>context</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>import</span> <span class=nx>dbUtil</span> <span class=kr>from</span> <span class=s1>&#39;../utils/DbUtil&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>Logger</span> <span class=kr>from</span> <span class=s1>&#39;../utils/Logger&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>relationalStore</span> <span class=kr>from</span> <span class=s1>&#39;@ohos.data.relationalStore&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>enum</span> <span class=nx>ColumnType</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>LONG</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>DOUBLE</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>STRING</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>BLOB</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>interface</span> <span class=nx>ColumnInfo</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 实体字段
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>name</span>: <span class=kt>string</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 映射到数据库对应的字段
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>columnName</span>: <span class=kt>string</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 数据库字段类型
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>type</span><span class=o>:</span> <span class=nx>ColumnType</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>interface</span> <span class=nx>ValuesBucket</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nx>key</span>: <span class=kt>string</span><span class=p>]</span><span class=o>:</span> <span class=kt>any</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>DB_NAME</span> <span class=o>=</span> <span class=s1>&#39;testDB&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>TABLE_NAME</span> <span class=o>=</span> <span class=s1>&#39;table1&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>SQL_CREATE_TABLE</span> <span class=o>=</span> <span class=sb>`
</span></span></span><span class=line><span class=cl><span class=sb>  CREATE TABLE IF NOT EXISTS </span><span class=si>${</span><span class=nx>TABLE_NAME</span><span class=si>}</span><span class=sb>  (
</span></span></span><span class=line><span class=cl><span class=sb>    ID INTEGER PRIMARY KEY AUTOINCREMENT,
</span></span></span><span class=line><span class=cl><span class=sb>    NAME TEXT NOT NULL,
</span></span></span><span class=line><span class=cl><span class=sb>    AGE INTEGER,
</span></span></span><span class=line><span class=cl><span class=sb>    SALARY REAL,
</span></span></span><span class=line><span class=cl><span class=sb>    CODES BLOB
</span></span></span><span class=line><span class=cl><span class=sb>  )
</span></span></span><span class=line><span class=cl><span class=sb>`</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>columns</span>: <span class=kt>ColumnInfo</span><span class=p>[]</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;NAME&#39;</span><span class=p>,</span> <span class=nx>columnName</span><span class=o>:</span> <span class=s1>&#39;NAME&#39;</span><span class=p>,</span> <span class=kr>type</span><span class=o>:</span> <span class=nx>ColumnType</span><span class=p>.</span><span class=nx>STRING</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;AGE&#39;</span><span class=p>,</span> <span class=nx>columnName</span><span class=o>:</span> <span class=s1>&#39;AGE&#39;</span><span class=p>,</span> <span class=kr>type</span><span class=o>:</span> <span class=nx>ColumnType</span><span class=p>.</span><span class=nx>LONG</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;SALARY&#39;</span><span class=p>,</span> <span class=nx>columnName</span><span class=o>:</span> <span class=s1>&#39;SALARY&#39;</span><span class=p>,</span> <span class=kr>type</span><span class=o>:</span> <span class=nx>ColumnType</span><span class=p>.</span><span class=nx>DOUBLE</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;CODES&#39;</span><span class=p>,</span> <span class=nx>columnName</span><span class=o>:</span> <span class=s1>&#39;CODES&#39;</span><span class=p>,</span> <span class=kr>type</span><span class=o>:</span> <span class=nx>ColumnType</span><span class=p>.</span><span class=nx>BLOB</span> <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>valBucket</span>: <span class=kt>ValuesBucket</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;NAME&#39;</span><span class=o>:</span> <span class=s1>&#39;John Doe&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;AGE&#39;</span><span class=o>:</span> <span class=mi>30</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;SALARY&#39;</span><span class=o>:</span> <span class=mf>5000.50</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;CODES&#39;</span><span class=o>:</span> <span class=k>new</span> <span class=nx>Uint8Array</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>]),</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>predicates</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>relationalStore</span><span class=p>.</span><span class=nx>RdbPredicates</span><span class=p>(</span><span class=nx>TABLE_NAME</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>createTable</span> <span class=o>=</span> <span class=kr>async</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>res</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>dbUtil</span><span class=p>.</span><span class=nx>createTable</span><span class=p>(</span><span class=nx>SQL_CREATE_TABLE</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>Logger</span><span class=p>.</span><span class=nx>debug</span><span class=p>(</span><span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>res</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>insertData</span> <span class=o>=</span> <span class=kr>async</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>res</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>dbUtil</span><span class=p>.</span><span class=nx>insert</span><span class=p>(</span><span class=nx>TABLE_NAME</span><span class=p>,</span> <span class=nx>valBucket</span><span class=p>,</span> <span class=nx>columns</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>res</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>queryData</span> <span class=o>=</span> <span class=kr>async</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>res</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>dbUtil</span><span class=p>.</span><span class=nx>queryForList</span><span class=p>(</span><span class=nx>predicates</span><span class=p>,</span> <span class=nx>columns</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>Logger</span><span class=p>.</span><span class=nx>debug</span><span class=p>(</span><span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>res</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>createTable</span><span class=p>,</span> <span class=nx>insertData</span><span class=p>,</span> <span class=nx>queryData</span> 
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-tsx data-lang=tsx><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>createTable</span><span class=p>,</span> <span class=nx>insertData</span><span class=p>,</span> <span class=nx>queryData</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;../viewmodel/useDb&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>@Entry</span>
</span></span><span class=line><span class=cl><span class=kd>@Component</span>
</span></span><span class=line><span class=cl><span class=nx>struct</span> <span class=nx>Index</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>build() {</span>
</span></span><span class=line><span class=cl>    <span class=nx>Column</span><span class=p>({</span> <span class=nx>space</span>: <span class=kt>10</span> <span class=p>})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>Button</span><span class=p>(</span><span class=s2>&#34;Create&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>onClick</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>createTable</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=nx>Button</span><span class=p>(</span><span class=s2>&#34;Insert&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>onClick</span><span class=p>(</span><span class=kr>async</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>insertData</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=nx>Button</span><span class=p>(</span><span class=s2>&#34;Query&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>onClick</span><span class=p>(</span><span class=kr>async</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=k>await</span> <span class=nx>queryData</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>width</span><span class=p>(</span><span class=s1>&#39;100%&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202405061531517.png><img src=https://qiniu.waite.wang/202405061531517.png alt=image-20240506153110474></a></div></p><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202405061531929.png><img src=https://qiniu.waite.wang/202405061531929.png alt=image-20240506153146460></a></div></p><h2 id=通知>通知<a hidden class=anchor aria-hidden=true href=#通知>#</a></h2><h3 id=基础通知>基础通知<a hidden class=anchor aria-hidden=true href=#基础通知>#</a></h3><p><a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V3/notification-guidelines-0000001281360946-V3 target=_blank>https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V3/notification-guidelines-0000001281360946-V3</a></p><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202405062126248.png><img src=https://qiniu.waite.wang/202405062126248.png alt=image-20240506212640352></a></div></p><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202405062127967.png><img src=https://qiniu.waite.wang/202405062127967.png alt=image-20240506212749996></a></div></p><p><a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V3/js-apis-notification-0000001333321097-V3 target=_blank>https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V3/js-apis-notification-0000001333321097-V3</a></p><table><thead><tr><th>名称</th><th>值</th><th>说明</th></tr></thead><tbody><tr><td>NOTIFICATION_CONTENT_BASIC_TEXT</td><td>ContentType</td><td>普通类型通知。</td></tr><tr><td>NOTIFICATION_CONTENT_LONG_TEXT</td><td>ContentType</td><td>长文本类型通知。</td></tr><tr><td>NOTIFICATION_CONTENT_PICTURE</td><td>ContentType</td><td>图片类型通知。</td></tr><tr><td>NOTIFICATION_CONTENT_CONVERSATION</td><td>ContentType</td><td>社交类型通知。</td></tr><tr><td>NOTIFICATION_CONTENT_MULTILINE</td><td>ContentType</td><td>多行文本类型通知。</td></tr></tbody></table><p><strong>系统能力</strong>：以下各项对应的系统能力均为SystemCapability.Notification.Notification</p><table><thead><tr><th>名称</th><th>可读</th><th>可写</th><th>类型</th><th>必填</th><th>描述</th></tr></thead><tbody><tr><td>content</td><td>是</td><td>是</td><td><a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V3/js-apis-notification-0000001333321097-V3#ZH-CN_TOPIC_0000001333321097__notificationcontent target=_blank>NotificationContent</a></td><td>是</td><td>通知内容。</td></tr><tr><td>id</td><td>是</td><td>是</td><td>number</td><td>否</td><td>通知ID。</td></tr><tr><td>slotType</td><td>是</td><td>是</td><td><a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V3/js-apis-notification-0000001333321097-V3#ZH-CN_TOPIC_0000001333321097__slottype target=_blank>SlotType</a></td><td>否</td><td>通道类型。</td></tr><tr><td>isOngoing</td><td>是</td><td>是</td><td>boolean</td><td>否</td><td>是否进行时通知。</td></tr><tr><td>isUnremovable</td><td>是</td><td>是</td><td>boolean</td><td>否</td><td>是否可移除。</td></tr><tr><td>deliveryTime</td><td>是</td><td>是</td><td>number</td><td>否</td><td>通知发送时间。</td></tr><tr><td>tapDismissed</td><td>是</td><td>是</td><td>boolean</td><td>否</td><td>通知是否自动清除。</td></tr><tr><td>autoDeletedTime</td><td>是</td><td>是</td><td>number</td><td>否</td><td>自动清除的时间。</td></tr><tr><td>wantAgent</td><td>是</td><td>是</td><td>WantAgent</td><td>否</td><td>点击跳转的WantAgent。</td></tr><tr><td>extraInfo</td><td>是</td><td>是</td><td>{[key: string]: any}</td><td>否</td><td>扩展参数。</td></tr><tr><td>color</td><td>是</td><td>是</td><td>number</td><td>否</td><td>通知背景颜色。</td></tr><tr><td>colorEnabled</td><td>是</td><td>是</td><td>boolean</td><td>否</td><td>通知背景颜色是否使能。</td></tr><tr><td>isAlertOnce</td><td>是</td><td>是</td><td>boolean</td><td>否</td><td>设置是否仅有一次此通知警报。</td></tr><tr><td>isStopwatch</td><td>是</td><td>是</td><td>boolean</td><td>否</td><td>是否显示已用时间。</td></tr><tr><td>isCountDown</td><td>是</td><td>是</td><td>boolean</td><td>否</td><td>是否显示倒计时时间。</td></tr><tr><td>isFloatingIcon</td><td>是</td><td>是</td><td>boolean</td><td>否</td><td>是否显示状态栏图标。</td></tr><tr><td>label</td><td>是</td><td>是</td><td>string</td><td>否</td><td>通知标签。</td></tr><tr><td>badgeIconStyle</td><td>是</td><td>是</td><td>number</td><td>否</td><td>通知角标类型。</td></tr><tr><td>showDeliveryTime</td><td>是</td><td>是</td><td>boolean</td><td>否</td><td>是否显示分发时间。</td></tr><tr><td>actionButtons</td><td>是</td><td>是</td><td>Array&lt;
<a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V3/js-apis-notification-0000001333321097-V3#ZH-CN_TOPIC_0000001333321097__notificationactionbutton target=_blank>NotificationActionButton</a>></td><td>否</td><td>通知按钮，最多两个按钮。</td></tr><tr><td>smallIcon</td><td>是</td><td>是</td><td>PixelMap</td><td>否</td><td>通知小图标。</td></tr><tr><td>largeIcon</td><td>是</td><td>是</td><td>PixelMap</td><td>否</td><td>通知大图标。</td></tr><tr><td>creatorBundleName</td><td>是</td><td>否</td><td>string</td><td>否</td><td>创建通知的包名。</td></tr><tr><td>creatorUid</td><td>是</td><td>否</td><td>number</td><td>否</td><td>创建通知的UID。</td></tr><tr><td>creatorPid</td><td>是</td><td>否</td><td>number</td><td>否</td><td>创建通知的PID。</td></tr><tr><td>creatorUserId8+</td><td>是</td><td>否</td><td>number</td><td>否</td><td>创建通知的UserId。</td></tr><tr><td>hashCode</td><td>是</td><td>否</td><td>string</td><td>否</td><td>通知唯一标识。</td></tr><tr><td>groupName8+</td><td>是</td><td>是</td><td>string</td><td>否</td><td>组通知名称。</td></tr><tr><td>template8+</td><td>是</td><td>是</td><td><a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V3/js-apis-notification-0000001333321097-V3#ZH-CN_TOPIC_0000001333321097__notificationtemplate8 target=_blank>NotificationTemplate</a></td><td>否</td><td>通知模板。</td></tr><tr><td>distributedOption8+</td><td>是</td><td>是</td><td><a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V3/js-apis-notification-0000001333321097-V3#ZH-CN_TOPIC_0000001333321097__distributedoptions8 target=_blank>DistributedOptions</a></td><td>否</td><td>分布式通知的选项。</td></tr><tr><td>notificationFlags8+</td><td>是</td><td>否</td><td><a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V3/js-apis-notification-0000001333321097-V3#ZH-CN_TOPIC_0000001333321097__notificationflags8 target=_blank>NotificationFlags</a></td><td>否</td><td>获取NotificationFlags。</td></tr></tbody></table><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202405062132587.png><img src=https://qiniu.waite.wang/202405062132587.png alt=image-20240506213240105></a></div></p><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202405062234933.png><img src=https://qiniu.waite.wang/202405062234933.png alt=image-20240506223426686></a></div></p><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202405062234804.png><img src=https://qiniu.waite.wang/202405062234804.png alt=image-20240506223438334></a></div></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-tsx data-lang=tsx><span class=line><span class=cl><span class=kr>import</span> <span class=nx>notify</span> <span class=kr>from</span> <span class=s1>&#39;@ohos.notificationManager&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>image</span> <span class=kr>from</span> <span class=s1>&#39;@ohos.multimedia.image&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>@Entry</span>
</span></span><span class=line><span class=cl><span class=kd>@Component</span>
</span></span><span class=line><span class=cl><span class=nx>struct</span> <span class=nx>Index</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 全局任务 id
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>idx</span>: <span class=kt>number</span> <span class=o>=</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 图像
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>pixel</span>: <span class=kt>PixelMap</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>aboutToAppear() {</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 获取资源管理器
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>let</span> <span class=nx>rm</span> <span class=o>=</span> <span class=nx>getContext</span><span class=p>(</span><span class=k>this</span><span class=p>).</span><span class=nx>resourceManager</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 读取图片
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>let</span> <span class=nx>file</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>rm</span><span class=p>.</span><span class=nx>getMediaContent</span><span class=p>(</span><span class=nx>$r</span><span class=p>(</span><span class=s1>&#39;app.media.watchGT4&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 创建 PixelMap
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>image</span><span class=p>.</span><span class=nx>createImageSource</span><span class=p>(</span><span class=nx>file</span><span class=p>.</span><span class=nx>buffer</span><span class=p>).</span><span class=nx>createPixelMap</span><span class=p>()</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>value</span> <span class=o>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>pixel</span> <span class=o>=</span> <span class=nx>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=nx>reason</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>reason</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>build() {</span>
</span></span><span class=line><span class=cl>    <span class=nx>Column</span><span class=p>({</span> <span class=nx>space</span>: <span class=kt>10</span> <span class=p>})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>Button</span><span class=p>(</span><span class=sb>`发送normalText通知`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>onClick</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>publishNormalTextNotification</span><span class=p>())</span>
</span></span><span class=line><span class=cl>      <span class=nx>Button</span><span class=p>(</span><span class=sb>`发送longText通知`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>onClick</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>publishLongTextNotification</span><span class=p>())</span>
</span></span><span class=line><span class=cl>      <span class=nx>Button</span><span class=p>(</span><span class=sb>`发送multiLine通知`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>onClick</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>publishMultiLineNotification</span><span class=p>())</span>
</span></span><span class=line><span class=cl>      <span class=nx>Button</span><span class=p>(</span><span class=sb>`发送Picture通知`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>onClick</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>publishPictureNotification</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>width</span><span class=p>(</span><span class=s1>&#39;100%&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>publishNormalTextNotification() {</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>request</span>: <span class=kt>notify.NotificationRequest</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>id</span>: <span class=kt>this.idx</span><span class=o>++</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>content</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>contentType</span>: <span class=kt>notify.ContentType.NOTIFICATION_CONTENT_BASIC_TEXT</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>normal</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>title</span><span class=o>:</span> <span class=s1>&#39;通知标题&#39;</span> <span class=o>+</span> <span class=k>this</span><span class=p>.</span><span class=nx>idx</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>text</span><span class=o>:</span> <span class=s1>&#39;通知内容详情&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>additionalText</span><span class=o>:</span> <span class=s1>&#39;通知附加内容&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nx>showDeliveryTime</span>: <span class=kt>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>deliveryTime</span>: <span class=kt>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>getTime</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>      <span class=nx>groupName</span><span class=o>:</span> <span class=s1>&#39;wechat&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>slotType</span>: <span class=kt>notify.SlotType.SOCIAL_COMMUNICATION</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span><span class=nx>request</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>publishLongTextNotification() {</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>request</span>: <span class=kt>notify.NotificationRequest</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>id</span>: <span class=kt>this.idx</span><span class=o>++</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>content</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>contentType</span>: <span class=kt>notify.ContentType.NOTIFICATION_CONTENT_LONG_TEXT</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>longText</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>title</span><span class=o>:</span> <span class=s1>&#39;通知标题&#39;</span> <span class=o>+</span> <span class=k>this</span><span class=p>.</span><span class=nx>idx</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>text</span><span class=o>:</span> <span class=s1>&#39;通知内容详情&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>additionalText</span><span class=o>:</span> <span class=s1>&#39;通知附加内容&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>longText</span><span class=o>:</span> <span class=s1>&#39;通知中的长文本，我很长，我很长，我很长，我很长，我很长，我很长，我很长&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>briefText</span><span class=o>:</span> <span class=s1>&#39;通知概要和总结&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>expandedTitle</span><span class=o>:</span> <span class=s1>&#39;通知展开时的标题&#39;</span> <span class=o>+</span> <span class=k>this</span><span class=p>.</span><span class=nx>idx</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span><span class=nx>request</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>publishMultiLineNotification() {</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>request</span>: <span class=kt>notify.NotificationRequest</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>id</span>: <span class=kt>this.idx</span><span class=o>++</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>content</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>contentType</span>: <span class=kt>notify.ContentType.NOTIFICATION_CONTENT_MULTILINE</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>multiLine</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>title</span><span class=o>:</span> <span class=s1>&#39;通知标题&#39;</span> <span class=o>+</span> <span class=k>this</span><span class=p>.</span><span class=nx>idx</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>text</span><span class=o>:</span> <span class=s1>&#39;通知内容详情&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>additionalText</span><span class=o>:</span> <span class=s1>&#39;通知附加内容&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>briefText</span><span class=o>:</span> <span class=s1>&#39;通知概要和总结&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>longTitle</span><span class=o>:</span> <span class=s1>&#39;展开时的标题，我很宽，我很宽，我很宽&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>lines</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;第一行&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;第二行&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;第三行&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;第四行&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span><span class=nx>request</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>publishPictureNotification() {</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>request</span>: <span class=kt>notify.NotificationRequest</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>id</span>: <span class=kt>this.idx</span><span class=o>++</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>content</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>contentType</span>: <span class=kt>notify.ContentType.NOTIFICATION_CONTENT_PICTURE</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>picture</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>title</span><span class=o>:</span> <span class=s1>&#39;通知标题&#39;</span> <span class=o>+</span> <span class=k>this</span><span class=p>.</span><span class=nx>idx</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>text</span><span class=o>:</span> <span class=s1>&#39;通知内容详情&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>additionalText</span><span class=o>:</span> <span class=s1>&#39;通知附加内容&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>briefText</span><span class=o>:</span> <span class=s1>&#39;通知概要和总结&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>expandedTitle</span><span class=o>:</span> <span class=s1>&#39;展开后标题&#39;</span> <span class=o>+</span> <span class=k>this</span><span class=p>.</span><span class=nx>idx</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>picture</span>: <span class=kt>this.pixel</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span><span class=nx>request</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>private</span> <span class=nx>publish</span><span class=p>(</span><span class=nx>request</span>: <span class=kt>notify.NotificationRequest</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>notify</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span><span class=nx>request</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>then</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;notify test&#39;</span><span class=p>,</span> <span class=s1>&#39;发送通知成功&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>reason</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;notify test&#39;</span><span class=p>,</span> <span class=s1>&#39;发送通知失败&#39;</span><span class=p>,</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>reason</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=进度条通知>进度条通知<a hidden class=anchor aria-hidden=true href=#进度条通知>#</a></h3><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202405070825635.png><img src=https://qiniu.waite.wang/202405070825635.png alt=image-20240507082507831></a></div></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-tsx data-lang=tsx><span class=line><span class=cl><span class=kr>import</span> <span class=nx>Notification</span> <span class=kr>from</span> <span class=s1>&#39;@ohos.notificationManager&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>wantAgent</span><span class=p>,</span> <span class=p>{</span> <span class=nx>WantAgent</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;@ohos.app.ability.wantAgent&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>promptAction</span> <span class=kr>from</span> <span class=s1>&#39;@ohos.promptAction&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>Prompt</span> <span class=kr>from</span> <span class=s1>&#39;@system.prompt&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>enum</span> <span class=nx>DownloadState</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>NOT_BEGIN</span> <span class=o>=</span> <span class=s1>&#39;未开始&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>DOWNLOADING</span> <span class=o>=</span> <span class=s1>&#39;下载中&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>PAUSE</span> <span class=o>=</span> <span class=s1>&#39;已暂停&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>FINISHED</span> <span class=o>=</span> <span class=s1>&#39;已完成&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>@Entry</span>
</span></span><span class=line><span class=cl><span class=kd>@Component</span>
</span></span><span class=line><span class=cl><span class=nx>struct</span> <span class=nx>Index</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 下载进度
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kd>@State</span> <span class=nx>progressValue</span>: <span class=kt>number</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>  <span class=nx>progressMaxValue</span>: <span class=kt>number</span> <span class=o>=</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 任务状态
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kd>@State</span> <span class=nx>state</span>: <span class=kt>DownloadState</span> <span class=o>=</span> <span class=nx>DownloadState</span><span class=p>.</span><span class=nx>NOT_BEGIN</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 下载的文件名
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>filename</span>: <span class=kt>string</span> <span class=o>=</span> <span class=s1>&#39;圣诞星.mp4&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 模拟下载的任务的id
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>taskId</span>: <span class=kt>number</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 通知id
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>notificationId</span>: <span class=kt>number</span> <span class=o>=</span> <span class=mi>999</span>
</span></span><span class=line><span class=cl>  <span class=nx>isSupport</span>: <span class=kt>boolean</span> <span class=o>=</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>  <span class=nx>wantAgentInstance</span>: <span class=kt>WantAgent</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>aboutToAppear() {</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 1.判断当前系统是否支持进度条模板
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>this</span><span class=p>.</span><span class=nx>isSupport</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>Notification</span><span class=p>.</span><span class=nx>isSupportTemplate</span><span class=p>(</span><span class=s1>&#39;downloadTemplate&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 2.创建拉取当前应用的行为意图
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// 2.1.创建wantInfo信息
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>let</span> <span class=nx>wantInfo</span>: <span class=kt>wantAgent.WantAgentInfo</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>wants</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>bundleName</span><span class=o>:</span> <span class=s1>&#39;com.example.myapplication&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>abilityName</span><span class=o>:</span> <span class=s1>&#39;EntryAbility&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nx>requestCode</span>: <span class=kt>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>operationType</span>: <span class=kt>wantAgent.OperationType.START_ABILITY</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>wantAgentFlags</span><span class=o>:</span> <span class=p>[</span><span class=nx>wantAgent</span><span class=p>.</span><span class=nx>WantAgentFlags</span><span class=p>.</span><span class=nx>CONSTANT_FLAG</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 2.2.创建wantAgent实例
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>this</span><span class=p>.</span><span class=nx>wantAgentInstance</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>wantAgent</span><span class=p>.</span><span class=nx>getWantAgent</span><span class=p>(</span><span class=nx>wantInfo</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>build() {</span>
</span></span><span class=line><span class=cl>    <span class=nx>Row</span><span class=p>({</span> <span class=nx>space</span>: <span class=kt>10</span> <span class=p>})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>Image</span><span class=p>(</span><span class=nx>$r</span><span class=p>(</span><span class=s1>&#39;app.media.ic_files_video&#39;</span><span class=p>)).</span><span class=nx>width</span><span class=p>(</span><span class=mi>50</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=nx>Column</span><span class=p>({</span> <span class=nx>space</span>: <span class=kt>5</span> <span class=p>})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>Row() {</span>
</span></span><span class=line><span class=cl>          <span class=nx>Text</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>filename</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=nx>Text</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>progressValue</span><span class=si>}</span><span class=sb>%`</span><span class=p>).</span><span class=nx>fontColor</span><span class=p>(</span><span class=s1>&#39;#c1c2c1&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>width</span><span class=p>(</span><span class=s1>&#39;100%&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>justifyContent</span><span class=p>(</span><span class=nx>FlexAlign</span><span class=p>.</span><span class=nx>SpaceBetween</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nx>Progress</span><span class=p>({</span>
</span></span><span class=line><span class=cl>          <span class=nx>value</span>: <span class=kt>this.progressValue</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>total</span>: <span class=kt>this.progressMaxValue</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nx>Row</span><span class=p>({</span> <span class=nx>space</span>: <span class=kt>5</span> <span class=p>})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>Text</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>progressValue</span> <span class=o>*</span> <span class=mf>0.43</span><span class=p>).</span><span class=nx>toFixed</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span><span class=si>}</span><span class=sb>MB`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=nx>fontSize</span><span class=p>(</span><span class=mi>14</span><span class=p>).</span><span class=nx>fontColor</span><span class=p>(</span><span class=s1>&#39;#c1c2c1&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=nx>Blank</span><span class=p>()</span>
</span></span><span class=line><span class=cl>          <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>state</span> <span class=o>===</span> <span class=nx>DownloadState</span><span class=p>.</span><span class=nx>NOT_BEGIN</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>Button</span><span class=p>(</span><span class=s1>&#39;开始&#39;</span><span class=p>).</span><span class=nx>downloadButton</span><span class=p>()</span>
</span></span><span class=line><span class=cl>              <span class=p>.</span><span class=nx>onClick</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>download</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>          <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>state</span> <span class=o>===</span> <span class=nx>DownloadState</span><span class=p>.</span><span class=nx>DOWNLOADING</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>Button</span><span class=p>(</span><span class=s1>&#39;取消&#39;</span><span class=p>).</span><span class=nx>downloadButton</span><span class=p>().</span><span class=nx>backgroundColor</span><span class=p>(</span><span class=s1>&#39;#d1d2d3&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>              <span class=p>.</span><span class=nx>onClick</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>cancel</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=nx>Button</span><span class=p>(</span><span class=s1>&#39;暂停&#39;</span><span class=p>).</span><span class=nx>downloadButton</span><span class=p>()</span>
</span></span><span class=line><span class=cl>              <span class=p>.</span><span class=nx>onClick</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>pause</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>          <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>state</span> <span class=o>===</span> <span class=nx>DownloadState</span><span class=p>.</span><span class=nx>PAUSE</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>Button</span><span class=p>(</span><span class=s1>&#39;取消&#39;</span><span class=p>).</span><span class=nx>downloadButton</span><span class=p>().</span><span class=nx>backgroundColor</span><span class=p>(</span><span class=s1>&#39;#d1d2d3&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>              <span class=p>.</span><span class=nx>onClick</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>cancel</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=nx>Button</span><span class=p>(</span><span class=s1>&#39;继续&#39;</span><span class=p>).</span><span class=nx>downloadButton</span><span class=p>()</span>
</span></span><span class=line><span class=cl>              <span class=p>.</span><span class=nx>onClick</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>download</span><span class=p>())</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>Button</span><span class=p>(</span><span class=s1>&#39;打开&#39;</span><span class=p>).</span><span class=nx>downloadButton</span><span class=p>()</span>
</span></span><span class=line><span class=cl>              <span class=p>.</span><span class=nx>onClick</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>open</span><span class=p>())</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}.</span><span class=nx>width</span><span class=p>(</span><span class=s1>&#39;100%&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>layoutWeight</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>width</span><span class=p>(</span><span class=s1>&#39;100%&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>borderRadius</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>padding</span><span class=p>(</span><span class=mi>15</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>backgroundColor</span><span class=p>(</span><span class=nx>Color</span><span class=p>.</span><span class=nx>White</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>cancel() {</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 取消定时任务
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>taskId</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>clearInterval</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>taskId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>taskId</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>notificationId</span><span class=p>.</span><span class=nx>toString</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 清理下载任务进度
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>this</span><span class=p>.</span><span class=nx>progressValue</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 标记任务状态：未开始
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>this</span><span class=p>.</span><span class=nx>state</span> <span class=o>=</span> <span class=nx>DownloadState</span><span class=p>.</span><span class=nx>NOT_BEGIN</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 取消通知
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>Notification</span><span class=p>.</span><span class=nx>cancel</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>notificationId</span><span class=p>).</span><span class=nx>then</span><span class=p>((</span><span class=nx>response</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;ssssss&#39;</span><span class=p>,</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>response</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>download() {</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 清理旧任务
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>taskId</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>clearInterval</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>taskId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 开启定时任务，模拟下载
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>this</span><span class=p>.</span><span class=nx>taskId</span> <span class=o>=</span> <span class=nx>setInterval</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 判断任务进度是否达到100
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>progressValue</span> <span class=o>&gt;=</span> <span class=mi>100</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 任务完成了，应该取消定时任务
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>clearInterval</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>taskId</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>taskId</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 并且标记任务状态为已完成
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>this</span><span class=p>.</span><span class=nx>state</span> <span class=o>=</span> <span class=nx>DownloadState</span><span class=p>.</span><span class=nx>FINISHED</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 发送通知
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>this</span><span class=p>.</span><span class=nx>publishProgressNotification</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 模拟任务进度变更
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>this</span><span class=p>.</span><span class=nx>progressValue</span> <span class=o>+=</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 发送通知
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>this</span><span class=p>.</span><span class=nx>publishProgressNotification</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span> <span class=mi>500</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 标记任务状态：下载中
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>this</span><span class=p>.</span><span class=nx>state</span> <span class=o>=</span> <span class=nx>DownloadState</span><span class=p>.</span><span class=nx>DOWNLOADING</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>pause() {</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 取消定时任务
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>taskId</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>clearInterval</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>taskId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>taskId</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 标记任务状态：已暂停
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>this</span><span class=p>.</span><span class=nx>state</span> <span class=o>=</span> <span class=nx>DownloadState</span><span class=p>.</span><span class=nx>PAUSE</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 发送通知
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>this</span><span class=p>.</span><span class=nx>publishProgressNotification</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>open() {</span>
</span></span><span class=line><span class=cl>    <span class=nx>promptAction</span><span class=p>.</span><span class=nx>showToast</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;功能未实现&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>publishProgressNotification() {</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>isSupportTpl</span>: <span class=kt>boolean</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>await</span> <span class=nx>Notification</span><span class=p>.</span><span class=nx>isSupportTemplate</span><span class=p>(</span><span class=s1>&#39;downloadTemplate&#39;</span><span class=p>).</span><span class=nx>then</span><span class=p>((</span><span class=nx>data</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>isSupportTpl</span> <span class=o>=</span> <span class=nx>data</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}).</span><span class=k>catch</span><span class=p>((</span><span class=nx>err</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>Prompt</span><span class=p>.</span><span class=nx>showToast</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>message</span><span class=o>:</span> <span class=sb>`判断是否支持进度条模板时报错,error[</span><span class=si>${</span><span class=nx>err</span><span class=si>}</span><span class=sb>]`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>duration</span>: <span class=kt>2000</span>
</span></span><span class=line><span class=cl>      <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>isSupportTpl</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 构造模板
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kd>let</span> <span class=nx>template</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;downloadTemplate&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>data</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>progressValue</span>: <span class=kt>this.progressValue</span><span class=p>,</span> <span class=c1>// 当前进度值
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=nx>progressMaxValue</span>: <span class=kt>this.progressMaxValue</span> <span class=c1>// 最大进度值
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=kd>let</span> <span class=nx>notificationRequest</span>: <span class=kt>Notification.NotificationRequest</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>id</span>: <span class=kt>this.notificationId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>content</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>contentType</span>: <span class=kt>Notification.ContentType.NOTIFICATION_CONTENT_BASIC_TEXT</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>normal</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>title</span>: <span class=kt>this.filename</span> <span class=o>+</span> <span class=s1>&#39;:  &#39;</span> <span class=o>+</span> <span class=k>this</span><span class=p>.</span><span class=nx>state</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>text</span><span class=o>:</span> <span class=s1>&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>additionalText</span>: <span class=kt>this.progressValue</span> <span class=o>+</span> <span class=s1>&#39;%&#39;</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=nx>template</span>: <span class=kt>template</span>
</span></span><span class=line><span class=cl>      <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=c1>// 发布通知
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>Notification</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span><span class=nx>notificationRequest</span><span class=p>).</span><span class=nx>then</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>Prompt</span><span class=p>.</span><span class=nx>showToast</span><span class=p>({</span>
</span></span><span class=line><span class=cl>          <span class=nx>message</span><span class=o>:</span> <span class=sb>`发布通知成功！`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>duration</span>: <span class=kt>2000</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>      <span class=p>}).</span><span class=k>catch</span><span class=p>((</span><span class=nx>err</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>Prompt</span><span class=p>.</span><span class=nx>showToast</span><span class=p>({</span>
</span></span><span class=line><span class=cl>          <span class=nx>message</span><span class=o>:</span> <span class=sb>`发布通知失败,error[</span><span class=si>${</span><span class=nx>err</span><span class=si>}</span><span class=sb>]`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>duration</span>: <span class=kt>2000</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>      <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>Prompt</span><span class=p>.</span><span class=nx>showToast</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;不支持downloadTemplate进度条通知模板&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>duration</span>: <span class=kt>2000</span>
</span></span><span class=line><span class=cl>      <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>publishDownloadNotification() {</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 1.判断当前系统是否支持进度条模板
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=k>this</span><span class=p>.</span><span class=nx>isSupport</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 当前系统不支持进度条模板
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;not support&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 2.准备进度条模板的参数
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>let</span> <span class=nx>template</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;downloadTemplate&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>data</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>progressValue</span>: <span class=kt>this.progressValue</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>progressMaxValue</span>: <span class=kt>this.progressMaxValue</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>request</span>: <span class=kt>Notification.NotificationRequest</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>id</span>: <span class=kt>this.notificationId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>template</span>: <span class=kt>template</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>wantAgent</span>: <span class=kt>this.wantAgentInstance</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>content</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>contentType</span>: <span class=kt>Notification.ContentType.NOTIFICATION_CONTENT_BASIC_TEXT</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>normal</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>title</span>: <span class=kt>this.filename</span> <span class=o>+</span> <span class=s1>&#39;:  &#39;</span> <span class=o>+</span> <span class=k>this</span><span class=p>.</span><span class=nx>state</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>text</span><span class=o>:</span> <span class=s1>&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>additionalText</span>: <span class=kt>this.progressValue</span> <span class=o>+</span> <span class=s1>&#39;%&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 3.发送通知
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>Notification</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span><span class=nx>request</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>then</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;test&#39;</span><span class=p>,</span> <span class=s1>&#39;通知发送成功&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=nx>reason</span> <span class=o>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;test&#39;</span><span class=p>,</span> <span class=s1>&#39;通知发送失败！&#39;</span><span class=p>,</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>reason</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>@Extend</span><span class=p>(</span><span class=nx>Button</span><span class=p>)</span> <span class=kd>function</span> <span class=nx>downloadButton() {</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>width</span><span class=p>(</span><span class=mi>75</span><span class=p>).</span><span class=nx>height</span><span class=p>(</span><span class=mi>28</span><span class=p>).</span><span class=nx>fontSize</span><span class=p>(</span><span class=mi>14</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=通知意图>通知意图<a hidden class=anchor aria-hidden=true href=#通知意图>#</a></h3><blockquote><p>具体参数看官方文档</p></blockquote><p><a href=https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V2/js-apis-app-ability-wantagent-0000001493424324-V2 target=_blank>https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V2/js-apis-app-ability-wantagent-0000001493424324-V2</a></p><p>​<div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202405070915916.png><img src=https://qiniu.waite.wang/202405070915916.png alt=image-20240507091512134></a></div></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-tsx data-lang=tsx><span class=line><span class=cl><span class=kr>async</span> <span class=nx>aboutToAppear() {</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 1.判断当前系统是否支持进度条模板
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>this</span><span class=p>.</span><span class=nx>isSupport</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>Notification</span><span class=p>.</span><span class=nx>isSupportTemplate</span><span class=p>(</span><span class=s1>&#39;downloadTemplate&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 2.创建拉取当前应用的行为意图
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// 2.1.创建wantInfo信息
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kd>let</span> <span class=nx>wantInfo</span>: <span class=kt>wantAgent.WantAgentInfo</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>wants</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>bundleName</span><span class=o>:</span> <span class=s1>&#39;com.example.learn_2&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>abilityName</span><span class=o>:</span> <span class=s1>&#39;EntryAbility&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=nx>requestCode</span>: <span class=kt>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>operationType</span>: <span class=kt>wantAgent.OperationType.START_ABILITY</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>wantAgentFlags</span><span class=o>:</span> <span class=p>[</span><span class=nx>wantAgent</span><span class=p>.</span><span class=nx>WantAgentFlags</span><span class=p>.</span><span class=nx>CONSTANT_FLAG</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 2.2.创建wantAgent实例
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>this</span><span class=p>.</span><span class=nx>wantAgentInstance</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>wantAgent</span><span class=p>.</span><span class=nx>getWantAgent</span><span class=p>(</span><span class=nx>wantInfo</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-tsx data-lang=tsx><span class=line><span class=cl><span class=kr>async</span> <span class=nx>publishProgressNotification() {</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>isSupportTpl</span>: <span class=kt>boolean</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>await</span> <span class=nx>Notification</span><span class=p>.</span><span class=nx>isSupportTemplate</span><span class=p>(</span><span class=s1>&#39;downloadTemplate&#39;</span><span class=p>).</span><span class=nx>then</span><span class=p>((</span><span class=nx>data</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>isSupportTpl</span> <span class=o>=</span> <span class=nx>data</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}).</span><span class=k>catch</span><span class=p>((</span><span class=nx>err</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>Prompt</span><span class=p>.</span><span class=nx>showToast</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>message</span><span class=o>:</span> <span class=sb>`判断是否支持进度条模板时报错,error[</span><span class=si>${</span><span class=nx>err</span><span class=si>}</span><span class=sb>]`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>duration</span>: <span class=kt>2000</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>isSupportTpl</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 构造模板
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>let</span> <span class=nx>template</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;downloadTemplate&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>data</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>progressValue</span>: <span class=kt>this.progressValue</span><span class=p>,</span> <span class=c1>// 当前进度值
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>progressMaxValue</span>: <span class=kt>this.progressMaxValue</span> <span class=c1>// 最大进度值
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>notificationRequest</span>: <span class=kt>Notification.NotificationRequest</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>id</span>: <span class=kt>this.notificationId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>wantAgent</span>: <span class=kt>this.wantAgentInstance</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>content</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>contentType</span>: <span class=kt>Notification.ContentType.NOTIFICATION_CONTENT_BASIC_TEXT</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>normal</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>title</span>: <span class=kt>this.filename</span> <span class=o>+</span> <span class=s1>&#39;:  &#39;</span> <span class=o>+</span> <span class=k>this</span><span class=p>.</span><span class=nx>state</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>text</span><span class=o>:</span> <span class=s1>&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>additionalText</span>: <span class=kt>this.progressValue</span> <span class=o>+</span> <span class=s1>&#39;%&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nx>template</span>: <span class=kt>template</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 发布通知
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>Notification</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span><span class=nx>notificationRequest</span><span class=p>).</span><span class=nx>then</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>Prompt</span><span class=p>.</span><span class=nx>showToast</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>message</span><span class=o>:</span> <span class=sb>`发布通知成功！`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>duration</span>: <span class=kt>2000</span>
</span></span><span class=line><span class=cl>      <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>}).</span><span class=k>catch</span><span class=p>((</span><span class=nx>err</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>Prompt</span><span class=p>.</span><span class=nx>showToast</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>message</span><span class=o>:</span> <span class=sb>`发布通知失败,error[</span><span class=si>${</span><span class=nx>err</span><span class=si>}</span><span class=sb>]`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>duration</span>: <span class=kt>2000</span>
</span></span><span class=line><span class=cl>      <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>Prompt</span><span class=p>.</span><span class=nx>showToast</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;不支持downloadTemplate进度条通知模板&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>duration</span>: <span class=kt>2000</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://waite.wang/tags/harmony/>Harmony</a></li></ul><nav class=paginav><a class=prev href=https://waite.wang/posts/mini-program/create-uniapp-standard/><span class=title>« 上一页</span><br><span>uniapp+vite+vue3+ts配置eslint代码检查及prettier规范检查</span>
</a><a class=next href=https://waite.wang/posts/harmony/learn-harmony-2/><span class=title>下一页 »</span><br><span>鸿蒙学习笔记2</span></a></nav></footer><script src=https://utteranc.es/client.js repo=Waite0603/HugoBlog issue-term=pathname theme=github-light crossorigin=anonymous async></script></article></main><footer class=footer><span><a href=https://beian.miit.gov.cn/ target=_blank rel="noopener noreferrer">粤 ICP 备 2022028437 号</a></span><br><span>Copyright &copy; 2018 - 2025 By <a href=https://waite.wang/>Waite</a>, All Rights
Reserved.</span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script src=/js/jquery-3.5.1.min.js></script><link rel=stylesheet href=/css/jquery.fancybox.min.css><script src=/js/jquery.fancybox.min.js></script></body></html>