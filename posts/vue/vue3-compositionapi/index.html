<!doctype html><html lang=zh-cn dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Vue3 CompositionAPI | éš¶ç¬”éš¾ä¹¦</title>
<meta name=keywords content="Vue3"><meta name=description content="Options APIçš„å¼Šç«¯


åœ¨Vue2ä¸­ï¼Œæˆ‘ä»¬ç¼–å†™ç»„ä»¶çš„æ–¹å¼æ˜¯Options APIï¼š

Options APIçš„ä¸€å¤§ç‰¹ç‚¹å°±æ˜¯åœ¨å¯¹åº”çš„å±æ€§ä¸­ç¼–å†™å¯¹åº”çš„åŠŸèƒ½æ¨¡å—ï¼›
æ¯”å¦‚dataå®šä¹‰æ•°æ®ã€methodsä¸­å®šä¹‰æ–¹æ³•ã€computedä¸­å®šä¹‰è®¡ç®—å±æ€§ã€watchä¸­ç›‘å¬å±æ€§æ”¹å˜ï¼Œä¹ŸåŒ…æ‹¬ç”Ÿå‘½ å‘¨æœŸé’©å­ï¼›



ä½†æ˜¯è¿™ç§ä»£ç æœ‰ä¸€ä¸ªå¾ˆå¤§çš„å¼Šç«¯ï¼š"><meta name=author content><link rel=canonical href=https://waite.wang/posts/vue/vue3-compositionapi/><link crossorigin=anonymous href=/assets/css/stylesheet.3d97af64455e262976bc8963ce1a2382d14e8c2788745b1deedf23a8e2ebd65c.css integrity="sha256-PZevZEVeJil2vIljzhojgtFOjCeIdFsd7t8jqOLr1lw=" rel="preload stylesheet" as=style><link rel=icon href=https://waite.wang/images/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://waite.wang/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://waite.wang/favicon-32x32.png><link rel=apple-touch-icon href=https://waite.wang/apple-touch-icon.png><link rel=mask-icon href=https://waite.wang/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh-cn href=https://waite.wang/posts/vue/vue3-compositionapi/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://waite.wang/posts/vue/vue3-compositionapi/"><meta property="og:site_name" content="éš¶ç¬”éš¾ä¹¦"><meta property="og:title" content="Vue3 CompositionAPI"><meta property="og:description" content="Options APIçš„å¼Šç«¯ åœ¨Vue2ä¸­ï¼Œæˆ‘ä»¬ç¼–å†™ç»„ä»¶çš„æ–¹å¼æ˜¯Options APIï¼š
Options APIçš„ä¸€å¤§ç‰¹ç‚¹å°±æ˜¯åœ¨å¯¹åº”çš„å±æ€§ä¸­ç¼–å†™å¯¹åº”çš„åŠŸèƒ½æ¨¡å—ï¼› æ¯”å¦‚dataå®šä¹‰æ•°æ®ã€methodsä¸­å®šä¹‰æ–¹æ³•ã€computedä¸­å®šä¹‰è®¡ç®—å±æ€§ã€watchä¸­ç›‘å¬å±æ€§æ”¹å˜ï¼Œä¹ŸåŒ…æ‹¬ç”Ÿå‘½ å‘¨æœŸé’©å­ï¼› ä½†æ˜¯è¿™ç§ä»£ç æœ‰ä¸€ä¸ªå¾ˆå¤§çš„å¼Šç«¯ï¼š"><meta property="og:locale" content="zh-cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-12-29T16:04:23+08:00"><meta property="article:modified_time" content="2023-12-29T16:04:23+08:00"><meta property="article:tag" content="Vue3"><meta name=twitter:card content="summary"><meta name=twitter:title content="Vue3 CompositionAPI"><meta name=twitter:description content="Options APIçš„å¼Šç«¯


åœ¨Vue2ä¸­ï¼Œæˆ‘ä»¬ç¼–å†™ç»„ä»¶çš„æ–¹å¼æ˜¯Options APIï¼š

Options APIçš„ä¸€å¤§ç‰¹ç‚¹å°±æ˜¯åœ¨å¯¹åº”çš„å±æ€§ä¸­ç¼–å†™å¯¹åº”çš„åŠŸèƒ½æ¨¡å—ï¼›
æ¯”å¦‚dataå®šä¹‰æ•°æ®ã€methodsä¸­å®šä¹‰æ–¹æ³•ã€computedä¸­å®šä¹‰è®¡ç®—å±æ€§ã€watchä¸­ç›‘å¬å±æ€§æ”¹å˜ï¼Œä¹ŸåŒ…æ‹¬ç”Ÿå‘½ å‘¨æœŸé’©å­ï¼›



ä½†æ˜¯è¿™ç§ä»£ç æœ‰ä¸€ä¸ªå¾ˆå¤§çš„å¼Šç«¯ï¼š"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://waite.wang/posts/"},{"@type":"ListItem","position":2,"name":"Vue3 CompositionAPI","item":"https://waite.wang/posts/vue/vue3-compositionapi/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Vue3 CompositionAPI","name":"Vue3 CompositionAPI","description":"Options APIçš„å¼Šç«¯ åœ¨Vue2ä¸­ï¼Œæˆ‘ä»¬ç¼–å†™ç»„ä»¶çš„æ–¹å¼æ˜¯Options APIï¼š\nOptions APIçš„ä¸€å¤§ç‰¹ç‚¹å°±æ˜¯åœ¨å¯¹åº”çš„å±æ€§ä¸­ç¼–å†™å¯¹åº”çš„åŠŸèƒ½æ¨¡å—ï¼› æ¯”å¦‚dataå®šä¹‰æ•°æ®ã€methodsä¸­å®šä¹‰æ–¹æ³•ã€computedä¸­å®šä¹‰è®¡ç®—å±æ€§ã€watchä¸­ç›‘å¬å±æ€§æ”¹å˜ï¼Œä¹ŸåŒ…æ‹¬ç”Ÿå‘½ å‘¨æœŸé’©å­ï¼› ä½†æ˜¯è¿™ç§ä»£ç æœ‰ä¸€ä¸ªå¾ˆå¤§çš„å¼Šç«¯ï¼š\n","keywords":["Vue3"],"articleBody":"Options APIçš„å¼Šç«¯ åœ¨Vue2ä¸­ï¼Œæˆ‘ä»¬ç¼–å†™ç»„ä»¶çš„æ–¹å¼æ˜¯Options APIï¼š\nOptions APIçš„ä¸€å¤§ç‰¹ç‚¹å°±æ˜¯åœ¨å¯¹åº”çš„å±æ€§ä¸­ç¼–å†™å¯¹åº”çš„åŠŸèƒ½æ¨¡å—ï¼› æ¯”å¦‚dataå®šä¹‰æ•°æ®ã€methodsä¸­å®šä¹‰æ–¹æ³•ã€computedä¸­å®šä¹‰è®¡ç®—å±æ€§ã€watchä¸­ç›‘å¬å±æ€§æ”¹å˜ï¼Œä¹ŸåŒ…æ‹¬ç”Ÿå‘½ å‘¨æœŸé’©å­ï¼› ä½†æ˜¯è¿™ç§ä»£ç æœ‰ä¸€ä¸ªå¾ˆå¤§çš„å¼Šç«¯ï¼š\nå½“æˆ‘ä»¬å®ç°æŸä¸€ä¸ªåŠŸèƒ½æ—¶ï¼Œè¿™ä¸ªåŠŸèƒ½å¯¹åº”çš„ä»£ç é€»è¾‘ä¼šè¢«æ‹†åˆ†åˆ°å„ä¸ªå±æ€§ä¸­ï¼› å½“æˆ‘ä»¬ç»„ä»¶å˜å¾—æ›´å¤§ã€æ›´å¤æ‚æ—¶ï¼Œé€»è¾‘å…³æ³¨ç‚¹çš„åˆ—è¡¨å°±ä¼šå¢é•¿ï¼Œé‚£ä¹ˆåŒä¸€ä¸ªåŠŸèƒ½çš„é€»è¾‘å°±ä¼šè¢«æ‹†åˆ†çš„å¾ˆåˆ†æ•£ï¼› å°¤å…¶å¯¹äºé‚£äº›ä¸€å¼€å§‹æ²¡æœ‰ç¼–å†™è¿™äº›ç»„ä»¶çš„äººæ¥è¯´ï¼Œè¿™ä¸ªç»„ä»¶çš„ä»£ç æ˜¯éš¾ä»¥é˜…è¯»å’Œç†è§£çš„ï¼ˆé˜…è¯»ç»„ä»¶çš„å…¶ä»–äººï¼‰ï¼› ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªéå¸¸å¤§çš„ç»„ä»¶ï¼Œå…¶ä¸­çš„é€»è¾‘åŠŸèƒ½æŒ‰ç…§é¢œè‰²è¿›è¡Œäº†åˆ’åˆ†ï¼š\nè¿™ç§ç¢ç‰‡åŒ–çš„ä»£ç ä½¿ç”¨ç†è§£å’Œç»´æŠ¤è¿™ä¸ªå¤æ‚çš„ç»„ä»¶å˜å¾—å¼‚å¸¸å›°éš¾ï¼Œå¹¶ä¸”éšè—äº†æ½œåœ¨çš„é€»è¾‘é—®é¢˜ï¼› å¹¶ä¸”å½“æˆ‘ä»¬å¤„ç†å•ä¸ªé€»è¾‘å…³æ³¨ç‚¹æ—¶ï¼Œéœ€è¦ä¸æ–­çš„è·³åˆ°ç›¸åº”çš„ä»£ç å—ä¸­ï¼› å¦‚æœæˆ‘ä»¬èƒ½å°†åŒä¸€ä¸ªé€»è¾‘å…³æ³¨ ç‚¹ç›¸å…³çš„ä»£ç æ”¶é›†åœ¨ä¸€èµ·ä¼šæ›´ å¥½ã€‚ è¿™å°±æ˜¯Composition APIæƒ³ è¦åšçš„äº‹æƒ…ï¼Œä»¥åŠå¯ä»¥å¸®åŠ©æˆ‘ ä»¬å®Œæˆçš„äº‹æƒ…ã€‚ ä¹Ÿæœ‰äººæŠŠVue Composition APIç®€ç§°ä¸ºVCAã€‚ æˆ‘ä»¬æ— éœ€å†ä¸ºäº†ä¸€ä¸ªé€»è¾‘å…³æ³¨ç‚¹åœ¨ä¸åŒçš„é€‰é¡¹å—é—´æ¥å›æ»šåŠ¨åˆ‡æ¢ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥å¾ˆè½»æ¾åœ°å°†è¿™ä¸€ç»„ä»£ç ç§»åŠ¨åˆ°ä¸€ä¸ªå¤–éƒ¨æ–‡ä»¶ä¸­ï¼Œä¸å†éœ€è¦ä¸ºäº†æŠ½è±¡è€Œé‡æ–°ç»„ç»‡ä»£ç ï¼Œå¤§å¤§é™ä½äº†é‡æ„æˆæœ¬ï¼Œè¿™åœ¨é•¿æœŸç»´æŠ¤çš„å¤§å‹é¡¹ç›®ä¸­éå¸¸å…³é”®ã€‚ è®¤è¯† ç»„åˆå¼ API (Composition API) https://cn.vuejs.org/guide/extras/composition-api-faq.html#what-is-composition-api\nç»„åˆå¼ API (Composition API) æ˜¯ä¸€ç³»åˆ— API çš„é›†åˆï¼Œä½¿æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‡½æ•°è€Œä¸æ˜¯å£°æ˜é€‰é¡¹çš„æ–¹å¼ä¹¦å†™ Vue ç»„ä»¶ã€‚å®ƒæ˜¯ä¸€ä¸ªæ¦‚æ‹¬æ€§çš„æœ¯è¯­ï¼Œæ¶µç›–äº†ä»¥ä¸‹æ–¹é¢çš„ APIï¼š\nå“åº”å¼ APIï¼šä¾‹å¦‚ ref() å’Œ reactive()ï¼Œä½¿æˆ‘ä»¬å¯ä»¥ç›´æ¥åˆ›å»ºå“åº”å¼çŠ¶æ€ã€è®¡ç®—å±æ€§å’Œä¾¦å¬å™¨ã€‚ ç”Ÿå‘½å‘¨æœŸé’©å­ï¼šä¾‹å¦‚ onMounted() å’Œ onUnmounted()ï¼Œä½¿æˆ‘ä»¬å¯ä»¥åœ¨ç»„ä»¶å„ä¸ªç”Ÿå‘½å‘¨æœŸé˜¶æ®µæ·»åŠ é€»è¾‘ã€‚ ä¾èµ–æ³¨å…¥ï¼šä¾‹å¦‚ provide() å’Œ inject()ï¼Œä½¿æˆ‘ä»¬å¯ä»¥åœ¨ä½¿ç”¨å“åº”å¼ API æ—¶ï¼Œåˆ©ç”¨ Vue çš„ä¾èµ–æ³¨å…¥ç³»ç»Ÿã€‚ ç»„åˆå¼ API æ˜¯ Vue 3 åŠ Vue 2.7 çš„å†…ç½®åŠŸèƒ½ã€‚å¯¹äºæ›´è€çš„ Vue 2 ç‰ˆæœ¬ï¼Œå¯ä»¥ä½¿ç”¨å®˜æ–¹ç»´æŠ¤çš„æ’ä»¶ @vue/composition-apiã€‚åœ¨ Vue 3 ä¸­ï¼Œç»„åˆå¼ API åŸºæœ¬ä¸Šéƒ½ä¼šé…åˆ `` è¯­æ³•åœ¨å•æ–‡ä»¶ç»„ä»¶ä¸­ä½¿ç”¨ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ç»„åˆå¼ API çš„ç»„ä»¶ç¤ºä¾‹ï¼š\n\u003cscript setup\u003e import { ref, onMounted } from 'vue' // å“åº”å¼çŠ¶æ€ const count = ref(0) // æ›´æ”¹çŠ¶æ€ã€è§¦å‘æ›´æ–°çš„å‡½æ•° function increment() { count.value++ } // ç”Ÿå‘½å‘¨æœŸé’©å­ onMounted(() =\u003e { console.log(`è®¡æ•°å™¨åˆå§‹å€¼ä¸º ${count.value}ã€‚`) }) \u003c/script\u003e \u003ctemplate\u003e \u003cbutton @click=\"increment\"\u003eç‚¹å‡»äº†ï¼š{{ count }} æ¬¡\u003c/button\u003e \u003c/template\u003e è™½ç„¶è¿™å¥— API çš„é£æ ¼æ˜¯åŸºäºå‡½æ•°çš„ç»„åˆï¼Œä½†ç»„åˆå¼ API å¹¶ä¸æ˜¯å‡½æ•°å¼ç¼–ç¨‹ã€‚ç»„åˆå¼ API æ˜¯ä»¥ Vue ä¸­æ•°æ®å¯å˜çš„ã€ç»†ç²’åº¦çš„å“åº”æ€§ç³»ç»Ÿä¸ºåŸºç¡€çš„ï¼Œè€Œå‡½æ•°å¼ç¼–ç¨‹é€šå¸¸å¼ºè°ƒæ•°æ®ä¸å¯å˜ã€‚\nsetup() ä»¥ä¸‹çš„ä»£ç  å‡ä¼šé‡‡ç”¨é€‰é¡¹å¼çš„å†™æ³•, ç»„åˆå¼ Api çš„å†™æ³•å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£, ä½†åŸºæœ¬åŸç†å·®ä¸å¤š, è€Œä¸” Vue3 é€‰é¡¹å¼å†™æ³•æ˜¯åŸºäºç»„åˆå¼å†™æ³•äº§ç”Ÿçš„!\nsetup() é’©å­æ˜¯åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ç»„åˆå¼ API çš„å…¥å£ï¼Œé€šå¸¸åªåœ¨ä»¥ä¸‹æƒ…å†µä¸‹ä½¿ç”¨ï¼š\néœ€è¦åœ¨éå•æ–‡ä»¶ç»„ä»¶ä¸­ä½¿ç”¨ç»„åˆå¼ API æ—¶ã€‚ éœ€è¦åœ¨åŸºäºé€‰é¡¹å¼ API çš„ç»„ä»¶ä¸­é›†æˆåŸºäºç»„åˆå¼ API çš„ä»£ç æ—¶ã€‚ setupå‡½æ•°çš„å‚æ•° ä¸»è¦æœ‰ä¸¤ä¸ªå‚æ•°: ç¬¬ä¸€ä¸ªå‚æ•°ï¼šprops ç¬¬äºŒä¸ªå‚æ•°ï¼šcontext setup å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç»„ä»¶çš„ propsã€‚å’Œæ ‡å‡†çš„ç»„ä»¶ä¸€è‡´ï¼Œä¸€ä¸ª setup å‡½æ•°çš„ props æ˜¯å“åº”å¼çš„ï¼Œå¹¶ä¸”ä¼šåœ¨ä¼ å…¥æ–°çš„ props æ—¶åŒæ­¥æ›´æ–°ã€‚ï¼š å¯¹äºå®šä¹‰propsçš„ç±»å‹ï¼Œæˆ‘ä»¬è¿˜æ˜¯å’Œä¹‹å‰çš„è§„åˆ™æ˜¯ä¸€æ ·çš„ï¼Œåœ¨propsé€‰é¡¹ä¸­å®šä¹‰ï¼› å¹¶ä¸”åœ¨templateä¸­ä¾ç„¶æ˜¯å¯ä»¥æ­£å¸¸å»ä½¿ç”¨propsä¸­çš„å±æ€§ï¼Œæ¯”å¦‚messageï¼› å¦‚æœæˆ‘ä»¬åœ¨setupå‡½æ•°ä¸­æƒ³è¦ä½¿ç”¨propsï¼Œé‚£ä¹ˆä¸å¯ä»¥é€šè¿‡ this å»è·å– \u003cscript\u003e import { ref } from 'vue' export default { setup() { const count = ref(0) // è¿”å›å€¼ä¼šæš´éœ²ç»™æ¨¡æ¿å’Œå…¶ä»–çš„é€‰é¡¹å¼ API é’©å­ return { count } }, mounted() { console.log(this.count) // 0 } } \u003c/script\u003e \u003ctemplate\u003e \u003cbutton @click=\"count++\"\u003e{{ count }}\u003c/button\u003e \u003c/template\u003e \u003cscript\u003e export default { props: { message: { type: String, required: true } }, data() { return { counter: 100 } }, setup(props, ....){ ..... } ... } \u003c/script\u003e setup å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç»„ä»¶çš„ propsã€‚å’Œæ ‡å‡†çš„ç»„ä»¶ä¸€è‡´ï¼Œä¸€ä¸ª setup å‡½æ•°çš„ props æ˜¯å“åº”å¼çš„ï¼Œå¹¶ä¸”ä¼šåœ¨ä¼ å…¥æ–°çš„ props æ—¶åŒæ­¥æ›´æ–°ã€‚ export default { props: { title: String }, setup(props) { console.log(props.title) } } è¯·æ³¨æ„å¦‚æœä½ è§£æ„äº† props å¯¹è±¡ï¼Œè§£æ„å‡ºçš„å˜é‡å°†ä¼šä¸¢å¤±å“åº”æ€§ã€‚å› æ­¤æˆ‘ä»¬æ¨èé€šè¿‡ props.xxx çš„å½¢å¼æ¥ä½¿ç”¨å…¶ä¸­çš„ propsã€‚\nå¦‚æœä½ ç¡®å®éœ€è¦è§£æ„ props å¯¹è±¡ï¼Œæˆ–è€…éœ€è¦å°†æŸä¸ª prop ä¼ åˆ°ä¸€ä¸ªå¤–éƒ¨å‡½æ•°ä¸­å¹¶ä¿æŒå“åº”æ€§ï¼Œé‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨ toRefs() å’Œ toRef() è¿™ä¸¤ä¸ªå·¥å…·å‡½æ•°ï¼š\nimport { toRefs, toRef } from 'vue' export default { setup(props) { // å°† `props` è½¬ä¸ºä¸€ä¸ªå…¶ä¸­å…¨æ˜¯ ref çš„å¯¹è±¡ï¼Œç„¶åè§£æ„ const { title } = toRefs(props) // `title` æ˜¯ä¸€ä¸ªè¿½è¸ªç€ `props.title` çš„ ref console.log(title.value) // æˆ–è€…ï¼Œå°† `props` çš„å•ä¸ªå±æ€§è½¬ä¸ºä¸€ä¸ª ref const title = toRef(props, 'title') } } å¦å¤–ä¸€ä¸ªå‚æ•°æ˜¯contextï¼Œæˆ‘ä»¬ä¹Ÿç§°ä¹‹ä¸ºæ˜¯ä¸€ä¸ªSetupContextï¼Œå®ƒé‡Œé¢åŒ…å«ä¸‰ä¸ªå±æ€§ï¼š attrsï¼šæ‰€æœ‰çš„épropçš„attributeï¼› slotsï¼šçˆ¶ç»„ä»¶ä¼ é€’è¿‡æ¥çš„æ’æ§½ï¼ˆè¿™ä¸ªåœ¨ä»¥æ¸²æŸ“å‡½æ•°è¿”å›æ—¶ä¼šæœ‰ä½œç”¨ï¼Œåé¢ä¼šè®²åˆ°ï¼‰ï¼› emitï¼šå½“æˆ‘ä»¬ç»„ä»¶å†…éƒ¨éœ€è¦å‘å‡ºäº‹ä»¶æ—¶ä¼šç”¨åˆ°emitï¼ˆå› ä¸ºæˆ‘ä»¬ä¸èƒ½è®¿é—®thisï¼Œæ‰€ä»¥ä¸å¯ä»¥é€šè¿‡ this.$emitå‘å‡ºäº‹ä»¶ï¼‰ï¼› export default { setup(props, context) { // é€ä¼  Attributesï¼ˆéå“åº”å¼çš„å¯¹è±¡ï¼Œç­‰ä»·äº $attrsï¼‰ console.log(context.attrs) // æ’æ§½ï¼ˆéå“åº”å¼çš„å¯¹è±¡ï¼Œç­‰ä»·äº $slotsï¼‰ console.log(context.slots) // è§¦å‘äº‹ä»¶ï¼ˆå‡½æ•°ï¼Œç­‰ä»·äº $emitï¼‰ console.log(context.emit) // æš´éœ²å…¬å…±å±æ€§ï¼ˆå‡½æ•°ï¼‰ console.log(context.expose) } // è¯¥ä¸Šä¸‹æ–‡å¯¹è±¡æ˜¯éå“åº”å¼çš„ï¼Œå¯ä»¥å®‰å…¨åœ°è§£æ„ï¼š setup(props, {attrs, slots, emit}) { console.log(props.message); console.log(attrs.id, attrs.class); console.log(slots); console.log(emit); } } attrs å’Œ slots éƒ½æ˜¯æœ‰çŠ¶æ€çš„å¯¹è±¡ï¼Œå®ƒä»¬æ€»æ˜¯ä¼šéšç€ç»„ä»¶è‡ªèº«çš„æ›´æ–°è€Œæ›´æ–°ã€‚è¿™æ„å‘³ç€ä½ åº”å½“é¿å…è§£æ„å®ƒä»¬ï¼Œå¹¶å§‹ç»ˆé€šè¿‡ attrs.x æˆ– slots.x çš„å½¢å¼ä½¿ç”¨å…¶ä¸­çš„å±æ€§ã€‚æ­¤å¤–è¿˜éœ€æ³¨æ„ï¼Œå’Œ props ä¸åŒï¼Œattrs å’Œ slots çš„å±æ€§éƒ½ä¸æ˜¯å“åº”å¼çš„ã€‚å¦‚æœä½ æƒ³è¦åŸºäº attrs æˆ– slots çš„æ”¹å˜æ¥æ‰§è¡Œå‰¯ä½œç”¨ï¼Œé‚£ä¹ˆä½ åº”è¯¥åœ¨ onBeforeUpdate ç”Ÿå‘½å‘¨æœŸé’©å­ä¸­ç¼–å†™ç›¸å…³é€»è¾‘ã€‚\nä»£ç ç¤ºä¾‹\n\u003ctemplate\u003e \u003cHelloWorld msg=\"Welcome to Your Vue.js App\" class=\"app-attr\" /\u003e \u003c/template\u003e \u003cscript\u003e import HelloWorld from './components/HelloWorld.vue'; export default { name: 'App', components: { HelloWorld } }; \u003c/script\u003e \u003cstyle\u003e\u003c/style\u003e \u003ctemplate\u003e \u003cdiv class=\"hello\"\u003e {{ msg }} \u003c/div\u003e \u003c/template\u003e \u003cscript\u003e export default { name: 'HelloWorld', // ç»„ä»¶æ¥å—çš„å‚æ•° props: { msg: String }, // å‘å°„çš„äº‹ä»¶è¿™é‡Œå¯ä»¥æ ‡æ³¨ä¸€ä¸‹ emits:['change'], setup(props, context) { // è¿™æ ·å¯ä»¥æ‹¿åˆ°ä¼ é€’è¿‡æ¥çš„msgçš„å€¼ console.log(props.msg); // attrs console.log(context.attrs); // å‘å°„äº‹ä»¶ context.emit('change'); } }; \u003c/script\u003e \u003cstyle scoped\u003e\u003c/style\u003e setupå‡½æ•°çš„è¿”å›å€¼ setup ä¹Ÿå¯ä»¥è¿”å›ä¸€ä¸ª æ¸²æŸ“å‡½æ•°ï¼Œæ­¤æ—¶åœ¨æ¸²æŸ“å‡½æ•°ä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨åœ¨åŒä¸€ä½œç”¨åŸŸä¸‹å£°æ˜çš„å“åº”å¼çŠ¶æ€ï¼š\nimport { h, ref } from 'vue' export default { setup() { const count = ref(0) return () =\u003e h('div', count.value) } } è¿”å›ä¸€ä¸ªæ¸²æŸ“å‡½æ•°å°†ä¼šé˜»æ­¢æˆ‘ä»¬è¿”å›å…¶ä»–ä¸œè¥¿ã€‚å¯¹äºç»„ä»¶å†…éƒ¨æ¥è¯´ï¼Œè¿™æ ·æ²¡æœ‰é—®é¢˜ï¼Œä½†å¦‚æœæˆ‘ä»¬æƒ³é€šè¿‡æ¨¡æ¿å¼•ç”¨å°†è¿™ä¸ªç»„ä»¶çš„æ–¹æ³•æš´éœ²ç»™çˆ¶ç»„ä»¶ï¼Œé‚£å°±æœ‰é—®é¢˜äº†ã€‚\næˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨ expose() è§£å†³è¿™ä¸ªé—®é¢˜ï¼š\nimport { h, ref } from 'vue' export default { setup(props, { expose }) { const count = ref(0) const increment = () =\u003e ++count.value expose({ increment }) return () =\u003e h('div', count.value) } } æ­¤æ—¶çˆ¶ç»„ä»¶å¯ä»¥é€šè¿‡æ¨¡æ¿å¼•ç”¨æ¥è®¿é—®è¿™ä¸ª increment æ–¹æ³•ã€‚\nexport default { props: { message: { type: String, required: true } }, setup() { let counter = 100; // å±€éƒ¨å‡½æ•° const increment = () =\u003e { counter++; console.log(counter); } return { title: \"Hello Home\", counter, increment } } } setupçš„è¿”å›å€¼å¯ä»¥åœ¨æ¨¡æ¿templateä¸­è¢«ä½¿ç”¨ ä¹Ÿå°±æ˜¯è¯´å¯ä»¥é€šè¿‡setupçš„è¿”å›å€¼æ¥æ›¿ä»£dataé€‰é¡¹ æœ€åå¯¼å‡ºçš„ä¸€å®šè¦æ˜¯ä¸ªå¯¹è±¡\n\u003ctemplate\u003e \u003cdiv class=\"hello\"\u003e \u003ch1\u003e{{ count }}\u003c/h1\u003e \u003cbutton @click=\"increment\"\u003e+ 1\u003c/button\u003e \u003c/div\u003e \u003c/template\u003e \u003cscript\u003e export default { name: 'HelloWorld', setup() { // å®šä¹‰æ™®é€šçš„å˜é‡ï¼Œå¯ä»¥è¢«æ­£å¸¸ä½¿ç”¨ // ç¼ºç‚¹ : æ•°æ®ä¸æ˜¯å“åº”å¼çš„ let count = 100; // å®šä¹‰æ–¹æ³• const increment = () =\u003e { count++; console.log(count); }; // å¯¼å‡º return { count, increment }; } }; \u003c/script\u003e \u003cstyle scoped\u003e\u003c/style\u003e å› ä¸ºåªæ˜¯å®šä¹‰äº†ä¸ªå˜é‡ï¼Œç„¶åå¯¼å‡ºäº†ï¼Œå¹¶æ²¡æœ‰ä½¿å®ƒå“åº”å¼\nè¡¥å……: ä¸ºä»€ä¹ˆ setup ä¸èƒ½ä½¿ç”¨ this åœ¨Vue 3ä¸­ï¼Œsetup å‡½æ•°æ˜¯ç”¨æ¥æ›¿ä»£ä»¥å‰çš„ data, computed, methods ç­‰é€‰é¡¹çš„ã€‚setup() è‡ªèº«å¹¶ä¸å«å¯¹ç»„ä»¶å®ä¾‹çš„è®¿é—®æƒï¼Œå³åœ¨ setup() ä¸­è®¿é—® this ä¼šæ˜¯ undefinedã€‚ä½ å¯ä»¥åœ¨é€‰é¡¹å¼ API ä¸­è®¿é—®ç»„åˆå¼ API æš´éœ²çš„å€¼ï¼Œä½†åè¿‡æ¥åˆ™ä¸è¡Œã€‚\nå®šä¹‰å“åº”å¼æ•°æ®çš„ä¸¤ç§æ–¹å¼ Reactive API å¦‚æœæƒ³ä¸ºåœ¨setupä¸­å®šä¹‰çš„æ•°æ®æä¾›å“åº”å¼çš„ç‰¹æ€§ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨reactiveçš„å‡½æ•°\nps : å¦‚æœä¼ å…¥ä¸€ä¸ªåŸºæœ¬æ•°æ®ç±»å‹ï¼ˆStringã€Numberã€Booleanï¼‰ä¼šæŠ¥ä¸€ä¸ªè­¦å‘Š\nåº”ç”¨åœºæ™¯ : reactive APIå¯¹ä¼ å…¥çš„ç±»å‹æ˜¯æœ‰é™åˆ¶çš„ï¼Œå®ƒè¦æ±‚æˆ‘ä»¬å¿…é¡»ä¼ å…¥çš„æ˜¯ä¸€ä¸ªå¯¹è±¡æˆ–è€…æ•°ç»„ç±»å‹ï¼Œæœ€å¥½ç›¸äº’æœ‰å…³è”çš„æ•°æ®æ—¶ä½¿ç”¨\næ¯”å¦‚è¯´æƒ³è¦ä¸Šé¢çš„ä¾‹å­å®ç°å“åº”å¼, æˆ‘ä»¬å¯ä»¥åšå¦‚ä¸‹æ“ä½œ\n\u003ctemplate\u003e \u003cdiv class=\"hello\"\u003e \u003ch1\u003e{{ state.count }}\u003c/h1\u003e \u003cbutton @click=\"increment\"\u003e+ 1\u003c/button\u003e \u003c/div\u003e \u003c/template\u003e \u003cscript\u003e // ä»vueä¸­å¯¼å…¥reactive import { reactive } from 'vue'; export default { name: 'HelloWorld', setup() { // ä½¿ç”¨reactiveï¼Œä¼šè¿”å›ä¸€ä¸ªå“åº”å¼å¯¹è±¡ const state = reactive({ // åœ¨å¯¹è±¡ä¸­ç¼–å†™è‡ªå·±æ‰€éœ€è¦çš„å±æ€§ count: 100 }); const increment = () =\u003e { // è¿™æ ·ä½¿ç”¨ state.count++; console.log(state.count); }; return { // å¯¼å‡ºå“åº”å¼stateå¯¹è±¡ state, increment }; } }; \u003c/script\u003e Reactiveåˆ¤æ–­çš„API isProxy : æ£€æŸ¥å¯¹è±¡æ˜¯å¦æ˜¯ç”± reactive æˆ– readonlyåˆ›å»ºçš„ proxy isReactive : æ£€æŸ¥å¯¹è±¡æ˜¯å¦æ˜¯ç”± reactiveåˆ›å»ºçš„å“åº”å¼ä»£ç†ï¼Œå¦‚æœè¯¥ä»£ç†æ˜¯ readonly å»ºçš„ï¼Œä½†åŒ…è£¹äº†ç”± reactive åˆ›å»ºçš„å¦ä¸€ä¸ªä»£ç†ï¼Œå®ƒä¹Ÿä¼šè¿”å› true isReadonly : æ£€æŸ¥å¯¹è±¡æ˜¯å¦æ˜¯ç”± readonly åˆ›å»ºçš„åªè¯»ä»£ç† toRaw : è¿”å› reactive æˆ– readonly ä»£ç†çš„åŸå§‹å¯¹è±¡ï¼ˆä¸å»ºè®®ä¿ç•™å¯¹åŸå§‹å¯¹è±¡çš„æŒä¹…å¼•ç”¨ã€‚è¯·è°¨æ…ä½¿ç”¨ï¼‰ shallowReactive : åˆ›å»ºä¸€ä¸ªå“åº”å¼ä»£ç†ï¼Œå®ƒè·Ÿè¸ªå…¶è‡ªèº« property çš„å“åº”æ€§ï¼Œä½†ä¸æ‰§è¡ŒåµŒå¥—å¯¹è±¡çš„æ·±å±‚å“åº”å¼è½¬æ¢ (æ·±å±‚è¿˜æ˜¯åŸç”Ÿå¯¹è±¡)ï¼Œåªå“åº”ç¬¬ä¸€å±‚ shallowReadonly : åˆ›å»ºä¸€ä¸ª proxyï¼Œä½¿å…¶è‡ªèº«çš„ property ä¸ºåªè¯»ï¼Œä½†ä¸æ‰§è¡ŒåµŒå¥—å¯¹è±¡çš„æ·±åº¦åªè¯»è½¬æ¢ï¼ˆæ·±å±‚è¿˜æ˜¯å¯è¯»ã€å¯å†™çš„ï¼‰åªæ£€æŸ¥ç¬¬ä¸€å±‚ import { reactive, readonly, isProxy, isReactive, isReadonly, toRaw, shallowReactive, shallowReadonly } from 'vue'; // åˆ›å»ºä¸€ä¸ªå“åº”å¼å¯¹è±¡ const original = { count: 0 }; const obj = reactive(original); // æ£€æŸ¥å¯¹è±¡æ˜¯å¦æ˜¯ä»£ç†å¯¹è±¡ console.log(isProxy(obj)); // true // æ£€æŸ¥å¯¹è±¡æ˜¯å¦æ˜¯ç”± reactive åˆ›å»ºçš„å“åº”å¼ä»£ç† console.log(isReactive(obj)); // true // æ£€æŸ¥å¯¹è±¡æ˜¯å¦æ˜¯ç”± readonly åˆ›å»ºçš„åªè¯»ä»£ç† const ro = readonly(obj); console.log(isReadonly(ro)); // true // è¿”å› reactive æˆ– readonly ä»£ç†çš„åŸå§‹å¯¹è±¡ const rawObj = toRaw(obj); // åˆ›å»ºä¸€ä¸ªæµ…å±‚å“åº”å¼ä»£ç† const shallowObj = shallowReactive({ nested: { count: 0 } }); // åˆ›å»ºä¸€ä¸ªæµ…å±‚åªè¯»ä»£ç† const shallowRo = shallowReadonly({ nested: { count: 0 } }); ä»¥ä¸‹æ˜¯ä¸€äº›åè¯è§£é‡Š:\nä»£ç†å¯¹è±¡ï¼šåœ¨Vue 3ä¸­ï¼Œä»£ç†å¯¹è±¡æ˜¯ç”± reactive æˆ– readonly åˆ›å»ºçš„å¯¹è±¡çš„ä»£ç†ï¼Œç”¨äºè·Ÿè¸ªå¯¹è±¡çš„å±æ€§çš„å˜åŒ–ã€‚ readonlyï¼šreadonly æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºåˆ›å»ºä¸€ä¸ªåªè¯»çš„ä»£ç†å¯¹è±¡ï¼Œè¯¥ä»£ç†å¯¹è±¡åªèƒ½è¯»å–å±æ€§å€¼ï¼Œä¸èƒ½ä¿®æ”¹å±æ€§å€¼ã€‚ æµ…å±‚å“åº”å¼ï¼šæµ…å±‚å“åº”å¼æ˜¯æŒ‡åªæœ‰å¯¹è±¡çš„ç¬¬ä¸€å±‚å±æ€§ä¼šè¢«è®¾ç½®ä¸ºå“åº”å¼ï¼Œè€ŒåµŒå¥—å¯¹è±¡çš„å±æ€§ä¸ä¼šè¢«è®¾ç½®ä¸ºå“åº”å¼ã€‚ æµ…å±‚åªè¯»ä»£ç†ï¼šæµ…å±‚åªè¯»ä»£ç†æ˜¯æŒ‡åªæœ‰å¯¹è±¡çš„ç¬¬ä¸€å±‚å±æ€§ä¼šè¢«è®¾ç½®ä¸ºåªè¯»ï¼Œè€ŒåµŒå¥—å¯¹è±¡çš„å±æ€§ä¸ä¼šè¢«è®¾ç½®ä¸ºåªè¯»ã€‚ import { reactive, readonly, shallowReactive, shallowReadonly } from 'vue'; // åˆ›å»ºä¸€ä¸ªæ™®é€šå¯¹è±¡ const original = { count: 0, nested: { count: 1 } }; // åˆ›å»ºä¸€ä¸ªå“åº”å¼ä»£ç†å¯¹è±¡ const reactiveObj = reactive(original); reactiveObj.count = 1; // å¯ä»¥ä¿®æ”¹å±æ€§å€¼ reactiveObj.nested.count = 2; // åµŒå¥—å¯¹è±¡çš„å±æ€§ä¹Ÿä¼šè¢«è®¾ç½®ä¸ºå“åº”å¼ // åˆ›å»ºä¸€ä¸ªåªè¯»ä»£ç†å¯¹è±¡ const readonlyObj = readonly(original); // readonlyObj.count = 2; // è¯•å›¾ä¿®æ”¹åªè¯»å±æ€§ä¼šæŠ¥é”™ // readonlyObj.nested.count = 2; // åµŒå¥—å¯¹è±¡çš„å±æ€§ä¹Ÿæ˜¯åªè¯»çš„ // åˆ›å»ºä¸€ä¸ªæµ…å±‚å“åº”å¼ä»£ç†å¯¹è±¡ const shallowReactiveObj = shallowReactive(original); shallowReactiveObj.count = 2; // å¯ä»¥ä¿®æ”¹å±æ€§å€¼ shallowReactiveObj.nested.count = 2; // åµŒå¥—å¯¹è±¡çš„å±æ€§ä¸ä¼šè¢«è®¾ç½®ä¸ºå“åº”å¼ // åˆ›å»ºä¸€ä¸ªæµ…å±‚åªè¯»ä»£ç†å¯¹è±¡ const shallowReadonlyObj = shallowReadonly(original); shallowReadonlyObj.count = 2; // è¯•å›¾ä¿®æ”¹åªè¯»å±æ€§ä¼šæŠ¥é”™ shallowReadonlyObj.nested.count = 2; // åµŒå¥—å¯¹è±¡çš„å±æ€§ä¸ä¼šè¢«è®¾ç½®ä¸ºåªè¯» Ref API Refå‡½æ•° : å®šä¹‰ç®€å•ç±»å‹çš„æ•°æ®ï¼Œä¹Ÿå¯ä»¥å®šä¹‰å¤æ‚ç±»å‹çš„æ•°æ®\nåº”ç”¨åœºæ™¯ : å®šä¹‰ä¸€äº›ç®€å•çš„æ•°æ®ï¼Œæˆ–è€…ä»æ¥å£ä¸­è·å¾—çš„æ•°æ®\nref ä¼šè¿”å›ä¸€ä¸ªå¯å˜çš„å“åº”å¼å¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä½œä¸ºä¸€ä¸ª å“åº”å¼çš„å¼•ç”¨ ç»´æŠ¤ç€å®ƒå†…éƒ¨çš„å€¼ï¼Œè¿™å°±æ˜¯refåç§°çš„æ¥æº å®ƒå†…éƒ¨çš„å€¼æ˜¯åœ¨refçš„ value å±æ€§ä¸­è¢«ç»´æŠ¤çš„ ä¸ç®¡ä¼ å…¥çš„æ˜¯åŸºæœ¬ç±»å‹è¿˜æ˜¯å¼•ç”¨ç±»å‹ï¼Œéƒ½æ”¾åœ¨.valueä¸­ ä½¿ç”¨çš„æ—¶å€™æ˜¯ç”¨ .valueï¼Œä½†æ˜¯æœ‰ä¸¤ä¸ªæ³¨æ„äº‹é¡¹:\nåœ¨æ¨¡æ¿ä¸­å¼•å…¥refçš„å€¼æ—¶ï¼ŒVueä¼šè‡ªåŠ¨å¸®åŠ©æˆ‘ä»¬è¿›è¡Œè§£åŒ…æ“ä½œï¼Œæ‰€ä»¥å¹¶ä¸éœ€è¦åœ¨æ¨¡æ¿ä¸­é€šè¿‡ ref.value çš„æ–¹å¼ï¼Œç›´æ¥ä½¿ç”¨å³å¯ åœ¨ setup å‡½æ•°å†…éƒ¨ï¼Œå®ƒä¾ç„¶æ˜¯ä¸€ä¸ª refå¼•ç”¨ï¼Œ æ‰€ä»¥å¯¹å…¶è¿›è¡Œæ“ä½œæ—¶ï¼Œä¾ç„¶éœ€è¦ä½¿ç”¨ ref.valueçš„æ–¹å¼ åŸºæœ¬ä½¿ç”¨ \u003ctemplate\u003e \u003cdiv class=\"hello\"\u003e \u003ch1\u003e{{ count }}\u003c/h1\u003e \u003cbutton @click=\"increment\"\u003e+ 1\u003c/button\u003e \u003c/div\u003e \u003c/template\u003e \u003cscript\u003e // ä»vueä¸­å¯¼å…¥ref import { ref } from 'vue'; export default { name: 'HelloWorld', setup() { // ä½¿ç”¨Refï¼Œä¼šè¿”å›ä¸€ä¸ªå“åº”å¼å¯¹è±¡ let count = ref(100); const increment = () =\u003e { // è¿™æ ·ä½¿ç”¨,éœ€è¦ä½¿ç”¨ .value count.value++; console.log(count.value); }; return { // ç›´æ¥å¯¼å‡ºcountå³å¯ count, increment }; } }; \u003c/script\u003e Refè‡ªåŠ¨è§£åŒ… æ¨¡æ¿ä¸­çš„è§£åŒ…æ˜¯æµ…å±‚çš„è§£åŒ…ï¼Œå¦‚æœæˆ‘ä»¬çš„ä»£ç æ˜¯ä¸‹é¢çš„æ–¹å¼ï¼š å¦‚æœæˆ‘ä»¬å°†refæ”¾åˆ°ä¸€ä¸ªreactiveçš„å±æ€§å½“ä¸­ï¼Œé‚£ä¹ˆåœ¨æ¨¡æ¿ä¸­ä½¿ç”¨æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨è§£åŒ…ï¼š const count = ref(1) const obj = reactive({ count }) // ref ä¼šè¢«è§£åŒ… console.log(obj.count === count.value) // true // ä¼šæ›´æ–° `obj.count` count.value++ console.log(count.value) // 2 console.log(obj.count) // 2 // ä¹Ÿä¼šæ›´æ–° `count` ref obj.count++ console.log(obj.count) // 3 console.log(count.value) // 3 æ³¨æ„å½“è®¿é—®åˆ°æŸä¸ªå“åº”å¼æ•°ç»„æˆ– Map è¿™æ ·çš„åŸç”Ÿé›†åˆç±»å‹ä¸­çš„ ref å…ƒç´ æ—¶ï¼Œä¸ä¼šæ‰§è¡Œ ref çš„è§£åŒ…ï¼š\nconst books = reactive([ref('Vue 3 Guide')]) // è¿™é‡Œéœ€è¦ .value console.log(books[0].value) const map = reactive(new Map([['count', ref(0)]])) // è¿™é‡Œéœ€è¦ .value console.log(map.get('count').value) Refåˆ¤æ–­çš„API isRef : åˆ¤æ–­å€¼æ˜¯å¦æ˜¯ä¸€ä¸ªrefå¯¹è±¡ unref : å¦‚æœæˆ‘ä»¬æƒ³è¦è·å–ä¸€ä¸ªrefå¼•ç”¨ä¸­çš„valueï¼Œé‚£ä¹ˆä¹Ÿå¯ä»¥é€šè¿‡unrefæ–¹æ³• å¦‚æœå‚æ•°æ˜¯ä¸€ä¸ª refï¼Œåˆ™è¿”å›å†…éƒ¨å€¼ï¼Œå¦åˆ™è¿”å›å‚æ•°æœ¬èº« è¿™æ˜¯ val = isRef(val) ? val.value : val çš„è¯­æ³•ç³–å‡½æ•° shallowRefï¼šshallowRef æ˜¯ç”¨æ¥åˆ›å»ºä¸€ä¸ªæµ…å±‚çš„ ref å¯¹è±¡çš„å‡½æ•°ã€‚æµ…å±‚çš„æ„æ€æ˜¯åªæœ‰å¯¹è±¡çš„ç¬¬ä¸€å±‚å±æ€§ä¼šè¢«è®¾ç½®ä¸ºå“åº”å¼ï¼Œè€ŒåµŒå¥—å¯¹è±¡çš„å±æ€§ä¸ä¼šè¢«è®¾ç½®ä¸ºå“åº”å¼ã€‚è¿™æ„å‘³ç€å¯¹åµŒå¥—å¯¹è±¡å±æ€§çš„ä¿®æ”¹ä¸ä¼šè§¦å‘å“åº”ã€‚ triggerRefï¼štriggerRef ç”¨äºæ‰‹åŠ¨è§¦å‘ä¸ shallowRef ç›¸å…³è”çš„å‰¯ä½œç”¨ã€‚å½“ shallowRef å…³è”çš„æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œç›¸å…³çš„å‰¯ä½œç”¨å°†è¢«è§¦å‘æ‰§è¡Œã€‚ import { ref, isRef, unref, shallowRef, triggerRef } from 'vue'; // åˆ¤æ–­å€¼æ˜¯å¦æ˜¯ä¸€ä¸ª ref å¯¹è±¡ const count = ref(0); console.log(isRef(count)); // true // è·å– ref å¼•ç”¨ä¸­çš„å€¼ const value = unref(count); // è¯­æ³•ç³–å‡½æ•°ç¤ºä¾‹ const val = isRef(count) ? count.value : count; // åˆ›å»ºä¸€ä¸ªæµ…å±‚çš„ ref å¯¹è±¡ const shallowCount = shallowRef({ value: 0 }); shallowCount.value = 1; // å¯ä»¥ç›´æ¥ä¿®æ”¹ value å±æ€§ // æ‰‹åŠ¨è§¦å‘ä¸ shallowRef ç›¸å…³è”çš„å‰¯ä½œç”¨ triggerRef(shallowCount); è‡ªå®šä¹‰Ref =\u003e customRef åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„refï¼Œå¹¶å¯¹å…¶ä¾èµ–é¡¹è·Ÿè¸ªå’Œæ›´æ–°è§¦å‘è¿›è¡Œæ˜¾ç¤ºæ§åˆ¶ï¼š å®ƒéœ€è¦ä¸€ä¸ªå·¥å‚å‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥å— track å’Œ trigger å‡½æ•°ä½œä¸ºå‚æ•°ï¼› å¹¶ä¸”åº”è¯¥è¿”å›ä¸€ä¸ªå¸¦æœ‰ get å’Œ set çš„å¯¹è±¡ï¼› è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªçš„æ¡ˆä¾‹ï¼š å¯¹åŒå‘ç»‘å®šçš„å±æ€§è¿›è¡Œdebounce(èŠ‚æµ)çš„æ“ä½œ import { customRef } from 'vue'; // è‡ªå®šä¹‰ref export default function(value, delay = 300) { let timer = null; return customRef((track, trigger) =\u003e { return { get() { track(); return value; }, set(newValue) { clearTimeout(timer); timer = setTimeout(() =\u003e { value = newValue; trigger(); }, delay); } } }) } \u003ctemplate\u003e \u003cdiv\u003e \u003cinput v-model=\"message\"/\u003e \u003ch2\u003e{{message}}\u003c/h2\u003e \u003c/div\u003e \u003c/template\u003e \u003cscript\u003e import debounceRef from './hook/useDebounceRef'; export default { setup() { const message = debounceRef(\"Hello World\"); return { message } } } \u003c/script\u003e readonly æ¦‚å¿µ åœ¨æˆ‘ä»¬ä¼ é€’ç»™å…¶ä»–ç»„ä»¶æ•°æ®æ—¶ï¼Œå¾€å¾€å¸Œæœ›å…¶ä»–ç»„ä»¶ä½¿ç”¨æˆ‘ä»¬ä¼ é€’çš„å†…å®¹ï¼Œä½†æ˜¯ä¸å…è®¸å®ƒä»¬ä¿®æ”¹æ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨ readonlyäº†ï¼›\nåªè¯»ä»£ç†æ˜¯æ·±å±‚çš„ï¼šå¯¹ä»»ä½•åµŒå¥—å±æ€§çš„è®¿é—®éƒ½å°†æ˜¯åªè¯»çš„ã€‚å®ƒçš„ ref è§£åŒ…è¡Œä¸ºä¸ reactive() ç›¸åŒï¼Œä½†è§£åŒ…å¾—åˆ°çš„å€¼æ˜¯åªè¯»çš„ã€‚ è¦é¿å…æ·±å±‚çº§çš„è½¬æ¢è¡Œä¸ºï¼Œè¯·ä½¿ç”¨ shallowReadonly() ä½œæ›¿ä»£ã€‚ åœ¨å¼€å‘ä¸­å¸¸è§çš„readonlyæ–¹æ³•ä¼šä¼ å…¥ä¸‰ä¸ªç±»å‹çš„å‚æ•°ï¼š ç±»å‹ä¸€ï¼šæ™®é€šå¯¹è±¡ ç±»å‹äºŒï¼šreactiveè¿”å›çš„å¯¹è±¡ ç±»å‹ä¸‰ï¼šrefçš„å¯¹è±¡ åœ¨readonlyçš„ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæœ‰å¦‚ä¸‹è§„åˆ™ : readonlyè¿”å›çš„å¯¹è±¡éƒ½æ˜¯ä¸å…è®¸ä¿®æ”¹çš„ ä½†æ˜¯ç»è¿‡readonlyå¤„ç†çš„åŸæ¥çš„å¯¹è±¡æ˜¯å…è®¸è¢«ä¿®æ”¹çš„ æ¯”å¦‚ const info = readonly(obj)ï¼Œinfoå¯¹è±¡æ˜¯ä¸å…è®¸è¢«ä¿®æ”¹çš„ å½“objè¢«ä¿®æ”¹æ—¶ï¼Œreadonlyè¿”å›çš„infoå¯¹è±¡ä¹Ÿä¼šè¢«ä¿®æ”¹ ä½†æ˜¯ä¸èƒ½å»ä¿®æ”¹readonlyè¿”å›çš„å¯¹è±¡info \u003ctemplate\u003e \u003cdiv class=\"hello\"\u003e \u003cbutton @click=\"btnClick\"\u003eæŒ‰é’®\u003c/button\u003e \u003c/div\u003e \u003c/template\u003e \u003cscript setup\u003e import { reactive, readonly, watchEffect } from 'vue' const original = reactive({ count: 0 }) const copy = readonly(original) const btnClick = () =\u003e { original.count++ } watchEffect(() =\u003e { // ç”¨æ¥åšå“åº”æ€§è¿½è¸ª console.log(copy.count) }) // æ›´æ”¹æºå±æ€§ä¼šè§¦å‘å…¶ä¾èµ–çš„ä¾¦å¬å™¨ original.count++ // æ›´æ”¹è¯¥åªè¯»å‰¯æœ¬å°†ä¼šå¤±è´¥ï¼Œå¹¶ä¼šå¾—åˆ°ä¸€ä¸ªè­¦å‘Š copy.count++ // warning! \u003c/script\u003e toRefs \u0026\u0026 toRef toRefs å¦‚æœä½¿ç”¨ES6çš„è§£æ„è¯­æ³•ï¼Œå¯¹reactiveè¿”å›çš„å¯¹è±¡è¿›è¡Œè§£æ„è·å–å€¼ï¼Œé‚£ä¹ˆä¹‹åæ— è®ºæ˜¯ä¿®æ”¹ç»“æ„åçš„å˜é‡ï¼Œè¿˜æ˜¯ä¿®æ”¹reactive è¿”å›çš„stateå¯¹è±¡ï¼Œæ•°æ®éƒ½ä¸å†æ˜¯å“åº”å¼çš„\nå¦‚ä½•æ”¹æˆå“åº”å¼å‘¢ï¼ŒVueæä¾›äº†ä¸€ä¸ªtoRefsçš„å‡½æ•° å¯ä»¥å°†reactiveè¿”å›çš„å¯¹è±¡ä¸­çš„å±æ€§éƒ½è½¬æˆrefï¼Œè¿™æ ·è§£æ„å‡ºæ¥çš„å°±æ˜¯å“åº”å¼çš„äº† \u003ctemplate\u003e \u003cdiv class=\"hello\"\u003e \u003ch1\u003e{{ age }}\u003c/h1\u003e \u003cbutton @click=\"increment\"\u003e+age\u003c/button\u003e \u003c/div\u003e \u003c/template\u003e \u003cscript\u003e // ä»vueä¸­å¯¼å…¥ref import { reactive, ref, readonly, toRefs } from 'vue'; export default { name: 'HelloWorld', setup() { const info = reactive({ name: 'star', age: 18 }); // ä½¿ç”¨toRefsåŒ…è£¹éœ€è¦ç»“æ„çš„reactiveå¯¹è±¡ï¼Œè¿™æ ·è§£æ„å‡ºæ¥çš„å€¼ä¹Ÿæ˜¯å“åº”å¼çš„ let { name, age } = toRefs(info); const increment = () =\u003e { info.age++; // ğŸ‘†è¿™æ ·éƒ½å¯ä»¥ä¿®æ”¹ageï¼Œéƒ½æ˜¯å“åº”å¼çš„ğŸ‘‡ // ç›¸å½“äºå·²ç»å»ºç«‹äº†é“¾æ¥ï¼Œä»»ä½•ä¸€ä¸ªä¿®æ”¹éƒ½ä¼šå¼•èµ·å¦å¤–ä¸€ä¸ªå˜åŒ– age.value++; console.log(age, info.age); }; return { name, age, increment }; } }; \u003c/script\u003e \u003cstyle scoped\u003e\u003c/style\u003e toRef å¦‚æœåªå¸Œæœ›è½¬æ¢reactiveå¯¹è±¡ä¸­çš„å…¶ä¸­æŸä¸ªå±æ€§ä¸ºref, é‚£ä¹ˆå¯ä»¥ä½¿ç”¨toRefçš„æ–¹æ³•\nps : è¿™ä¸ªæ•ˆç‡ä¼šæ›´é«˜ç‚¹, è¿™ç§åšæ³•ç›¸å½“äºå·²ç»åœ¨state.nameå’Œref.valueä¹‹é—´å»ºç«‹äº† é“¾æ¥ï¼Œä»»ä½•ä¸€ä¸ªä¿®æ”¹éƒ½ä¼šå¼•èµ·å¦å¤–ä¸€ä¸ªå˜åŒ–\nlet age = toRef(info, \"age\"); const changeAge = () =\u003e { age.value++; } computed åœ¨å‰é¢çš„Options APIä¸­ï¼Œæˆ‘ä»¬æ˜¯ä½¿ç”¨computedé€‰é¡¹æ¥å®Œæˆçš„ï¼› åœ¨Composition APIä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ setup å‡½æ•°ä¸­ä½¿ç”¨ computed æ–¹æ³•æ¥ç¼–å†™ä¸€ä¸ªè®¡ç®—å±æ€§ï¼› å¦‚ä½•ä½¿ç”¨computedå‘¢ï¼Ÿ æ–¹å¼ä¸€ï¼šæ¥æ”¶ä¸€ä¸ªgetterå‡½æ•°ï¼Œå¹¶ä¸º getter å‡½æ•°è¿”å›çš„å€¼ï¼Œè¿”å›ä¸€ä¸ªä¸å˜çš„ ref å¯¹è±¡ï¼› æ–¹å¼äºŒï¼šæ¥æ”¶ä¸€ä¸ªå…·æœ‰ get å’Œ set çš„å¯¹è±¡ï¼Œè¿”å›ä¸€ä¸ªå¯å˜çš„ï¼ˆå¯è¯»å†™ï¼‰ref å¯¹è±¡ï¼› æ–¹å¼ä¸€ \u003ctemplate\u003e {{ fullName }} {{ scoreState }} \u003c/template\u003e \u003cscript\u003e import { computed, reactive, ref } from 'vue'; export default { name: 'App', setup() { const names = reactive({ firstName: 'coder', lastName: 'star' }); // ç›´æ¥ä½¿ç”¨getterå‡½æ•°ï¼Œæ­£å¸¸æ¥è¯´éƒ½è¿™ä¹ˆä½¿ç”¨ const fullName = computed(() =\u003e names.firstName + names.lastName); const score = ref(88); const scoreState = computed(() =\u003e (score.value \u003e 90 ? 'ä¼˜ç§€' : 'ä¸€èˆ¬')); return { fullName, scoreState }; } }; \u003c/script\u003e æ–¹å¼äºŒ \u003ctemplate\u003e {{ fullName }} \u003cbutton @click=\"changeName\"\u003echange\u003c/button\u003e \u003c/template\u003e \u003cscript\u003e import { computed, reactive } from 'vue'; export default { name: 'App', setup() { const names = reactive({ firstName: 'å†²å•Š', lastName: 'è¿ªè¿¦å¥¥ç‰¹æ›¼' }); // ä¼šè¿”å›ä¸€ä¸ªrefå¯¹è±¡ const fullName = computed({ set(newValue) { const tempNames = newValue.split(' '); names.firstName = tempNames[0]; names.lastName = tempNames[1]; }, get() { return names.firstName + names.lastName; } }); // è®¾ç½®å€¼ const changeName = () =\u003e { fullName.value = fullName.value === 'å†²å•Šè¿ªè¿¦å¥¥ç‰¹æ›¼' ? 'ç¥ç§˜çš„ å®‡å®™äºº' : 'å†²å•Š è¿ªè¿¦å¥¥ç‰¹æ›¼'; }; return { fullName, changeName }; } }; \u003c/script\u003e ç”Ÿå‘½å‘¨æœŸé’©å­ https://cn.vuejs.org/api/composition-api-lifecycle.html\nsetupä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨å¯¼å…¥çš„onXå‡½æ•°æ³¨å†Œç”Ÿå‘½å‘¨æœŸï¼Œå¹¶ä¸”åŒä¸€ä¸ªç”Ÿå‘½å‘¨æœŸå¯ä»¥ä½¿ç”¨å¤šæ¬¡\næ‰€æœ‰ç½—åˆ—åœ¨æœ¬é¡µçš„ API éƒ½åº”è¯¥åœ¨ç»„ä»¶çš„ setup() é˜¶æ®µè¢«åŒæ­¥è°ƒç”¨ã€‚ç›¸å…³ç»†èŠ‚è¯·çœ‹ æŒ‡å— - ç”Ÿå‘½å‘¨æœŸé’©å­ã€‚\nå¯ä»¥ä½¿ç”¨ç›´æ¥å¯¼å…¥çš„ onX å‡½æ•°æ³¨å†Œç”Ÿå‘½å‘¨æœŸé’©å­ï¼› beforeCreateå’Œcreateåœ¨setupä¸­æ²¡æœ‰ç›¸å¯¹åº”çš„onXçš„å‡½æ•° å¦‚æœæƒ³è¦åœ¨beforeCreateå’Œcreateä¸­è¿›è¡Œæ“ä½œ å¯ä»¥æŠŠä»£ç ç›´æ¥å†™å…¥åˆ°setupä¸­ setupçš„æ‰§è¡Œæ—¶åºæ¯”beforeCreateå’Œcreateè¿˜è¦æ—© import { onBeforeMount, onMounted, onBeforeUpdate, onUpdated, onBeforeUnmount, onUnmounted } from 'vue'; // æ³¨å†Œç”Ÿå‘½å‘¨æœŸé’©å­ export default { setup() { onBeforeMount(() =\u003e { console.log('Before Mount'); // ç»„ä»¶æŒ‚è½½å‰ }); onMounted(() =\u003e { console.log('Mounted'); // ç»„ä»¶æŒ‚è½½å }); onBeforeUpdate(() =\u003e { console.log('Before Update'); // ç»„ä»¶æ›´æ–°å‰ }); onUpdated(() =\u003e { console.log('Updated'); // ç»„ä»¶æ›´æ–°å }); onBeforeUnmount(() =\u003e { console.log('Before Unmount'); // ç»„ä»¶å¸è½½å‰ }); onUnmounted(() =\u003e { console.log('Unmounted'); // ç»„ä»¶å¸è½½å }); // åŒä¸€ä¸ªç”Ÿå‘½å‘¨æœŸå¯ä»¥ä½¿ç”¨å¤šæ¬¡ onMounted(() =\u003e { console.log('Another Mounted'); // å¦ä¸€ä¸ªç»„ä»¶æŒ‚è½½å }); return {}; } }; setupä¸­ä½¿ç”¨refè·å–å…ƒç´ æˆ–ç»„ä»¶ è¦å®šä¹‰ä¸€ä¸ªrefå¯¹è±¡ï¼Œç»‘å®šåˆ°å…ƒç´ æˆ–è€…ç»„ä»¶çš„refå±æ€§ä¸Šå³å¯\nåªæœ‰åœ¨æŒ‚è½½å®Œæˆåæ‰èƒ½æ‹¿åˆ°å€¼, æ‰€ä»¥éœ€è¦åœ¨ç”Ÿå‘½å‘¨æœŸä¸­è°ƒç”¨æ‹¿å€¼\nè·å–å…ƒç´  \u003ctemplate\u003e \u003ch2 ref=\"titleRef\"\u003eæˆ‘æ˜¯è¿ªè¿¦\u003c/h2\u003e \u003c/template\u003e \u003cscript\u003e import { onMounted, ref } from 'vue'; export default { name: 'App', setup() { // 2. ç”Ÿæˆrefå¯¹è±¡ const titleRef = ref(); // 4. å¯ä»¥åœ¨ç”Ÿå‘½å‘¨æœŸä¸­è·å–åˆ°å€¼ onMounted(() =\u003e { console.log(titleRef.value); // æˆ‘æ˜¯è¿ªè¿¦ }); return { // 3. è¿”å›å‡ºå»ï¼Œä¼šè‡ªåŠ¨åŒ¹é…åˆ°å¯¹åº”çš„refçš„ titleRef }; } }; \u003c/script\u003e è·å–ç»„ä»¶ \u003ctemplate\u003e \u003cdiv\u003eæˆ‘æ˜¯å­ç»„ä»¶\u003c/div\u003e \u003c/template\u003e \u003cscript\u003e export default { name: 'home-layout', setup() { const showMessage = () =\u003e { console.log('home-layout function exection'); }; return { showMessage }; } }; \u003c/script\u003e \u003ctemplate\u003e \u003chome ref=\"homeCompRef\" /\u003e \u003c/template\u003e \u003cscript\u003e import { onMounted, ref } from 'vue'; import home from './home.vue'; export default { name: 'App', components: { home }, setup() { // 2. ç”Ÿæˆrefå¯¹è±¡ const homeCompRef = ref(); // 4. å¯ä»¥åœ¨ç”Ÿå‘½å‘¨æœŸä¸­è·å–åˆ°å€¼ onMounted(() =\u003e { console.log(homeCompRef.value); // proxyå¯¹è±¡ console.log(homeCompRef.value.$el); // æˆ‘æ˜¯å­ç»„ä»¶ homeCompRef.value.showMessage(); // è°ƒç”¨å­ç»„ä»¶æ–¹æ³• }); return { // 3. è¿”å›å‡ºå»ï¼Œä¼šè‡ªåŠ¨åŒ¹é…åˆ°å¯¹åº”çš„refçš„ homeCompRef }; } }; \u003c/script\u003e ä¾¦å¬æ•°æ®çš„å˜åŒ– åœ¨å‰é¢çš„Options APIä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡watché€‰é¡¹æ¥ä¾¦å¬dataæˆ–è€…propsçš„æ•°æ®å˜åŒ–ï¼Œå½“æ•°æ®å˜åŒ–æ—¶æ‰§è¡ŒæŸä¸€äº› æ“ä½œã€‚\nåœ¨Composition APIä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨watchEffectå’Œwatchæ¥å®Œæˆå“åº”å¼æ•°æ®çš„ä¾¦å¬ï¼›\nwatchEffectç”¨äºè‡ªåŠ¨æ”¶é›†å“åº”å¼æ•°æ®çš„ä¾èµ–ï¼› watchéœ€è¦æ‰‹åŠ¨æŒ‡å®šä¾¦å¬çš„æ•°æ®æºï¼› watchEffect åŸºæœ¬ä½¿ç”¨ è‡ªåŠ¨æ”¶é›†å“åº”å¼æ•°æ®çš„ä¾èµ– watchEffectä¼ å…¥çš„å‡½æ•°ä¼šè¢«ç«‹å³æ‰§è¡Œä¸€æ¬¡ï¼Œå¹¶ä¸”åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ä¼šæ”¶é›†ä¾èµ– åªæœ‰æ”¶é›†çš„ä¾èµ–å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒwatchEffectä¼ å…¥çš„å‡½æ•°æ‰ä¼šå†æ¬¡æ‰§è¡Œ \u003ctemplate\u003e \u003cdiv\u003e \u003ch1\u003e{{ name }} - {{ age }}\u003c/h1\u003e \u003cbutton @click=\"changeName\"\u003echangeName\u003c/button\u003e \u003cbutton @click=\"changeAge\"\u003echangeAge\u003c/button\u003e \u003c/div\u003e \u003c/template\u003e \u003cscript\u003e import { ref, watchEffect } from 'vue'; export default { setup() { let name = ref('star'); let age = ref(18); const changeName = () =\u003e (name.value === 'star' ? (name.value = 'xuanyu') : (name.value = 'star')); const changeAge = () =\u003e age.value++; watchEffect(() =\u003e { // å› ä¸ºè¿™é‡Œåªä½¿ç”¨äº†nameï¼Œæ‰€ä»¥åªä¼šç›‘å¬nameï¼Œå¦‚æœæŠŠageä¹Ÿå†™è¿›æ¥ï¼Œé‚£ä¹ˆä¸¤ä¸ªéƒ½ä¼šç›‘å¬ console.log('name:', name.value); }); return { name, age, changeName, changeAge }; } }; \u003c/script\u003e åœæ­¢ç›‘å¬ å¦‚æœåœ¨å‘ç”ŸæŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›åœæ­¢ä¾¦å¬ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥è·å–watchEffectçš„è¿”å›å€¼å‡½æ•°ï¼Œè°ƒç”¨è¯¥å‡½æ•°å³å¯ã€‚ \u003ctemplate\u003e \u003cdiv\u003e \u003ch1\u003e{{ name }} - {{ age }}\u003c/h1\u003e \u003cbutton @click=\"changeName\"\u003echangeName\u003c/button\u003e \u003cbutton @click=\"changeAge\"\u003echangeAge\u003c/button\u003e \u003c/div\u003e \u003c/template\u003e \u003cscript\u003e import { ref, watchEffect } from 'vue'; export default { setup() { let name = ref('star'); let age = ref(18); const changeName = () =\u003e (name.value === 'star' ? (name.value = 'xuanyu') : (name.value = 'star')); // è·å–è¿”å›å€¼ const stopWatchEffect = watchEffect(() =\u003e { // è‡ªåŠ¨ç›‘å¬age console.log('age:', age.value); }); const changeAge = () =\u003e { age.value++; if (age.value \u003e 22) { // åœæ­¢ç›‘å¬ stopWatchEffect(); } }; return { name, age, changeName, changeAge }; } }; \u003c/script\u003e æ¸…é™¤å‰¯ä½œç”¨ ä»€ä¹ˆæ˜¯æ¸…é™¤å‰¯ä½œç”¨å‘¢ï¼Ÿ æ¯”å¦‚åœ¨å¼€å‘ä¸­æˆ‘ä»¬éœ€è¦åœ¨ä¾¦å¬å‡½æ•°ä¸­æ‰§è¡Œç½‘ç»œè¯·æ±‚ï¼Œä½†æ˜¯åœ¨ç½‘ç»œè¯·æ±‚è¿˜æ²¡æœ‰è¾¾åˆ°çš„æ—¶å€™ï¼Œæˆ‘ä»¬åœæ­¢äº†ä¾¦å¬å™¨ï¼Œ æˆ–è€…ä¾¦å¬å™¨ä¾¦å¬å‡½æ•°è¢«å†æ¬¡æ‰§è¡Œäº† é‚£ä¹ˆä¸Šä¸€æ¬¡çš„ç½‘ç»œè¯·æ±‚åº”è¯¥è¢«å–æ¶ˆæ‰ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥æ¸…é™¤ä¸Šä¸€æ¬¡çš„å‰¯ä½œç”¨ï¼› åœ¨æˆ‘ä»¬ç»™watchEffectä¼ å…¥çš„å‡½æ•°è¢«å›è°ƒæ—¶ï¼Œå…¶å®å¯ä»¥è·å–åˆ°ä¸€ä¸ªå‚æ•°ï¼šonInvalidate å½“å‰¯ä½œç”¨å³å°†é‡æ–°æ‰§è¡Œ æˆ–è€… ä¾¦å¬å™¨è¢«åœæ­¢ æ—¶ä¼šæ‰§è¡Œè¯¥å‡½æ•°ä¼ å…¥çš„å›è°ƒå‡½æ•°ï¼› æˆ‘ä»¬å¯ä»¥åœ¨ä¼ å…¥çš„å›è°ƒå‡½æ•°ä¸­ï¼Œæ‰§è¡Œä¸€äº›æ¸…é™¤å·¥ä½œï¼› \u003ctemplate\u003e \u003cdiv\u003e \u003ch2\u003e{{ name }}-{{ age }}\u003c/h2\u003e \u003cbutton @click=\"changeName\"\u003eä¿®æ”¹name\u003c/button\u003e \u003cbutton @click=\"changeAge\"\u003eä¿®æ”¹age\u003c/button\u003e \u003c/div\u003e \u003c/template\u003e \u003cscript\u003e import { ref, watchEffect } from 'vue'; export default { setup() { // watchEffect: è‡ªåŠ¨æ”¶é›†å“åº”å¼çš„ä¾èµ– const name = ref(\"why\"); const age = ref(18); const stop = watchEffect((onInvalidate) =\u003e { const timer = setTimeout(() =\u003e { console.log(\"ç½‘ç»œè¯·æ±‚æˆåŠŸ~\"); }, 2000) // æ ¹æ®nameå’Œageä¸¤ä¸ªå˜é‡å‘é€ç½‘ç»œè¯·æ±‚ onInvalidate(() =\u003e { // åœ¨è¿™ä¸ªå‡½æ•°ä¸­æ¸…é™¤é¢å¤–çš„å‰¯ä½œç”¨ // request.cancel() clearTimeout(timer); console.log(\"onInvalidate\"); }) console.log(\"name:\", name.value, \"age:\", age.value); }); const changeName = () =\u003e name.value = name.value === \"why\" ? \"kobe\" : \"why\"; const changeAge = () =\u003e age.value++; return { name, age, changeName, changeAge } } } \u003c/script\u003e watchEffectçš„æ‰§è¡Œæ—¶æœº é»˜è®¤æƒ…å†µä¸‹ï¼Œç»„ä»¶çš„æ›´æ–°ä¼šåœ¨å‰¯ä½œç”¨å‡½æ•°æ‰§è¡Œä¹‹å‰ï¼š å¦‚æœæˆ‘ä»¬å¸Œæœ›åœ¨å‰¯ä½œç”¨å‡½æ•°ä¸­è·å–åˆ°å…ƒç´ ï¼Œæ˜¯å¦å¯è¡Œå‘¢ï¼Ÿ \u003ctemplate\u003e \u003cdiv\u003e \u003ch2 ref=\"title\"\u003eå“ˆå“ˆå“ˆ\u003c/h2\u003e \u003c/div\u003e \u003c/template\u003e \u003cscript\u003e import { ref, watchEffect } from 'vue'; export default { setup() { const title = ref(null); watchEffect(() =\u003e { console.log(title.value); }) return { title } } } \u003c/script\u003e æˆ‘ä»¬ä¼šå‘ç°æ‰“å°ç»“æœæ‰“å°äº†ä¸¤æ¬¡ï¼š è¿™æ˜¯å› ä¸ºsetupå‡½æ•°åœ¨æ‰§è¡Œæ—¶å°±ä¼šç«‹å³æ‰§è¡Œä¼ å…¥çš„å‰¯ä½œç”¨å‡½æ•°ï¼Œè¿™ä¸ªæ—¶å€™DOMå¹¶æ²¡æœ‰æŒ‚è½½ï¼Œæ‰€ä»¥æ‰“å°ä¸ºnullï¼› è€Œå½“DOMæŒ‚è½½æ—¶ï¼Œä¼šç»™titleçš„refå¯¹è±¡èµ‹å€¼æ–°çš„å€¼ï¼Œå‰¯ä½œç”¨å‡½æ•°ä¼šå†æ¬¡æ‰§è¡Œï¼Œæ‰“å°å‡ºæ¥å¯¹åº”çš„å…ƒç´ ï¼› è¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦æ”¹å˜å‰¯ä½œç”¨å‡½æ•°çš„æ‰§è¡Œæ—¶æœºï¼› å®ƒçš„é»˜è®¤å€¼æ˜¯preï¼Œå®ƒä¼šåœ¨å…ƒç´  æŒ‚è½½ æˆ–è€… æ›´æ–° ä¹‹å‰æ‰§è¡Œï¼› æ‰€ä»¥æˆ‘ä»¬ä¼šå…ˆæ‰“å°å‡ºæ¥ä¸€ä¸ªç©ºçš„ï¼Œå½“ä¾èµ–çš„titleå‘ç”Ÿæ”¹å˜æ—¶ï¼Œå°±ä¼šå†æ¬¡æ‰§è¡Œä¸€æ¬¡ï¼Œæ‰“å°å‡ºå…ƒç´ ï¼› æˆ‘ä»¬å¯ä»¥è®¾ç½®å‰¯ä½œç”¨å‡½æ•°çš„æ‰§è¡Œæ—¶æœºï¼š pre : é»˜è®¤å€¼,å®ƒä¼šåœ¨å…ƒç´  æŒ‚è½½ æˆ–è€… æ›´æ–° ä¹‹å‰æ‰§è¡Œ post : å…ƒç´  æŒ‚è½½ æˆ–è€… æ›´æ–° ä¹‹åæ‰§è¡Œ sync : å¼ºåˆ¶åŒæ­¥ä¸€èµ·æ‰§è¡Œï¼Œæ•ˆç‡å¾ˆä½ï¼Œä¸æ¨è \u003cscript\u003e import { ref, watchEffect } from 'vue'; export default { setup() { const title = ref(null); watchEffect(() =\u003e { console.log(title.value); }, { flush: \"post\" }) return { title } } } \u003c/script\u003e Watch watchçš„APIå®Œå…¨ç­‰åŒäºç»„ä»¶watché€‰é¡¹çš„Propertyï¼š watchéœ€è¦ä¾¦å¬ç‰¹å®šçš„æ•°æ®æºï¼Œå¹¶åœ¨å›è°ƒå‡½æ•°ä¸­æ‰§è¡Œå‰¯ä½œç”¨ï¼› é»˜è®¤æƒ…å†µä¸‹å®ƒæ˜¯æƒ°æ€§çš„ï¼Œåªæœ‰å½“è¢«ä¾¦å¬çš„æºå‘ ç”Ÿå˜åŒ–æ—¶æ‰ä¼šæ‰§è¡Œå›è°ƒï¼› ä¸watchEffectçš„æ¯”è¾ƒï¼Œwatchå…è®¸æˆ‘ä»¬ï¼š æ‡’æ‰§è¡Œå‰¯ä½œç”¨ï¼ˆç¬¬ä¸€æ¬¡ä¸ä¼šç›´æ¥æ‰§è¡Œï¼‰ï¼› æ›´å…·ä½“çš„è¯´æ˜å½“å“ªäº›çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè§¦å‘ä¾¦å¬å™¨çš„æ‰§è¡Œï¼› è®¿é—®ä¾¦å¬çŠ¶æ€å˜åŒ–å‰åçš„å€¼ï¼› ä¾¦å¬å•ä¸ªæ•°æ®æº watchä¾¦å¬å‡½æ•°çš„æ•°æ®æºæœ‰ä¸¤ç§ç±»å‹ï¼š\nä¸€ä¸ªgetterå‡½æ•°ï¼šä½†æ˜¯è¯¥getterå‡½æ•°å¿…é¡»å¼•ç”¨å¯å“åº”å¼çš„å¯¹è±¡ï¼ˆæ¯”å¦‚reactiveæˆ–è€…refï¼‰ï¼› ç›´æ¥å†™å…¥ä¸€ä¸ªå¯å“åº”å¼çš„å¯¹è±¡ï¼Œrefï¼ˆå¦‚æœæ˜¯ä¸€ä¸ª reactive çš„å¯¹è±¡çš„ä¾¦å¬, éœ€è¦è¿›è¡ŒæŸäº›è½¬æ¢ ï¼‰ï¼› import { watch, reactive, ref, toRefs } from 'vue'; // ä¸€ä¸ªgetterå‡½æ•°å¼•ç”¨å¯å“åº”å¼çš„å¯¹è±¡ const state = reactive({ count: 0 }); watch( () =\u003e state.count, (newValue, oldValue) =\u003e { console.log(`Count changed from ${oldValue} to ${newValue}`); }); // ç›´æ¥å†™å…¥ä¸€ä¸ªå¯å“åº”å¼çš„å¯¹è±¡ const count = ref(0); watch(count, (newValue, oldValue) =\u003e { console.log(`Count changed from ${oldValue} to ${newValue}`); }); // ç›´æ¥å†™å…¥ä¸€ä¸ªå¯å“åº”å¼çš„å¯¹è±¡ï¼Œéœ€è¦è¿›è¡ŒæŸäº›è½¬æ¢ const reactiveState = reactive({ count: 0 }); const { count } = toRefs(reactiveState); watch(count, (newValue, oldValue) =\u003e { console.log(`Count changed from ${oldValue} to ${newValue}`); }); æ³¨æ„: reactive å¯¹è±¡è·å–åˆ°çš„ newValue ä»¥åŠ oldValue æœ¬èº«éƒ½æ˜¯ reactive å¯¹è±¡\nwatch( info, (newInfo, oldInfo) =\u003e { console.log(newInfo, oldInfo); } ) å¦‚æœå¸Œæœ›ä¸¤è€…éƒ½æ˜¯ä¸€ä¸ªæ™®é€šå¯¹è±¡, å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å†™æ³•(JavaScriptä¸­çš„å±•å¼€è¿ç®—ç¬¦):\nwatch( () =\u003e ({ ...info }), (newInfo, oldInfo) =\u003e { console.log(newInfo, oldInfo); } ) ä»¥ä¸‹æ˜¯å®Œæ•´ä»£ç :\n\u003ctemplate\u003e \u003cdiv\u003e \u003ch2 ref=\"title\"\u003e{{ info.name }}\u003c/h2\u003e \u003cbutton @click=\"changeData\"\u003eä¿®æ”¹æ•°æ®\u003c/button\u003e \u003c/div\u003e \u003c/template\u003e \u003cscript\u003e import { reactive, watch } from 'vue'; export default { setup() { const info = reactive({ name: \"why\", age: 18 }); watch( () =\u003e ({ ...info }), (newInfo, oldInfo) =\u003e { console.log(newInfo, oldInfo); } ) watch( info, (newInfo, oldInfo) =\u003e { console.log(newInfo, oldInfo); } ) const changeData = () =\u003e info.name = info.name === \"why\" ? \"kobe\" : \"why\"; return { changeData, info } } } \u003c/script\u003e ä¾¦å¬å¤šä¸ªæ•°æ®æº å½“ä¾¦å¬å¤šä¸ªæ¥æºæ—¶ï¼Œå›è°ƒå‡½æ•°æ¥å—ä¸¤ä¸ªæ•°ç»„ï¼Œåˆ†åˆ«å¯¹åº”æ¥æºæ•°ç»„ä¸­çš„æ–°å€¼å’Œæ—§å€¼ï¼š\nwatch([fooRef, barRef], ([foo, bar], [prevFoo, prevBar]) =\u003e { /* ... */ }) \u003ctemplate\u003e \u003cdiv\u003e \u003ch2 ref=\"title\"\u003e{{ info.name }}\u003c/h2\u003e \u003cbutton @click=\"changeData\"\u003eä¿®æ”¹æ•°æ®\u003c/button\u003e \u003c/div\u003e \u003c/template\u003e \u003cscript\u003e import { ref, reactive, watch } from 'vue'; export default { setup() { const info = reactive({ name: \"why\", age: 18 }); const name = ref(\"why\"); watch([() =\u003e ({ ...info }), name], ([newInfo, newName], [oldInfo, oldName]) =\u003e { console.log(newInfo, newName, oldInfo, oldName); }) const changeData = () =\u003e { info.name = \"kobe\"; } return { changeData, info } } } \u003c/script\u003e watchçš„é€‰é¡¹ deep : æ˜¯å¦æ·±åº¦ç›‘å¬ immediate ï¼š æ˜¯å¦ç«‹å³æ‰§è¡Œ watch ä¾¦å¬ reactiveæ—¶é»˜è®¤æ˜¯æ·±åº¦ä¾¦å¬çš„, ä½†æ˜¯åœ¨ä½¿ç”¨ {...info}å±•å¼€è¿ç®—ç¬¦æ—¶, æ˜¯ä¸ä¼šæ·±åº¦ç›‘å¬çš„, æ‰€ä»¥æˆ‘ä»¬è¦è®¾ç½® deep: True\nimmediate: ç¬¬ä¸€æ¬¡ä¼šæ‰§è¡Œ\nwatch( () =\u003e { const obj = { ...info } obj.friend = { ...obj.friend } return obj }, (newValue, oldValue) =\u003e { console.log(newValue, oldValue) }, { // å¦‚æœæœ‰å¤šå±‚ï¼Œéœ€è¦åŠ ä¸Šdeep deep: true, // ç«‹å³æ‰§è¡Œ immediate: true } ) åœæ­¢ä¾¦å¬ const stop = watch(source, callback) // å½“å·²ä¸å†éœ€è¦è¯¥ä¾¦å¬å™¨æ—¶ï¼š stop() å‰¯ä½œç”¨æ¸…ç† watch(id, async (newId, oldId, onCleanup) =\u003e { const { response, cancel } = doAsyncWork(newId) // å½“ `id` å˜åŒ–æ—¶ï¼Œ`cancel` å°†è¢«è°ƒç”¨ï¼Œ // å–æ¶ˆä¹‹å‰çš„æœªå®Œæˆçš„è¯·æ±‚ onCleanup(cancel) data.value = await response }) provide \u0026\u0026 inject provide å’Œ inject é€šå¸¸æˆå¯¹ä¸€èµ·ä½¿ç”¨ï¼Œä½¿ä¸€ä¸ªç¥–å…ˆç»„ä»¶ä½œä¸ºå…¶åä»£ç»„ä»¶çš„ä¾èµ–æ³¨å…¥æ–¹ï¼Œæ— è®ºè¿™ä¸ªç»„ä»¶çš„å±‚çº§æœ‰å¤šæ·±éƒ½å¯ä»¥æ³¨å…¥æˆåŠŸï¼Œåªè¦ä»–ä»¬å¤„äºåŒä¸€æ¡ç»„ä»¶é“¾ä¸Šã€‚\nprovideå¯ä»¥ä¼ å…¥ä¸¤ä¸ªå‚æ•° :\nnameï¼šæä¾›çš„å±æ€§åç§° valueï¼šæä¾›çš„å±æ€§å€¼ injectå¯ä»¥ä¼ å…¥ä¸¤ä¸ªå‚æ•° :\nå¯¹åº”provideä¼ è¿‡æ¥çš„nameå€¼ é»˜è®¤å€¼ \u003ctemplate\u003e \u003ch1\u003eAPP count: {{ count }}\u003c/h1\u003e \u003cbutton @click=\"change\"\u003eAPP button\u003c/button\u003e \u003cdemo /\u003e \u003c/template\u003e \u003cscript\u003e import { ref, provide, readonly } from 'vue' import demo from './components/demo.vue' export default { name: 'App', components: { demo }, setup() { let count = ref(100) // ç¬¬ä¸€ä¸ªå‚æ•°key ç¬¬äºŒä¸ªå‚æ•°å€¼ï¼Œä¸è®©å­ç»„ä»¶éšä¾¿ä¿®æ”¹ï¼Œç”¨readonlyåŒ…è£¹ä¸€ä¸‹ provide('count', readonly(count)) const change = () =\u003e count.value++ return { count, change } } } \u003c/script\u003e \u003ctemplate\u003e \u003ch2\u003edemo count:{{ count }}\u003c/h2\u003e \u003cbutton @click=\"change\"\u003edemo change\u003c/button\u003e \u003c/template\u003e \u003cscript\u003e import { ref, inject } from 'vue' export default { setup() { // æ¥æ”¶ ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥ç»™ä¸€ä¸ªé»˜è®¤å€¼ let count = inject('count', '') // å› ä¸ºè®¾ç½®äº†readOnly æ‰€ä»¥æ›´æ”¹ä¸äº† const change = () =\u003e count.value++ return { count, change } } } \u003c/script\u003e hå‡½æ•° Vueåœ¨ç”ŸæˆçœŸå®çš„DOMä¹‹å‰ï¼Œä¼šå°†èŠ‚ç‚¹è½¬æ¢æˆVNodeï¼Œè€ŒVNodeç»„åˆåœ¨ä¸€èµ·å½¢æˆä¸€é¢—æ ‘ç»“æ„ï¼Œå°±æ˜¯è™šæ‹ŸDOM ( VDOM ) äº‹å®ä¸Šï¼Œç¼–å†™çš„ template ä¸­çš„HTML æœ€ç»ˆä¹Ÿæ˜¯ä½¿ç”¨æ¸²æŸ“å‡½æ•°ç”Ÿæˆå¯¹åº”çš„VNode é‚£ä¹ˆï¼Œå¦‚æœæƒ³å……åˆ†çš„åˆ©ç”¨JavaScriptçš„ç¼–ç¨‹èƒ½åŠ›ï¼Œå¯ä»¥è‡ªå·±æ¥ç¼–å†™ createVNode å‡½æ•°ï¼Œç”Ÿæˆå¯¹åº”çš„VNode h() å‡½æ•°æ˜¯ä¸€ä¸ªç”¨äºåˆ›å»º vnode çš„ä¸€ä¸ªå‡½æ•° å…¶å®æ›´å‡†å¤‡çš„å‘½åæ˜¯ createVNode() å‡½æ•°ï¼Œä½†æ˜¯ä¸ºäº†ç®€ä¾¿åœ¨Vueå°†ä¹‹ç®€åŒ–ä¸º h() å‡½æ•° å‚æ•° // å®Œæ•´å‚æ•°ç­¾å function h( type: string | Component, props?: object | null, children?: Children | Slot | Slots ): VNode // çœç•¥ props function h(type: string | Component, children?: Children | Slot): VNode type Children = string | number | boolean | VNode | null | Children[] type Slot = () =\u003e Children type Slots = { [name: string]: Slot } ç¬¬ä¸€ä¸ªå‚æ•°æ—¢å¯ä»¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸² (ç”¨äºåŸç”Ÿå…ƒç´ ) ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ª Vue ç»„ä»¶å®šä¹‰ã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯è¦ä¼ é€’çš„ propï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯å­èŠ‚ç‚¹ã€‚ å½“åˆ›å»ºä¸€ä¸ªç»„ä»¶çš„ vnode æ—¶ï¼Œå­èŠ‚ç‚¹å¿…é¡»ä»¥æ’æ§½å‡½æ•°è¿›è¡Œä¼ é€’ã€‚å¦‚æœç»„ä»¶åªæœ‰é»˜è®¤æ§½ï¼Œå¯ä»¥ä½¿ç”¨å•ä¸ªæ’æ§½å‡½æ•°è¿›è¡Œä¼ é€’ã€‚å¦åˆ™ï¼Œå¿…é¡»ä»¥æ’æ§½å‡½æ•°çš„å¯¹è±¡å½¢å¼æ¥ä¼ é€’ã€‚ ä¸ºäº†æ–¹ä¾¿é˜…è¯»ï¼Œå½“å­èŠ‚ç‚¹ä¸æ˜¯æ’æ§½å¯¹è±¡æ—¶ï¼Œå¯ä»¥çœç•¥ prop å‚æ•°ã€‚ åŸºæœ¬ä½¿ç”¨ hå‡½æ•°å¯ä»¥åœ¨ä¸¤ä¸ªåœ°æ–¹ä½¿ç”¨ï¼š\nrenderå‡½æ•°é€‰é¡¹ä¸­ï¼› setupå‡½æ•°é€‰é¡¹ä¸­ï¼ˆsetupæœ¬èº«éœ€è¦æ˜¯ä¸€ä¸ªå‡½æ•°ç±»å‹ï¼Œå‡½æ•°å†è¿”å›hå‡½æ•°åˆ›å»ºçš„VNodeï¼‰ï¼› åœ¨renderå‡½æ•°é€‰é¡¹ä¸­ \u003cscript\u003e // 1. å¼•å…¥hå‡½æ•° import { h } from 'vue'; export default { data() { return { counter: 0 }; }, // 2. å®šä¹‰renderé€‰é¡¹ render() { // 3. è¿”å›è‡ªå®šä¹‰çš„hå‡½æ•° return h('div', { class: 'app-view', name: 'abc' }, [ // 4. å®šä¹‰h2 h('h2', { className: 'title' }, this.counter), // 5. å®šä¹‰å¢åŠ æŒ‰é’® h( 'button', { className: 'add-btn', onClick: () =\u003e { this.counter++; } }, 'åŠ ä¸€' ), // 6. å®šä¹‰å‡å°‘æŒ‰é’® h( 'button', { className: 'remove-btn', onClick: () =\u003e { this.counter--; } }, 'å‡ä¸€' ) ]); } } \u003c/script\u003e åœ¨setupå‡½æ•°é€‰é¡¹ä¸­ \u003cscript\u003e import { h, ref } from 'vue'; export default { setup() { const counter = ref(0); const increment = () =\u003e { counter.value++; }; const decrement = () =\u003e { counter.value--; }; // è¿”å›renderå‡½æ•° return () =\u003e h('div', { class: 'app-view', name: 'abc' }, [ h('h2', { className: 'title' }, counter.value), h( 'button', { onClick: increment }, '+1' ), h( 'button', { onClick: decrement }, '-1' ) ]); } }; \u003c/script\u003e åœ¨setupè¯­æ³•ç³–ä¸­ \u003ctemplate\u003e \u003cstar-render /\u003e \u003c/template\u003e \u003cscript setup\u003e import { h, ref } from 'vue'; const counter = ref(0); const increment = () =\u003e { counter.value++; }; const decrement = () =\u003e { counter.value--; }; // 1. æ‹¿åˆ°renderå‡½æ•° const starRender = () =\u003e h('div', { class: 'app-view', name: 'abc' }, [ h('h2', { className: 'title' }, counter.value), h( 'button', { onClick: increment }, '+1' ), h( 'button', { onClick: decrement }, '-1' ) ]); \u003c/script\u003e å…¶ä»–å†™æ³• åˆ›å»ºåŸç”Ÿå…ƒç´ ï¼š\nimport { h } from 'vue' // é™¤äº† type å¤–ï¼Œå…¶ä»–å‚æ•°éƒ½æ˜¯å¯é€‰çš„ h('div') h('div', { id: 'foo' }) // attribute å’Œ property éƒ½å¯ä»¥ç”¨äº prop // Vue ä¼šè‡ªåŠ¨é€‰æ‹©æ­£ç¡®çš„æ–¹å¼æ¥åˆ†é…å®ƒ h('div', { class: 'bar', innerHTML: 'hello' }) // class ä¸ style å¯ä»¥åƒåœ¨æ¨¡æ¿ä¸­ä¸€æ · // ç”¨æ•°ç»„æˆ–å¯¹è±¡çš„å½¢å¼ä¹¦å†™ h('div', { class: [foo, { bar }], style: { color: 'red' } }) // äº‹ä»¶ç›‘å¬å™¨åº”ä»¥ onXxx çš„å½¢å¼ä¹¦å†™ h('div', { onClick: () =\u003e {} }) // children å¯ä»¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸² h('div', { id: 'foo' }, 'hello') // æ²¡æœ‰ prop æ—¶å¯ä»¥çœç•¥ä¸å†™ h('div', 'hello') h('div', [h('span', 'hello')]) // children æ•°ç»„å¯ä»¥åŒæ—¶åŒ…å« vnode å’Œå­—ç¬¦ä¸² h('div', ['hello', h('span', 'hello')]) åˆ›å»ºç»„ä»¶ï¼š\nimport Foo from './Foo.vue' // ä¼ é€’ prop h(Foo, { // ç­‰ä»·äº some-prop=\"hello\" someProp: 'hello', // ç­‰ä»·äº @update=\"() =\u003e {}\" onUpdate: () =\u003e {} }) // ä¼ é€’å•ä¸ªé»˜è®¤æ’æ§½ h(Foo, () =\u003e 'default slot') // ä¼ é€’å…·åæ’æ§½ // æ³¨æ„ï¼Œéœ€è¦ä½¿ç”¨ `null` æ¥é¿å… // æ’æ§½å¯¹è±¡è¢«å½“ä½œæ˜¯ prop h(MyComponent, null, { default: () =\u003e 'default slot', foo: () =\u003e h('div', 'foo'), bar: () =\u003e [h('span', 'one'), h('span', 'two')] }) å‡½æ•°ç»„ä»¶å’Œæ’æ§½çš„ä½¿ç”¨ \u003cscript\u003e import { h } from \"vue\"; export default { render() { return h(\"div\", null, [ h(\"h2\", null, \"Hello World\"), this.$slots.default ? this.$slots.default({name: \"coderwhy\"}): h(\"span\", null, \"æˆ‘æ˜¯HelloWorldçš„æ’æ§½é»˜è®¤å€¼\") ]) } } \u003c/script\u003e \u003cstyle lang=\"scss\" scoped\u003e \u003c/style\u003e \u003ctemplate\u003e \u003cstarRender /\u003e \u003c/template\u003e \u003cscript setup\u003e import { h } from 'vue'; import HelloWorld from './HelloWorld.vue'; const starRender = () =\u003e h(\"div\", null, [ h(HelloWorld, null, { default: props =\u003e h(\"span\", null, `appä¼ å…¥åˆ°HelloWorldä¸­çš„å†…å®¹: ${props.name}`) }) ]) \u003c/script\u003e Jsx JSX æ˜¯ JavaScript çš„ä¸€ä¸ªç±»ä¼¼ XML çš„æ‰©å±•ï¼Œæœ‰äº†å®ƒï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä»¥ä¸‹çš„æ–¹å¼æ¥ä¹¦å†™ä»£ç ï¼š\nconst vnode = \u003cdiv\u003ehello\u003c/div\u003e åœ¨ JSX è¡¨è¾¾å¼ä¸­ï¼Œä½¿ç”¨å¤§æ‹¬å·æ¥åµŒå…¥åŠ¨æ€å€¼ï¼š\nconst vnode = \u003cdiv id={dynamicId}\u003ehello, {userName}\u003c/div\u003e é…ç½® vue-cliç¯å¢ƒ npm install @vue/babel-plugin-jsx -D babel.config.js ä¸­é…ç½® viteç¯å¢ƒ npm install @vitejs/plugin-vue-jsx -D vite.config.js ä¸­é…ç½® import { fileURLToPath, URL } from 'node:url'; import { defineConfig } from 'vite'; import vue from '@vitejs/plugin-vue'; import jsx from '@vitejs/plugin-vue-jsx'; export default defineConfig({ plugins: [vue(), jsx()], resolve: { alias: { '@': fileURLToPath(new URL('./src', import.meta.url)) } } }); åŸºæœ¬ä½¿ç”¨ åœ¨renderå‡½æ•°ä¸­ \u003cscript lang=\"jsx\"\u003e import Home from './pages/home.vue'; export default { data() { return { counter: 0 }; }, render() { // 2. è¿”å›jsxå†™æ³• return ( \u003cdiv class=\"app-view\"\u003e \u003ch2\u003eå½“å‰è®¡æ•°:{this.counter}\u003c/h2\u003e \u003cbutton onClick={this.increment}\u003e+1\u003c/button\u003e \u003cbutton onClick={this.decrement}\u003e-1\u003c/button\u003e \u003c/div\u003e ); }, methods: { increment() { this.counter++; }, decrement() { this.counter--; } } }; \u003c/script\u003e åœ¨setupå‡½æ•°ä¸­ \u003cscript lang=\"jsx\"\u003e export default { data() { return { counter: 0 }; }, render() { // 2. è¿”å›jsxå†™æ³• return ( \u003cdiv class=\"app-view\"\u003e \u003ch2\u003eå½“å‰è®¡æ•°:{this.counter}\u003c/h2\u003e \u003cbutton onClick={this.increment}\u003e+1\u003c/button\u003e \u003cbutton onClick={this.decrement}\u003e-1\u003c/button\u003e \u003c/div\u003e ); }, methods: { increment() { this.counter++; }, decrement() { this.counter--; } } }; \u003c/script\u003e åœ¨setupè¯­æ³•ç³–ä¸­ \u003ctemplate\u003e \u003cstar-render /\u003e \u003c/template\u003e \u003cscript setup lang=\"jsx\"\u003e import { ref } from 'vue'; const counter = ref(0); const increment = () =\u003e counter.value++; const decrement = () =\u003e counter.value--; // 2. æ‹¿åˆ°renderå‡½æ•° const starRender = () =\u003e ( \u003cdiv class=\"app-view\"\u003e \u003ch2\u003eå½“å‰è®¡æ•°:{counter.value}\u003c/h2\u003e \u003cbutton onClick={increment}\u003e+1\u003c/button\u003e \u003cbutton onClick={decrement}\u003e-1\u003c/button\u003e \u003c/div\u003e ); \u003c/script\u003e script setupè¯­æ³•ç³– ","wordCount":"15734","inLanguage":"zh-cn","datePublished":"2023-12-29T16:04:23+08:00","dateModified":"2023-12-29T16:04:23+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://waite.wang/posts/vue/vue3-compositionapi/"},"publisher":{"@type":"Organization","name":"éš¶ç¬”éš¾ä¹¦","logo":{"@type":"ImageObject","url":"https://waite.wang/images/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://waite.wang/ accesskey=h title="éš¶ç¬”éš¾ä¹¦ (Alt + H)">éš¶ç¬”éš¾ä¹¦</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://waite.wang/ title=é¦–é¡µ><span>é¦–é¡µ</span></a></li><li><a href=https://waite.wang/search title=æœç´¢><span>æœç´¢</span></a></li><li><a href=https://waite.wang/categories title=åˆ†ç±»><span>åˆ†ç±»</span></a></li><li><a href=https://waite.wang/tags title=æ ‡ç­¾><span>æ ‡ç­¾</span></a></li><li><a href=https://waite.wang/archives title=å½’æ¡£><span>å½’æ¡£</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Vue3 CompositionAPI</h1><div class=post-meta>Created: &nbsp;<span title='2023-12-29 16:04:23 +0800 +0800'>2023-12-29</span>&nbsp;Â·&nbsp;32 min&nbsp;Â·&nbsp;15734 words&nbsp;|&nbsp;<a href=https://github.com/Waite0603/HugoBlog/edit/main/content/posts/vue/vue3-compositionAPI.md rel="noopener noreferrer" target=_blank>åœ¨ GitHub ç¼–è¾‘</a></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#options-api%e7%9a%84%e5%bc%8a%e7%ab%af aria-label="Options APIçš„å¼Šç«¯">Options APIçš„å¼Šç«¯</a></li><li><a href=#%e8%ae%a4%e8%af%86-%e7%bb%84%e5%90%88%e5%bc%8f-api-composition-api aria-label="è®¤è¯† ç»„åˆå¼ API (Composition API)">è®¤è¯† ç»„åˆå¼ API (Composition API)</a></li><li><a href=#setup aria-label=setup()>setup()</a><ul><li><a href=#setup%e5%87%bd%e6%95%b0%e7%9a%84%e5%8f%82%e6%95%b0 aria-label=setupå‡½æ•°çš„å‚æ•°>setupå‡½æ•°çš„å‚æ•°</a></li><li><a href=#setup%e5%87%bd%e6%95%b0%e7%9a%84%e8%bf%94%e5%9b%9e%e5%80%bc aria-label=setupå‡½æ•°çš„è¿”å›å€¼>setupå‡½æ•°çš„è¿”å›å€¼</a></li><li><a href=#%e8%a1%a5%e5%85%85-%e4%b8%ba%e4%bb%80%e4%b9%88-setup-%e4%b8%8d%e8%83%bd%e4%bd%bf%e7%94%a8-this aria-label="è¡¥å……: ä¸ºä»€ä¹ˆ setup ä¸èƒ½ä½¿ç”¨ this">è¡¥å……: ä¸ºä»€ä¹ˆ setup ä¸èƒ½ä½¿ç”¨ this</a></li></ul></li><li><a href=#%e5%ae%9a%e4%b9%89%e5%93%8d%e5%ba%94%e5%bc%8f%e6%95%b0%e6%8d%ae%e7%9a%84%e4%b8%a4%e7%a7%8d%e6%96%b9%e5%bc%8f aria-label=å®šä¹‰å“åº”å¼æ•°æ®çš„ä¸¤ç§æ–¹å¼>å®šä¹‰å“åº”å¼æ•°æ®çš„ä¸¤ç§æ–¹å¼</a><ul><li><a href=#reactive-api aria-label="Reactive API">Reactive API</a><ul><li><a href=#reactive%e5%88%a4%e6%96%ad%e7%9a%84api aria-label=Reactiveåˆ¤æ–­çš„API>Reactiveåˆ¤æ–­çš„API</a></li></ul></li><li><a href=#ref-api aria-label="Ref API">Ref API</a><ul><li><a href=#%e5%9f%ba%e6%9c%ac%e4%bd%bf%e7%94%a8 aria-label=åŸºæœ¬ä½¿ç”¨>åŸºæœ¬ä½¿ç”¨</a></li><li><a href=#ref%e8%87%aa%e5%8a%a8%e8%a7%a3%e5%8c%85 aria-label=Refè‡ªåŠ¨è§£åŒ…>Refè‡ªåŠ¨è§£åŒ…</a></li><li><a href=#ref%e5%88%a4%e6%96%ad%e7%9a%84api aria-label=Refåˆ¤æ–­çš„API>Refåˆ¤æ–­çš„API</a></li><li><a href=#%e8%87%aa%e5%ae%9a%e4%b9%89ref--customref aria-label="è‡ªå®šä¹‰Ref => customRef">è‡ªå®šä¹‰Ref => <strong>customRef</strong></a></li></ul></li></ul></li><li><a href=#readonly aria-label=readonly>readonly</a><ul><li><a href=#%e6%a6%82%e5%bf%b5 aria-label=æ¦‚å¿µ>æ¦‚å¿µ</a></li></ul></li><li><a href=#torefs--toref aria-label="toRefs && toRef">toRefs && toRef</a><ul><li><a href=#torefs aria-label=toRefs><strong>toRefs</strong></a></li><li><a href=#toref aria-label=toRef><strong>toRef</strong></a></li></ul></li><li><a href=#computed aria-label=computed>computed</a><ul><li><a href=#%e6%96%b9%e5%bc%8f%e4%b8%80 aria-label=æ–¹å¼ä¸€>æ–¹å¼ä¸€</a></li><li><a href=#%e6%96%b9%e5%bc%8f%e4%ba%8c aria-label=æ–¹å¼äºŒ>æ–¹å¼äºŒ</a></li></ul></li><li><a href=#%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%e9%92%a9%e5%ad%90 aria-label=ç”Ÿå‘½å‘¨æœŸé’©å­>ç”Ÿå‘½å‘¨æœŸé’©å­</a></li><li><a href=#setup%e4%b8%ad%e4%bd%bf%e7%94%a8ref%e8%8e%b7%e5%8f%96%e5%85%83%e7%b4%a0%e6%88%96%e7%bb%84%e4%bb%b6 aria-label=setupä¸­ä½¿ç”¨refè·å–å…ƒç´ æˆ–ç»„ä»¶>setupä¸­ä½¿ç”¨refè·å–å…ƒç´ æˆ–ç»„ä»¶</a><ul><li><a href=#%e8%8e%b7%e5%8f%96%e5%85%83%e7%b4%a0 aria-label=è·å–å…ƒç´ >è·å–å…ƒç´ </a></li><li><a href=#%e8%8e%b7%e5%8f%96%e7%bb%84%e4%bb%b6 aria-label=è·å–ç»„ä»¶>è·å–ç»„ä»¶</a></li></ul></li><li><a href=#%e4%be%a6%e5%90%ac%e6%95%b0%e6%8d%ae%e7%9a%84%e5%8f%98%e5%8c%96 aria-label=ä¾¦å¬æ•°æ®çš„å˜åŒ–>ä¾¦å¬æ•°æ®çš„å˜åŒ–</a><ul><li><a href=#watcheffect aria-label=watchEffect>watchEffect</a><ul><li><a href=#%e5%9f%ba%e6%9c%ac%e4%bd%bf%e7%94%a8-1 aria-label=åŸºæœ¬ä½¿ç”¨>åŸºæœ¬ä½¿ç”¨</a></li><li><a href=#%e5%81%9c%e6%ad%a2%e7%9b%91%e5%90%ac aria-label=åœæ­¢ç›‘å¬>åœæ­¢ç›‘å¬</a></li><li><a href=#%e6%b8%85%e9%99%a4%e5%89%af%e4%bd%9c%e7%94%a8 aria-label=æ¸…é™¤å‰¯ä½œç”¨>æ¸…é™¤å‰¯ä½œç”¨</a></li><li><a href=#watcheffect%e7%9a%84%e6%89%a7%e8%a1%8c%e6%97%b6%e6%9c%ba aria-label=watchEffectçš„æ‰§è¡Œæ—¶æœº>watchEffectçš„æ‰§è¡Œæ—¶æœº</a></li></ul></li><li><a href=#watch aria-label=Watch>Watch</a><ul><li><a href=#%e4%be%a6%e5%90%ac%e5%8d%95%e4%b8%aa%e6%95%b0%e6%8d%ae%e6%ba%90 aria-label=ä¾¦å¬å•ä¸ªæ•°æ®æº>ä¾¦å¬å•ä¸ªæ•°æ®æº</a></li><li><a href=#%e4%be%a6%e5%90%ac%e5%a4%9a%e4%b8%aa%e6%95%b0%e6%8d%ae%e6%ba%90 aria-label=ä¾¦å¬å¤šä¸ªæ•°æ®æº>ä¾¦å¬å¤šä¸ªæ•°æ®æº</a></li><li><a href=#watch%e7%9a%84%e9%80%89%e9%a1%b9 aria-label=watchçš„é€‰é¡¹>watchçš„é€‰é¡¹</a></li><li><a href=#%e5%81%9c%e6%ad%a2%e4%be%a6%e5%90%ac aria-label=åœæ­¢ä¾¦å¬>åœæ­¢ä¾¦å¬</a></li><li><a href=#%e5%89%af%e4%bd%9c%e7%94%a8%e6%b8%85%e7%90%86 aria-label=å‰¯ä½œç”¨æ¸…ç†>å‰¯ä½œç”¨æ¸…ç†</a></li></ul></li></ul></li><li><a href=#provide--inject aria-label="provide && inject">provide && inject</a></li><li><a href=#h%e5%87%bd%e6%95%b0 aria-label=hå‡½æ•°>hå‡½æ•°</a><ul><li><a href=#%e5%8f%82%e6%95%b0 aria-label=å‚æ•°>å‚æ•°</a></li><li><a href=#%e5%9f%ba%e6%9c%ac%e4%bd%bf%e7%94%a8-2 aria-label=åŸºæœ¬ä½¿ç”¨>åŸºæœ¬ä½¿ç”¨</a><ul><li><a href=#%e5%9c%a8render%e5%87%bd%e6%95%b0%e9%80%89%e9%a1%b9%e4%b8%ad aria-label=åœ¨renderå‡½æ•°é€‰é¡¹ä¸­>åœ¨renderå‡½æ•°é€‰é¡¹ä¸­</a></li><li><a href=#%e5%9c%a8setup%e5%87%bd%e6%95%b0%e9%80%89%e9%a1%b9%e4%b8%ad aria-label=åœ¨setupå‡½æ•°é€‰é¡¹ä¸­>åœ¨setupå‡½æ•°é€‰é¡¹ä¸­</a></li><li><a href=#%e5%9c%a8setup%e8%af%ad%e6%b3%95%e7%b3%96%e4%b8%ad aria-label=åœ¨setupè¯­æ³•ç³–ä¸­>åœ¨setupè¯­æ³•ç³–ä¸­</a></li><li><a href=#%e5%85%b6%e4%bb%96%e5%86%99%e6%b3%95 aria-label=å…¶ä»–å†™æ³•>å…¶ä»–å†™æ³•</a></li></ul></li><li><a href=#%e5%87%bd%e6%95%b0%e7%bb%84%e4%bb%b6%e5%92%8c%e6%8f%92%e6%a7%bd%e7%9a%84%e4%bd%bf%e7%94%a8 aria-label=å‡½æ•°ç»„ä»¶å’Œæ’æ§½çš„ä½¿ç”¨>å‡½æ•°ç»„ä»¶å’Œæ’æ§½çš„ä½¿ç”¨</a></li></ul></li><li><a href=#jsx aria-label=Jsx>Jsx</a><ul><li><a href=#%e9%85%8d%e7%bd%ae aria-label=é…ç½®>é…ç½®</a><ul><li><a href=#vue-cli%e7%8e%af%e5%a2%83 aria-label=vue-cliç¯å¢ƒ>vue-cliç¯å¢ƒ</a></li><li><a href=#vite%e7%8e%af%e5%a2%83 aria-label=viteç¯å¢ƒ>viteç¯å¢ƒ</a></li></ul></li><li><a href=#%e5%9f%ba%e6%9c%ac%e4%bd%bf%e7%94%a8-3 aria-label=åŸºæœ¬ä½¿ç”¨>åŸºæœ¬ä½¿ç”¨</a><ul><li><a href=#%e5%9c%a8render%e5%87%bd%e6%95%b0%e4%b8%ad aria-label=åœ¨renderå‡½æ•°ä¸­>åœ¨renderå‡½æ•°ä¸­</a></li><li><a href=#%e5%9c%a8setup%e5%87%bd%e6%95%b0%e4%b8%ad aria-label=åœ¨setupå‡½æ•°ä¸­>åœ¨setupå‡½æ•°ä¸­</a></li><li><a href=#%e5%9c%a8setup%e8%af%ad%e6%b3%95%e7%b3%96%e4%b8%ad-1 aria-label=åœ¨setupè¯­æ³•ç³–ä¸­>åœ¨setupè¯­æ³•ç³–ä¸­</a></li></ul></li></ul></li><li><a href=#script-setup%e8%af%ad%e6%b3%95%e7%b3%96 aria-label="script setupè¯­æ³•ç³–">script setupè¯­æ³•ç³–</a><ul><li><a href=#%e9%a1%b6%e5%b1%82%e7%9a%84%e7%bb%91%e5%ae%9a%e4%bc%9a%e8%a2%ab%e6%9a%b4%e9%9c%b2%e7%bb%99%e6%a8%a1%e6%9d%bf aria-label=é¡¶å±‚çš„ç»‘å®šä¼šè¢«æš´éœ²ç»™æ¨¡æ¿>é¡¶å±‚çš„ç»‘å®šä¼šè¢«æš´éœ²ç»™æ¨¡æ¿</a></li><li><a href=#defineprops aria-label=defineProps()>defineProps()</a></li><li><a href=#defineemits aria-label=defineEmits()>defineEmits()</a></li><li><a href=#defineexpose aria-label=defineExpose()>defineExpose()</a></li></ul></li><li><a href=#%e8%87%aa%e5%ae%9a%e4%b9%89%e7%bb%84%e4%bb%b6 aria-label=è‡ªå®šä¹‰ç»„ä»¶>è‡ªå®šä¹‰ç»„ä»¶</a><ul><li><a href=#%e6%8c%87%e4%bb%a4%e7%9a%84%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f aria-label=æŒ‡ä»¤çš„ç”Ÿå‘½å‘¨æœŸ>æŒ‡ä»¤çš„ç”Ÿå‘½å‘¨æœŸ</a></li><li><a href=#%e6%8c%87%e4%bb%a4%e9%92%a9%e5%ad%90 aria-label=æŒ‡ä»¤é’©å­>æŒ‡ä»¤é’©å­</a></li><li><a href=#%e7%ae%80%e5%8d%95%e4%bd%bf%e7%94%a8 aria-label=ç®€å•ä½¿ç”¨>ç®€å•ä½¿ç”¨</a><ul><li><a href=#%e9%bb%98%e8%ae%a4%e5%ae%9e%e7%8e%b0%e6%96%b9%e5%bc%8f aria-label=é»˜è®¤å®ç°æ–¹å¼>é»˜è®¤å®ç°æ–¹å¼</a></li><li><a href=#%e4%bd%bf%e7%94%a8%e5%b1%80%e9%83%a8%e6%8c%87%e4%bb%a4 aria-label=ä½¿ç”¨å±€éƒ¨æŒ‡ä»¤>ä½¿ç”¨å±€éƒ¨æŒ‡ä»¤</a></li><li><a href=#%e8%87%aa%e5%ae%9a%e4%b9%89%e5%85%a8%e5%b1%80%e6%8c%87%e4%bb%a4 aria-label=è‡ªå®šä¹‰å…¨å±€æŒ‡ä»¤>è‡ªå®šä¹‰å…¨å±€æŒ‡ä»¤</a><ul><li><a href=#%e8%bf%9b%e8%a1%8c%e6%8a%bd%e5%8f%96 aria-label=è¿›è¡ŒæŠ½å–>è¿›è¡ŒæŠ½å–</a></li></ul></li><li><a href=#setup-1 aria-label=setup>setup</a><ul><li><a href=#%e5%87%bd%e6%95%b0 aria-label=å‡½æ•°>å‡½æ•°</a></li><li><a href=#%e8%af%ad%e6%b3%95%e7%b3%96 aria-label=è¯­æ³•ç³–>è¯­æ³•ç³–</a></li></ul></li></ul></li></ul></li><li><a href=#%e5%86%85%e7%bd%ae%e7%bb%84%e4%bb%b6 aria-label=å†…ç½®ç»„ä»¶>å†…ç½®ç»„ä»¶</a><ul><li><a href=#teleport aria-label=Teleport>Teleport</a><ul><li><a href=#%e5%9f%ba%e6%9c%ac%e4%bd%bf%e7%94%a8-4 aria-label=åŸºæœ¬ä½¿ç”¨>åŸºæœ¬ä½¿ç”¨</a></li><li><a href=#%e6%8c%82%e8%bd%bd%e5%88%b0app%e4%b9%8b%e5%a4%96%e7%9a%84%e6%8c%87%e5%ae%9a%e5%85%83%e7%b4%a0%e4%b8%8a aria-label=æŒ‚è½½åˆ°#appä¹‹å¤–çš„æŒ‡å®šå…ƒç´ ä¸Š>æŒ‚è½½åˆ°#appä¹‹å¤–çš„æŒ‡å®šå…ƒç´ ä¸Š</a></li><li><a href=#%e5%a4%9a%e4%b8%aateleport aria-label=å¤šä¸ªTeleport>å¤šä¸ªTeleport</a></li></ul></li><li><a href=#%e5%85%b6%e4%bb%96 aria-label=å…¶ä»–>å…¶ä»–</a></li></ul></li><li><a href=#vue%e6%8f%92%e4%bb%b6 aria-label=Vueæ’ä»¶>Vueæ’ä»¶</a><ul><li><a href=#%e5%af%b9%e8%b1%a1%e7%b1%bb%e5%9e%8b aria-label=å¯¹è±¡ç±»å‹>å¯¹è±¡ç±»å‹</a></li><li><a href=#%e5%87%bd%e6%95%b0%e7%b1%bb%e5%9e%8b aria-label=å‡½æ•°ç±»å‹>å‡½æ•°ç±»å‹</a></li><li><a href=#%e6%94%b9%e5%86%99%e8%87%aa%e5%ae%9a%e4%b9%89%e6%8c%87%e4%bb%a4 aria-label=æ”¹å†™è‡ªå®šä¹‰æŒ‡ä»¤>æ”¹å†™è‡ªå®šä¹‰æŒ‡ä»¤</a></li></ul></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h2 id=options-apiçš„å¼Šç«¯>Options APIçš„å¼Šç«¯<a hidden class=anchor aria-hidden=true href=#options-apiçš„å¼Šç«¯>#</a></h2><ul><li><p>åœ¨Vue2ä¸­ï¼Œæˆ‘ä»¬ç¼–å†™ç»„ä»¶çš„æ–¹å¼æ˜¯Options APIï¼š</p><ul><li>Options APIçš„ä¸€å¤§ç‰¹ç‚¹å°±æ˜¯åœ¨å¯¹åº”çš„å±æ€§ä¸­ç¼–å†™å¯¹åº”çš„åŠŸèƒ½æ¨¡å—ï¼›</li><li>æ¯”å¦‚dataå®šä¹‰æ•°æ®ã€methodsä¸­å®šä¹‰æ–¹æ³•ã€computedä¸­å®šä¹‰è®¡ç®—å±æ€§ã€watchä¸­ç›‘å¬å±æ€§æ”¹å˜ï¼Œä¹ŸåŒ…æ‹¬ç”Ÿå‘½ å‘¨æœŸé’©å­ï¼›</li></ul></li><li><p>ä½†æ˜¯è¿™ç§ä»£ç æœ‰ä¸€ä¸ªå¾ˆå¤§çš„å¼Šç«¯ï¼š</p><ul><li>å½“æˆ‘ä»¬å®ç°æŸä¸€ä¸ªåŠŸèƒ½æ—¶ï¼Œè¿™ä¸ªåŠŸèƒ½å¯¹åº”çš„ä»£ç é€»è¾‘ä¼šè¢«æ‹†åˆ†åˆ°å„ä¸ªå±æ€§ä¸­ï¼›</li><li>å½“æˆ‘ä»¬ç»„ä»¶å˜å¾—æ›´å¤§ã€æ›´å¤æ‚æ—¶ï¼Œé€»è¾‘å…³æ³¨ç‚¹çš„åˆ—è¡¨å°±ä¼šå¢é•¿ï¼Œé‚£ä¹ˆåŒä¸€ä¸ªåŠŸèƒ½çš„é€»è¾‘å°±ä¼šè¢«æ‹†åˆ†çš„å¾ˆåˆ†æ•£ï¼›</li><li>å°¤å…¶å¯¹äºé‚£äº›ä¸€å¼€å§‹æ²¡æœ‰ç¼–å†™è¿™äº›ç»„ä»¶çš„äººæ¥è¯´ï¼Œè¿™ä¸ªç»„ä»¶çš„ä»£ç æ˜¯éš¾ä»¥é˜…è¯»å’Œç†è§£çš„ï¼ˆé˜…è¯»ç»„ä»¶çš„å…¶ä»–äººï¼‰ï¼›</li></ul></li><li><p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªéå¸¸å¤§çš„ç»„ä»¶ï¼Œå…¶ä¸­çš„é€»è¾‘åŠŸèƒ½æŒ‰ç…§é¢œè‰²è¿›è¡Œäº†åˆ’åˆ†ï¼š</p><ul><li>è¿™ç§ç¢ç‰‡åŒ–çš„ä»£ç ä½¿ç”¨ç†è§£å’Œç»´æŠ¤è¿™ä¸ªå¤æ‚çš„ç»„ä»¶å˜å¾—å¼‚å¸¸å›°éš¾ï¼Œå¹¶ä¸”éšè—äº†æ½œåœ¨çš„é€»è¾‘é—®é¢˜ï¼›</li><li>å¹¶ä¸”å½“æˆ‘ä»¬å¤„ç†å•ä¸ªé€»è¾‘å…³æ³¨ç‚¹æ—¶ï¼Œéœ€è¦ä¸æ–­çš„è·³åˆ°ç›¸åº”çš„ä»£ç å—ä¸­ï¼›</li></ul></li></ul><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202312160000793.png><img src=https://qiniu.waite.wang/202312160000793.png alt=image-20231216000029755></a></div></p><ul><li>å¦‚æœæˆ‘ä»¬èƒ½å°†åŒä¸€ä¸ªé€»è¾‘å…³æ³¨ ç‚¹ç›¸å…³çš„ä»£ç æ”¶é›†åœ¨ä¸€èµ·ä¼šæ›´ å¥½ã€‚</li><li>è¿™å°±æ˜¯Composition APIæƒ³ è¦åšçš„äº‹æƒ…ï¼Œä»¥åŠå¯ä»¥å¸®åŠ©æˆ‘ ä»¬å®Œæˆçš„äº‹æƒ…ã€‚</li><li>ä¹Ÿæœ‰äººæŠŠVue Composition APIç®€ç§°ä¸ºVCAã€‚</li><li>æˆ‘ä»¬æ— éœ€å†ä¸ºäº†ä¸€ä¸ªé€»è¾‘å…³æ³¨ç‚¹åœ¨ä¸åŒçš„é€‰é¡¹å—é—´æ¥å›æ»šåŠ¨åˆ‡æ¢ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥å¾ˆè½»æ¾åœ°å°†è¿™ä¸€ç»„ä»£ç ç§»åŠ¨åˆ°ä¸€ä¸ªå¤–éƒ¨æ–‡ä»¶ä¸­ï¼Œä¸å†éœ€è¦ä¸ºäº†æŠ½è±¡è€Œé‡æ–°ç»„ç»‡ä»£ç ï¼Œå¤§å¤§é™ä½äº†é‡æ„æˆæœ¬ï¼Œè¿™åœ¨é•¿æœŸç»´æŠ¤çš„å¤§å‹é¡¹ç›®ä¸­éå¸¸å…³é”®ã€‚</li></ul><h2 id=è®¤è¯†-ç»„åˆå¼-api-composition-api>è®¤è¯† ç»„åˆå¼ API (Composition API)<a hidden class=anchor aria-hidden=true href=#è®¤è¯†-ç»„åˆå¼-api-composition-api>#</a></h2><blockquote><p><a href=https://cn.vuejs.org/guide/extras/composition-api-faq.html#what-is-composition-api target=_blank>https://cn.vuejs.org/guide/extras/composition-api-faq.html#what-is-composition-api</a></p></blockquote><p>ç»„åˆå¼ API (Composition API) æ˜¯ä¸€ç³»åˆ— API çš„é›†åˆï¼Œä½¿æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‡½æ•°è€Œä¸æ˜¯å£°æ˜é€‰é¡¹çš„æ–¹å¼ä¹¦å†™ Vue ç»„ä»¶ã€‚å®ƒæ˜¯ä¸€ä¸ªæ¦‚æ‹¬æ€§çš„æœ¯è¯­ï¼Œæ¶µç›–äº†ä»¥ä¸‹æ–¹é¢çš„ APIï¼š</p><ul><li><a href=https://cn.vuejs.org/api/reactivity-core.html target=_blank>å“åº”å¼ API</a>ï¼šä¾‹å¦‚ <code>ref()</code> å’Œ <code>reactive()</code>ï¼Œä½¿æˆ‘ä»¬å¯ä»¥ç›´æ¥åˆ›å»ºå“åº”å¼çŠ¶æ€ã€è®¡ç®—å±æ€§å’Œä¾¦å¬å™¨ã€‚</li><li><a href=https://cn.vuejs.org/api/composition-api-lifecycle.html target=_blank>ç”Ÿå‘½å‘¨æœŸé’©å­</a>ï¼šä¾‹å¦‚ <code>onMounted()</code> å’Œ <code>onUnmounted()</code>ï¼Œä½¿æˆ‘ä»¬å¯ä»¥åœ¨ç»„ä»¶å„ä¸ªç”Ÿå‘½å‘¨æœŸé˜¶æ®µæ·»åŠ é€»è¾‘ã€‚</li><li><a href=https://cn.vuejs.org/api/composition-api-dependency-injection.html target=_blank>ä¾èµ–æ³¨å…¥</a>ï¼šä¾‹å¦‚ <code>provide()</code> å’Œ <code>inject()</code>ï¼Œä½¿æˆ‘ä»¬å¯ä»¥åœ¨ä½¿ç”¨å“åº”å¼ API æ—¶ï¼Œåˆ©ç”¨ Vue çš„ä¾èµ–æ³¨å…¥ç³»ç»Ÿã€‚</li></ul><p>ç»„åˆå¼ API æ˜¯ Vue 3 åŠ
<a href=https://blog.vuejs.org/posts/vue-2-7-naruto.html target=_blank>Vue 2.7</a> çš„å†…ç½®åŠŸèƒ½ã€‚å¯¹äºæ›´è€çš„ Vue 2 ç‰ˆæœ¬ï¼Œå¯ä»¥ä½¿ç”¨å®˜æ–¹ç»´æŠ¤çš„æ’ä»¶
<a href=https://github.com/vuejs/composition-api target=_blank><code>@vue/composition-api</code></a>ã€‚åœ¨ Vue 3 ä¸­ï¼Œç»„åˆå¼ API åŸºæœ¬ä¸Šéƒ½ä¼šé…åˆ
<a href=https://cn.vuejs.org/api/sfc-script-setup.html target=_blank>``</a> è¯­æ³•åœ¨å•æ–‡ä»¶ç»„ä»¶ä¸­ä½¿ç”¨ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ç»„åˆå¼ API çš„ç»„ä»¶ç¤ºä¾‹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>ref</span><span class=p>,</span> <span class=nx>onMounted</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å“åº”å¼çŠ¶æ€
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>count</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// æ›´æ”¹çŠ¶æ€ã€è§¦å‘æ›´æ–°çš„å‡½æ•°
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>function</span> <span class=nx>increment</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>count</span><span class=p>.</span><span class=nx>value</span><span class=o>++</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ç”Ÿå‘½å‘¨æœŸé’©å­
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>onMounted</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`è®¡æ•°å™¨åˆå§‹å€¼ä¸º </span><span class=si>${</span><span class=nx>count</span><span class=p>.</span><span class=nx>value</span><span class=si>}</span><span class=sb>ã€‚`</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>button</span> <span class=nt>@click</span><span class=s>=&#34;increment&#34;</span><span class=p>&gt;</span><span class=na>ç‚¹å‡»äº†</span><span class=err>ï¼š</span><span class=p>{{</span> <span class=na>count</span> <span class=p>}}</span> <span class=na>æ¬¡</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>è™½ç„¶è¿™å¥— API çš„é£æ ¼æ˜¯åŸºäºå‡½æ•°çš„ç»„åˆï¼Œä½†<strong>ç»„åˆå¼ API å¹¶ä¸æ˜¯å‡½æ•°å¼ç¼–ç¨‹</strong>ã€‚ç»„åˆå¼ API æ˜¯ä»¥ Vue ä¸­æ•°æ®å¯å˜çš„ã€ç»†ç²’åº¦çš„å“åº”æ€§ç³»ç»Ÿä¸ºåŸºç¡€çš„ï¼Œè€Œå‡½æ•°å¼ç¼–ç¨‹é€šå¸¸å¼ºè°ƒæ•°æ®ä¸å¯å˜ã€‚</p><h2 id=setup>setup()<a hidden class=anchor aria-hidden=true href=#setup>#</a></h2><blockquote><p>ä»¥ä¸‹çš„ä»£ç  å‡ä¼šé‡‡ç”¨é€‰é¡¹å¼çš„å†™æ³•, ç»„åˆå¼ Api çš„å†™æ³•å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£, ä½†åŸºæœ¬åŸç†å·®ä¸å¤š, è€Œä¸” Vue3 é€‰é¡¹å¼å†™æ³•æ˜¯åŸºäºç»„åˆå¼å†™æ³•äº§ç”Ÿçš„!</p></blockquote><p><code>setup()</code> é’©å­æ˜¯åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ç»„åˆå¼ API çš„å…¥å£ï¼Œé€šå¸¸åªåœ¨ä»¥ä¸‹æƒ…å†µä¸‹ä½¿ç”¨ï¼š</p><ol><li>éœ€è¦åœ¨éå•æ–‡ä»¶ç»„ä»¶ä¸­ä½¿ç”¨ç»„åˆå¼ API æ—¶ã€‚</li><li>éœ€è¦åœ¨åŸºäºé€‰é¡¹å¼ API çš„ç»„ä»¶ä¸­é›†æˆåŸºäºç»„åˆå¼ API çš„ä»£ç æ—¶ã€‚</li></ol><h3 id=setupå‡½æ•°çš„å‚æ•°>setupå‡½æ•°çš„å‚æ•°<a hidden class=anchor aria-hidden=true href=#setupå‡½æ•°çš„å‚æ•°>#</a></h3><ul><li>ä¸»è¦æœ‰ä¸¤ä¸ªå‚æ•°:<ul><li>ç¬¬ä¸€ä¸ªå‚æ•°ï¼šprops</li><li>ç¬¬äºŒä¸ªå‚æ•°ï¼šcontext</li></ul></li><li><code>setup</code> å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç»„ä»¶çš„ <code>props</code>ã€‚å’Œæ ‡å‡†çš„ç»„ä»¶ä¸€è‡´ï¼Œä¸€ä¸ª <code>setup</code> å‡½æ•°çš„ <code>props</code> æ˜¯å“åº”å¼çš„ï¼Œå¹¶ä¸”ä¼šåœ¨ä¼ å…¥æ–°çš„ props æ—¶åŒæ­¥æ›´æ–°ã€‚ï¼š<ul><li>å¯¹äºå®šä¹‰propsçš„ç±»å‹ï¼Œæˆ‘ä»¬è¿˜æ˜¯å’Œä¹‹å‰çš„è§„åˆ™æ˜¯ä¸€æ ·çš„ï¼Œåœ¨propsé€‰é¡¹ä¸­å®šä¹‰ï¼›</li><li>å¹¶ä¸”åœ¨templateä¸­ä¾ç„¶æ˜¯å¯ä»¥æ­£å¸¸å»ä½¿ç”¨propsä¸­çš„å±æ€§ï¼Œæ¯”å¦‚messageï¼›</li><li>å¦‚æœæˆ‘ä»¬åœ¨setupå‡½æ•°ä¸­æƒ³è¦ä½¿ç”¨propsï¼Œé‚£ä¹ˆä¸å¯ä»¥é€šè¿‡ this å»è·å–</li></ul></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=c>&lt;!--</span> <span class=nx>æ¨èä½¿ç”¨ä»¥ä¸‹å†™æ³•</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>ref</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>count</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// è¿”å›å€¼ä¼šæš´éœ²ç»™æ¨¡æ¿å’Œå…¶ä»–çš„é€‰é¡¹å¼ API é’©å­
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>count</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>mounted</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>count</span><span class=p>)</span> <span class=c1>// 0
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>button</span> <span class=nt>@click</span><span class=s>=&#34;count++&#34;</span><span class=p>&gt;{{</span> <span class=na>count</span> <span class=p>}}&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=c>&lt;!--</span> <span class=nx>å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å†™æ³•</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>props</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>message</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>type</span><span class=o>:</span> <span class=nb>String</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>required</span><span class=o>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>data</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>counter</span><span class=o>:</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>setup</span><span class=p>(</span><span class=nx>props</span><span class=p>,</span> <span class=p>....){</span>
</span></span><span class=line><span class=cl>      <span class=p>.....</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><ul><li><code>setup</code> å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç»„ä»¶çš„ <code>props</code>ã€‚å’Œæ ‡å‡†çš„ç»„ä»¶ä¸€è‡´ï¼Œä¸€ä¸ª <code>setup</code> å‡½æ•°çš„ <code>props</code> æ˜¯å“åº”å¼çš„ï¼Œå¹¶ä¸”ä¼šåœ¨ä¼ å…¥æ–°çš„ props æ—¶åŒæ­¥æ›´æ–°ã€‚</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>props</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>title</span><span class=o>:</span> <span class=nb>String</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>(</span><span class=nx>props</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>props</span><span class=p>.</span><span class=nx>title</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>è¯·æ³¨æ„å¦‚æœä½ è§£æ„äº† <code>props</code> å¯¹è±¡ï¼Œè§£æ„å‡ºçš„å˜é‡å°†ä¼šä¸¢å¤±å“åº”æ€§ã€‚å› æ­¤æˆ‘ä»¬æ¨èé€šè¿‡ <code>props.xxx</code> çš„å½¢å¼æ¥ä½¿ç”¨å…¶ä¸­çš„ propsã€‚</p><p>å¦‚æœä½ ç¡®å®éœ€è¦è§£æ„ <code>props</code> å¯¹è±¡ï¼Œæˆ–è€…éœ€è¦å°†æŸä¸ª prop ä¼ åˆ°ä¸€ä¸ªå¤–éƒ¨å‡½æ•°ä¸­å¹¶ä¿æŒå“åº”æ€§ï¼Œé‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨
<a href=https://cn.vuejs.org/api/reactivity-utilities.html#torefs target=_blank>toRefs()</a> å’Œ
<a href=https://cn.vuejs.org/api/reactivity-utilities.html#toref target=_blank>toRef()</a> è¿™ä¸¤ä¸ªå·¥å…·å‡½æ•°ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>toRefs</span><span class=p>,</span> <span class=nx>toRef</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>(</span><span class=nx>props</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// å°† `props` è½¬ä¸ºä¸€ä¸ªå…¶ä¸­å…¨æ˜¯ ref çš„å¯¹è±¡ï¼Œç„¶åè§£æ„
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=p>{</span> <span class=nx>title</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>toRefs</span><span class=p>(</span><span class=nx>props</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1>// `title` æ˜¯ä¸€ä¸ªè¿½è¸ªç€ `props.title` çš„ ref
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>title</span><span class=p>.</span><span class=nx>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// æˆ–è€…ï¼Œå°† `props` çš„å•ä¸ªå±æ€§è½¬ä¸ºä¸€ä¸ª ref
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>title</span> <span class=o>=</span> <span class=nx>toRef</span><span class=p>(</span><span class=nx>props</span><span class=p>,</span> <span class=s1>&#39;title&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><ul><li>å¦å¤–ä¸€ä¸ªå‚æ•°æ˜¯contextï¼Œæˆ‘ä»¬ä¹Ÿç§°ä¹‹ä¸ºæ˜¯ä¸€ä¸ªSetupContextï¼Œå®ƒé‡Œé¢åŒ…å«ä¸‰ä¸ªå±æ€§ï¼š<ul><li>attrsï¼šæ‰€æœ‰çš„épropçš„attributeï¼›</li><li>slotsï¼šçˆ¶ç»„ä»¶ä¼ é€’è¿‡æ¥çš„æ’æ§½ï¼ˆè¿™ä¸ªåœ¨ä»¥æ¸²æŸ“å‡½æ•°è¿”å›æ—¶ä¼šæœ‰ä½œç”¨ï¼Œåé¢ä¼šè®²åˆ°ï¼‰ï¼›</li><li>emitï¼šå½“æˆ‘ä»¬ç»„ä»¶å†…éƒ¨éœ€è¦å‘å‡ºäº‹ä»¶æ—¶ä¼šç”¨åˆ°emitï¼ˆå› ä¸ºæˆ‘ä»¬ä¸èƒ½è®¿é—®thisï¼Œæ‰€ä»¥ä¸å¯ä»¥é€šè¿‡ this.$emitå‘å‡ºäº‹ä»¶ï¼‰ï¼›</li></ul></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>(</span><span class=nx>props</span><span class=p>,</span> <span class=nx>context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// é€ä¼  Attributesï¼ˆéå“åº”å¼çš„å¯¹è±¡ï¼Œç­‰ä»·äº $attrsï¼‰
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>attrs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// æ’æ§½ï¼ˆéå“åº”å¼çš„å¯¹è±¡ï¼Œç­‰ä»·äº $slotsï¼‰
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>slots</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// è§¦å‘äº‹ä»¶ï¼ˆå‡½æ•°ï¼Œç­‰ä»·äº $emitï¼‰
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>emit</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// æš´éœ²å…¬å…±å±æ€§ï¼ˆå‡½æ•°ï¼‰
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>expose</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>   <span class=c1>// è¯¥ä¸Šä¸‹æ–‡å¯¹è±¡æ˜¯éå“åº”å¼çš„ï¼Œå¯ä»¥å®‰å…¨åœ°è§£æ„ï¼š
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>setup</span><span class=p>(</span><span class=nx>props</span><span class=p>,</span> <span class=p>{</span><span class=nx>attrs</span><span class=p>,</span> <span class=nx>slots</span><span class=p>,</span> <span class=nx>emit</span><span class=p>})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>props</span><span class=p>.</span><span class=nx>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>attrs</span><span class=p>.</span><span class=nx>id</span><span class=p>,</span> <span class=nx>attrs</span><span class=p>.</span><span class=kr>class</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>slots</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>emit</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><code>attrs</code> å’Œ <code>slots</code> éƒ½æ˜¯æœ‰çŠ¶æ€çš„å¯¹è±¡ï¼Œå®ƒä»¬æ€»æ˜¯ä¼šéšç€ç»„ä»¶è‡ªèº«çš„æ›´æ–°è€Œæ›´æ–°ã€‚è¿™æ„å‘³ç€ä½ åº”å½“é¿å…è§£æ„å®ƒä»¬ï¼Œå¹¶å§‹ç»ˆé€šè¿‡ <code>attrs.x</code> æˆ– <code>slots.x</code> çš„å½¢å¼ä½¿ç”¨å…¶ä¸­çš„å±æ€§ã€‚æ­¤å¤–è¿˜éœ€æ³¨æ„ï¼Œå’Œ <code>props</code> ä¸åŒï¼Œ<code>attrs</code> å’Œ <code>slots</code> çš„å±æ€§éƒ½<strong>ä¸æ˜¯</strong>å“åº”å¼çš„ã€‚å¦‚æœä½ æƒ³è¦åŸºäº <code>attrs</code> æˆ– <code>slots</code> çš„æ”¹å˜æ¥æ‰§è¡Œå‰¯ä½œç”¨ï¼Œé‚£ä¹ˆä½ åº”è¯¥åœ¨ <code>onBeforeUpdate</code> ç”Ÿå‘½å‘¨æœŸé’©å­ä¸­ç¼–å†™ç›¸å…³é€»è¾‘ã€‚</p><blockquote><p>ä»£ç ç¤ºä¾‹</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>HelloWorld</span> <span class=na>msg</span><span class=o>=</span><span class=s>&#34;Welcome to Your Vue.js App&#34;</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;app-attr&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>HelloWorld</span> <span class=nx>from</span> <span class=s1>&#39;./components/HelloWorld.vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;App&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>components</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>HelloWorld</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>style</span><span class=p>&gt;&lt;/</span><span class=nt>style</span><span class=p>&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;hello&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!--</span> <span class=nx>ä½¿ç”¨æ¥å—è¿‡æ¥çš„å‚æ•°</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>{{</span> <span class=nx>msg</span> <span class=p>}}</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;HelloWorld&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ç»„ä»¶æ¥å—çš„å‚æ•°
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>props</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>msg</span><span class=o>:</span> <span class=nb>String</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=c1>// å‘å°„çš„äº‹ä»¶è¿™é‡Œå¯ä»¥æ ‡æ³¨ä¸€ä¸‹
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>emits</span><span class=o>:</span><span class=p>[</span><span class=s1>&#39;change&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>(</span><span class=nx>props</span><span class=p>,</span> <span class=nx>context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// è¿™æ ·å¯ä»¥æ‹¿åˆ°ä¼ é€’è¿‡æ¥çš„msgçš„å€¼
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>props</span><span class=p>.</span><span class=nx>msg</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// attrs
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>attrs</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// å‘å°„äº‹ä»¶
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>context</span><span class=p>.</span><span class=nx>emit</span><span class=p>(</span><span class=s1>&#39;change&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>style</span> <span class=na>scoped</span><span class=p>&gt;&lt;/</span><span class=nt>style</span><span class=p>&gt;</span>
</span></span></code></pre></div><h3 id=setupå‡½æ•°çš„è¿”å›å€¼>setupå‡½æ•°çš„è¿”å›å€¼<a hidden class=anchor aria-hidden=true href=#setupå‡½æ•°çš„è¿”å›å€¼>#</a></h3><p><code>setup</code> ä¹Ÿå¯ä»¥è¿”å›ä¸€ä¸ª
<a href=https://cn.vuejs.org/guide/extras/render-function.html target=_blank>æ¸²æŸ“å‡½æ•°</a>ï¼Œæ­¤æ—¶åœ¨æ¸²æŸ“å‡½æ•°ä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨åœ¨åŒä¸€ä½œç”¨åŸŸä¸‹å£°æ˜çš„å“åº”å¼çŠ¶æ€ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>h</span><span class=p>,</span> <span class=nx>ref</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>count</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>h</span><span class=p>(</span><span class=s1>&#39;div&#39;</span><span class=p>,</span> <span class=nx>count</span><span class=p>.</span><span class=nx>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>è¿”å›ä¸€ä¸ªæ¸²æŸ“å‡½æ•°å°†ä¼šé˜»æ­¢æˆ‘ä»¬è¿”å›å…¶ä»–ä¸œè¥¿ã€‚å¯¹äºç»„ä»¶å†…éƒ¨æ¥è¯´ï¼Œè¿™æ ·æ²¡æœ‰é—®é¢˜ï¼Œä½†å¦‚æœæˆ‘ä»¬æƒ³é€šè¿‡æ¨¡æ¿å¼•ç”¨å°†è¿™ä¸ªç»„ä»¶çš„æ–¹æ³•æš´éœ²ç»™çˆ¶ç»„ä»¶ï¼Œé‚£å°±æœ‰é—®é¢˜äº†ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨
<a href=https://cn.vuejs.org/api/composition-api-setup.html#exposing-public-properties target=_blank><code>expose()</code></a> è§£å†³è¿™ä¸ªé—®é¢˜ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>h</span><span class=p>,</span> <span class=nx>ref</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>(</span><span class=nx>props</span><span class=p>,</span> <span class=p>{</span> <span class=nx>expose</span> <span class=p>})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>count</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>increment</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=o>++</span><span class=nx>count</span><span class=p>.</span><span class=nx>value</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>expose</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>increment</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>h</span><span class=p>(</span><span class=s1>&#39;div&#39;</span><span class=p>,</span> <span class=nx>count</span><span class=p>.</span><span class=nx>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>æ­¤æ—¶çˆ¶ç»„ä»¶å¯ä»¥é€šè¿‡æ¨¡æ¿å¼•ç”¨æ¥è®¿é—®è¿™ä¸ª <code>increment</code> æ–¹æ³•ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>props</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>message</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>type</span><span class=o>:</span> <span class=nb>String</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>required</span><span class=o>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>counter</span> <span class=o>=</span> <span class=mi>100</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// å±€éƒ¨å‡½æ•°
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>increment</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>counter</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>counter</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>title</span><span class=o>:</span> <span class=s2>&#34;Hello Home&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>counter</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>increment</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><ul><li>setupçš„è¿”å›å€¼å¯ä»¥åœ¨æ¨¡æ¿templateä¸­è¢«ä½¿ç”¨</li><li>ä¹Ÿå°±æ˜¯è¯´å¯ä»¥é€šè¿‡setupçš„è¿”å›å€¼æ¥æ›¿ä»£dataé€‰é¡¹</li></ul><blockquote><p><strong>æœ€åå¯¼å‡ºçš„ä¸€å®šè¦æ˜¯ä¸ªå¯¹è±¡</strong></p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;hello&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!--</span> <span class=nx>ä½¿ç”¨å¯¼å‡ºçš„å˜é‡</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;{{</span> <span class=nx>count</span> <span class=p>}}&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!--</span> <span class=nx>ä½¿ç”¨å¯¼å‡ºçš„æ–¹æ³•</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>button</span> <span class=nt>@click</span><span class=s>=&#34;increment&#34;</span><span class=p>&gt;</span><span class=err>+</span> <span class=na>1</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;HelloWorld&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// å®šä¹‰æ™®é€šçš„å˜é‡ï¼Œå¯ä»¥è¢«æ­£å¸¸ä½¿ç”¨
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// ç¼ºç‚¹ : æ•°æ®ä¸æ˜¯å“åº”å¼çš„
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>let</span> <span class=nx>count</span> <span class=o>=</span> <span class=mi>100</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// å®šä¹‰æ–¹æ³•
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>increment</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>count</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>count</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=c1>// å¯¼å‡º
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>count</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>increment</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>style</span> <span class=na>scoped</span><span class=p>&gt;&lt;/</span><span class=nt>style</span><span class=p>&gt;</span>
</span></span></code></pre></div><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202312162228196.gif><img src=https://qiniu.waite.wang/202312162228196.gif alt=img></a></div></p><blockquote><p><strong>å› ä¸ºåªæ˜¯å®šä¹‰äº†ä¸ªå˜é‡ï¼Œç„¶åå¯¼å‡ºäº†ï¼Œå¹¶æ²¡æœ‰ä½¿å®ƒå“åº”å¼</strong></p></blockquote><h3 id=è¡¥å……-ä¸ºä»€ä¹ˆ-setup-ä¸èƒ½ä½¿ç”¨-this>è¡¥å……: ä¸ºä»€ä¹ˆ setup ä¸èƒ½ä½¿ç”¨ this<a hidden class=anchor aria-hidden=true href=#è¡¥å……-ä¸ºä»€ä¹ˆ-setup-ä¸èƒ½ä½¿ç”¨-this>#</a></h3><p>åœ¨Vue 3ä¸­ï¼Œ<code>setup </code>å‡½æ•°æ˜¯ç”¨æ¥æ›¿ä»£ä»¥å‰çš„ <code>data</code>, <code>computed</code>, <code>methods </code>ç­‰é€‰é¡¹çš„ã€‚<code>setup()</code> è‡ªèº«å¹¶ä¸å«å¯¹ç»„ä»¶å®ä¾‹çš„è®¿é—®æƒï¼Œå³åœ¨ <code>setup()</code> ä¸­è®¿é—® <code>this</code> ä¼šæ˜¯ <code>undefined</code>ã€‚ä½ å¯ä»¥åœ¨é€‰é¡¹å¼ API ä¸­è®¿é—®ç»„åˆå¼ API æš´éœ²çš„å€¼ï¼Œä½†åè¿‡æ¥åˆ™ä¸è¡Œã€‚</p><h2 id=å®šä¹‰å“åº”å¼æ•°æ®çš„ä¸¤ç§æ–¹å¼>å®šä¹‰å“åº”å¼æ•°æ®çš„ä¸¤ç§æ–¹å¼<a hidden class=anchor aria-hidden=true href=#å®šä¹‰å“åº”å¼æ•°æ®çš„ä¸¤ç§æ–¹å¼>#</a></h2><h3 id=reactive-api>Reactive API<a hidden class=anchor aria-hidden=true href=#reactive-api>#</a></h3><blockquote><p>å¦‚æœæƒ³ä¸ºåœ¨setupä¸­å®šä¹‰çš„æ•°æ®æä¾›å“åº”å¼çš„ç‰¹æ€§ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨reactiveçš„å‡½æ•°</p><p>ps : å¦‚æœä¼ å…¥ä¸€ä¸ªåŸºæœ¬æ•°æ®ç±»å‹ï¼ˆStringã€Numberã€Booleanï¼‰ä¼šæŠ¥ä¸€ä¸ªè­¦å‘Š</p><p>åº”ç”¨åœºæ™¯ : reactive APIå¯¹ä¼ å…¥çš„ç±»å‹æ˜¯æœ‰é™åˆ¶çš„ï¼Œå®ƒè¦æ±‚æˆ‘ä»¬å¿…é¡»ä¼ å…¥çš„æ˜¯ä¸€ä¸ªå¯¹è±¡æˆ–è€…æ•°ç»„ç±»å‹ï¼Œæœ€å¥½ç›¸äº’æœ‰å…³è”çš„æ•°æ®æ—¶ä½¿ç”¨</p></blockquote><p>æ¯”å¦‚è¯´æƒ³è¦ä¸Šé¢çš„ä¾‹å­å®ç°å“åº”å¼, æˆ‘ä»¬å¯ä»¥åšå¦‚ä¸‹æ“ä½œ</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;hello&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!--</span> <span class=nx>è¿™æ ·ä½¿ç”¨å³å¯</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;{{</span> <span class=nx>state</span><span class=p>.</span><span class=nx>count</span> <span class=p>}}&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>button</span> <span class=nt>@click</span><span class=s>=&#34;increment&#34;</span><span class=p>&gt;</span><span class=err>+</span> <span class=na>1</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=c1>// ä»vueä¸­å¯¼å…¥reactive
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=p>{</span> <span class=nx>reactive</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;HelloWorld&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ä½¿ç”¨reactiveï¼Œä¼šè¿”å›ä¸€ä¸ªå“åº”å¼å¯¹è±¡
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>state</span> <span class=o>=</span> <span class=nx>reactive</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=c1>// åœ¨å¯¹è±¡ä¸­ç¼–å†™è‡ªå·±æ‰€éœ€è¦çš„å±æ€§
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>count</span><span class=o>:</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>increment</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// è¿™æ ·ä½¿ç”¨
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>state</span><span class=p>.</span><span class=nx>count</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>state</span><span class=p>.</span><span class=nx>count</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// å¯¼å‡ºå“åº”å¼stateå¯¹è±¡
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>state</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>increment</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><h4 id=reactiveåˆ¤æ–­çš„api>Reactiveåˆ¤æ–­çš„API<a hidden class=anchor aria-hidden=true href=#reactiveåˆ¤æ–­çš„api>#</a></h4><ul><li>isProxy : æ£€æŸ¥å¯¹è±¡æ˜¯å¦æ˜¯ç”± reactive æˆ– readonlyåˆ›å»ºçš„ proxy</li><li>isReactive : æ£€æŸ¥å¯¹è±¡æ˜¯å¦æ˜¯ç”± reactiveåˆ›å»ºçš„å“åº”å¼ä»£ç†ï¼Œå¦‚æœè¯¥ä»£ç†æ˜¯ readonly å»ºçš„ï¼Œä½†åŒ…è£¹äº†ç”± reactive åˆ›å»ºçš„å¦ä¸€ä¸ªä»£ç†ï¼Œå®ƒä¹Ÿä¼šè¿”å› true</li><li>isReadonly : æ£€æŸ¥å¯¹è±¡æ˜¯å¦æ˜¯ç”± readonly åˆ›å»ºçš„åªè¯»ä»£ç†</li><li>toRaw : è¿”å› reactive æˆ– readonly ä»£ç†çš„åŸå§‹å¯¹è±¡ï¼ˆä¸å»ºè®®ä¿ç•™å¯¹åŸå§‹å¯¹è±¡çš„æŒä¹…å¼•ç”¨ã€‚è¯·è°¨æ…ä½¿ç”¨ï¼‰</li><li>shallowReactive : åˆ›å»ºä¸€ä¸ªå“åº”å¼ä»£ç†ï¼Œå®ƒè·Ÿè¸ªå…¶è‡ªèº« property çš„å“åº”æ€§ï¼Œä½†ä¸æ‰§è¡ŒåµŒå¥—å¯¹è±¡çš„æ·±å±‚å“åº”å¼è½¬æ¢ (æ·±å±‚è¿˜æ˜¯åŸç”Ÿå¯¹è±¡)ï¼Œåªå“åº”ç¬¬ä¸€å±‚</li><li>shallowReadonly : åˆ›å»ºä¸€ä¸ª proxyï¼Œä½¿å…¶è‡ªèº«çš„ property ä¸ºåªè¯»ï¼Œä½†ä¸æ‰§è¡ŒåµŒå¥—å¯¹è±¡çš„æ·±åº¦åªè¯»è½¬æ¢ï¼ˆæ·±å±‚è¿˜æ˜¯å¯è¯»ã€å¯å†™çš„ï¼‰åªæ£€æŸ¥ç¬¬ä¸€å±‚</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>reactive</span><span class=p>,</span> <span class=nx>readonly</span><span class=p>,</span> <span class=nx>isProxy</span><span class=p>,</span> <span class=nx>isReactive</span><span class=p>,</span> <span class=nx>isReadonly</span><span class=p>,</span> <span class=nx>toRaw</span><span class=p>,</span> <span class=nx>shallowReactive</span><span class=p>,</span> <span class=nx>shallowReadonly</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// åˆ›å»ºä¸€ä¸ªå“åº”å¼å¯¹è±¡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>original</span> <span class=o>=</span> <span class=p>{</span> <span class=nx>count</span><span class=o>:</span> <span class=mi>0</span> <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>obj</span> <span class=o>=</span> <span class=nx>reactive</span><span class=p>(</span><span class=nx>original</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// æ£€æŸ¥å¯¹è±¡æ˜¯å¦æ˜¯ä»£ç†å¯¹è±¡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>isProxy</span><span class=p>(</span><span class=nx>obj</span><span class=p>));</span> <span class=c1>// true
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// æ£€æŸ¥å¯¹è±¡æ˜¯å¦æ˜¯ç”± reactive åˆ›å»ºçš„å“åº”å¼ä»£ç†
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>isReactive</span><span class=p>(</span><span class=nx>obj</span><span class=p>));</span> <span class=c1>// true
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// æ£€æŸ¥å¯¹è±¡æ˜¯å¦æ˜¯ç”± readonly åˆ›å»ºçš„åªè¯»ä»£ç†
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>ro</span> <span class=o>=</span> <span class=nx>readonly</span><span class=p>(</span><span class=nx>obj</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>isReadonly</span><span class=p>(</span><span class=nx>ro</span><span class=p>));</span> <span class=c1>// true
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// è¿”å› reactive æˆ– readonly ä»£ç†çš„åŸå§‹å¯¹è±¡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>rawObj</span> <span class=o>=</span> <span class=nx>toRaw</span><span class=p>(</span><span class=nx>obj</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// åˆ›å»ºä¸€ä¸ªæµ…å±‚å“åº”å¼ä»£ç†
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>shallowObj</span> <span class=o>=</span> <span class=nx>shallowReactive</span><span class=p>({</span> <span class=nx>nested</span><span class=o>:</span> <span class=p>{</span> <span class=nx>count</span><span class=o>:</span> <span class=mi>0</span> <span class=p>}</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// åˆ›å»ºä¸€ä¸ªæµ…å±‚åªè¯»ä»£ç†
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>shallowRo</span> <span class=o>=</span> <span class=nx>shallowReadonly</span><span class=p>({</span> <span class=nx>nested</span><span class=o>:</span> <span class=p>{</span> <span class=nx>count</span><span class=o>:</span> <span class=mi>0</span> <span class=p>}</span> <span class=p>});</span>
</span></span></code></pre></div><blockquote><p>ä»¥ä¸‹æ˜¯ä¸€äº›åè¯è§£é‡Š:</p><ul><li>ä»£ç†å¯¹è±¡ï¼šåœ¨Vue 3ä¸­ï¼Œä»£ç†å¯¹è±¡æ˜¯ç”± reactive æˆ– readonly åˆ›å»ºçš„å¯¹è±¡çš„ä»£ç†ï¼Œç”¨äºè·Ÿè¸ªå¯¹è±¡çš„å±æ€§çš„å˜åŒ–ã€‚</li><li>readonlyï¼šreadonly æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºåˆ›å»ºä¸€ä¸ªåªè¯»çš„ä»£ç†å¯¹è±¡ï¼Œè¯¥ä»£ç†å¯¹è±¡åªèƒ½è¯»å–å±æ€§å€¼ï¼Œä¸èƒ½ä¿®æ”¹å±æ€§å€¼ã€‚</li><li>æµ…å±‚å“åº”å¼ï¼šæµ…å±‚å“åº”å¼æ˜¯æŒ‡åªæœ‰å¯¹è±¡çš„ç¬¬ä¸€å±‚å±æ€§ä¼šè¢«è®¾ç½®ä¸ºå“åº”å¼ï¼Œè€ŒåµŒå¥—å¯¹è±¡çš„å±æ€§ä¸ä¼šè¢«è®¾ç½®ä¸ºå“åº”å¼ã€‚</li><li>æµ…å±‚åªè¯»ä»£ç†ï¼šæµ…å±‚åªè¯»ä»£ç†æ˜¯æŒ‡åªæœ‰å¯¹è±¡çš„ç¬¬ä¸€å±‚å±æ€§ä¼šè¢«è®¾ç½®ä¸ºåªè¯»ï¼Œè€ŒåµŒå¥—å¯¹è±¡çš„å±æ€§ä¸ä¼šè¢«è®¾ç½®ä¸ºåªè¯»ã€‚</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>reactive</span><span class=p>,</span> <span class=nx>readonly</span><span class=p>,</span> <span class=nx>shallowReactive</span><span class=p>,</span> <span class=nx>shallowReadonly</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// åˆ›å»ºä¸€ä¸ªæ™®é€šå¯¹è±¡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>original</span> <span class=o>=</span> <span class=p>{</span> <span class=nx>count</span><span class=o>:</span> <span class=mi>0</span><span class=p>,</span> <span class=nx>nested</span><span class=o>:</span> <span class=p>{</span> <span class=nx>count</span><span class=o>:</span> <span class=mi>1</span> <span class=p>}</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// åˆ›å»ºä¸€ä¸ªå“åº”å¼ä»£ç†å¯¹è±¡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>reactiveObj</span> <span class=o>=</span> <span class=nx>reactive</span><span class=p>(</span><span class=nx>original</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>reactiveObj</span><span class=p>.</span><span class=nx>count</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span> <span class=c1>// å¯ä»¥ä¿®æ”¹å±æ€§å€¼
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>reactiveObj</span><span class=p>.</span><span class=nx>nested</span><span class=p>.</span><span class=nx>count</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span> <span class=c1>// åµŒå¥—å¯¹è±¡çš„å±æ€§ä¹Ÿä¼šè¢«è®¾ç½®ä¸ºå“åº”å¼
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// åˆ›å»ºä¸€ä¸ªåªè¯»ä»£ç†å¯¹è±¡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>readonlyObj</span> <span class=o>=</span> <span class=nx>readonly</span><span class=p>(</span><span class=nx>original</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// readonlyObj.count = 2; // è¯•å›¾ä¿®æ”¹åªè¯»å±æ€§ä¼šæŠ¥é”™
</span></span></span><span class=line><span class=cl><span class=c1>// readonlyObj.nested.count = 2; // åµŒå¥—å¯¹è±¡çš„å±æ€§ä¹Ÿæ˜¯åªè¯»çš„
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// åˆ›å»ºä¸€ä¸ªæµ…å±‚å“åº”å¼ä»£ç†å¯¹è±¡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>shallowReactiveObj</span> <span class=o>=</span> <span class=nx>shallowReactive</span><span class=p>(</span><span class=nx>original</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>shallowReactiveObj</span><span class=p>.</span><span class=nx>count</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span> <span class=c1>// å¯ä»¥ä¿®æ”¹å±æ€§å€¼
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>shallowReactiveObj</span><span class=p>.</span><span class=nx>nested</span><span class=p>.</span><span class=nx>count</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span> <span class=c1>// åµŒå¥—å¯¹è±¡çš„å±æ€§ä¸ä¼šè¢«è®¾ç½®ä¸ºå“åº”å¼
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// åˆ›å»ºä¸€ä¸ªæµ…å±‚åªè¯»ä»£ç†å¯¹è±¡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>shallowReadonlyObj</span> <span class=o>=</span> <span class=nx>shallowReadonly</span><span class=p>(</span><span class=nx>original</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>shallowReadonlyObj</span><span class=p>.</span><span class=nx>count</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span> <span class=c1>// è¯•å›¾ä¿®æ”¹åªè¯»å±æ€§ä¼šæŠ¥é”™
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>shallowReadonlyObj</span><span class=p>.</span><span class=nx>nested</span><span class=p>.</span><span class=nx>count</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span> <span class=c1>// åµŒå¥—å¯¹è±¡çš„å±æ€§ä¸ä¼šè¢«è®¾ç½®ä¸ºåªè¯»
</span></span></span></code></pre></div></blockquote><h3 id=ref-api>Ref API<a hidden class=anchor aria-hidden=true href=#ref-api>#</a></h3><blockquote><p><strong>Refå‡½æ•° : å®šä¹‰ç®€å•ç±»å‹çš„æ•°æ®ï¼Œä¹Ÿå¯ä»¥å®šä¹‰å¤æ‚ç±»å‹çš„æ•°æ®</strong></p><p><strong>åº”ç”¨åœºæ™¯ : å®šä¹‰ä¸€äº›ç®€å•çš„æ•°æ®ï¼Œæˆ–è€…ä»æ¥å£ä¸­è·å¾—çš„æ•°æ®</strong></p></blockquote><ul><li>ref ä¼šè¿”å›ä¸€ä¸ªå¯å˜çš„å“åº”å¼å¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä½œä¸ºä¸€ä¸ª å“åº”å¼çš„å¼•ç”¨ ç»´æŠ¤ç€å®ƒå†…éƒ¨çš„å€¼ï¼Œè¿™å°±æ˜¯refåç§°çš„æ¥æº</li><li>å®ƒå†…éƒ¨çš„å€¼æ˜¯åœ¨<code>ref</code>çš„ <code>value</code> å±æ€§ä¸­è¢«ç»´æŠ¤çš„</li><li>ä¸ç®¡ä¼ å…¥çš„æ˜¯åŸºæœ¬ç±»å‹è¿˜æ˜¯å¼•ç”¨ç±»å‹ï¼Œéƒ½æ”¾åœ¨<code>.value</code>ä¸­</li></ul><blockquote><p>ä½¿ç”¨çš„æ—¶å€™æ˜¯ç”¨ .valueï¼Œä½†æ˜¯æœ‰ä¸¤ä¸ªæ³¨æ„äº‹é¡¹:</p><ul><li>åœ¨æ¨¡æ¿ä¸­å¼•å…¥refçš„å€¼æ—¶ï¼ŒVueä¼šè‡ªåŠ¨å¸®åŠ©æˆ‘ä»¬è¿›è¡Œè§£åŒ…æ“ä½œï¼Œæ‰€ä»¥å¹¶ä¸éœ€è¦åœ¨æ¨¡æ¿ä¸­é€šè¿‡ ref.value çš„æ–¹å¼ï¼Œç›´æ¥ä½¿ç”¨å³å¯</li><li>åœ¨ setup å‡½æ•°å†…éƒ¨ï¼Œå®ƒä¾ç„¶æ˜¯ä¸€ä¸ª refå¼•ç”¨ï¼Œ æ‰€ä»¥å¯¹å…¶è¿›è¡Œæ“ä½œæ—¶ï¼Œä¾ç„¶éœ€è¦ä½¿ç”¨ ref.valueçš„æ–¹å¼</li></ul></blockquote><h4 id=åŸºæœ¬ä½¿ç”¨>åŸºæœ¬ä½¿ç”¨<a hidden class=anchor aria-hidden=true href=#åŸºæœ¬ä½¿ç”¨>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;hello&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!--</span> <span class=nx>è¿™æ ·ä½¿ç”¨å³å¯</span><span class=err>ï¼Œ</span><span class=nx>ä¸éœ€è¦ä½¿ç”¨count</span><span class=p>.</span><span class=nx>value</span><span class=err>ï¼Œ</span><span class=nx>ä¼šè‡ªåŠ¨è§£åŒ…</span><span class=err>ï¼Œ</span><span class=nx>å–å‡ºå…¶ä¸­çš„value</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;{{</span> <span class=nx>count</span> <span class=p>}}&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>button</span> <span class=nt>@click</span><span class=s>=&#34;increment&#34;</span><span class=p>&gt;</span><span class=err>+</span> <span class=na>1</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=c1>// ä»vueä¸­å¯¼å…¥ref
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=p>{</span> <span class=nx>ref</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;HelloWorld&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ä½¿ç”¨Refï¼Œä¼šè¿”å›ä¸€ä¸ªå“åº”å¼å¯¹è±¡
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>let</span> <span class=nx>count</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=mi>100</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>increment</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// è¿™æ ·ä½¿ç”¨,éœ€è¦ä½¿ç”¨ .value
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>count</span><span class=p>.</span><span class=nx>value</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>count</span><span class=p>.</span><span class=nx>value</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// ç›´æ¥å¯¼å‡ºcountå³å¯
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>count</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>increment</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><h4 id=refè‡ªåŠ¨è§£åŒ…>Refè‡ªåŠ¨è§£åŒ…<a hidden class=anchor aria-hidden=true href=#refè‡ªåŠ¨è§£åŒ…>#</a></h4><ul><li>æ¨¡æ¿ä¸­çš„è§£åŒ…æ˜¯æµ…å±‚çš„è§£åŒ…ï¼Œå¦‚æœæˆ‘ä»¬çš„ä»£ç æ˜¯ä¸‹é¢çš„æ–¹å¼ï¼š</li><li>å¦‚æœæˆ‘ä»¬å°†<code>ref</code>æ”¾åˆ°ä¸€ä¸ª<code>reactive</code>çš„å±æ€§å½“ä¸­ï¼Œé‚£ä¹ˆåœ¨æ¨¡æ¿ä¸­ä½¿ç”¨æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨è§£åŒ…ï¼š</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>count</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>obj</span> <span class=o>=</span> <span class=nx>reactive</span><span class=p>({</span> <span class=nx>count</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ref ä¼šè¢«è§£åŒ…
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>obj</span><span class=p>.</span><span class=nx>count</span> <span class=o>===</span> <span class=nx>count</span><span class=p>.</span><span class=nx>value</span><span class=p>)</span> <span class=c1>// true
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// ä¼šæ›´æ–° `obj.count`
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>count</span><span class=p>.</span><span class=nx>value</span><span class=o>++</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>count</span><span class=p>.</span><span class=nx>value</span><span class=p>)</span> <span class=c1>// 2
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>obj</span><span class=p>.</span><span class=nx>count</span><span class=p>)</span> <span class=c1>// 2
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// ä¹Ÿä¼šæ›´æ–° `count` ref
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>obj</span><span class=p>.</span><span class=nx>count</span><span class=o>++</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>obj</span><span class=p>.</span><span class=nx>count</span><span class=p>)</span> <span class=c1>// 3
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>count</span><span class=p>.</span><span class=nx>value</span><span class=p>)</span> <span class=c1>// 3
</span></span></span></code></pre></div><p>æ³¨æ„å½“è®¿é—®åˆ°æŸä¸ªå“åº”å¼æ•°ç»„æˆ– <code>Map</code> è¿™æ ·çš„åŸç”Ÿé›†åˆç±»å‹ä¸­çš„ ref å…ƒç´ æ—¶ï¼Œ<strong>ä¸ä¼š</strong>æ‰§è¡Œ ref çš„è§£åŒ…ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>books</span> <span class=o>=</span> <span class=nx>reactive</span><span class=p>([</span><span class=nx>ref</span><span class=p>(</span><span class=s1>&#39;Vue 3 Guide&#39;</span><span class=p>)])</span>
</span></span><span class=line><span class=cl><span class=c1>// è¿™é‡Œéœ€è¦ .value
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>books</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=nx>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>map</span> <span class=o>=</span> <span class=nx>reactive</span><span class=p>(</span><span class=k>new</span> <span class=nx>Map</span><span class=p>([[</span><span class=s1>&#39;count&#39;</span><span class=p>,</span> <span class=nx>ref</span><span class=p>(</span><span class=mi>0</span><span class=p>)]]))</span>
</span></span><span class=line><span class=cl><span class=c1>// è¿™é‡Œéœ€è¦ .value
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>map</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;count&#39;</span><span class=p>).</span><span class=nx>value</span><span class=p>)</span>
</span></span></code></pre></div><h4 id=refåˆ¤æ–­çš„api>Refåˆ¤æ–­çš„API<a hidden class=anchor aria-hidden=true href=#refåˆ¤æ–­çš„api>#</a></h4><ul><li>isRef : åˆ¤æ–­å€¼æ˜¯å¦æ˜¯ä¸€ä¸ªrefå¯¹è±¡</li><li>unref : å¦‚æœæˆ‘ä»¬æƒ³è¦è·å–ä¸€ä¸ªrefå¼•ç”¨ä¸­çš„valueï¼Œé‚£ä¹ˆä¹Ÿå¯ä»¥é€šè¿‡unrefæ–¹æ³•<ul><li>å¦‚æœå‚æ•°æ˜¯ä¸€ä¸ª refï¼Œåˆ™è¿”å›å†…éƒ¨å€¼ï¼Œå¦åˆ™è¿”å›å‚æ•°æœ¬èº«</li><li>è¿™æ˜¯ val = isRef(val) ? val.value : val çš„è¯­æ³•ç³–å‡½æ•°</li></ul></li><li>shallowRefï¼šshallowRef æ˜¯ç”¨æ¥åˆ›å»ºä¸€ä¸ªæµ…å±‚çš„ ref å¯¹è±¡çš„å‡½æ•°ã€‚æµ…å±‚çš„æ„æ€æ˜¯åªæœ‰å¯¹è±¡çš„ç¬¬ä¸€å±‚å±æ€§ä¼šè¢«è®¾ç½®ä¸ºå“åº”å¼ï¼Œè€ŒåµŒå¥—å¯¹è±¡çš„å±æ€§ä¸ä¼šè¢«è®¾ç½®ä¸ºå“åº”å¼ã€‚è¿™æ„å‘³ç€å¯¹åµŒå¥—å¯¹è±¡å±æ€§çš„ä¿®æ”¹ä¸ä¼šè§¦å‘å“åº”ã€‚</li><li>triggerRefï¼štriggerRef ç”¨äºæ‰‹åŠ¨è§¦å‘ä¸ shallowRef ç›¸å…³è”çš„å‰¯ä½œç”¨ã€‚å½“ shallowRef å…³è”çš„æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œç›¸å…³çš„å‰¯ä½œç”¨å°†è¢«è§¦å‘æ‰§è¡Œã€‚</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>ref</span><span class=p>,</span> <span class=nx>isRef</span><span class=p>,</span> <span class=nx>unref</span><span class=p>,</span> <span class=nx>shallowRef</span><span class=p>,</span> <span class=nx>triggerRef</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// åˆ¤æ–­å€¼æ˜¯å¦æ˜¯ä¸€ä¸ª ref å¯¹è±¡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>count</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>isRef</span><span class=p>(</span><span class=nx>count</span><span class=p>));</span> <span class=c1>// true
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// è·å– ref å¼•ç”¨ä¸­çš„å€¼
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>value</span> <span class=o>=</span> <span class=nx>unref</span><span class=p>(</span><span class=nx>count</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// è¯­æ³•ç³–å‡½æ•°ç¤ºä¾‹
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>val</span> <span class=o>=</span> <span class=nx>isRef</span><span class=p>(</span><span class=nx>count</span><span class=p>)</span> <span class=o>?</span> <span class=nx>count</span><span class=p>.</span><span class=nx>value</span> <span class=o>:</span> <span class=nx>count</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// åˆ›å»ºä¸€ä¸ªæµ…å±‚çš„ ref å¯¹è±¡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>shallowCount</span> <span class=o>=</span> <span class=nx>shallowRef</span><span class=p>({</span> <span class=nx>value</span><span class=o>:</span> <span class=mi>0</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=nx>shallowCount</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span> <span class=c1>// å¯ä»¥ç›´æ¥ä¿®æ”¹ value å±æ€§
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// æ‰‹åŠ¨è§¦å‘ä¸ shallowRef ç›¸å…³è”çš„å‰¯ä½œç”¨
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>triggerRef</span><span class=p>(</span><span class=nx>shallowCount</span><span class=p>);</span>
</span></span></code></pre></div><h4 id=è‡ªå®šä¹‰ref--customref>è‡ªå®šä¹‰Ref => <strong>customRef</strong><a hidden class=anchor aria-hidden=true href=#è‡ªå®šä¹‰ref--customref>#</a></h4><ul><li>åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„refï¼Œå¹¶å¯¹å…¶ä¾èµ–é¡¹è·Ÿè¸ªå’Œæ›´æ–°è§¦å‘è¿›è¡Œæ˜¾ç¤ºæ§åˆ¶ï¼š<ul><li>å®ƒéœ€è¦ä¸€ä¸ªå·¥å‚å‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥å— <code>track </code>å’Œ <code>trigger </code>å‡½æ•°ä½œä¸ºå‚æ•°ï¼›</li><li>å¹¶ä¸”åº”è¯¥è¿”å›ä¸€ä¸ªå¸¦æœ‰ <code>get </code>å’Œ <code>set</code> çš„å¯¹è±¡ï¼›</li></ul></li><li>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªçš„æ¡ˆä¾‹ï¼š<ul><li>å¯¹åŒå‘ç»‘å®šçš„å±æ€§è¿›è¡Œdebounce(èŠ‚æµ)çš„æ“ä½œ</li></ul></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>customRef</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// è‡ªå®šä¹‰ref
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>export</span> <span class=k>default</span> <span class=kd>function</span><span class=p>(</span><span class=nx>value</span><span class=p>,</span> <span class=nx>delay</span> <span class=o>=</span> <span class=mi>300</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>timer</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span> 
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>customRef</span><span class=p>((</span><span class=nx>track</span><span class=p>,</span> <span class=nx>trigger</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>get</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>track</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nx>set</span><span class=p>(</span><span class=nx>newValue</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>clearTimeout</span><span class=p>(</span><span class=nx>timer</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>timer</span> <span class=o>=</span> <span class=nx>setTimeout</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>value</span> <span class=o>=</span> <span class=nx>newValue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          <span class=nx>trigger</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span> <span class=nx>delay</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>v</span><span class=nt>-model</span><span class=err>=&#34;</span><span class=na>message</span><span class=err>&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h2</span><span class=p>&gt;{{</span><span class=nx>message</span><span class=p>}}&lt;/</span><span class=nt>h2</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=kr>import</span> <span class=nx>debounceRef</span> <span class=nx>from</span> <span class=s1>&#39;./hook/useDebounceRef&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>message</span> <span class=o>=</span> <span class=nx>debounceRef</span><span class=p>(</span><span class=s2>&#34;Hello World&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>message</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><h2 id=readonly>readonly<a hidden class=anchor aria-hidden=true href=#readonly>#</a></h2><h3 id=æ¦‚å¿µ>æ¦‚å¿µ<a hidden class=anchor aria-hidden=true href=#æ¦‚å¿µ>#</a></h3><blockquote><p>åœ¨æˆ‘ä»¬ä¼ é€’ç»™å…¶ä»–ç»„ä»¶æ•°æ®æ—¶ï¼Œå¾€å¾€å¸Œæœ›å…¶ä»–ç»„ä»¶ä½¿ç”¨æˆ‘ä»¬ä¼ é€’çš„å†…å®¹ï¼Œä½†æ˜¯ä¸å…è®¸å®ƒä»¬ä¿®æ”¹æ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨ <code>readonly</code>äº†ï¼›</p></blockquote><ul><li>åªè¯»ä»£ç†æ˜¯æ·±å±‚çš„ï¼šå¯¹ä»»ä½•åµŒå¥—å±æ€§çš„è®¿é—®éƒ½å°†æ˜¯åªè¯»çš„ã€‚å®ƒçš„ ref è§£åŒ…è¡Œä¸ºä¸ <code>reactive()</code> ç›¸åŒï¼Œä½†è§£åŒ…å¾—åˆ°çš„å€¼æ˜¯åªè¯»çš„ã€‚</li><li>è¦é¿å…æ·±å±‚çº§çš„è½¬æ¢è¡Œä¸ºï¼Œè¯·ä½¿ç”¨
<a href=https://cn.vuejs.org/api/reactivity-advanced.html#shallowreadonly target=_blank>shallowReadonly()</a> ä½œæ›¿ä»£ã€‚</li><li>åœ¨å¼€å‘ä¸­å¸¸è§çš„readonlyæ–¹æ³•ä¼šä¼ å…¥ä¸‰ä¸ªç±»å‹çš„å‚æ•°ï¼š<ul><li>ç±»å‹ä¸€ï¼šæ™®é€šå¯¹è±¡</li><li>ç±»å‹äºŒï¼šreactiveè¿”å›çš„å¯¹è±¡</li><li>ç±»å‹ä¸‰ï¼šrefçš„å¯¹è±¡</li></ul></li><li>åœ¨readonlyçš„ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæœ‰å¦‚ä¸‹è§„åˆ™ :<ul><li>readonlyè¿”å›çš„å¯¹è±¡éƒ½æ˜¯ä¸å…è®¸ä¿®æ”¹çš„</li><li>ä½†æ˜¯ç»è¿‡readonlyå¤„ç†çš„åŸæ¥çš„å¯¹è±¡æ˜¯å…è®¸è¢«ä¿®æ”¹çš„<ul><li>æ¯”å¦‚ const info = readonly(obj)ï¼Œinfoå¯¹è±¡æ˜¯ä¸å…è®¸è¢«ä¿®æ”¹çš„</li><li>å½“objè¢«ä¿®æ”¹æ—¶ï¼Œreadonlyè¿”å›çš„infoå¯¹è±¡ä¹Ÿä¼šè¢«ä¿®æ”¹</li><li>ä½†æ˜¯ä¸èƒ½å»ä¿®æ”¹readonlyè¿”å›çš„å¯¹è±¡info</li></ul></li></ul></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;hello&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>button</span> <span class=nt>@click</span><span class=s>=&#34;btnClick&#34;</span><span class=p>&gt;</span><span class=na>æŒ‰é’®</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>reactive</span><span class=p>,</span> <span class=nx>readonly</span><span class=p>,</span> <span class=nx>watchEffect</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>original</span> <span class=o>=</span> <span class=nx>reactive</span><span class=p>({</span> <span class=nx>count</span><span class=o>:</span> <span class=mi>0</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>copy</span> <span class=o>=</span> <span class=nx>readonly</span><span class=p>(</span><span class=nx>original</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>btnClick</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>original</span><span class=p>.</span><span class=nx>count</span><span class=o>++</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>watchEffect</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ç”¨æ¥åšå“åº”æ€§è¿½è¸ª
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>copy</span><span class=p>.</span><span class=nx>count</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// æ›´æ”¹æºå±æ€§ä¼šè§¦å‘å…¶ä¾èµ–çš„ä¾¦å¬å™¨
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>original</span><span class=p>.</span><span class=nx>count</span><span class=o>++</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// æ›´æ”¹è¯¥åªè¯»å‰¯æœ¬å°†ä¼šå¤±è´¥ï¼Œå¹¶ä¼šå¾—åˆ°ä¸€ä¸ªè­¦å‘Š
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>copy</span><span class=p>.</span><span class=nx>count</span><span class=o>++</span> <span class=c1>// warning!
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><h2 id=torefs--toref>toRefs && toRef<a hidden class=anchor aria-hidden=true href=#torefs--toref>#</a></h2><h3 id=torefs><strong>toRefs</strong><a hidden class=anchor aria-hidden=true href=#torefs>#</a></h3><blockquote><p>å¦‚æœä½¿ç”¨ES6çš„è§£æ„è¯­æ³•ï¼Œå¯¹reactiveè¿”å›çš„å¯¹è±¡è¿›è¡Œè§£æ„è·å–å€¼ï¼Œé‚£ä¹ˆä¹‹åæ— è®ºæ˜¯ä¿®æ”¹ç»“æ„åçš„å˜é‡ï¼Œè¿˜æ˜¯ä¿®æ”¹reactive è¿”å›çš„stateå¯¹è±¡ï¼Œæ•°æ®éƒ½ä¸å†æ˜¯å“åº”å¼çš„</p></blockquote><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202312171700262.png><img src=https://qiniu.waite.wang/202312171700262.png alt=image-20231217170024283></a></div></p><ul><li>å¦‚ä½•æ”¹æˆå“åº”å¼å‘¢ï¼ŒVueæä¾›äº†ä¸€ä¸ªtoRefsçš„å‡½æ•°</li><li>å¯ä»¥å°†reactiveè¿”å›çš„å¯¹è±¡ä¸­çš„å±æ€§éƒ½è½¬æˆrefï¼Œè¿™æ ·è§£æ„å‡ºæ¥çš„å°±æ˜¯å“åº”å¼çš„äº†</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;hello&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;{{</span> <span class=nx>age</span> <span class=p>}}&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>button</span> <span class=nt>@click</span><span class=s>=&#34;increment&#34;</span><span class=p>&gt;</span><span class=err>+</span><span class=na>age</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=c1>// ä»vueä¸­å¯¼å…¥ref
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=p>{</span> <span class=nx>reactive</span><span class=p>,</span> <span class=nx>ref</span><span class=p>,</span> <span class=nx>readonly</span><span class=p>,</span> <span class=nx>toRefs</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;HelloWorld&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>info</span> <span class=o>=</span> <span class=nx>reactive</span><span class=p>({</span> <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;star&#39;</span><span class=p>,</span> <span class=nx>age</span><span class=o>:</span> <span class=mi>18</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ä½¿ç”¨toRefsåŒ…è£¹éœ€è¦ç»“æ„çš„reactiveå¯¹è±¡ï¼Œè¿™æ ·è§£æ„å‡ºæ¥çš„å€¼ä¹Ÿæ˜¯å“åº”å¼çš„
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>let</span> <span class=p>{</span> <span class=nx>name</span><span class=p>,</span> <span class=nx>age</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>toRefs</span><span class=p>(</span><span class=nx>info</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>increment</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>info</span><span class=p>.</span><span class=nx>age</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=c1>// ğŸ‘†è¿™æ ·éƒ½å¯ä»¥ä¿®æ”¹ageï¼Œéƒ½æ˜¯å“åº”å¼çš„ğŸ‘‡
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=c1>// ç›¸å½“äºå·²ç»å»ºç«‹äº†é“¾æ¥ï¼Œä»»ä½•ä¸€ä¸ªä¿®æ”¹éƒ½ä¼šå¼•èµ·å¦å¤–ä¸€ä¸ªå˜åŒ–
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>age</span><span class=p>.</span><span class=nx>value</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>age</span><span class=p>,</span> <span class=nx>info</span><span class=p>.</span><span class=nx>age</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>age</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>increment</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>style</span> <span class=na>scoped</span><span class=p>&gt;&lt;/</span><span class=nt>style</span><span class=p>&gt;</span>
</span></span></code></pre></div><h3 id=toref><strong>toRef</strong><a hidden class=anchor aria-hidden=true href=#toref>#</a></h3><blockquote><p>å¦‚æœåªå¸Œæœ›è½¬æ¢reactiveå¯¹è±¡ä¸­çš„å…¶ä¸­æŸä¸ªå±æ€§ä¸ºref, é‚£ä¹ˆå¯ä»¥ä½¿ç”¨toRefçš„æ–¹æ³•</p><p><strong>ps : è¿™ä¸ªæ•ˆç‡ä¼šæ›´é«˜ç‚¹, è¿™ç§åšæ³•ç›¸å½“äºå·²ç»åœ¨state.nameå’Œref.valueä¹‹é—´å»ºç«‹äº† é“¾æ¥ï¼Œä»»ä½•ä¸€ä¸ªä¿®æ”¹éƒ½ä¼šå¼•èµ·å¦å¤–ä¸€ä¸ªå˜åŒ–</strong></p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>let</span> <span class=nx>age</span> <span class=o>=</span> <span class=nx>toRef</span><span class=p>(</span><span class=nx>info</span><span class=p>,</span> <span class=s2>&#34;age&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>changeAge</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>age</span><span class=p>.</span><span class=nx>value</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=computed>computed<a hidden class=anchor aria-hidden=true href=#computed>#</a></h2><ul><li>åœ¨å‰é¢çš„Options APIä¸­ï¼Œæˆ‘ä»¬æ˜¯ä½¿ç”¨computedé€‰é¡¹æ¥å®Œæˆçš„ï¼›</li><li>åœ¨Composition APIä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ setup å‡½æ•°ä¸­ä½¿ç”¨ computed æ–¹æ³•æ¥ç¼–å†™ä¸€ä¸ªè®¡ç®—å±æ€§ï¼›</li></ul><ul><li>å¦‚ä½•ä½¿ç”¨computedå‘¢ï¼Ÿ<ul><li>æ–¹å¼ä¸€ï¼šæ¥æ”¶ä¸€ä¸ªgetterå‡½æ•°ï¼Œå¹¶ä¸º getter å‡½æ•°è¿”å›çš„å€¼ï¼Œè¿”å›ä¸€ä¸ªä¸å˜çš„ ref å¯¹è±¡ï¼›</li><li>æ–¹å¼äºŒï¼šæ¥æ”¶ä¸€ä¸ªå…·æœ‰ get å’Œ set çš„å¯¹è±¡ï¼Œè¿”å›ä¸€ä¸ªå¯å˜çš„ï¼ˆå¯è¯»å†™ï¼‰ref å¯¹è±¡ï¼›</li></ul></li></ul><h3 id=æ–¹å¼ä¸€>æ–¹å¼ä¸€<a hidden class=anchor aria-hidden=true href=#æ–¹å¼ä¸€>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!--</span> <span class=nx>coderstar</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>{{</span> <span class=nx>fullName</span> <span class=p>}}</span>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!--</span> <span class=nx>ä¸€èˆ¬</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>{{</span> <span class=nx>scoreState</span> <span class=p>}}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>computed</span><span class=p>,</span> <span class=nx>reactive</span><span class=p>,</span> <span class=nx>ref</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;App&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>names</span> <span class=o>=</span> <span class=nx>reactive</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>firstName</span><span class=o>:</span> <span class=s1>&#39;coder&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>lastName</span><span class=o>:</span> <span class=s1>&#39;star&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ç›´æ¥ä½¿ç”¨getterå‡½æ•°ï¼Œæ­£å¸¸æ¥è¯´éƒ½è¿™ä¹ˆä½¿ç”¨
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>fullName</span> <span class=o>=</span> <span class=nx>computed</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=nx>names</span><span class=p>.</span><span class=nx>firstName</span> <span class=o>+</span> <span class=nx>names</span><span class=p>.</span><span class=nx>lastName</span><span class=p>);</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>score</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=mi>88</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>scoreState</span> <span class=o>=</span> <span class=nx>computed</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>(</span><span class=nx>score</span><span class=p>.</span><span class=nx>value</span> <span class=o>&gt;</span> <span class=mi>90</span> <span class=o>?</span> <span class=s1>&#39;ä¼˜ç§€&#39;</span> <span class=o>:</span> <span class=s1>&#39;ä¸€èˆ¬&#39;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>fullName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>scoreState</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><h3 id=æ–¹å¼äºŒ>æ–¹å¼äºŒ<a hidden class=anchor aria-hidden=true href=#æ–¹å¼äºŒ>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>{{</span> <span class=nx>fullName</span> <span class=p>}}</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>button</span> <span class=nt>@click</span><span class=s>=&#34;changeName&#34;</span><span class=p>&gt;</span><span class=na>change</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>computed</span><span class=p>,</span> <span class=nx>reactive</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;App&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>names</span> <span class=o>=</span> <span class=nx>reactive</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>firstName</span><span class=o>:</span> <span class=s1>&#39;å†²å•Š&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>lastName</span><span class=o>:</span> <span class=s1>&#39;è¿ªè¿¦å¥¥ç‰¹æ›¼&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ä¼šè¿”å›ä¸€ä¸ªrefå¯¹è±¡
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>fullName</span> <span class=o>=</span> <span class=nx>computed</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>set</span><span class=p>(</span><span class=nx>newValue</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>tempNames</span> <span class=o>=</span> <span class=nx>newValue</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=s1>&#39; &#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>names</span><span class=p>.</span><span class=nx>firstName</span> <span class=o>=</span> <span class=nx>tempNames</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=nx>names</span><span class=p>.</span><span class=nx>lastName</span> <span class=o>=</span> <span class=nx>tempNames</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nx>get</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>names</span><span class=p>.</span><span class=nx>firstName</span> <span class=o>+</span> <span class=nx>names</span><span class=p>.</span><span class=nx>lastName</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=c1>// è®¾ç½®å€¼
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>changeName</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>fullName</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=nx>fullName</span><span class=p>.</span><span class=nx>value</span> <span class=o>===</span> <span class=s1>&#39;å†²å•Šè¿ªè¿¦å¥¥ç‰¹æ›¼&#39;</span> <span class=o>?</span> <span class=s1>&#39;ç¥ç§˜çš„ å®‡å®™äºº&#39;</span> <span class=o>:</span> <span class=s1>&#39;å†²å•Š è¿ªè¿¦å¥¥ç‰¹æ›¼&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>fullName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>changeName</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202312171732557.gif><img src=https://qiniu.waite.wang/202312171732557.gif alt=img></a></div></p><h2 id=ç”Ÿå‘½å‘¨æœŸé’©å­>ç”Ÿå‘½å‘¨æœŸé’©å­<a hidden class=anchor aria-hidden=true href=#ç”Ÿå‘½å‘¨æœŸé’©å­>#</a></h2><blockquote><p><a href=https://cn.vuejs.org/api/composition-api-lifecycle.html target=_blank>https://cn.vuejs.org/api/composition-api-lifecycle.html</a></p></blockquote><blockquote><p><strong>setupä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨å¯¼å…¥çš„onXå‡½æ•°æ³¨å†Œç”Ÿå‘½å‘¨æœŸï¼Œå¹¶ä¸”åŒä¸€ä¸ªç”Ÿå‘½å‘¨æœŸå¯ä»¥ä½¿ç”¨å¤šæ¬¡</strong></p><p><strong>æ‰€æœ‰ç½—åˆ—åœ¨æœ¬é¡µçš„ API éƒ½åº”è¯¥åœ¨ç»„ä»¶çš„ <code>setup()</code> é˜¶æ®µè¢«åŒæ­¥è°ƒç”¨ã€‚ç›¸å…³ç»†èŠ‚è¯·çœ‹
<a href=https://cn.vuejs.org/guide/essentials/lifecycle.html target=_blank>æŒ‡å— - ç”Ÿå‘½å‘¨æœŸé’©å­</a>ã€‚</strong></p><ul><li>å¯ä»¥ä½¿ç”¨ç›´æ¥å¯¼å…¥çš„ onX å‡½æ•°æ³¨å†Œç”Ÿå‘½å‘¨æœŸé’©å­ï¼›</li><li>beforeCreateå’Œcreateåœ¨setupä¸­æ²¡æœ‰ç›¸å¯¹åº”çš„onXçš„å‡½æ•°<ul><li>å¦‚æœæƒ³è¦åœ¨beforeCreateå’Œcreateä¸­è¿›è¡Œæ“ä½œ</li><li>å¯ä»¥æŠŠä»£ç ç›´æ¥å†™å…¥åˆ°setupä¸­</li><li>setupçš„æ‰§è¡Œæ—¶åºæ¯”beforeCreateå’Œcreateè¿˜è¦æ—©</li></ul></li></ul></blockquote><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/image-20231218002757954.png><img src=https://qiniu.waite.wang/image-20231218002757954.png alt=image-20231218002757954></a></div></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>onBeforeMount</span><span class=p>,</span> <span class=nx>onMounted</span><span class=p>,</span> <span class=nx>onBeforeUpdate</span><span class=p>,</span> <span class=nx>onUpdated</span><span class=p>,</span> <span class=nx>onBeforeUnmount</span><span class=p>,</span> <span class=nx>onUnmounted</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// æ³¨å†Œç”Ÿå‘½å‘¨æœŸé’©å­
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>onBeforeMount</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Before Mount&#39;</span><span class=p>);</span> <span class=c1>// ç»„ä»¶æŒ‚è½½å‰
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>onMounted</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Mounted&#39;</span><span class=p>);</span> <span class=c1>// ç»„ä»¶æŒ‚è½½å
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>onBeforeUpdate</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Before Update&#39;</span><span class=p>);</span> <span class=c1>// ç»„ä»¶æ›´æ–°å‰
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>onUpdated</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Updated&#39;</span><span class=p>);</span> <span class=c1>// ç»„ä»¶æ›´æ–°å
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>onBeforeUnmount</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Before Unmount&#39;</span><span class=p>);</span> <span class=c1>// ç»„ä»¶å¸è½½å‰
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>onUnmounted</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Unmounted&#39;</span><span class=p>);</span> <span class=c1>// ç»„ä»¶å¸è½½å
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// åŒä¸€ä¸ªç”Ÿå‘½å‘¨æœŸå¯ä»¥ä½¿ç”¨å¤šæ¬¡
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>onMounted</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Another Mounted&#39;</span><span class=p>);</span> <span class=c1>// å¦ä¸€ä¸ªç»„ä»¶æŒ‚è½½å
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><h2 id=setupä¸­ä½¿ç”¨refè·å–å…ƒç´ æˆ–ç»„ä»¶>setupä¸­ä½¿ç”¨refè·å–å…ƒç´ æˆ–ç»„ä»¶<a hidden class=anchor aria-hidden=true href=#setupä¸­ä½¿ç”¨refè·å–å…ƒç´ æˆ–ç»„ä»¶>#</a></h2><blockquote><p><strong>è¦å®šä¹‰ä¸€ä¸ªrefå¯¹è±¡ï¼Œç»‘å®šåˆ°å…ƒç´ æˆ–è€…ç»„ä»¶çš„refå±æ€§ä¸Šå³å¯</strong></p><p><strong>åªæœ‰åœ¨æŒ‚è½½å®Œæˆåæ‰èƒ½æ‹¿åˆ°å€¼, æ‰€ä»¥éœ€è¦åœ¨ç”Ÿå‘½å‘¨æœŸä¸­è°ƒç”¨æ‹¿å€¼</strong></p></blockquote><h3 id=è·å–å…ƒç´ >è·å–å…ƒç´ <a hidden class=anchor aria-hidden=true href=#è·å–å…ƒç´ >#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!--</span> <span class=mf>1.</span> <span class=nx>æŒ‡å®šref</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>h2</span> <span class=na>ref</span><span class=o>=</span><span class=s>&#34;titleRef&#34;</span><span class=p>&gt;</span><span class=nx>æˆ‘æ˜¯è¿ªè¿¦</span><span class=p>&lt;/</span><span class=nt>h2</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>onMounted</span><span class=p>,</span> <span class=nx>ref</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;App&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 2. ç”Ÿæˆrefå¯¹è±¡
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>titleRef</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>();</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=c1>// 4. å¯ä»¥åœ¨ç”Ÿå‘½å‘¨æœŸä¸­è·å–åˆ°å€¼
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>onMounted</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>titleRef</span><span class=p>.</span><span class=nx>value</span><span class=p>);</span> <span class=c1>// &lt;h2&gt;æˆ‘æ˜¯è¿ªè¿¦&lt;/h2&gt;
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>});</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 3. è¿”å›å‡ºå»ï¼Œä¼šè‡ªåŠ¨åŒ¹é…åˆ°å¯¹åº”çš„refçš„
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>titleRef</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><h3 id=è·å–ç»„ä»¶>è·å–ç»„ä»¶<a hidden class=anchor aria-hidden=true href=#è·å–ç»„ä»¶>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span><span class=nx>æˆ‘æ˜¯å­ç»„ä»¶</span><span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;home-layout&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>showMessage</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;home-layout function exection&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span> <span class=nx>showMessage</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!--</span> <span class=mf>1.</span> <span class=nx>æŒ‡å®šref</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>home</span> <span class=na>ref</span><span class=o>=</span><span class=s>&#34;homeCompRef&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>onMounted</span><span class=p>,</span> <span class=nx>ref</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>home</span> <span class=nx>from</span> <span class=s1>&#39;./home.vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;App&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>components</span><span class=o>:</span> <span class=p>{</span> <span class=nx>home</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 2. ç”Ÿæˆrefå¯¹è±¡
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>homeCompRef</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>();</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=c1>// 4. å¯ä»¥åœ¨ç”Ÿå‘½å‘¨æœŸä¸­è·å–åˆ°å€¼
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>onMounted</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>homeCompRef</span><span class=p>.</span><span class=nx>value</span><span class=p>);</span> <span class=c1>// proxyå¯¹è±¡
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>homeCompRef</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>$el</span><span class=p>);</span> <span class=c1>// &lt;div&gt;æˆ‘æ˜¯å­ç»„ä»¶&lt;/div&gt;
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>homeCompRef</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>showMessage</span><span class=p>();</span> <span class=c1>// è°ƒç”¨å­ç»„ä»¶æ–¹æ³•
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>});</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 3. è¿”å›å‡ºå»ï¼Œä¼šè‡ªåŠ¨åŒ¹é…åˆ°å¯¹åº”çš„refçš„
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>homeCompRef</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202312172141785.png><img src=https://qiniu.waite.wang/202312172141785.png alt=image-20231217214139261></a></div></p><h2 id=ä¾¦å¬æ•°æ®çš„å˜åŒ–>ä¾¦å¬æ•°æ®çš„å˜åŒ–<a hidden class=anchor aria-hidden=true href=#ä¾¦å¬æ•°æ®çš„å˜åŒ–>#</a></h2><ul><li><p>åœ¨å‰é¢çš„Options APIä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡watché€‰é¡¹æ¥ä¾¦å¬dataæˆ–è€…propsçš„æ•°æ®å˜åŒ–ï¼Œå½“æ•°æ®å˜åŒ–æ—¶æ‰§è¡ŒæŸä¸€äº› æ“ä½œã€‚</p></li><li><p>åœ¨Composition APIä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨watchEffectå’Œwatchæ¥å®Œæˆå“åº”å¼æ•°æ®çš„ä¾¦å¬ï¼›</p><ul><li>watchEffectç”¨äºè‡ªåŠ¨æ”¶é›†å“åº”å¼æ•°æ®çš„ä¾èµ–ï¼›</li><li>watchéœ€è¦æ‰‹åŠ¨æŒ‡å®šä¾¦å¬çš„æ•°æ®æºï¼›</li></ul></li></ul><h3 id=watcheffect>watchEffect<a hidden class=anchor aria-hidden=true href=#watcheffect>#</a></h3><h4 id=åŸºæœ¬ä½¿ç”¨-1>åŸºæœ¬ä½¿ç”¨<a hidden class=anchor aria-hidden=true href=#åŸºæœ¬ä½¿ç”¨-1>#</a></h4><ul><li>è‡ªåŠ¨æ”¶é›†å“åº”å¼æ•°æ®çš„ä¾èµ–</li><li>watchEffectä¼ å…¥çš„å‡½æ•°ä¼šè¢«ç«‹å³æ‰§è¡Œä¸€æ¬¡ï¼Œå¹¶ä¸”åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ä¼šæ”¶é›†ä¾èµ–</li><li>åªæœ‰æ”¶é›†çš„ä¾èµ–å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒwatchEffectä¼ å…¥çš„å‡½æ•°æ‰ä¼šå†æ¬¡æ‰§è¡Œ</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;{{</span> <span class=nx>name</span> <span class=p>}}</span> <span class=o>-</span> <span class=p>{{</span> <span class=nx>age</span> <span class=p>}}&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>button</span> <span class=nt>@click</span><span class=s>=&#34;changeName&#34;</span><span class=p>&gt;</span><span class=na>changeName</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>button</span> <span class=nt>@click</span><span class=s>=&#34;changeAge&#34;</span><span class=p>&gt;</span><span class=na>changeAge</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>ref</span><span class=p>,</span> <span class=nx>watchEffect</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>name</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=s1>&#39;star&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>age</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=mi>18</span><span class=p>);</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>changeName</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>(</span><span class=nx>name</span><span class=p>.</span><span class=nx>value</span> <span class=o>===</span> <span class=s1>&#39;star&#39;</span> <span class=o>?</span> <span class=p>(</span><span class=nx>name</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=s1>&#39;xuanyu&#39;</span><span class=p>)</span> <span class=o>:</span> <span class=p>(</span><span class=nx>name</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=s1>&#39;star&#39;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>changeAge</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>age</span><span class=p>.</span><span class=nx>value</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=nx>watchEffect</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// å› ä¸ºè¿™é‡Œåªä½¿ç”¨äº†nameï¼Œæ‰€ä»¥åªä¼šç›‘å¬nameï¼Œå¦‚æœæŠŠageä¹Ÿå†™è¿›æ¥ï¼Œé‚£ä¹ˆä¸¤ä¸ªéƒ½ä¼šç›‘å¬
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;name:&#39;</span><span class=p>,</span> <span class=nx>name</span><span class=p>.</span><span class=nx>value</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span> <span class=nx>name</span><span class=p>,</span> <span class=nx>age</span><span class=p>,</span> <span class=nx>changeName</span><span class=p>,</span> <span class=nx>changeAge</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202312171743816.gif><img src=https://qiniu.waite.wang/202312171743816.gif alt=img></a></div></p><h4 id=åœæ­¢ç›‘å¬>åœæ­¢ç›‘å¬<a hidden class=anchor aria-hidden=true href=#åœæ­¢ç›‘å¬>#</a></h4><ul><li>å¦‚æœåœ¨å‘ç”ŸæŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›åœæ­¢ä¾¦å¬ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥è·å–watchEffectçš„è¿”å›å€¼å‡½æ•°ï¼Œè°ƒç”¨è¯¥å‡½æ•°å³å¯ã€‚</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;{{</span> <span class=nx>name</span> <span class=p>}}</span> <span class=o>-</span> <span class=p>{{</span> <span class=nx>age</span> <span class=p>}}&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>button</span> <span class=nt>@click</span><span class=s>=&#34;changeName&#34;</span><span class=p>&gt;</span><span class=na>changeName</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>button</span> <span class=nt>@click</span><span class=s>=&#34;changeAge&#34;</span><span class=p>&gt;</span><span class=na>changeAge</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>ref</span><span class=p>,</span> <span class=nx>watchEffect</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>name</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=s1>&#39;star&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>age</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=mi>18</span><span class=p>);</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>changeName</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>(</span><span class=nx>name</span><span class=p>.</span><span class=nx>value</span> <span class=o>===</span> <span class=s1>&#39;star&#39;</span> <span class=o>?</span> <span class=p>(</span><span class=nx>name</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=s1>&#39;xuanyu&#39;</span><span class=p>)</span> <span class=o>:</span> <span class=p>(</span><span class=nx>name</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=s1>&#39;star&#39;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=c1>// è·å–è¿”å›å€¼
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>stopWatchEffect</span> <span class=o>=</span> <span class=nx>watchEffect</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// è‡ªåŠ¨ç›‘å¬age
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;age:&#39;</span><span class=p>,</span> <span class=nx>age</span><span class=p>.</span><span class=nx>value</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>changeAge</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>age</span><span class=p>.</span><span class=nx>value</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>age</span><span class=p>.</span><span class=nx>value</span> <span class=o>&gt;</span> <span class=mi>22</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// åœæ­¢ç›‘å¬
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>stopWatchEffect</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span> <span class=nx>name</span><span class=p>,</span> <span class=nx>age</span><span class=p>,</span> <span class=nx>changeName</span><span class=p>,</span> <span class=nx>changeAge</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202312171747594.gif><img src=https://qiniu.waite.wang/202312171747594.gif alt=img></a></div></p><h4 id=æ¸…é™¤å‰¯ä½œç”¨>æ¸…é™¤å‰¯ä½œç”¨<a hidden class=anchor aria-hidden=true href=#æ¸…é™¤å‰¯ä½œç”¨>#</a></h4><ul><li>ä»€ä¹ˆæ˜¯æ¸…é™¤å‰¯ä½œç”¨å‘¢ï¼Ÿ<ul><li>æ¯”å¦‚åœ¨å¼€å‘ä¸­æˆ‘ä»¬éœ€è¦åœ¨ä¾¦å¬å‡½æ•°ä¸­æ‰§è¡Œç½‘ç»œè¯·æ±‚ï¼Œä½†æ˜¯åœ¨ç½‘ç»œè¯·æ±‚è¿˜æ²¡æœ‰è¾¾åˆ°çš„æ—¶å€™ï¼Œæˆ‘ä»¬åœæ­¢äº†ä¾¦å¬å™¨ï¼Œ æˆ–è€…ä¾¦å¬å™¨ä¾¦å¬å‡½æ•°è¢«å†æ¬¡æ‰§è¡Œäº†</li><li>é‚£ä¹ˆä¸Šä¸€æ¬¡çš„ç½‘ç»œè¯·æ±‚åº”è¯¥è¢«å–æ¶ˆæ‰ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥æ¸…é™¤ä¸Šä¸€æ¬¡çš„å‰¯ä½œç”¨ï¼›</li></ul></li><li>åœ¨æˆ‘ä»¬ç»™watchEffectä¼ å…¥çš„å‡½æ•°è¢«å›è°ƒæ—¶ï¼Œå…¶å®å¯ä»¥è·å–åˆ°ä¸€ä¸ªå‚æ•°ï¼šonInvalidate<ul><li>å½“å‰¯ä½œç”¨å³å°†é‡æ–°æ‰§è¡Œ æˆ–è€… ä¾¦å¬å™¨è¢«åœæ­¢ æ—¶ä¼šæ‰§è¡Œè¯¥å‡½æ•°ä¼ å…¥çš„å›è°ƒå‡½æ•°ï¼›</li><li>æˆ‘ä»¬å¯ä»¥åœ¨ä¼ å…¥çš„å›è°ƒå‡½æ•°ä¸­ï¼Œæ‰§è¡Œä¸€äº›æ¸…é™¤å·¥ä½œï¼›</li></ul></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h2</span><span class=p>&gt;{{</span> <span class=nx>name</span> <span class=p>}}</span><span class=o>-</span><span class=p>{{</span> <span class=nx>age</span> <span class=p>}}&lt;/</span><span class=nt>h2</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>button</span> <span class=nt>@click</span><span class=s>=&#34;changeName&#34;</span><span class=p>&gt;</span><span class=na>ä¿®æ”¹name</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>button</span> <span class=nt>@click</span><span class=s>=&#34;changeAge&#34;</span><span class=p>&gt;</span><span class=na>ä¿®æ”¹age</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>ref</span><span class=p>,</span> <span class=nx>watchEffect</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// watchEffect: è‡ªåŠ¨æ”¶é›†å“åº”å¼çš„ä¾èµ–
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>name</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=s2>&#34;why&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>age</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=mi>18</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>stop</span> <span class=o>=</span> <span class=nx>watchEffect</span><span class=p>((</span><span class=nx>onInvalidate</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>timer</span> <span class=o>=</span> <span class=nx>setTimeout</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;ç½‘ç»œè¯·æ±‚æˆåŠŸ~&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span> <span class=mi>2000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=c1>// æ ¹æ®nameå’Œageä¸¤ä¸ªå˜é‡å‘é€ç½‘ç»œè¯·æ±‚
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>onInvalidate</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// åœ¨è¿™ä¸ªå‡½æ•°ä¸­æ¸…é™¤é¢å¤–çš„å‰¯ä½œç”¨
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>// request.cancel()
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>clearTimeout</span><span class=p>(</span><span class=nx>timer</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;onInvalidate&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>})</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;name:&#34;</span><span class=p>,</span> <span class=nx>name</span><span class=p>.</span><span class=nx>value</span><span class=p>,</span> <span class=s2>&#34;age:&#34;</span><span class=p>,</span> <span class=nx>age</span><span class=p>.</span><span class=nx>value</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>changeName</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>name</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=nx>name</span><span class=p>.</span><span class=nx>value</span> <span class=o>===</span> <span class=s2>&#34;why&#34;</span> <span class=o>?</span> <span class=s2>&#34;kobe&#34;</span> <span class=o>:</span> <span class=s2>&#34;why&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>changeAge</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>age</span><span class=p>.</span><span class=nx>value</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>age</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>changeName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>changeAge</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span> 
</span></span></code></pre></div><h4 id=watcheffectçš„æ‰§è¡Œæ—¶æœº>watchEffectçš„æ‰§è¡Œæ—¶æœº<a hidden class=anchor aria-hidden=true href=#watcheffectçš„æ‰§è¡Œæ—¶æœº>#</a></h4><ul><li>é»˜è®¤æƒ…å†µä¸‹ï¼Œç»„ä»¶çš„æ›´æ–°ä¼šåœ¨å‰¯ä½œç”¨å‡½æ•°æ‰§è¡Œä¹‹å‰ï¼š<ul><li>å¦‚æœæˆ‘ä»¬å¸Œæœ›åœ¨å‰¯ä½œç”¨å‡½æ•°ä¸­è·å–åˆ°å…ƒç´ ï¼Œæ˜¯å¦å¯è¡Œå‘¢ï¼Ÿ</li></ul></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h2</span> <span class=na>ref</span><span class=o>=</span><span class=s>&#34;title&#34;</span><span class=p>&gt;</span><span class=nx>å“ˆå“ˆå“ˆ</span><span class=p>&lt;/</span><span class=nt>h2</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=kr>import</span> <span class=p>{</span> <span class=nx>ref</span><span class=p>,</span> <span class=nx>watchEffect</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>title</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=nx>watchEffect</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>title</span><span class=p>.</span><span class=nx>value</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>})</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>title</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202312172147749.png><img src=https://qiniu.waite.wang/202312172147749.png alt=image-20231217214736939></a></div></p><ul><li>æˆ‘ä»¬ä¼šå‘ç°æ‰“å°ç»“æœæ‰“å°äº†ä¸¤æ¬¡ï¼š<ul><li>è¿™æ˜¯å› ä¸ºsetupå‡½æ•°åœ¨æ‰§è¡Œæ—¶å°±ä¼šç«‹å³æ‰§è¡Œä¼ å…¥çš„å‰¯ä½œç”¨å‡½æ•°ï¼Œè¿™ä¸ªæ—¶å€™DOMå¹¶æ²¡æœ‰æŒ‚è½½ï¼Œæ‰€ä»¥æ‰“å°ä¸ºnullï¼›</li><li>è€Œå½“DOMæŒ‚è½½æ—¶ï¼Œä¼šç»™<code>title</code>çš„<code>ref</code>å¯¹è±¡èµ‹å€¼æ–°çš„å€¼ï¼Œå‰¯ä½œç”¨å‡½æ•°ä¼šå†æ¬¡æ‰§è¡Œï¼Œæ‰“å°å‡ºæ¥å¯¹åº”çš„å…ƒç´ ï¼›</li></ul></li><li>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦æ”¹å˜å‰¯ä½œç”¨å‡½æ•°çš„æ‰§è¡Œæ—¶æœºï¼›<ul><li>å®ƒçš„é»˜è®¤å€¼æ˜¯preï¼Œå®ƒä¼šåœ¨å…ƒç´  æŒ‚è½½ æˆ–è€… æ›´æ–° ä¹‹å‰æ‰§è¡Œï¼›</li><li>æ‰€ä»¥æˆ‘ä»¬ä¼šå…ˆæ‰“å°å‡ºæ¥ä¸€ä¸ªç©ºçš„ï¼Œå½“ä¾èµ–çš„titleå‘ç”Ÿæ”¹å˜æ—¶ï¼Œå°±ä¼šå†æ¬¡æ‰§è¡Œä¸€æ¬¡ï¼Œæ‰“å°å‡ºå…ƒç´ ï¼›</li></ul></li><li>æˆ‘ä»¬å¯ä»¥è®¾ç½®å‰¯ä½œç”¨å‡½æ•°çš„æ‰§è¡Œæ—¶æœºï¼š<ul><li>pre : é»˜è®¤å€¼,å®ƒä¼šåœ¨å…ƒç´  æŒ‚è½½ æˆ–è€… æ›´æ–° ä¹‹å‰æ‰§è¡Œ</li><li>post : å…ƒç´  æŒ‚è½½ æˆ–è€… æ›´æ–° ä¹‹åæ‰§è¡Œ</li><li>sync : å¼ºåˆ¶åŒæ­¥ä¸€èµ·æ‰§è¡Œï¼Œæ•ˆç‡å¾ˆä½ï¼Œä¸æ¨è</li></ul></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=kr>import</span> <span class=p>{</span> <span class=nx>ref</span><span class=p>,</span> <span class=nx>watchEffect</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>title</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=nx>watchEffect</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>title</span><span class=p>.</span><span class=nx>value</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>flush</span><span class=o>:</span> <span class=s2>&#34;post&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>title</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><h3 id=watch>Watch<a hidden class=anchor aria-hidden=true href=#watch>#</a></h3><ul><li>watchçš„APIå®Œå…¨ç­‰åŒäºç»„ä»¶watché€‰é¡¹çš„Propertyï¼š<ul><li>watchéœ€è¦ä¾¦å¬ç‰¹å®šçš„æ•°æ®æºï¼Œå¹¶åœ¨å›è°ƒå‡½æ•°ä¸­æ‰§è¡Œå‰¯ä½œç”¨ï¼›</li><li>é»˜è®¤æƒ…å†µä¸‹å®ƒæ˜¯æƒ°æ€§çš„ï¼Œåªæœ‰å½“è¢«ä¾¦å¬çš„æºå‘ ç”Ÿå˜åŒ–æ—¶æ‰ä¼šæ‰§è¡Œå›è°ƒï¼›</li></ul></li><li>ä¸watchEffectçš„æ¯”è¾ƒï¼Œwatchå…è®¸æˆ‘ä»¬ï¼š<ul><li>æ‡’æ‰§è¡Œå‰¯ä½œç”¨ï¼ˆç¬¬ä¸€æ¬¡ä¸ä¼šç›´æ¥æ‰§è¡Œï¼‰ï¼›</li><li>æ›´å…·ä½“çš„è¯´æ˜å½“å“ªäº›çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè§¦å‘ä¾¦å¬å™¨çš„æ‰§è¡Œï¼›</li><li>è®¿é—®ä¾¦å¬çŠ¶æ€å˜åŒ–å‰åçš„å€¼ï¼›</li></ul></li></ul><h4 id=ä¾¦å¬å•ä¸ªæ•°æ®æº>ä¾¦å¬å•ä¸ªæ•°æ®æº<a hidden class=anchor aria-hidden=true href=#ä¾¦å¬å•ä¸ªæ•°æ®æº>#</a></h4><p>watchä¾¦å¬å‡½æ•°çš„æ•°æ®æºæœ‰ä¸¤ç§ç±»å‹ï¼š</p><ul><li>ä¸€ä¸ªgetterå‡½æ•°ï¼šä½†æ˜¯è¯¥getterå‡½æ•°å¿…é¡»å¼•ç”¨å¯å“åº”å¼çš„å¯¹è±¡ï¼ˆæ¯”å¦‚reactiveæˆ–è€…refï¼‰ï¼›</li><li>ç›´æ¥å†™å…¥ä¸€ä¸ªå¯å“åº”å¼çš„å¯¹è±¡ï¼Œrefï¼ˆå¦‚æœæ˜¯ä¸€ä¸ª reactive çš„å¯¹è±¡çš„ä¾¦å¬, éœ€è¦è¿›è¡ŒæŸäº›è½¬æ¢ ï¼‰ï¼›</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>watch</span><span class=p>,</span> <span class=nx>reactive</span><span class=p>,</span> <span class=nx>ref</span><span class=p>,</span> <span class=nx>toRefs</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ä¸€ä¸ªgetterå‡½æ•°å¼•ç”¨å¯å“åº”å¼çš„å¯¹è±¡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>state</span> <span class=o>=</span> <span class=nx>reactive</span><span class=p>({</span> <span class=nx>count</span><span class=o>:</span> <span class=mi>0</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=nx>watch</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>state</span><span class=p>.</span><span class=nx>count</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nx>newValue</span><span class=p>,</span> <span class=nx>oldValue</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Count changed from </span><span class=si>${</span><span class=nx>oldValue</span><span class=si>}</span><span class=sb> to </span><span class=si>${</span><span class=nx>newValue</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ç›´æ¥å†™å…¥ä¸€ä¸ªå¯å“åº”å¼çš„å¯¹è±¡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>count</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>watch</span><span class=p>(</span><span class=nx>count</span><span class=p>,</span> <span class=p>(</span><span class=nx>newValue</span><span class=p>,</span> <span class=nx>oldValue</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Count changed from </span><span class=si>${</span><span class=nx>oldValue</span><span class=si>}</span><span class=sb> to </span><span class=si>${</span><span class=nx>newValue</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ç›´æ¥å†™å…¥ä¸€ä¸ªå¯å“åº”å¼çš„å¯¹è±¡ï¼Œéœ€è¦è¿›è¡ŒæŸäº›è½¬æ¢
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>reactiveState</span> <span class=o>=</span> <span class=nx>reactive</span><span class=p>({</span> <span class=nx>count</span><span class=o>:</span> <span class=mi>0</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>count</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>toRefs</span><span class=p>(</span><span class=nx>reactiveState</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>watch</span><span class=p>(</span><span class=nx>count</span><span class=p>,</span> <span class=p>(</span><span class=nx>newValue</span><span class=p>,</span> <span class=nx>oldValue</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Count changed from </span><span class=si>${</span><span class=nx>oldValue</span><span class=si>}</span><span class=sb> to </span><span class=si>${</span><span class=nx>newValue</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><blockquote><p>æ³¨æ„: <code>reactive </code>å¯¹è±¡è·å–åˆ°çš„ <code>newValue </code>ä»¥åŠ <code>oldValue </code>æœ¬èº«éƒ½æ˜¯ <code>reactive</code> å¯¹è±¡</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>watch</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=nx>info</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nx>newInfo</span><span class=p>,</span> <span class=nx>oldInfo</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>newInfo</span><span class=p>,</span> <span class=nx>oldInfo</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></div><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202312172311755.png><img src=https://qiniu.waite.wang/202312172311755.png alt=image-20231217231108219></a></div></p><p>å¦‚æœå¸Œæœ›ä¸¤è€…éƒ½æ˜¯ä¸€ä¸ªæ™®é€šå¯¹è±¡, å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å†™æ³•(JavaScriptä¸­çš„å±•å¼€è¿ç®—ç¬¦):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>watch</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>({</span> <span class=p>...</span><span class=nx>info</span> <span class=p>}),</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nx>newInfo</span><span class=p>,</span> <span class=nx>oldInfo</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>newInfo</span><span class=p>,</span> <span class=nx>oldInfo</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></div><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202312172313342.png><img src=https://qiniu.waite.wang/202312172313342.png alt=image-20231217231330425></a></div></p><p>ä»¥ä¸‹æ˜¯å®Œæ•´ä»£ç :</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h2</span> <span class=na>ref</span><span class=o>=</span><span class=s>&#34;title&#34;</span><span class=p>&gt;{{</span> <span class=nx>info</span><span class=p>.</span><span class=nx>name</span> <span class=p>}}&lt;/</span><span class=nt>h2</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>button</span> <span class=nt>@click</span><span class=s>=&#34;changeData&#34;</span><span class=p>&gt;</span><span class=na>ä¿®æ”¹æ•°æ®</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>reactive</span><span class=p>,</span> <span class=nx>watch</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>info</span> <span class=o>=</span> <span class=nx>reactive</span><span class=p>({</span> <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;why&#34;</span><span class=p>,</span> <span class=nx>age</span><span class=o>:</span> <span class=mi>18</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>watch</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>({</span> <span class=p>...</span><span class=nx>info</span> <span class=p>}),</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=nx>newInfo</span><span class=p>,</span> <span class=nx>oldInfo</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>newInfo</span><span class=p>,</span> <span class=nx>oldInfo</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>watch</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=nx>info</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=nx>newInfo</span><span class=p>,</span> <span class=nx>oldInfo</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>newInfo</span><span class=p>,</span> <span class=nx>oldInfo</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>changeData</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>info</span><span class=p>.</span><span class=nx>name</span> <span class=o>=</span> <span class=nx>info</span><span class=p>.</span><span class=nx>name</span> <span class=o>===</span> <span class=s2>&#34;why&#34;</span> <span class=o>?</span> <span class=s2>&#34;kobe&#34;</span> <span class=o>:</span> <span class=s2>&#34;why&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>changeData</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>info</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div></blockquote><h4 id=ä¾¦å¬å¤šä¸ªæ•°æ®æº>ä¾¦å¬å¤šä¸ªæ•°æ®æº<a hidden class=anchor aria-hidden=true href=#ä¾¦å¬å¤šä¸ªæ•°æ®æº>#</a></h4><p>å½“ä¾¦å¬å¤šä¸ªæ¥æºæ—¶ï¼Œå›è°ƒå‡½æ•°æ¥å—ä¸¤ä¸ªæ•°ç»„ï¼Œåˆ†åˆ«å¯¹åº”æ¥æºæ•°ç»„ä¸­çš„æ–°å€¼å’Œæ—§å€¼ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>watch</span><span class=p>([</span><span class=nx>fooRef</span><span class=p>,</span> <span class=nx>barRef</span><span class=p>],</span> <span class=p>([</span><span class=nx>foo</span><span class=p>,</span> <span class=nx>bar</span><span class=p>],</span> <span class=p>[</span><span class=nx>prevFoo</span><span class=p>,</span> <span class=nx>prevBar</span><span class=p>])</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=cm>/* ... */</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h2</span> <span class=na>ref</span><span class=o>=</span><span class=s>&#34;title&#34;</span><span class=p>&gt;{{</span> <span class=nx>info</span><span class=p>.</span><span class=nx>name</span> <span class=p>}}&lt;/</span><span class=nt>h2</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>button</span> <span class=nt>@click</span><span class=s>=&#34;changeData&#34;</span><span class=p>&gt;</span><span class=na>ä¿®æ”¹æ•°æ®</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>ref</span><span class=p>,</span> <span class=nx>reactive</span><span class=p>,</span> <span class=nx>watch</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>info</span> <span class=o>=</span> <span class=nx>reactive</span><span class=p>({</span> <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;why&#34;</span><span class=p>,</span> <span class=nx>age</span><span class=o>:</span> <span class=mi>18</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>name</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=s2>&#34;why&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>watch</span><span class=p>([()</span> <span class=p>=&gt;</span> <span class=p>({</span> <span class=p>...</span><span class=nx>info</span> <span class=p>}),</span> <span class=nx>name</span><span class=p>],</span> <span class=p>([</span><span class=nx>newInfo</span><span class=p>,</span> <span class=nx>newName</span><span class=p>],</span> <span class=p>[</span><span class=nx>oldInfo</span><span class=p>,</span> <span class=nx>oldName</span><span class=p>])</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>newInfo</span><span class=p>,</span> <span class=nx>newName</span><span class=p>,</span> <span class=nx>oldInfo</span><span class=p>,</span> <span class=nx>oldName</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>changeData</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>info</span><span class=p>.</span><span class=nx>name</span> <span class=o>=</span> <span class=s2>&#34;kobe&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>changeData</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>info</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><h4 id=watchçš„é€‰é¡¹>watchçš„é€‰é¡¹<a hidden class=anchor aria-hidden=true href=#watchçš„é€‰é¡¹>#</a></h4><ul><li><strong>deep : æ˜¯å¦æ·±åº¦ç›‘å¬</strong></li><li><strong>immediate ï¼š æ˜¯å¦ç«‹å³æ‰§è¡Œ</strong></li></ul><blockquote><p><code>watch</code> ä¾¦å¬ <code>reactive</code>æ—¶é»˜è®¤æ˜¯æ·±åº¦ä¾¦å¬çš„, ä½†æ˜¯åœ¨ä½¿ç”¨ <code>{...info}</code>å±•å¼€è¿ç®—ç¬¦æ—¶, æ˜¯ä¸ä¼šæ·±åº¦ç›‘å¬çš„, æ‰€ä»¥æˆ‘ä»¬è¦è®¾ç½® <code>deep: True</code></p><p>immediate: ç¬¬ä¸€æ¬¡ä¼šæ‰§è¡Œ</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>watch</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>obj</span> <span class=o>=</span> <span class=p>{</span> <span class=p>...</span><span class=nx>info</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>obj</span><span class=p>.</span><span class=nx>friend</span> <span class=o>=</span> <span class=p>{</span> <span class=p>...</span><span class=nx>obj</span><span class=p>.</span><span class=nx>friend</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>obj</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nx>newValue</span><span class=p>,</span> <span class=nx>oldValue</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>newValue</span><span class=p>,</span> <span class=nx>oldValue</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// å¦‚æœæœ‰å¤šå±‚ï¼Œéœ€è¦åŠ ä¸Šdeep
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>deep</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ç«‹å³æ‰§è¡Œ
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>immediate</span><span class=o>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></div><h4 id=åœæ­¢ä¾¦å¬>åœæ­¢ä¾¦å¬<a hidden class=anchor aria-hidden=true href=#åœæ­¢ä¾¦å¬>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>stop</span> <span class=o>=</span> <span class=nx>watch</span><span class=p>(</span><span class=nx>source</span><span class=p>,</span> <span class=nx>callback</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å½“å·²ä¸å†éœ€è¦è¯¥ä¾¦å¬å™¨æ—¶ï¼š
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>stop</span><span class=p>()</span>
</span></span></code></pre></div><h4 id=å‰¯ä½œç”¨æ¸…ç†>å‰¯ä½œç”¨æ¸…ç†<a hidden class=anchor aria-hidden=true href=#å‰¯ä½œç”¨æ¸…ç†>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>watch</span><span class=p>(</span><span class=nx>id</span><span class=p>,</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>newId</span><span class=p>,</span> <span class=nx>oldId</span><span class=p>,</span> <span class=nx>onCleanup</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>{</span> <span class=nx>response</span><span class=p>,</span> <span class=nx>cancel</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>doAsyncWork</span><span class=p>(</span><span class=nx>newId</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=c1>// å½“ `id` å˜åŒ–æ—¶ï¼Œ`cancel` å°†è¢«è°ƒç”¨ï¼Œ
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// å–æ¶ˆä¹‹å‰çš„æœªå®Œæˆçš„è¯·æ±‚
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>onCleanup</span><span class=p>(</span><span class=nx>cancel</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>data</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>response</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div><h2 id=provide--inject>provide && inject<a hidden class=anchor aria-hidden=true href=#provide--inject>#</a></h2><p><code>provide</code> å’Œ
<a href=https://cn.vuejs.org/api/options-composition.html#inject target=_blank><code>inject</code></a> é€šå¸¸æˆå¯¹ä¸€èµ·ä½¿ç”¨ï¼Œä½¿ä¸€ä¸ªç¥–å…ˆç»„ä»¶ä½œä¸ºå…¶åä»£ç»„ä»¶çš„ä¾èµ–æ³¨å…¥æ–¹ï¼Œæ— è®ºè¿™ä¸ªç»„ä»¶çš„å±‚çº§æœ‰å¤šæ·±éƒ½å¯ä»¥æ³¨å…¥æˆåŠŸï¼Œåªè¦ä»–ä»¬å¤„äºåŒä¸€æ¡ç»„ä»¶é“¾ä¸Šã€‚</p><p><strong>provideå¯ä»¥ä¼ å…¥ä¸¤ä¸ªå‚æ•° :</strong></p><ul><li><strong>nameï¼šæä¾›çš„å±æ€§åç§°</strong></li><li><strong>valueï¼šæä¾›çš„å±æ€§å€¼</strong></li></ul><p><strong>injectå¯ä»¥ä¼ å…¥ä¸¤ä¸ªå‚æ•° :</strong></p><ul><li><strong>å¯¹åº”provideä¼ è¿‡æ¥çš„nameå€¼</strong></li><li><strong>é»˜è®¤å€¼</strong></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;</span><span class=nx>APP</span> <span class=nx>count</span><span class=o>:</span> <span class=p>{{</span> <span class=nx>count</span> <span class=p>}}&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>button</span> <span class=nt>@click</span><span class=s>=&#34;change&#34;</span><span class=p>&gt;</span><span class=na>APP</span> <span class=na>button</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>demo</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>ref</span><span class=p>,</span> <span class=nx>provide</span><span class=p>,</span> <span class=nx>readonly</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>demo</span> <span class=nx>from</span> <span class=s1>&#39;./components/demo.vue&#39;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;App&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>components</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>demo</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>count</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ç¬¬ä¸€ä¸ªå‚æ•°key  ç¬¬äºŒä¸ªå‚æ•°å€¼ï¼Œä¸è®©å­ç»„ä»¶éšä¾¿ä¿®æ”¹ï¼Œç”¨readonlyåŒ…è£¹ä¸€ä¸‹
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>provide</span><span class=p>(</span><span class=s1>&#39;count&#39;</span><span class=p>,</span> <span class=nx>readonly</span><span class=p>(</span><span class=nx>count</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>change</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>count</span><span class=p>.</span><span class=nx>value</span><span class=o>++</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>count</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>change</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>h2</span><span class=p>&gt;</span><span class=nx>demo</span> <span class=nx>count</span><span class=o>:</span><span class=p>{{</span> <span class=nx>count</span> <span class=p>}}&lt;/</span><span class=nt>h2</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>button</span> <span class=nt>@click</span><span class=s>=&#34;change&#34;</span><span class=p>&gt;</span><span class=na>demo</span> <span class=na>change</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>ref</span><span class=p>,</span> <span class=nx>inject</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// æ¥æ”¶   ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥ç»™ä¸€ä¸ªé»˜è®¤å€¼
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>let</span> <span class=nx>count</span> <span class=o>=</span> <span class=nx>inject</span><span class=p>(</span><span class=s1>&#39;count&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1>// å› ä¸ºè®¾ç½®äº†readOnly æ‰€ä»¥æ›´æ”¹ä¸äº†
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>change</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>count</span><span class=p>.</span><span class=nx>value</span><span class=o>++</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>count</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>change</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202312180036440.gif><img src=https://qiniu.waite.wang/202312180036440.gif alt=img></a></div></p><h2 id=hå‡½æ•°>hå‡½æ•°<a hidden class=anchor aria-hidden=true href=#hå‡½æ•°>#</a></h2><ul><li>Vueåœ¨ç”ŸæˆçœŸå®çš„DOMä¹‹å‰ï¼Œä¼šå°†èŠ‚ç‚¹è½¬æ¢æˆVNodeï¼Œè€ŒVNodeç»„åˆåœ¨ä¸€èµ·å½¢æˆä¸€é¢—æ ‘ç»“æ„ï¼Œå°±æ˜¯è™šæ‹ŸDOM ( VDOM )</li><li>äº‹å®ä¸Šï¼Œç¼–å†™çš„ template ä¸­çš„HTML æœ€ç»ˆä¹Ÿæ˜¯ä½¿ç”¨æ¸²æŸ“å‡½æ•°ç”Ÿæˆå¯¹åº”çš„VNode</li><li>é‚£ä¹ˆï¼Œå¦‚æœæƒ³å……åˆ†çš„åˆ©ç”¨JavaScriptçš„ç¼–ç¨‹èƒ½åŠ›ï¼Œå¯ä»¥è‡ªå·±æ¥ç¼–å†™ createVNode å‡½æ•°ï¼Œç”Ÿæˆå¯¹åº”çš„VNode</li><li><strong>h() å‡½æ•°æ˜¯ä¸€ä¸ªç”¨äºåˆ›å»º vnode çš„ä¸€ä¸ªå‡½æ•°</strong></li><li><strong>å…¶å®æ›´å‡†å¤‡çš„å‘½åæ˜¯ createVNode() å‡½æ•°ï¼Œä½†æ˜¯ä¸ºäº†ç®€ä¾¿åœ¨Vueå°†ä¹‹ç®€åŒ–ä¸º h() å‡½æ•°</strong></li></ul><h3 id=å‚æ•°>å‚æ•°<a hidden class=anchor aria-hidden=true href=#å‚æ•°>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// å®Œæ•´å‚æ•°ç­¾å
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>function</span> <span class=nx>h</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=nx>type</span><span class=o>:</span> <span class=nx>string</span> <span class=o>|</span> <span class=nx>Component</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>props</span><span class=o>?:</span> <span class=nx>object</span> <span class=o>|</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>children</span><span class=o>?:</span> <span class=nx>Children</span> <span class=o>|</span> <span class=nx>Slot</span> <span class=o>|</span> <span class=nx>Slots</span>
</span></span><span class=line><span class=cl><span class=p>)</span><span class=o>:</span> <span class=nx>VNode</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// çœç•¥ props
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>function</span> <span class=nx>h</span><span class=p>(</span><span class=nx>type</span><span class=o>:</span> <span class=nx>string</span> <span class=o>|</span> <span class=nx>Component</span><span class=p>,</span> <span class=nx>children</span><span class=o>?:</span> <span class=nx>Children</span> <span class=o>|</span> <span class=nx>Slot</span><span class=p>)</span><span class=o>:</span> <span class=nx>VNode</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>type</span> <span class=nx>Children</span> <span class=o>=</span> <span class=nx>string</span> <span class=o>|</span> <span class=nx>number</span> <span class=o>|</span> <span class=kr>boolean</span> <span class=o>|</span> <span class=nx>VNode</span> <span class=o>|</span> <span class=kc>null</span> <span class=o>|</span> <span class=nx>Children</span><span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>type</span> <span class=nx>Slot</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>Children</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>type</span> <span class=nx>Slots</span> <span class=o>=</span> <span class=p>{</span> <span class=p>[</span><span class=nx>name</span><span class=o>:</span> <span class=nx>string</span><span class=p>]</span><span class=o>:</span> <span class=nx>Slot</span> <span class=p>}</span>
</span></span></code></pre></div><ul><li>ç¬¬ä¸€ä¸ªå‚æ•°æ—¢å¯ä»¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸² (ç”¨äºåŸç”Ÿå…ƒç´ ) ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ª Vue ç»„ä»¶å®šä¹‰ã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯è¦ä¼ é€’çš„ propï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯å­èŠ‚ç‚¹ã€‚</li><li>å½“åˆ›å»ºä¸€ä¸ªç»„ä»¶çš„ vnode æ—¶ï¼Œå­èŠ‚ç‚¹å¿…é¡»ä»¥æ’æ§½å‡½æ•°è¿›è¡Œä¼ é€’ã€‚å¦‚æœç»„ä»¶åªæœ‰é»˜è®¤æ§½ï¼Œå¯ä»¥ä½¿ç”¨å•ä¸ªæ’æ§½å‡½æ•°è¿›è¡Œä¼ é€’ã€‚å¦åˆ™ï¼Œå¿…é¡»ä»¥æ’æ§½å‡½æ•°çš„å¯¹è±¡å½¢å¼æ¥ä¼ é€’ã€‚</li><li>ä¸ºäº†æ–¹ä¾¿é˜…è¯»ï¼Œå½“å­èŠ‚ç‚¹ä¸æ˜¯æ’æ§½å¯¹è±¡æ—¶ï¼Œå¯ä»¥çœç•¥ prop å‚æ•°ã€‚</li></ul><h3 id=åŸºæœ¬ä½¿ç”¨-2>åŸºæœ¬ä½¿ç”¨<a hidden class=anchor aria-hidden=true href=#åŸºæœ¬ä½¿ç”¨-2>#</a></h3><p>hå‡½æ•°å¯ä»¥åœ¨ä¸¤ä¸ªåœ°æ–¹ä½¿ç”¨ï¼š</p><ul><li>renderå‡½æ•°é€‰é¡¹ä¸­ï¼›</li><li>setupå‡½æ•°é€‰é¡¹ä¸­ï¼ˆsetupæœ¬èº«éœ€è¦æ˜¯ä¸€ä¸ªå‡½æ•°ç±»å‹ï¼Œå‡½æ•°å†è¿”å›hå‡½æ•°åˆ›å»ºçš„VNodeï¼‰ï¼›</li></ul><h4 id=åœ¨renderå‡½æ•°é€‰é¡¹ä¸­>åœ¨renderå‡½æ•°é€‰é¡¹ä¸­<a hidden class=anchor aria-hidden=true href=#åœ¨renderå‡½æ•°é€‰é¡¹ä¸­>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=c1>// 1. å¼•å…¥hå‡½æ•°
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=p>{</span> <span class=nx>h</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>data</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>counter</span><span class=o>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 2. å®šä¹‰renderé€‰é¡¹
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>render</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 3. è¿”å›è‡ªå®šä¹‰çš„hå‡½æ•°
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=nx>h</span><span class=p>(</span><span class=s1>&#39;div&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=kr>class</span><span class=o>:</span> <span class=s1>&#39;app-view&#39;</span><span class=p>,</span> <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;abc&#39;</span> <span class=p>},</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 4. å®šä¹‰h2
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>h</span><span class=p>(</span><span class=s1>&#39;h2&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>className</span><span class=o>:</span> <span class=s1>&#39;title&#39;</span> <span class=p>},</span> <span class=k>this</span><span class=p>.</span><span class=nx>counter</span><span class=p>),</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 5. å®šä¹‰å¢åŠ æŒ‰é’®
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>h</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;button&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>className</span><span class=o>:</span> <span class=s1>&#39;add-btn&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>onClick</span><span class=o>:</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=p>.</span><span class=nx>counter</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;åŠ ä¸€&#39;</span>
</span></span><span class=line><span class=cl>      <span class=p>),</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 6. å®šä¹‰å‡å°‘æŒ‰é’®
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>h</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;button&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>className</span><span class=o>:</span> <span class=s1>&#39;remove-btn&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>onClick</span><span class=o>:</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=p>.</span><span class=nx>counter</span><span class=o>--</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;å‡ä¸€&#39;</span>
</span></span><span class=line><span class=cl>      <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>]);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><h4 id=åœ¨setupå‡½æ•°é€‰é¡¹ä¸­>åœ¨setupå‡½æ•°é€‰é¡¹ä¸­<a hidden class=anchor aria-hidden=true href=#åœ¨setupå‡½æ•°é€‰é¡¹ä¸­>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>h</span><span class=p>,</span> <span class=nx>ref</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>counter</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>increment</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>counter</span><span class=p>.</span><span class=nx>value</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>decrement</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>counter</span><span class=p>.</span><span class=nx>value</span><span class=o>--</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=c1>// è¿”å›renderå‡½æ•°
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=p>()</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nx>h</span><span class=p>(</span><span class=s1>&#39;div&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=kr>class</span><span class=o>:</span> <span class=s1>&#39;app-view&#39;</span><span class=p>,</span> <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;abc&#39;</span> <span class=p>},</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=nx>h</span><span class=p>(</span><span class=s1>&#39;h2&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>className</span><span class=o>:</span> <span class=s1>&#39;title&#39;</span> <span class=p>},</span> <span class=nx>counter</span><span class=p>.</span><span class=nx>value</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=nx>h</span><span class=p>(</span>
</span></span><span class=line><span class=cl>          <span class=s1>&#39;button&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>onClick</span><span class=o>:</span> <span class=nx>increment</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=s1>&#39;+1&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=nx>h</span><span class=p>(</span>
</span></span><span class=line><span class=cl>          <span class=s1>&#39;button&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>onClick</span><span class=o>:</span> <span class=nx>decrement</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=s1>&#39;-1&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>]);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><h4 id=åœ¨setupè¯­æ³•ç³–ä¸­>åœ¨setupè¯­æ³•ç³–ä¸­<a hidden class=anchor aria-hidden=true href=#åœ¨setupè¯­æ³•ç³–ä¸­>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!--</span> <span class=mf>2.</span> <span class=nx>ä½¿ç”¨ä¸€ä¸‹</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>star-render</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>h</span><span class=p>,</span> <span class=nx>ref</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>counter</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>increment</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>counter</span><span class=p>.</span><span class=nx>value</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>decrement</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>counter</span><span class=p>.</span><span class=nx>value</span><span class=o>--</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=c1>// 1. æ‹¿åˆ°renderå‡½æ•°
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>starRender</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nx>h</span><span class=p>(</span><span class=s1>&#39;div&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=kr>class</span><span class=o>:</span> <span class=s1>&#39;app-view&#39;</span><span class=p>,</span> <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;abc&#39;</span> <span class=p>},</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=nx>h</span><span class=p>(</span><span class=s1>&#39;h2&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>className</span><span class=o>:</span> <span class=s1>&#39;title&#39;</span> <span class=p>},</span> <span class=nx>counter</span><span class=p>.</span><span class=nx>value</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=nx>h</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;button&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>onClick</span><span class=o>:</span> <span class=nx>increment</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;+1&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=nx>h</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;button&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>onClick</span><span class=o>:</span> <span class=nx>decrement</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;-1&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><h4 id=å…¶ä»–å†™æ³•>å…¶ä»–å†™æ³•<a hidden class=anchor aria-hidden=true href=#å…¶ä»–å†™æ³•>#</a></h4><p>åˆ›å»ºåŸç”Ÿå…ƒç´ ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>h</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// é™¤äº† type å¤–ï¼Œå…¶ä»–å‚æ•°éƒ½æ˜¯å¯é€‰çš„
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>h</span><span class=p>(</span><span class=s1>&#39;div&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>h</span><span class=p>(</span><span class=s1>&#39;div&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>id</span><span class=o>:</span> <span class=s1>&#39;foo&#39;</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// attribute å’Œ property éƒ½å¯ä»¥ç”¨äº prop
</span></span></span><span class=line><span class=cl><span class=c1>// Vue ä¼šè‡ªåŠ¨é€‰æ‹©æ­£ç¡®çš„æ–¹å¼æ¥åˆ†é…å®ƒ
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>h</span><span class=p>(</span><span class=s1>&#39;div&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=kr>class</span><span class=o>:</span> <span class=s1>&#39;bar&#39;</span><span class=p>,</span> <span class=nx>innerHTML</span><span class=o>:</span> <span class=s1>&#39;hello&#39;</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// class ä¸ style å¯ä»¥åƒåœ¨æ¨¡æ¿ä¸­ä¸€æ ·
</span></span></span><span class=line><span class=cl><span class=c1>// ç”¨æ•°ç»„æˆ–å¯¹è±¡çš„å½¢å¼ä¹¦å†™
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>h</span><span class=p>(</span><span class=s1>&#39;div&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=kr>class</span><span class=o>:</span> <span class=p>[</span><span class=nx>foo</span><span class=p>,</span> <span class=p>{</span> <span class=nx>bar</span> <span class=p>}],</span> <span class=nx>style</span><span class=o>:</span> <span class=p>{</span> <span class=nx>color</span><span class=o>:</span> <span class=s1>&#39;red&#39;</span> <span class=p>}</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// äº‹ä»¶ç›‘å¬å™¨åº”ä»¥ onXxx çš„å½¢å¼ä¹¦å†™
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>h</span><span class=p>(</span><span class=s1>&#39;div&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>onClick</span><span class=o>:</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{}</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// children å¯ä»¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>h</span><span class=p>(</span><span class=s1>&#39;div&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>id</span><span class=o>:</span> <span class=s1>&#39;foo&#39;</span> <span class=p>},</span> <span class=s1>&#39;hello&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// æ²¡æœ‰ prop æ—¶å¯ä»¥çœç•¥ä¸å†™
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>h</span><span class=p>(</span><span class=s1>&#39;div&#39;</span><span class=p>,</span> <span class=s1>&#39;hello&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>h</span><span class=p>(</span><span class=s1>&#39;div&#39;</span><span class=p>,</span> <span class=p>[</span><span class=nx>h</span><span class=p>(</span><span class=s1>&#39;span&#39;</span><span class=p>,</span> <span class=s1>&#39;hello&#39;</span><span class=p>)])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// children æ•°ç»„å¯ä»¥åŒæ—¶åŒ…å« vnode å’Œå­—ç¬¦ä¸²
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>h</span><span class=p>(</span><span class=s1>&#39;div&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;hello&#39;</span><span class=p>,</span> <span class=nx>h</span><span class=p>(</span><span class=s1>&#39;span&#39;</span><span class=p>,</span> <span class=s1>&#39;hello&#39;</span><span class=p>)])</span>
</span></span></code></pre></div><p>åˆ›å»ºç»„ä»¶ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=nx>Foo</span> <span class=nx>from</span> <span class=s1>&#39;./Foo.vue&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ä¼ é€’ prop
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>h</span><span class=p>(</span><span class=nx>Foo</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ç­‰ä»·äº some-prop=&#34;hello&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>someProp</span><span class=o>:</span> <span class=s1>&#39;hello&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ç­‰ä»·äº @update=&#34;() =&gt; {}&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>onUpdate</span><span class=o>:</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ä¼ é€’å•ä¸ªé»˜è®¤æ’æ§½
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>h</span><span class=p>(</span><span class=nx>Foo</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=s1>&#39;default slot&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ä¼ é€’å…·åæ’æ§½
</span></span></span><span class=line><span class=cl><span class=c1>// æ³¨æ„ï¼Œéœ€è¦ä½¿ç”¨ `null` æ¥é¿å…
</span></span></span><span class=line><span class=cl><span class=c1>// æ’æ§½å¯¹è±¡è¢«å½“ä½œæ˜¯ prop
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>h</span><span class=p>(</span><span class=nx>MyComponent</span><span class=p>,</span> <span class=kc>null</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>default</span><span class=o>:</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=s1>&#39;default slot&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>foo</span><span class=o>:</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>h</span><span class=p>(</span><span class=s1>&#39;div&#39;</span><span class=p>,</span> <span class=s1>&#39;foo&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>  <span class=nx>bar</span><span class=o>:</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>[</span><span class=nx>h</span><span class=p>(</span><span class=s1>&#39;span&#39;</span><span class=p>,</span> <span class=s1>&#39;one&#39;</span><span class=p>),</span> <span class=nx>h</span><span class=p>(</span><span class=s1>&#39;span&#39;</span><span class=p>,</span> <span class=s1>&#39;two&#39;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div><h3 id=å‡½æ•°ç»„ä»¶å’Œæ’æ§½çš„ä½¿ç”¨>å‡½æ•°ç»„ä»¶å’Œæ’æ§½çš„ä½¿ç”¨<a hidden class=anchor aria-hidden=true href=#å‡½æ•°ç»„ä»¶å’Œæ’æ§½çš„ä½¿ç”¨>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=kr>import</span> <span class=p>{</span> <span class=nx>h</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;vue&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>render</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>h</span><span class=p>(</span><span class=s2>&#34;div&#34;</span><span class=p>,</span> <span class=kc>null</span><span class=p>,</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=nx>h</span><span class=p>(</span><span class=s2>&#34;h2&#34;</span><span class=p>,</span> <span class=kc>null</span><span class=p>,</span> <span class=s2>&#34;Hello World&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>$slots</span><span class=p>.</span><span class=k>default</span> <span class=o>?</span> <span class=k>this</span><span class=p>.</span><span class=nx>$slots</span><span class=p>.</span><span class=k>default</span><span class=p>({</span><span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;coderwhy&#34;</span><span class=p>})</span><span class=o>:</span> <span class=nx>h</span><span class=p>(</span><span class=s2>&#34;span&#34;</span><span class=p>,</span> <span class=kc>null</span><span class=p>,</span> <span class=s2>&#34;æˆ‘æ˜¯HelloWorldçš„æ’æ§½é»˜è®¤å€¼&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>style</span> <span class=na>lang</span><span class=o>=</span><span class=s>&#34;scss&#34;</span> <span class=na>scoped</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>style</span><span class=p>&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>starRender</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>h</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>HelloWorld</span> <span class=nx>from</span> <span class=s1>&#39;./HelloWorld.vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>starRender</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nx>h</span><span class=p>(</span><span class=s2>&#34;div&#34;</span><span class=p>,</span> <span class=kc>null</span><span class=p>,</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=nx>h</span><span class=p>(</span><span class=nx>HelloWorld</span><span class=p>,</span> <span class=kc>null</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>default</span><span class=o>:</span> <span class=nx>props</span> <span class=p>=&gt;</span> <span class=nx>h</span><span class=p>(</span><span class=s2>&#34;span&#34;</span><span class=p>,</span> <span class=kc>null</span><span class=p>,</span> <span class=sb>`appä¼ å…¥åˆ°HelloWorldä¸­çš„å†…å®¹: </span><span class=si>${</span><span class=nx>props</span><span class=p>.</span><span class=nx>name</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>])</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202312181955950.png><img src=https://qiniu.waite.wang/202312181955950.png alt=image-20231218195545969></a></div></p><h2 id=jsx>Jsx<a hidden class=anchor aria-hidden=true href=#jsx>#</a></h2><p><a href=https://facebook.github.io/jsx/ target=_blank>JSX</a> æ˜¯ JavaScript çš„ä¸€ä¸ªç±»ä¼¼ XML çš„æ‰©å±•ï¼Œæœ‰äº†å®ƒï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä»¥ä¸‹çš„æ–¹å¼æ¥ä¹¦å†™ä»£ç ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=kr>const</span> <span class=nx>vnode</span> <span class=o>=</span> <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span><span class=nx>hello</span><span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>åœ¨ JSX è¡¨è¾¾å¼ä¸­ï¼Œä½¿ç”¨å¤§æ‹¬å·æ¥åµŒå…¥åŠ¨æ€å€¼ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=kr>const</span> <span class=nx>vnode</span> <span class=o>=</span> <span class=p>&lt;</span><span class=nt>div</span> <span class=na>id</span><span class=o>=</span><span class=p>{</span><span class=nx>dynamicId</span><span class=p>}&gt;</span><span class=nx>hello</span><span class=p>,</span> <span class=p>{</span><span class=nx>userName</span><span class=p>}&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span></code></pre></div><h3 id=é…ç½®>é…ç½®<a hidden class=anchor aria-hidden=true href=#é…ç½®>#</a></h3><h4 id=vue-cliç¯å¢ƒ>vue-cliç¯å¢ƒ<a hidden class=anchor aria-hidden=true href=#vue-cliç¯å¢ƒ>#</a></h4><ul><li><code>npm install @vue/babel-plugin-jsx -D</code></li><li><code>babel.config.js</code> ä¸­é…ç½®</li></ul><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202312182036029.png><img src=https://qiniu.waite.wang/202312182036029.png alt=img></a></div></p><h4 id=viteç¯å¢ƒ>viteç¯å¢ƒ<a hidden class=anchor aria-hidden=true href=#viteç¯å¢ƒ>#</a></h4><ul><li><code>npm install @vitejs/plugin-vue-jsx -D</code></li><li><code>vite.config.js</code> ä¸­é…ç½®</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>fileURLToPath</span><span class=p>,</span> <span class=nx>URL</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;node:url&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>defineConfig</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vite&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>vue</span> <span class=nx>from</span> <span class=s1>&#39;@vitejs/plugin-vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>jsx</span> <span class=nx>from</span> <span class=s1>&#39;@vitejs/plugin-vue-jsx&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineConfig</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>plugins</span><span class=o>:</span> <span class=p>[</span><span class=nx>vue</span><span class=p>(),</span> <span class=nx>jsx</span><span class=p>()],</span>
</span></span><span class=line><span class=cl>  <span class=nx>resolve</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>alias</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;@&#39;</span><span class=o>:</span> <span class=nx>fileURLToPath</span><span class=p>(</span><span class=k>new</span> <span class=nx>URL</span><span class=p>(</span><span class=s1>&#39;./src&#39;</span><span class=p>,</span> <span class=kr>import</span><span class=p>.</span><span class=nx>meta</span><span class=p>.</span><span class=nx>url</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><h3 id=åŸºæœ¬ä½¿ç”¨-3>åŸºæœ¬ä½¿ç”¨<a hidden class=anchor aria-hidden=true href=#åŸºæœ¬ä½¿ç”¨-3>#</a></h3><h4 id=åœ¨renderå‡½æ•°ä¸­>åœ¨renderå‡½æ•°ä¸­<a hidden class=anchor aria-hidden=true href=#åœ¨renderå‡½æ•°ä¸­>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=c>&lt;!--</span> <span class=mf>1.</span> <span class=nx>è¿™é‡ŒåŠ ä¸Šæ³¨æ˜è¯­è¨€ä½¿ç”¨jsx</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>lang</span><span class=o>=</span><span class=s>&#34;jsx&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>Home</span> <span class=nx>from</span> <span class=s1>&#39;./pages/home.vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>data</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>counter</span><span class=o>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>render</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 2. è¿”å›jsxå†™æ³•
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;app-view&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>h2</span><span class=p>&gt;</span><span class=nx>å½“å‰è®¡æ•°</span><span class=o>:</span><span class=p>{</span><span class=k>this</span><span class=p>.</span><span class=nx>counter</span><span class=p>}&lt;/</span><span class=nt>h2</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>button</span> <span class=na>onClick</span><span class=o>=</span><span class=p>{</span><span class=k>this</span><span class=p>.</span><span class=nx>increment</span><span class=p>}&gt;</span><span class=o>+</span><span class=mi>1</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>button</span> <span class=na>onClick</span><span class=o>=</span><span class=p>{</span><span class=k>this</span><span class=p>.</span><span class=nx>decrement</span><span class=p>}&gt;</span><span class=o>-</span><span class=mi>1</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>methods</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>increment</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>counter</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>decrement</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>counter</span><span class=o>--</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><h4 id=åœ¨setupå‡½æ•°ä¸­>åœ¨setupå‡½æ•°ä¸­<a hidden class=anchor aria-hidden=true href=#åœ¨setupå‡½æ•°ä¸­>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=c>&lt;!--</span> <span class=mf>1.</span> <span class=nx>è¿™é‡ŒåŠ ä¸Šæ³¨æ˜è¯­è¨€ä½¿ç”¨jsx</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>lang</span><span class=o>=</span><span class=s>&#34;jsx&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>data</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>counter</span><span class=o>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>render</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 2. è¿”å›jsxå†™æ³•
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;app-view&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>h2</span><span class=p>&gt;</span><span class=nx>å½“å‰è®¡æ•°</span><span class=o>:</span><span class=p>{</span><span class=k>this</span><span class=p>.</span><span class=nx>counter</span><span class=p>}&lt;/</span><span class=nt>h2</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>button</span> <span class=na>onClick</span><span class=o>=</span><span class=p>{</span><span class=k>this</span><span class=p>.</span><span class=nx>increment</span><span class=p>}&gt;</span><span class=o>+</span><span class=mi>1</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>button</span> <span class=na>onClick</span><span class=o>=</span><span class=p>{</span><span class=k>this</span><span class=p>.</span><span class=nx>decrement</span><span class=p>}&gt;</span><span class=o>-</span><span class=mi>1</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>methods</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>increment</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>counter</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>decrement</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>counter</span><span class=o>--</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><h4 id=åœ¨setupè¯­æ³•ç³–ä¸­-1>åœ¨setupè¯­æ³•ç³–ä¸­<a hidden class=anchor aria-hidden=true href=#åœ¨setupè¯­æ³•ç³–ä¸­-1>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!--</span> <span class=mf>3.</span> <span class=nx>ä½¿ç”¨</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>star-render</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=c>&lt;!--</span> <span class=mf>1.</span> <span class=nx>è¿™é‡ŒåŠ ä¸Šæ³¨æ˜è¯­è¨€ä½¿ç”¨jsx</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span> <span class=na>lang</span><span class=o>=</span><span class=s>&#34;jsx&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>ref</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>counter</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span> 
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>increment</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>counter</span><span class=p>.</span><span class=nx>value</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>decrement</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>counter</span><span class=p>.</span><span class=nx>value</span><span class=o>--</span><span class=p>;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=c1>// 2. æ‹¿åˆ°renderå‡½æ•°
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>starRender</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;app-view&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h2</span><span class=p>&gt;</span><span class=nx>å½“å‰è®¡æ•°</span><span class=o>:</span><span class=p>{</span><span class=nx>counter</span><span class=p>.</span><span class=nx>value</span><span class=p>}&lt;/</span><span class=nt>h2</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>button</span> <span class=na>onClick</span><span class=o>=</span><span class=p>{</span><span class=nx>increment</span><span class=p>}&gt;</span><span class=o>+</span><span class=mi>1</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>button</span> <span class=na>onClick</span><span class=o>=</span><span class=p>{</span><span class=nx>decrement</span><span class=p>}&gt;</span><span class=o>-</span><span class=mi>1</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><h2 id=script-setupè¯­æ³•ç³–>script setupè¯­æ³•ç³–<a hidden class=anchor aria-hidden=true href=#script-setupè¯­æ³•ç³–>#</a></h2><blockquote><p><code>&lt;script setup></code>æ˜¯åœ¨å•æ–‡ä»¶ç»„ä»¶ (SFC) ä¸­ä½¿ç”¨ç»„åˆå¼ API çš„ç¼–è¯‘æ—¶è¯­æ³•ç³–ï¼Œå½“åŒæ—¶ä½¿ç”¨ SFC ä¸ç»„åˆå¼ API æ—¶åˆ™æ¨èè¯¥è¯­æ³•</p></blockquote><ul><li><strong>æ›´å°‘çš„æ ·æ¿å†…å®¹ï¼Œæ›´ç®€æ´çš„ä»£ç </strong></li><li><strong>èƒ½å¤Ÿä½¿ç”¨çº¯ Typescript å£°æ˜ prop å’ŒæŠ›å‡ºäº‹ä»¶</strong></li><li><strong>æ›´å¥½çš„è¿è¡Œæ—¶æ€§èƒ½</strong></li><li><strong>æ›´å¥½çš„ IDE ç±»å‹æ¨æ–­æ€§èƒ½</strong></li></ul><h3 id=é¡¶å±‚çš„ç»‘å®šä¼šè¢«æš´éœ²ç»™æ¨¡æ¿>é¡¶å±‚çš„ç»‘å®šä¼šè¢«æš´éœ²ç»™æ¨¡æ¿<a hidden class=anchor aria-hidden=true href=#é¡¶å±‚çš„ç»‘å®šä¼šè¢«æš´éœ²ç»™æ¨¡æ¿>#</a></h3><blockquote><p>å½“ä½¿ç”¨<code> &lt;script setup></code> çš„æ—¶å€™ï¼Œä»»ä½•åœ¨<code>&lt;script setup></code> å£°æ˜çš„é¡¶å±‚çš„ç»‘å®š (åŒ…æ‹¬å˜é‡ï¼Œå‡½æ•°å£°æ˜ï¼Œä»¥åŠ import å¼•å…¥çš„å†…å®¹) èƒ½åœ¨æ¨¡æ¿ä¸­ç›´æ¥ä½¿ç”¨, å¯¼å…¥çš„ç»„ä»¶ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;{{</span> <span class=nx>mes</span> <span class=p>}}&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>button</span> <span class=nt>@click</span><span class=s>=&#34;addClick&#34;</span><span class=p>&gt;</span><span class=na>æŒ‰é’®</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=err>&lt;!--</span> <span class=na>1.</span> <span class=na>è¿™é‡ŒåŠ ä¸Šsetupå±æ€§</span> <span class=err>--</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>ref</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=c1>// å®šä¹‰æ•°æ®åï¼Œtemplateä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œæ— éœ€è¿”å›
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>mes</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// å®šä¹‰çš„æ–¹æ³•ä¹Ÿæ˜¯ï¼Œç›´æ¥å¯è¢«ä½¿ç”¨
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>addClick</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;hahah&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!--</span> <span class=mf>2.</span> <span class=nx>ç›´æ¥ä½¿ç”¨</span><span class=err>ï¼Œ</span><span class=nx>ä¸ç”¨é€šè¿‡compoentsæ³¨å†Œ</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>my-home</span><span class=p>&gt;&lt;/</span><span class=nt>my-home</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=c1>// 1. è¿™æ˜¯å¯¼å…¥çš„ç»„ä»¶
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>myHome</span> <span class=nx>from</span> <span class=s1>&#39;./myHome.vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><h3 id=defineprops>defineProps()<a hidden class=anchor aria-hidden=true href=#defineprops>#</a></h3><blockquote><p>defineProps => ç”¨æ¥æ¥æ”¶ä»çˆ¶ç»„ä»¶ä¼ é€’è¿‡æ¥çš„æ•°æ®</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>my-home</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;hello&#34;</span> <span class=nt>:age</span><span class=o>=</span><span class=s>&#34;18&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>my-home</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>myHome</span> <span class=nx>from</span> <span class=s1>&#39;./myHome.vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;{{</span> <span class=nx>name</span> <span class=p>}}</span> <span class=o>-</span> <span class=p>{{</span> <span class=nx>age</span> <span class=p>}}&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=c1>// definePropsæ˜¯å†…ç½®ç»„ä»¶ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œä¸ç”¨å¯¼å…¥
</span></span></span><span class=line><span class=cl><span class=c1>// å¯ä»¥æ¥æ”¶ä¸€ä¸‹è¿”å›çš„propså¯¹è±¡ï¼Œä¹Ÿå¯ä»¥ä¸ç”¨
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>props</span> <span class=o>=</span> <span class=nx>defineProps</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>type</span><span class=o>:</span> <span class=nb>String</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=k>default</span><span class=o>:</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>age</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>type</span><span class=o>:</span> <span class=nb>Number</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=k>default</span><span class=o>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>props</span><span class=p>);</span> <span class=c1>// Proxy {name: &#39;hello&#39;, age: 18}
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><h3 id=defineemits>defineEmits()<a hidden class=anchor aria-hidden=true href=#defineemits>#</a></h3><blockquote><p>defineProps => ç”¨æ¥å‘å°„äº‹ä»¶ç»™çˆ¶ç»„ä»¶</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>button</span> <span class=nt>@click</span><span class=s>=&#34;btnClick&#34;</span><span class=p>&gt;</span><span class=na>å‘é€</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=c1>// 1. æ³¨å†Œä¸€ä¸‹å‘å°„çš„äº‹ä»¶
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>emits</span> <span class=o>=</span> <span class=nx>defineEmits</span><span class=p>([</span><span class=s1>&#39;btnClick&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=c1>// 2. ç›‘å¬æŒ‰é’®çš„ç‚¹å‡»
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>btnClick</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 3. å‘å°„
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>emits</span><span class=p>(</span><span class=s1>&#39;btnClick&#39;</span><span class=p>,</span> <span class=s1>&#39;æˆ‘å‘å°„äº†&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!--</span> <span class=mf>1.</span> <span class=nx>ç›‘å¬å­ç»„ä»¶å‘å°„æ¥çš„äº‹ä»¶</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>my-home</span> <span class=nt>@btnClick</span><span class=s>=&#34;handleClick&#34;</span><span class=p>&gt;</span><span class=err>&lt;/</span><span class=na>my</span><span class=nt>-home</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>myHome</span> <span class=nx>from</span> <span class=s1>&#39;./myHome.vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=c1>// 2. è·å–å­ç»„ä»¶ä¼ é€’è¿‡æ¥çš„å€¼
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>handleClick</span> <span class=o>=</span> <span class=p>(</span><span class=nx>message</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>message</span><span class=p>);</span> <span class=c1>// æˆ‘å‘å°„äº†
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><h3 id=defineexpose>defineExpose()<a hidden class=anchor aria-hidden=true href=#defineexpose>#</a></h3><blockquote><p>defineExpose => ç”¨æ¥æš´éœ²æ•°æ®</p><p>ps : ä½¿ç”¨ <code>&lt;script setup> </code>çš„ç»„ä»¶æ˜¯é»˜è®¤å…³é—­çš„</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>foo</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;foo&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=c1>// æš´éœ²å‡ºå»ï¼Œæ‰å¯ä»¥è¢«è®¿é—®åˆ°
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>defineExpose</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>foo</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!--</span> <span class=mf>1.</span> <span class=nx>å®šä¹‰ref</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>my-home</span> <span class=na>ref</span><span class=o>=</span><span class=s>&#34;myHomeRef&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>my-home</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>onMounted</span><span class=p>,</span> <span class=nx>ref</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>myHome</span> <span class=nx>from</span> <span class=s1>&#39;../../../Vue3/06_é˜¶æ®µå…­-Vue3å…¨å®¶æ¡¶å®æˆ˜/code/04_learn_composition/src/11_script_setupè¯­æ³•/myHome.vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>// 2. å®šä¹‰åç§°ä¸€æ ·
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>myHomeRef</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nx>onMounted</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 3. åœ¨ç”Ÿå‘½å‘¨æœŸä¸­è®¿é—®
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>myHomeRef</span><span class=p>.</span><span class=nx>value</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><h2 id=è‡ªå®šä¹‰ç»„ä»¶>è‡ªå®šä¹‰ç»„ä»¶<a hidden class=anchor aria-hidden=true href=#è‡ªå®šä¹‰ç»„ä»¶>#</a></h2><h3 id=æŒ‡ä»¤çš„ç”Ÿå‘½å‘¨æœŸ>æŒ‡ä»¤çš„ç”Ÿå‘½å‘¨æœŸ<a hidden class=anchor aria-hidden=true href=#æŒ‡ä»¤çš„ç”Ÿå‘½å‘¨æœŸ>#</a></h3><ul><li>ä¸€ä¸ªæŒ‡ä»¤å®šä¹‰çš„å¯¹è±¡ï¼ŒVueæä¾›äº†å¦‚ä¸‹çš„å‡ ä¸ªé’©å­å‡½æ•°ï¼š</li><li>createdï¼šåœ¨ç»‘å®šå…ƒç´ çš„ attribute æˆ–äº‹ä»¶ç›‘å¬å™¨è¢«åº”ç”¨ä¹‹å‰è°ƒç”¨ï¼›</li><li>beforeMountï¼šå½“æŒ‡ä»¤ç¬¬ä¸€æ¬¡ç»‘å®šåˆ°å…ƒç´ å¹¶ä¸”åœ¨æŒ‚è½½çˆ¶ç»„ä»¶ä¹‹å‰è°ƒç”¨ï¼›</li><li>mountedï¼šåœ¨ç»‘å®šå…ƒç´ çš„çˆ¶ç»„ä»¶è¢«æŒ‚è½½åè°ƒç”¨ï¼›</li><li>beforeUpdateï¼šåœ¨æ›´æ–°åŒ…å«ç»„ä»¶çš„ VNode ä¹‹å‰è°ƒç”¨ï¼›</li><li>updatedï¼šåœ¨åŒ…å«ç»„ä»¶çš„ VNode åŠå…¶å­ç»„ä»¶çš„ VNode æ›´æ–°åè°ƒç”¨ï¼›</li><li>beforeUnmountï¼šåœ¨å¸è½½ç»‘å®šå…ƒç´ çš„çˆ¶ç»„ä»¶ä¹‹å‰è°ƒç”¨ï¼›</li><li>unmountedï¼šå½“æŒ‡ä»¤ä¸å…ƒç´ è§£é™¤ç»‘å®šä¸”çˆ¶ç»„ä»¶å·²å¸è½½æ—¶ï¼Œåªè°ƒç”¨ä¸€æ¬¡ï¼›</li></ul><h3 id=æŒ‡ä»¤é’©å­>æŒ‡ä»¤é’©å­<a hidden class=anchor aria-hidden=true href=#æŒ‡ä»¤é’©å­>#</a></h3><p>ä¸€ä¸ªæŒ‡ä»¤çš„å®šä¹‰å¯¹è±¡å¯ä»¥æä¾›å‡ ç§é’©å­å‡½æ•° (éƒ½æ˜¯å¯é€‰çš„)ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>myDirective</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// åœ¨ç»‘å®šå…ƒç´ çš„ attribute å‰
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// æˆ–äº‹ä»¶ç›‘å¬å™¨åº”ç”¨å‰è°ƒç”¨
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>created</span><span class=p>(</span><span class=nx>el</span><span class=p>,</span> <span class=nx>binding</span><span class=p>,</span> <span class=nx>vnode</span><span class=p>,</span> <span class=nx>prevVnode</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ä¸‹é¢ä¼šä»‹ç»å„ä¸ªå‚æ•°çš„ç»†èŠ‚
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=c1>// åœ¨å…ƒç´ è¢«æ’å…¥åˆ° DOM å‰è°ƒç”¨
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>beforeMount</span><span class=p>(</span><span class=nx>el</span><span class=p>,</span> <span class=nx>binding</span><span class=p>,</span> <span class=nx>vnode</span><span class=p>,</span> <span class=nx>prevVnode</span><span class=p>)</span> <span class=p>{},</span>
</span></span><span class=line><span class=cl>  <span class=c1>// åœ¨ç»‘å®šå…ƒç´ çš„çˆ¶ç»„ä»¶
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// åŠä»–è‡ªå·±çš„æ‰€æœ‰å­èŠ‚ç‚¹éƒ½æŒ‚è½½å®Œæˆåè°ƒç”¨
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>mounted</span><span class=p>(</span><span class=nx>el</span><span class=p>,</span> <span class=nx>binding</span><span class=p>,</span> <span class=nx>vnode</span><span class=p>,</span> <span class=nx>prevVnode</span><span class=p>)</span> <span class=p>{},</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ç»‘å®šå…ƒç´ çš„çˆ¶ç»„ä»¶æ›´æ–°å‰è°ƒç”¨
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>beforeUpdate</span><span class=p>(</span><span class=nx>el</span><span class=p>,</span> <span class=nx>binding</span><span class=p>,</span> <span class=nx>vnode</span><span class=p>,</span> <span class=nx>prevVnode</span><span class=p>)</span> <span class=p>{},</span>
</span></span><span class=line><span class=cl>  <span class=c1>// åœ¨ç»‘å®šå…ƒç´ çš„çˆ¶ç»„ä»¶
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// åŠä»–è‡ªå·±çš„æ‰€æœ‰å­èŠ‚ç‚¹éƒ½æ›´æ–°åè°ƒç”¨
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>updated</span><span class=p>(</span><span class=nx>el</span><span class=p>,</span> <span class=nx>binding</span><span class=p>,</span> <span class=nx>vnode</span><span class=p>,</span> <span class=nx>prevVnode</span><span class=p>)</span> <span class=p>{},</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ç»‘å®šå…ƒç´ çš„çˆ¶ç»„ä»¶å¸è½½å‰è°ƒç”¨
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>beforeUnmount</span><span class=p>(</span><span class=nx>el</span><span class=p>,</span> <span class=nx>binding</span><span class=p>,</span> <span class=nx>vnode</span><span class=p>,</span> <span class=nx>prevVnode</span><span class=p>)</span> <span class=p>{},</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ç»‘å®šå…ƒç´ çš„çˆ¶ç»„ä»¶å¸è½½åè°ƒç”¨
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>unmounted</span><span class=p>(</span><span class=nx>el</span><span class=p>,</span> <span class=nx>binding</span><span class=p>,</span> <span class=nx>vnode</span><span class=p>,</span> <span class=nx>prevVnode</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>æŒ‡ä»¤çš„é’©å­ä¼šä¼ é€’ä»¥ä¸‹å‡ ç§å‚æ•°ï¼š</p><ul><li><code>el</code>ï¼šæŒ‡ä»¤ç»‘å®šåˆ°çš„å…ƒç´ ã€‚è¿™å¯ä»¥ç”¨äºç›´æ¥æ“ä½œ DOMã€‚</li><li><code>binding</code>ï¼šä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«ä»¥ä¸‹å±æ€§ã€‚<ul><li><code>value</code>ï¼šä¼ é€’ç»™æŒ‡ä»¤çš„å€¼ã€‚ä¾‹å¦‚åœ¨ <code>v-my-directive="1 + 1"</code> ä¸­ï¼Œå€¼æ˜¯ <code>2</code>ã€‚</li><li><code>oldValue</code>ï¼šä¹‹å‰çš„å€¼ï¼Œä»…åœ¨ <code>beforeUpdate</code> å’Œ <code>updated</code> ä¸­å¯ç”¨ã€‚æ— è®ºå€¼æ˜¯å¦æ›´æ”¹ï¼Œå®ƒéƒ½å¯ç”¨ã€‚</li><li><code>arg</code>ï¼šä¼ é€’ç»™æŒ‡ä»¤çš„å‚æ•° (å¦‚æœæœ‰çš„è¯)ã€‚ä¾‹å¦‚åœ¨ <code>v-my-directive:foo</code> ä¸­ï¼Œå‚æ•°æ˜¯ <code>"foo"</code>ã€‚</li><li><code>modifiers</code>ï¼šä¸€ä¸ªåŒ…å«ä¿®é¥°ç¬¦çš„å¯¹è±¡ (å¦‚æœæœ‰çš„è¯)ã€‚ä¾‹å¦‚åœ¨ <code>v-my-directive.foo.bar</code> ä¸­ï¼Œä¿®é¥°ç¬¦å¯¹è±¡æ˜¯ <code>{ foo: true, bar: true }</code>ã€‚</li><li><code>instance</code>ï¼šä½¿ç”¨è¯¥æŒ‡ä»¤çš„ç»„ä»¶å®ä¾‹ã€‚</li><li><code>dir</code>ï¼šæŒ‡ä»¤çš„å®šä¹‰å¯¹è±¡ã€‚</li></ul></li><li><code>vnode</code>ï¼šä»£è¡¨ç»‘å®šå…ƒç´ çš„åº•å±‚ VNodeã€‚</li><li><code>prevNode</code>ï¼šä»£è¡¨ä¹‹å‰çš„æ¸²æŸ“ä¸­æŒ‡ä»¤æ‰€ç»‘å®šå…ƒç´ çš„ VNodeã€‚ä»…åœ¨ <code>beforeUpdate</code> å’Œ <code>updated</code> é’©å­ä¸­å¯ç”¨ã€‚</li></ul><p>ä¸¾ä¾‹æ¥è¯´ï¼Œåƒä¸‹é¢è¿™æ ·ä½¿ç”¨æŒ‡ä»¤ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>div</span> <span class=na>v</span><span class=nt>-example:foo.bar</span><span class=o>=</span><span class=s>&#34;baz&#34;</span><span class=p>&gt;</span>
</span></span></code></pre></div><p><code>binding</code> å‚æ•°ä¼šæ˜¯ä¸€ä¸ªè¿™æ ·çš„å¯¹è±¡ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>arg</span><span class=o>:</span> <span class=s1>&#39;foo&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>modifiers</span><span class=o>:</span> <span class=p>{</span> <span class=nx>bar</span><span class=o>:</span> <span class=kc>true</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>value</span><span class=o>:</span> <span class=cm>/* `baz` çš„å€¼ */</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>oldValue</span><span class=o>:</span> <span class=cm>/* ä¸Šä¸€æ¬¡æ›´æ–°æ—¶ `baz` çš„å€¼ */</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>å’Œå†…ç½®æŒ‡ä»¤ç±»ä¼¼ï¼Œè‡ªå®šä¹‰æŒ‡ä»¤çš„å‚æ•°ä¹Ÿå¯ä»¥æ˜¯åŠ¨æ€çš„ã€‚ä¸¾ä¾‹æ¥è¯´ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>div</span> <span class=na>v</span><span class=nt>-example:[arg]</span><span class=o>=</span><span class=s>&#34;value&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>è¿™é‡ŒæŒ‡ä»¤çš„å‚æ•°ä¼šåŸºäºç»„ä»¶çš„ <code>arg</code> æ•°æ®å±æ€§å“åº”å¼åœ°æ›´æ–°ã€‚</p><blockquote><p>é™¤äº† <code>el</code> å¤–ï¼Œå…¶ä»–å‚æ•°éƒ½æ˜¯åªè¯»çš„ï¼Œä¸è¦æ›´æ”¹å®ƒä»¬ã€‚è‹¥ä½ éœ€è¦åœ¨ä¸åŒçš„é’©å­é—´å…±äº«ä¿¡æ¯ï¼Œæ¨èé€šè¿‡å…ƒç´ çš„
<a href=https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/dataset target=_blank>dataset</a> attribute å®ç°ã€‚</p></blockquote><h3 id=ç®€å•ä½¿ç”¨>ç®€å•ä½¿ç”¨<a hidden class=anchor aria-hidden=true href=#ç®€å•ä½¿ç”¨>#</a></h3><blockquote><p><strong>Vueä¸­è‡ªå¸¦çš„æŒ‡ä»¤ä¾‹å¦‚v-showã€v-forã€v-modelç­‰ç­‰ï¼Œé™¤äº†ä½¿ç”¨è¿™äº›æŒ‡ä»¤ä¹‹å¤–ï¼ŒVue ä¹Ÿå…è®¸æˆ‘ä»¬æ¥è‡ªå®šä¹‰è‡ªå·±çš„æŒ‡ä»¤</strong></p><p><strong>ps : ä¸€èˆ¬éœ€è¦å¯¹domå…ƒç´ è¿›è¡Œåº•å±‚æ“ä½œæ—¶ä½¿ç”¨</strong></p></blockquote><ul><li>è‡ªå®šä¹‰æŒ‡ä»¤åˆ†ä¸ºä¸¤ç§ï¼š<ul><li>è‡ªå®šä¹‰å±€éƒ¨æŒ‡ä»¤ï¼šç»„ä»¶ä¸­é€šè¿‡ directives é€‰é¡¹ï¼Œåªèƒ½åœ¨å½“å‰ç»„ä»¶ä¸­ä½¿ç”¨ï¼›</li><li>è‡ªå®šä¹‰å…¨å±€æŒ‡ä»¤ï¼šappçš„ directive æ–¹æ³•ï¼Œå¯ä»¥åœ¨ä»»æ„ç»„ä»¶ä¸­è¢«ä½¿ç”¨ï¼›</li></ul></li></ul><h4 id=é»˜è®¤å®ç°æ–¹å¼>é»˜è®¤å®ç°æ–¹å¼<a hidden class=anchor aria-hidden=true href=#é»˜è®¤å®ç°æ–¹å¼>#</a></h4><p>ä¸€ä¸ªè‡ªå®šä¹‰æŒ‡ä»¤ç”±ä¸€ä¸ªåŒ…å«ç±»ä¼¼ç»„ä»¶ç”Ÿå‘½å‘¨æœŸé’©å­çš„å¯¹è±¡æ¥å®šä¹‰ã€‚é’©å­å‡½æ•°ä¼šæ¥æ”¶åˆ°æŒ‡ä»¤æ‰€ç»‘å®šå…ƒç´ ä½œä¸ºå…¶å‚æ•°ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰æŒ‡ä»¤çš„ä¾‹å­ï¼Œå½“ä¸€ä¸ª input å…ƒç´ è¢« Vue æ’å…¥åˆ° DOM ä¸­åï¼Œå®ƒä¼šè¢«è‡ªåŠ¨èšç„¦ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=c1>// åœ¨æ¨¡æ¿ä¸­å¯ç”¨ v-focus
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>vFocus</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>mounted</span><span class=o>:</span> <span class=p>(</span><span class=nx>el</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>el</span><span class=p>.</span><span class=nx>focus</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>input</span> <span class=na>v</span><span class=nt>-focus</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;app-view&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;text&#34;</span> <span class=na>ref</span><span class=o>=</span><span class=s>&#34;inputRef&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>onMounted</span><span class=p>,</span> <span class=nx>ref</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>inputRef</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=nx>onMounted</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>inputRef</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>focus</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><h4 id=ä½¿ç”¨å±€éƒ¨æŒ‡ä»¤>ä½¿ç”¨å±€éƒ¨æŒ‡ä»¤<a hidden class=anchor aria-hidden=true href=#ä½¿ç”¨å±€éƒ¨æŒ‡ä»¤>#</a></h4><p>åœ¨ <code>&lt;script setup></code> ä¸­ï¼Œä»»ä½•ä»¥ <code>v</code> å¼€å¤´çš„é©¼å³°å¼å‘½åçš„å˜é‡éƒ½å¯ä»¥è¢«ç”¨ä½œä¸€ä¸ªè‡ªå®šä¹‰æŒ‡ä»¤ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ<code>vFocus</code> å³å¯ä»¥åœ¨æ¨¡æ¿ä¸­ä»¥ <code>v-focus</code> çš„å½¢å¼ä½¿ç”¨ã€‚</p><p>åœ¨æ²¡æœ‰ä½¿ç”¨ <code>&lt;script setup></code> çš„æƒ…å†µä¸‹ï¼Œè‡ªå®šä¹‰æŒ‡ä»¤éœ€è¦é€šè¿‡ <code>directives</code> é€‰é¡¹æ³¨å†Œï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;text&#34;</span> <span class=nt>v-focus</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// å±€éƒ¨æŒ‡ä»¤
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>directives</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>focus</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>mounted</span><span class=p>(</span><span class=nx>el</span><span class=p>,</span> <span class=nx>bindings</span><span class=p>,</span> <span class=nx>vnode</span><span class=p>,</span> <span class=nx>preVnode</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;focus mounted&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=nx>el</span><span class=p>.</span><span class=nx>focus</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><h4 id=è‡ªå®šä¹‰å…¨å±€æŒ‡ä»¤>è‡ªå®šä¹‰å…¨å±€æŒ‡ä»¤<a hidden class=anchor aria-hidden=true href=#è‡ªå®šä¹‰å…¨å±€æŒ‡ä»¤>#</a></h4><ul><li><code>main.js</code>ä¸­æ³¨å†Œ</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>createApp</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>App</span> <span class=nx>from</span> <span class=s1>&#39;./App.vue&#39;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>app</span> <span class=o>=</span> <span class=nx>createApp</span><span class=p>(</span><span class=nx>App</span><span class=p>)</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=c1>// æŒ‡ä»¤åç§°
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>app</span><span class=p>.</span><span class=nx>directive</span><span class=p>(</span><span class=s1>&#39;focus&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ä½¿ç”¨è‡ªå®šä¹‰æŒ‡ä»¤çš„ç”Ÿå‘½å‘¨æœŸï¼ŒæŒ‚è½½åè®¿é—®
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>mounted</span><span class=p>(</span><span class=nx>el</span><span class=p>,</span> <span class=nx>bindings</span><span class=p>,</span> <span class=nx>vnode</span><span class=p>,</span> <span class=nx>preVnode</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>el</span><span class=o>?</span><span class=p>.</span><span class=nx>focus</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>mount</span><span class=p>(</span><span class=s1>&#39;#app&#39;</span><span class=p>)</span>
</span></span></code></pre></div><h5 id=è¿›è¡ŒæŠ½å–>è¿›è¡ŒæŠ½å–<a hidden class=anchor aria-hidden=true href=#è¿›è¡ŒæŠ½å–>#</a></h5><ul><li>æ³¨å†Œdirectivesæ–‡ä»¶å¤¹</li><li>/directives/format-time.js</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=nx>dayjs</span> <span class=nx>from</span> <span class=s1>&#39;dayjs&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=kd>function</span><span class=p>(</span><span class=nx>app</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>app</span><span class=p>.</span><span class=nx>directive</span><span class=p>(</span><span class=s2>&#34;format-time&#34;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>created</span><span class=p>(</span><span class=nx>el</span><span class=p>,</span> <span class=nx>bindings</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>bindings</span><span class=p>.</span><span class=nx>formatString</span> <span class=o>=</span> <span class=s2>&#34;YYYY-MM-DD HH:mm:ss&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>bindings</span><span class=p>.</span><span class=nx>value</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>bindings</span><span class=p>.</span><span class=nx>formatString</span> <span class=o>=</span> <span class=nx>bindings</span><span class=p>.</span><span class=nx>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>mounted</span><span class=p>(</span><span class=nx>el</span><span class=p>,</span> <span class=nx>bindings</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>textContent</span> <span class=o>=</span> <span class=nx>el</span><span class=p>.</span><span class=nx>textContent</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=kd>let</span> <span class=nx>timestamp</span> <span class=o>=</span> <span class=nb>parseInt</span><span class=p>(</span><span class=nx>textContent</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>textContent</span><span class=p>.</span><span class=nx>length</span> <span class=o>===</span> <span class=mi>10</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>timestamp</span> <span class=o>=</span> <span class=nx>timestamp</span> <span class=o>*</span> <span class=mi>1000</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=nx>el</span><span class=p>.</span><span class=nx>textContent</span> <span class=o>=</span> <span class=nx>dayjs</span><span class=p>(</span><span class=nx>timestamp</span><span class=p>).</span><span class=nx>format</span><span class=p>(</span><span class=nx>bindings</span><span class=p>.</span><span class=nx>formatString</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>}</span> 
</span></span></code></pre></div><ul><li>/directives/index.js</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=nx>registerFormatTime</span> <span class=nx>from</span> <span class=s1>&#39;./format-time&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=kd>function</span> <span class=nx>registerDirectives</span><span class=p>(</span><span class=nx>app</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>registerFormatTime</span><span class=p>(</span><span class=nx>app</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><ul><li>mian.js</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=nx>registerDirectives</span> <span class=nx>from</span> <span class=s1>&#39;./directives&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>registerDirectives</span><span class=p>(</span><span class=nx>app</span><span class=p>);</span>
</span></span></code></pre></div><h4 id=setup-1>setup<a hidden class=anchor aria-hidden=true href=#setup-1>#</a></h4><h5 id=å‡½æ•°>å‡½æ•°<a hidden class=anchor aria-hidden=true href=#å‡½æ•°>#</a></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>h1</span> <span class=na>v</span><span class=nt>-fomat-time</span><span class=err>=&#34;</span><span class=na>timeFormatType</span><span class=err>&#34;</span><span class=p>&gt;{{</span> <span class=nx>timeStamp</span> <span class=p>}}&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>ref</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>dayJs</span> <span class=nx>from</span> <span class=s1>&#39;dayjs&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>directives</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;fomat-time&#39;</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>mounted</span><span class=p>(</span><span class=nx>el</span><span class=p>,</span> <span class=nx>bindings</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// é»˜è®¤æ˜¾ç¤ºæ—¶é—´ç±»å‹
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kd>let</span> <span class=nx>formatType</span> <span class=o>=</span> <span class=nx>bindings</span><span class=p>.</span><span class=nx>value</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>formatType</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1>// è½¬æ¢æˆnumberç±»å‹
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kd>let</span> <span class=nx>time</span> <span class=o>=</span> <span class=nx>el</span><span class=p>.</span><span class=nx>textContent</span><span class=p>.</span><span class=nx>length</span> <span class=o>===</span> <span class=mi>10</span> <span class=o>?</span> <span class=nx>el</span><span class=p>.</span><span class=nx>textContent</span> <span class=o>*</span> <span class=mi>1000</span> <span class=o>:</span> <span class=nx>el</span><span class=p>.</span><span class=nx>textContent</span> <span class=o>*</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=c1>// æ ¼å¼åŒ–
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>el</span><span class=p>.</span><span class=nx>textContent</span> <span class=o>=</span> <span class=nx>dayJs</span><span class=p>(</span><span class=nx>time</span><span class=p>).</span><span class=nx>format</span><span class=p>(</span><span class=nx>formatType</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>setInterval</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=c1>// å®šæ—¶å™¨
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=nx>time</span> <span class=o>=</span> <span class=nx>dayJs</span><span class=p>(</span><span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>valueOf</span><span class=p>()).</span><span class=nx>format</span><span class=p>(</span><span class=nx>formatType</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=nx>el</span><span class=p>.</span><span class=nx>textContent</span> <span class=o>=</span> <span class=nx>time</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span> <span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// è®¾ç½®åˆå§‹æ—¶é—´æˆ³
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>timeStamp</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>valueOf</span><span class=p>())</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>timeFormatType</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=s1>&#39;YYYY-MM-DD HH:mm:ss&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>timeStamp</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>timeFormatType</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>style</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=nx>h1</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>display</span><span class=o>:</span> <span class=nx>inline</span><span class=o>-</span><span class=nx>block</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>color</span><span class=o>:</span> <span class=nx>transparent</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=o>-</span><span class=nx>webkit</span><span class=o>-</span><span class=nx>background</span><span class=o>-</span><span class=nx>clip</span><span class=o>:</span> <span class=nx>text</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>background</span><span class=o>-</span><span class=nx>image</span><span class=o>:</span> <span class=nx>linear</span><span class=o>-</span><span class=nx>gradient</span><span class=p>(</span><span class=nx>to</span> <span class=nx>right</span><span class=p>,</span> <span class=nx>red</span><span class=p>,</span> <span class=nx>blue</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>style</span><span class=p>&gt;</span>
</span></span></code></pre></div><h5 id=è¯­æ³•ç³–>è¯­æ³•ç³–<a hidden class=anchor aria-hidden=true href=#è¯­æ³•ç³–>#</a></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>h1</span> <span class=na>v</span><span class=nt>-fomat-time</span><span class=err>=&#34;</span><span class=na>timeFormatType</span><span class=err>&#34;</span><span class=p>&gt;{{</span> <span class=nx>timeStamp</span> <span class=p>}}&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>ref</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>dayJs</span> <span class=nx>from</span> <span class=s1>&#39;dayjs&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=c1>// è®¾ç½®åˆå§‹æ—¶é—´æˆ³
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>timeStamp</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>valueOf</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=c1>// è®¾ç½®åˆå§‹æ—¶é—´æ ¼å¼
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>timeFormatType</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=s1>&#39;YYYY-MM-DD HH:mm:ss&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=c1>// è‡ªå®šä¹‰æ—¶é—´æ ¼å¼åŒ–æŒ‡ä»¤
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>vFomatTime</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>mounted</span><span class=p>(</span><span class=nx>el</span><span class=p>,</span> <span class=nx>bindings</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// è·å–å®šä¹‰çš„æ—¶é—´æ ¼å¼
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=p>{</span> <span class=nx>value</span><span class=o>:</span> <span class=nx>timeFormatType</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>bindings</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// è½¬æ¢æˆnumberç±»å‹
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>let</span> <span class=nx>time</span> <span class=o>=</span> <span class=nx>el</span><span class=p>.</span><span class=nx>textContent</span><span class=p>.</span><span class=nx>length</span> <span class=o>===</span> <span class=mi>10</span> <span class=o>?</span> <span class=nx>el</span><span class=p>.</span><span class=nx>textContent</span> <span class=o>*</span> <span class=mi>1000</span> <span class=o>:</span> <span class=nx>el</span><span class=p>.</span><span class=nx>textContent</span> <span class=o>*</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ä½¿ç”¨dayJsï¼Œæ ¹æ®æ—¶é—´æ ¼å¼æ¥æ ¼å¼åŒ–æ—¶é—´,å¹¶èµ‹å€¼ç»™el
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>el</span><span class=p>.</span><span class=nx>textContent</span> <span class=o>=</span> <span class=nx>dayJs</span><span class=p>(</span><span class=nx>time</span><span class=p>).</span><span class=nx>format</span><span class=p>(</span><span class=nx>timeFormatType</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// å®šæ—¶å™¨ï¼Œæ¯éš”ä¸€ç§’ï¼Œé‡æ–°èµ‹å€¼ç»™el
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>setInterval</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>time</span> <span class=o>=</span> <span class=nx>dayJs</span><span class=p>(</span><span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>valueOf</span><span class=p>()).</span><span class=nx>format</span><span class=p>(</span><span class=nx>timeFormatType</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nx>el</span><span class=p>.</span><span class=nx>textContent</span> <span class=o>=</span> <span class=nx>time</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span> <span class=mi>1000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>style</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=nx>h1</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>display</span><span class=o>:</span> <span class=nx>inline</span><span class=o>-</span><span class=nx>block</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>color</span><span class=o>:</span> <span class=nx>transparent</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=o>-</span><span class=nx>webkit</span><span class=o>-</span><span class=nx>background</span><span class=o>-</span><span class=nx>clip</span><span class=o>:</span> <span class=nx>text</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>background</span><span class=o>-</span><span class=nx>clip</span><span class=o>:</span> <span class=nx>text</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>background</span><span class=o>-</span><span class=nx>image</span><span class=o>:</span> <span class=nx>linear</span><span class=o>-</span><span class=nx>gradient</span><span class=p>(</span><span class=nx>to</span> <span class=nx>right</span><span class=p>,</span> <span class=nx>red</span><span class=p>,</span> <span class=nx>blue</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>style</span><span class=p>&gt;</span>
</span></span></code></pre></div><h2 id=å†…ç½®ç»„ä»¶>å†…ç½®ç»„ä»¶<a hidden class=anchor aria-hidden=true href=#å†…ç½®ç»„ä»¶>#</a></h2><h3 id=teleport>Teleport<a hidden class=anchor aria-hidden=true href=#teleport>#</a></h3><blockquote><p><code>&lt;Teleport></code> æ˜¯ä¸€ä¸ªå†…ç½®ç»„ä»¶ï¼Œå®ƒå¯ä»¥å°†ä¸€ä¸ªç»„ä»¶å†…éƒ¨çš„ä¸€éƒ¨åˆ†æ¨¡æ¿â€œä¼ é€â€åˆ°è¯¥ç»„ä»¶çš„ DOM ç»“æ„å¤–å±‚çš„ä½ç½®å»ã€‚</p></blockquote><ul><li>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¸Œæœ›ç»„ä»¶ä¸æ˜¯æŒ‚è½½åœ¨å½“å‰ç»„ä»¶æ ‘ä¸Šçš„ï¼Œå¯èƒ½æ˜¯ç§»åŠ¨åˆ°Vue appä¹‹å¤–çš„å…¶ä»–ä½ç½®<ul><li>æ¯”å¦‚ç§»åŠ¨åˆ°bodyå…ƒç´ ä¸Šï¼Œæˆ–è€…æˆ‘ä»¬æœ‰å…¶ä»–çš„div#appä¹‹å¤–çš„å…ƒç´ ä¸Š</li><li>å¯ä»¥é€šè¿‡teleportæ¥å®Œæˆ</li></ul></li><li>teleport ç¿»è¯‘è¿‡æ¥æ˜¯å¿ƒçµä¼ è¾“ã€è¿œè·ç¦»è¿è¾“çš„æ„æ€ï¼Œæœ‰ä¸¤ä¸ªå±æ€§<ul><li>to : æŒ‡å®šå°†å…¶ä¸­çš„å†…å®¹ç§»åŠ¨åˆ°çš„ç›®æ ‡å…ƒç´ ï¼Œå¯ä»¥ä½¿ç”¨é€‰æ‹©å™¨</li><li>disabled : æ˜¯å¦ç¦ç”¨ teleport çš„åŠŸèƒ½</li></ul></li></ul><h4 id=åŸºæœ¬ä½¿ç”¨-4>åŸºæœ¬ä½¿ç”¨<a hidden class=anchor aria-hidden=true href=#åŸºæœ¬ä½¿ç”¨-4>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;app-view&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!--</span> <span class=nx>æŠŠè¯¥ç»„ä»¶æŒ‚è½½åˆ°bodyå…ƒç´ ä¸Š</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>teleport</span> <span class=na>to</span><span class=o>=</span><span class=s>&#34;body&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;</span><span class=nx>Teleport</span><span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>teleport</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>style</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=nx>h1</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>display</span><span class=o>:</span> <span class=nx>inline</span><span class=o>-</span><span class=nx>block</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>color</span><span class=o>:</span> <span class=nx>transparent</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=o>-</span><span class=nx>webkit</span><span class=o>-</span><span class=nx>background</span><span class=o>-</span><span class=nx>clip</span><span class=o>:</span> <span class=nx>text</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>background</span><span class=o>-</span><span class=nx>clip</span><span class=o>:</span> <span class=nx>text</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>background</span><span class=o>-</span><span class=nx>image</span><span class=o>:</span> <span class=nx>linear</span><span class=o>-</span><span class=nx>gradient</span><span class=p>(</span><span class=nx>to</span> <span class=nx>right</span><span class=p>,</span> <span class=nx>red</span><span class=p>,</span> <span class=nx>green</span><span class=p>,</span> <span class=nx>pink</span><span class=p>,</span> <span class=nx>yellow</span><span class=p>,</span> <span class=nx>blue</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>style</span><span class=p>&gt;</span>
</span></span></code></pre></div><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202312190008149.png><img src=https://qiniu.waite.wang/202312190008149.png alt=image-20231219000840061></a></div></p><h4 id=æŒ‚è½½åˆ°appä¹‹å¤–çš„æŒ‡å®šå…ƒç´ ä¸Š>æŒ‚è½½åˆ°#appä¹‹å¤–çš„æŒ‡å®šå…ƒç´ ä¸Š<a hidden class=anchor aria-hidden=true href=#æŒ‚è½½åˆ°appä¹‹å¤–çš„æŒ‡å®šå…ƒç´ ä¸Š>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;app&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;star&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;b&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;c&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!--</span> <span class=nx>æŠŠè¯¥ç»„ä»¶æŒ‚è½½åˆ°</span><span class=err>#</span><span class=nx>starå…ƒç´ ä¸Š</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>teleport</span> <span class=na>to</span><span class=o>=</span><span class=s>&#34;#star&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;</span><span class=nx>Teleport</span><span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>teleport</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!--</span> <span class=nx>æŠŠè¯¥ç»„ä»¶æŒ‚è½½åˆ°</span><span class=p>.</span><span class=nx>bå…ƒç´ ä¸Š</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>teleport</span> <span class=na>to</span><span class=o>=</span><span class=s>&#34;.b&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;</span><span class=nx>Teleport123</span><span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>teleport</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!--</span> <span class=nx>æ–‡æ¡£ä¸Šè¯´æ˜¯æŒ‚è½½åˆ°</span><span class=err>#</span><span class=nx>appä¹‹å¤–çš„å…ƒç´ </span><span class=err>ï¼Œ</span><span class=nx>å¯æ˜¯æˆ‘å‘ç°è‡ªå·±å†…éƒ¨çš„ä¹Ÿå¯ä»¥æŒ‡å®š</span><span class=err>ï¼Œ</span><span class=nx>emmmm</span><span class=err>ï¼Œ</span><span class=nx>ä¼˜å…ˆæ˜¯ä»å†…éƒ¨ä¸€å±‚å±‚å¾€å¤–æ‰¾çš„</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!--</span> <span class=nx>æŠŠè¯¥ç»„ä»¶æŒ‚è½½åˆ°</span><span class=p>.</span><span class=nx>cå…ƒç´ ä¸Š</span><span class=p>...</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>teleport</span> <span class=na>to</span><span class=o>=</span><span class=s>&#34;.c&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;</span><span class=nx>Teleport123</span><span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>teleport</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>style</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=nx>h1</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>display</span><span class=o>:</span> <span class=nx>inline</span><span class=o>-</span><span class=nx>block</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>color</span><span class=o>:</span> <span class=nx>transparent</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=o>-</span><span class=nx>webkit</span><span class=o>-</span><span class=nx>background</span><span class=o>-</span><span class=nx>clip</span><span class=o>:</span> <span class=nx>text</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>background</span><span class=o>-</span><span class=nx>clip</span><span class=o>:</span> <span class=nx>text</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>background</span><span class=o>-</span><span class=nx>image</span><span class=o>:</span> <span class=nx>linear</span><span class=o>-</span><span class=nx>gradient</span><span class=p>(</span><span class=nx>to</span> <span class=nx>right</span><span class=p>,</span> <span class=nx>red</span><span class=p>,</span> <span class=nx>green</span><span class=p>,</span> <span class=nx>pink</span><span class=p>,</span> <span class=nx>yellow</span><span class=p>,</span> <span class=nx>blue</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>style</span><span class=p>&gt;</span>
</span></span></code></pre></div><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202312190013634.png><img src=https://qiniu.waite.wang/202312190013634.png alt=image-20231219001340177></a></div></p><h4 id=å¤šä¸ªteleport>å¤šä¸ªTeleport<a hidden class=anchor aria-hidden=true href=#å¤šä¸ªteleport>#</a></h4><blockquote><p><strong>ä¼šåˆå¹¶ï¼Œè°å…ˆè°åœ¨å‰é¢</strong></p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;star&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;app-view&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!--</span> <span class=nx>æŠŠè¯¥ç»„ä»¶æŒ‚è½½åˆ°</span><span class=err>#</span><span class=nx>starå…ƒç´ ä¸Š</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>teleport</span> <span class=na>to</span><span class=o>=</span><span class=s>&#34;#star&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;</span><span class=nx>Teleport</span><span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>teleport</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!--</span> <span class=nx>æŠŠè¯¥ç»„ä»¶æŒ‚è½½åˆ°</span><span class=err>#</span><span class=nx>starå…ƒç´ ä¸Š</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>teleport</span> <span class=na>to</span><span class=o>=</span><span class=s>&#34;#star&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;</span><span class=nx>Teleport123</span><span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>teleport</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>style</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=nx>h1</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>display</span><span class=o>:</span> <span class=nx>inline</span><span class=o>-</span><span class=nx>block</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>color</span><span class=o>:</span> <span class=nx>transparent</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=o>-</span><span class=nx>webkit</span><span class=o>-</span><span class=nx>background</span><span class=o>-</span><span class=nx>clip</span><span class=o>:</span> <span class=nx>text</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>background</span><span class=o>-</span><span class=nx>clip</span><span class=o>:</span> <span class=nx>text</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>background</span><span class=o>-</span><span class=nx>image</span><span class=o>:</span> <span class=nx>linear</span><span class=o>-</span><span class=nx>gradient</span><span class=p>(</span><span class=nx>to</span> <span class=nx>right</span><span class=p>,</span> <span class=nx>red</span><span class=p>,</span> <span class=nx>green</span><span class=p>,</span> <span class=nx>pink</span><span class=p>,</span> <span class=nx>yellow</span><span class=p>,</span> <span class=nx>blue</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>style</span><span class=p>&gt;</span>
</span></span></code></pre></div><p><div class=post-img-view><a data-fancybox=gallery href=https://qiniu.waite.wang/202312190016061.png><img src=https://qiniu.waite.wang/202312190016061.png alt=image-20231219001638121></a></div></p><h3 id=å…¶ä»–>å…¶ä»–<a hidden class=anchor aria-hidden=true href=#å…¶ä»–>#</a></h3><blockquote><p><a href=https://ladder.waite.wang/web/vue/learn/components/%E5%BC%82%E6%AD%A5%E7%BB%84%E4%BB%B6.html>å¼‚æ­¥ç»„ä»¶ defineAsyncComponent/ Suspense : å®éªŒç‰¹æ€§</a></p><p><a href=https://ladder.waite.wang/web/vue/learn/components/%E5%8A%A8%E6%80%81%E7%BB%84%E4%BB%B6.html>åŠ¨æ€ç»„ä»¶ : component</a></p></blockquote><h2 id=vueæ’ä»¶>Vueæ’ä»¶<a hidden class=anchor aria-hidden=true href=#vueæ’ä»¶>#</a></h2><blockquote><p><a href=https://cn.vuejs.org/guide/reusability/plugins.html#plugins target=_blank>https://cn.vuejs.org/guide/reusability/plugins.html#plugins</a></p></blockquote><ul><li>é€šå¸¸æˆ‘ä»¬å‘Vueå…¨å±€æ·»åŠ ä¸€äº›åŠŸèƒ½æ—¶ï¼Œä¼šé‡‡ç”¨æ’ä»¶çš„æ¨¡å¼ï¼Œå®ƒæœ‰ä¸¤ç§ç¼–å†™æ–¹å¼ï¼š<ul><li>å¯¹è±¡ç±»å‹ï¼šä¸€ä¸ªå¯¹è±¡ï¼Œä½†æ˜¯å¿…é¡»åŒ…å«ä¸€ä¸ª <code>install </code>çš„å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šåœ¨å®‰è£…æ’ä»¶æ—¶æ‰§è¡Œï¼›</li><li>å‡½æ•°ç±»å‹ï¼šä¸€ä¸ª<code>function</code>ï¼Œè¿™ä¸ªå‡½æ•°ä¼šåœ¨å®‰è£…æ’ä»¶æ—¶è‡ªåŠ¨æ‰§è¡Œï¼›</li></ul></li><li>æ’ä»¶å¯ä»¥å®Œæˆçš„åŠŸèƒ½æ²¡æœ‰é™åˆ¶ï¼Œæ¯”å¦‚ä¸‹é¢çš„å‡ ç§éƒ½æ˜¯å¯ä»¥çš„ï¼š<ul><li>æ·»åŠ å…¨å±€æ–¹æ³•æˆ–è€…<code>property</code>ï¼Œé€šè¿‡æŠŠå®ƒä»¬æ·»åŠ åˆ° <code>config.globalProperties</code> ä¸Šå®ç°ï¼›</li><li>æ·»åŠ å…¨å±€èµ„æºï¼šæŒ‡ä»¤/è¿‡æ»¤å™¨/è¿‡æ¸¡ç­‰ï¼›</li><li>é€šè¿‡å…¨å±€ <code>mixin </code>æ¥æ·»åŠ ä¸€äº›ç»„ä»¶é€‰é¡¹ï¼›</li><li>ä¸€ä¸ªåº“ï¼Œæä¾›è‡ªå·±çš„ APIï¼ŒåŒæ—¶æä¾›ä¸Šé¢æåˆ°çš„ä¸€ä¸ªæˆ–å¤šä¸ªåŠŸèƒ½ï¼›</li></ul></li></ul><h3 id=å¯¹è±¡ç±»å‹>å¯¹è±¡ç±»å‹<a hidden class=anchor aria-hidden=true href=#å¯¹è±¡ç±»å‹>#</a></h3><blockquote><p>å¯¹è±¡ç±»å‹ï¼šä¸€ä¸ªå¯¹è±¡ï¼Œä½†æ˜¯å¿…é¡»åŒ…å«ä¸€ä¸ª install çš„å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šåœ¨å®‰è£…æ’ä»¶æ—¶æ‰§è¡Œ</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>install</span><span class=p>(</span><span class=nx>app</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;å¯¹è±¡æ–¹å¼ï¼Œæ’ä»¶è¢«è°ƒç”¨äº†&#39;</span><span class=p>,</span> <span class=nx>app</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><h3 id=å‡½æ•°ç±»å‹>å‡½æ•°ç±»å‹<a hidden class=anchor aria-hidden=true href=#å‡½æ•°ç±»å‹>#</a></h3><blockquote><p>å‡½æ•°ç±»å‹ï¼šä¸€ä¸ªfunctionï¼Œè¿™ä¸ªå‡½æ•°ä¼šåœ¨å®‰è£…æ’ä»¶æ—¶è‡ªåŠ¨æ‰§è¡Œ</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=kd>function</span><span class=p>(</span><span class=nx>app</span><span class=p>){</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;å‡½æ•°æ–¹å¼ï¼Œæ’ä»¶è¢«è°ƒç”¨äº†&#39;</span><span class=p>,</span> <span class=nx>app</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div><h3 id=æ”¹å†™è‡ªå®šä¹‰æŒ‡ä»¤>æ”¹å†™è‡ªå®šä¹‰æŒ‡ä»¤<a hidden class=anchor aria-hidden=true href=#æ”¹å†™è‡ªå®šä¹‰æŒ‡ä»¤>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>createApp</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>App</span> <span class=nx>from</span> <span class=s1>&#39;./App.vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>// 1. å¯¼å…¥æŒ‡ä»¤æ–¹æ³•
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>installDirectives</span> <span class=nx>from</span> <span class=s1>&#39;./directives&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=c1>// 2ã€‚ æ³¨å†Œæ‰€æœ‰æŒ‡ä»¤
</span></span></span><span class=line><span class=cl><span class=c1>// installDirectives(app);
</span></span></span><span class=line><span class=cl><span class=c1></span> 
</span></span><span class=line><span class=cl><span class=c1>// è¿™æ ·ä½¿ç”¨useæ–¹æ³•æ³¨å†ŒæŒ‡ä»¤ï¼Œå› ä¸ºä¼ å…¥çš„æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ‰€ä»¥ä¼šè‡ªåŠ¨æ‰§è¡Œ
</span></span></span><span class=line><span class=cl><span class=c1>// å¹¶ä¸”ä¼šæŠŠappå®ä¾‹ä¼ å…¥ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨å‡½æ•°å†…éƒ¨æ³¨å†ŒæŒ‡ä»¤äº†
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>createApp</span><span class=p>(</span><span class=nx>App</span><span class=p>).</span><span class=nx>use</span><span class=p>(</span><span class=nx>installDirectives</span><span class=p>).</span><span class=nx>mount</span><span class=p>(</span><span class=s1>&#39;#app&#39;</span><span class=p>);</span>
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://waite.wang/tags/vue3/>Vue3</a></li></ul><nav class=paginav><a class=prev href=https://waite.wang/posts/vue/vue-project-construction-specification/><span class=title>Â« ä¸Šä¸€é¡µ</span><br><span>vue é¡¹ç›®è§„èŒƒè®¾ç½®</span>
</a><a class=next href=https://waite.wang/posts/tools/qiniucloud-typora-picgo/><span class=title>ä¸‹ä¸€é¡µ Â»</span><br><span>ä¸ƒç‰›äº‘ + Typora + PicGo</span></a></nav></footer><script src=https://utteranc.es/client.js repo=Waite0603/HugoBlog issue-term=pathname theme=github-light crossorigin=anonymous async></script></article></main><footer class=footer><span><a href=https://beian.miit.gov.cn/ target=_blank rel="noopener noreferrer">ç²¤ ICP å¤‡ 2022028437 å·</a></span><br><span>Copyright &copy; 2018 - 2025 By <a href=https://waite.wang/>Waite</a>, All Rights
Reserved.</span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script src=/js/jquery-3.5.1.min.js></script><link rel=stylesheet href=/css/jquery.fancybox.min.css><script src=/js/jquery.fancybox.min.js></script></body></html>